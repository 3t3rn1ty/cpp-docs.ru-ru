---
title: "_CrtSetAllocHook | Документы Майкрософт"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- cpp-standard-libraries
ms.tgt_pltfrm: 
ms.topic: article
apiname:
- _CrtSetAllocHook
apilocation:
- msvcrt.dll
- msvcr80.dll
- msvcr90.dll
- msvcr100.dll
- msvcr100_clr0400.dll
- msvcr110.dll
- msvcr110_clr0400.dll
- msvcr120.dll
- msvcr120_clr0400.dll
- ucrtbase.dll
apitype: DLLExport
f1_keywords:
- _CrtSetAllocHook
- CrtSetAllocHook
dev_langs:
- C++
helpviewer_keywords:
- _CrtSetAllocHook function
- CrtSetAllocHook function
ms.assetid: 405df37b-2fd1-42c8-83bc-90887f17f29d
caps.latest.revision: 
author: corob-msft
ms.author: corob
manager: ghogen
ms.workload:
- cplusplus
ms.openlocfilehash: 6168081aff668a3b613b4844be3c50b841f5bc07
ms.sourcegitcommit: 185e11ab93af56ffc650fe42fb5ccdf1683e3847
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2018
---
# <a name="crtsetallochook"></a>_CrtSetAllocHook
Устанавливает определяемую клиентом функцию выделения памяти путем ее прикрепления к отладочному процессу выделения памяти среды выполнения языка C (только отладочная версия).  
  
## <a name="syntax"></a>Синтаксис  
  
```  
_CRT_ALLOC_HOOK _CrtSetAllocHook(  
   _CRT_ALLOC_HOOK allocHook   
);  
```  
  
#### <a name="parameters"></a>Параметры  
 `allocHook`  
 Новая, определенная клиентом функция выделения памяти, которую требуется прикрепить к отладочному процессу выделения памяти среды выполнения C.  
  
## <a name="return-value"></a>Возвращаемое значение  
 Возвращает ранее определенную функцию-обработчик выделения памяти или значение `NULL`, если параметр `allocHook` имеет значение `NULL`.  
  
## <a name="remarks"></a>Примечания  
 Функция `_CrtSetAllocHook` позволяет приложению прикрепить свою собственную функцию выделения памяти к процессу выделения памяти в отладочной библиотеке среды выполнения C. В результате каждый вызов функции отладочного выделения памяти для выделения, перераспределения или освобождения блока памяти запускает вызов функции-обработчика приложения. Функция `_CrtSetAllocHook` предоставляет приложению простой метод проверки того, как приложение обрабатывает ситуации недостатка памяти, возможность проверять шаблоны выделения памяти и возможность записывать в журнал данные выделения памяти для дальнейшего анализа. Если функция [_DEBUG](../../c-runtime-library/debug.md) не определена, вызовы `_CrtSetAllocHook` удаляются на этапе предварительной обработки.  
  
 Функция `_CrtSetAllocHook` устанавливает новую определенную клиентом функцию выделения памяти, указанную в параметре `allocHook`, и возвращает ранее определенную функцию-обработчик. В следующем примере показано, как должен объявляться прототип определяемого клиентом обработчика выделения памяти:  
  
```  
int YourAllocHook( int allocType, void *userData, size_t size, int   
blockType, long requestNumber, const unsigned char *filename, int   
lineNumber);  
```  
  
 Аргумент `allocType` определяет тип операции выделения памяти `(_HOOK_ALLOC`, `_HOOK_REALLOC` и `_HOOK_FREE`), которая запустила вызов функции-обработчика выделения памяти. Если запускающим типом выделения памяти является `_HOOK_FREE`, параметр `userData` представляет собой указатель на раздел пользовательских данных блока памяти, который должен быть освобожден. Однако если запускающим типом выделения памяти является `_HOOK_ALLOC` или `_HOOK_REALLOC`, параметр `userData` имеет значение `NULL`, поскольку блок памяти еще не выделен.  
  
 Параметр `size` определяет размер блока памяти в байтах, параметр `blockType` указывает тип блока памяти, параметр `requestNumber` является порядковым номером объекта выделения блока памяти, и, если доступны, параметры `filename` и `lineNumber` указывают исходное имя файла и номер строки, где был запущен процесс выделения.  
  
 После обработки функция-обработчик должна возвращать логическое значение, которое указывает главному процессу выделения памяти среды выполнения C, как продолжить выполнение. Когда функция-обработчик требует, чтобы главный процесс выделения памяти продолжал выполнение, как если бы функция-обработчик не вызывалась, функция-обработчик должна возвращать значение `TRUE`. Это приводит к запуску выполнения исходной операции выделения памяти. С помощью этой реализации функция-обработчик может получать и сохранять данные о выделении памяти для дальнейшего анализа, не препятствуя текущей операции выделения памяти и не изменяя состояние отладочной кучи.  
  
 Если функция-обработчик требует, чтобы главный процесс выделения продолжал выполнение, как если бы операция выделения памяти была запущена и завершилась неудачей, функция-обработчик должна возвращать значение `FALSE`. С помощью этой реализации функция-обработчик может имитировать широкий спектр состояний памяти и состояний отладочной кучи для проверки обработки приложением каждой ситуации.  
  
 Чтобы удалить функцию-обработчик, передайте значение `NULL` в функцию `_CrtSetAllocHook`.  
  
 Дополнительные сведения о том, как можно использовать функцию `_CrtSetAllocHook` с другими функциями управления памятью или как создавать собственные определенные клиентом функции-обработчики, см. в разделе [Написание функций отладочных ловушек](/visualstudio/debugger/debug-hook-function-writing).  
  
> [!NOTE]
>  Функция `_CrtSetAllocHook` не поддерживается с параметром `/clr:pure`. Параметры компилятора **/CLR: pure** и **/CLR: safe** в Visual Studio 2015 не рекомендуется использовать.  
  
## <a name="requirements"></a>Требования  
  
|Подпрограмма|Обязательный заголовок|  
|-------------|---------------------|  
|`_CrtSetAllocHook`|\<crtdbg.h>|  
  
 Дополнительные сведения о совместимости см. в разделе [Совместимость](../../c-runtime-library/compatibility.md) во введении.  
  
## <a name="libraries"></a>Библиотеки  
 Только отладочные версии [библиотек времени выполнения языка C](../../c-runtime-library/crt-library-features.md).  
  
## <a name="example"></a>Пример  
 Пример использования функции `_CrtSetAllocHook` см. в разделе [crt_dbg2](https://github.com/Microsoft/VCSamples/tree/master/VC2010Samples/crt/crt_dbg2).  
  
## <a name="see-also"></a>См. также  
 [Подпрограммы отладки](../../c-runtime-library/debug-routines.md)   
 [_CrtGetAllocHook](../../c-runtime-library/reference/crtgetallochook.md)
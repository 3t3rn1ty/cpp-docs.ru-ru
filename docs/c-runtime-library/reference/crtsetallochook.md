---
title: _CrtSetAllocHook | Документы Майкрософт
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-standard-libraries
ms.topic: reference
apiname:
- _CrtSetAllocHook
apilocation:
- msvcrt.dll
- msvcr80.dll
- msvcr90.dll
- msvcr100.dll
- msvcr100_clr0400.dll
- msvcr110.dll
- msvcr110_clr0400.dll
- msvcr120.dll
- msvcr120_clr0400.dll
- ucrtbase.dll
apitype: DLLExport
f1_keywords:
- _CrtSetAllocHook
- CrtSetAllocHook
dev_langs:
- C++
helpviewer_keywords:
- _CrtSetAllocHook function
- CrtSetAllocHook function
ms.assetid: 405df37b-2fd1-42c8-83bc-90887f17f29d
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: 8d86072ceb41b966adfca298152b6209450aace3
ms.sourcegitcommit: be2a7679c2bd80968204dee03d13ca961eaa31ff
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="crtsetallochook"></a>_CrtSetAllocHook

Устанавливает определяемую клиентом функцию выделения памяти путем ее прикрепления к отладочному процессу выделения памяти среды выполнения языка C (только отладочная версия).

## <a name="syntax"></a>Синтаксис

```C
_CRT_ALLOC_HOOK _CrtSetAllocHook(
   _CRT_ALLOC_HOOK allocHook
);
```

### <a name="parameters"></a>Параметры

*allocHook*<br/>
Новая, определенная клиентом функция выделения памяти, которую требуется прикрепить к отладочному процессу выделения памяти среды выполнения C.

## <a name="return-value"></a>Возвращаемое значение

Возвращает распределения, ранее определенную функцию-обработчик, или **NULL** Если *allocHook* — **NULL**.

## <a name="remarks"></a>Примечания

**_CrtSetAllocHook** позволяет приложению прикрепить свою собственную функцию выделения процессу выделения памяти C во время выполнения отладки библиотеки. В результате каждый вызов функции отладочного выделения памяти для выделения, перераспределения или освобождения блока памяти запускает вызов функции-обработчика приложения. **_CrtSetAllocHook** предоставляет приложению простой метод проверки как приложение обрабатывает ситуации недостатка памяти, возможность проверять шаблоны выделения памяти и возможность записывать в журнал данные выделения памяти для более поздней версии анализ. Когда [_DEBUG](../../c-runtime-library/debug.md) не определен, вызовы **_CrtSetAllocHook** удаляются на этапе предварительной обработки.

**_CrtSetAllocHook** функция устанавливает новый определяемую клиентом выделения функции, указанной в *allocHook* и возвращает ранее определенную функцию-обработчик. В следующем примере показано, как должен объявляться прототип определяемого клиентом обработчика выделения памяти:

```C
int YourAllocHook( int allocType, void *userData, size_t size,
                   int blockType, long requestNumber,
                   const unsigned char *filename, int lineNumber);
```

**AllocType** аргумент задает тип операции выделения памяти (**_HOOK_ALLOC**, **_HOOK_REALLOC**, и **_HOOK_FREE**), запустила вызов функции-ловушки выделения. Если запускающим типом выделения памяти имеет **_HOOK_FREE**, *userData* — это указатель на раздел пользовательских данных блока памяти, который должен быть освобожден. Однако если запускающим типом выделения памяти равно **_HOOK_ALLOC** или **_HOOK_REALLOC**, *userData* — **NULL** поскольку блок памяти есть еще не выделен.

*размер* указывает объем памяти блока в байтах, *blockType* указывает тип блока памяти, *requestNumber* имеет порядковый номер выделения объекта блока памяти и, если доступно, *filename* и **lineNumber** укажите исходный файл имя и номер строки где была инициирована процесс выделения.

После обработки функция-обработчик должна возвращать логическое значение, которое указывает главному процессу выделения памяти среды выполнения C, как продолжить выполнение. Когда функция-обработчик требует главный процесс выделения продолжал как если бы никогда не была вызвана функция-обработчик, функция-обработчик должна возвращать **TRUE**. Это приводит к запуску выполнения исходной операции выделения памяти. С помощью этой реализации функция-обработчик может получать и сохранять данные о выделении памяти для дальнейшего анализа, не препятствуя текущей операции выделения памяти и не изменяя состояние отладочной кучи.

Когда функция-обработчик требует главный процесс выделения, чтобы продолжить, так как если бы операция выделения памяти был вызван и его не удалось, а затем функция-обработчик должна возвращать **FALSE**. С помощью этой реализации функция-обработчик может имитировать широкий спектр состояний памяти и состояний отладочной кучи для проверки обработки приложением каждой ситуации.

Чтобы очистить функцию-обработчик, передайте **NULL** для **_CrtSetAllocHook**.

Дополнительные сведения о том, как **_CrtSetAllocHook** можно использовать другие функции управления памятью или написать собственные функции-обработчики, определяемую клиентом см. в разделе [отладки написание функций ловушка](/visualstudio/debugger/debug-hook-function-writing).

> [!NOTE]
> **_CrtSetAllocHook** не поддерживается в **/CLR: pure**. **/CLR: pure** и **/CLR: safe** параметры компилятора признаны устаревшими в Visual Studio 2015 и удалена в Visual Studio 2017 г.

## <a name="requirements"></a>Требования

|Подпрограмма|Обязательный заголовок|
|-------------|---------------------|
|**_CrtSetAllocHook**|\<crtdbg.h>|

Дополнительные сведения о совместимости см. в разделе [Совместимость](../../c-runtime-library/compatibility.md).

## <a name="libraries"></a>Библиотеки

Только отладочные версии [библиотек времени выполнения языка C](../../c-runtime-library/crt-library-features.md).

## <a name="example"></a>Пример

Пример использования **_CrtSetAllocHook**, в разделе [crt_dbg2](https://github.com/Microsoft/VCSamples/tree/master/VC2010Samples/crt/crt_dbg2).

## <a name="see-also"></a>См. также

[Процедуры отладки](../../c-runtime-library/debug-routines.md)<br/>
[_CrtGetAllocHook](crtgetallochook.md)<br/>

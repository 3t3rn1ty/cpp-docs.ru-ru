---
title: "Реализация страницы свойств (ATL) | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-windows
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: C++
helpviewer_keywords: property pages, implementing
ms.assetid: c30b67fe-ce08-4249-ae29-f3060fa8d61e
caps.latest.revision: "14"
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: 96314b4b8ba7696f784354c2353070ca3873c11c
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="example-implementing-a-property-page"></a>Пример: Реализация страницы свойств
В этом примере показано, как построить страница свойств, которая отображает (и позволяет изменять) свойства [классы документов](../mfc/document-classes.md) интерфейса.  
  
 Пример основан на [пример ATLPages](../visual-cpp-samples.md).  
  
 Чтобы выполнить этот пример, выполняет следующие действия:  
  
- [Добавление класса страницы свойств ATL](#vcconusing_the_atl_object_wizard) с помощью диалогового окна "Добавление класса" и мастер страницы свойств ATL.  
  
- [Изменение ресурса диалогового окна](#vcconediting_the_dialog_resource) путем добавления новых элементов управления для интересные свойства **документа** интерфейса.  
  
- [Добавление обработчиков сообщений](#vcconadding_message_handlers) для сохранения веб-узел страницы свойств уведомления об изменениях, внесенных пользователем.  
  
-   Добавить некоторые `#import` инструкций и typedef в [вспомогательные](#vcconhousekeeping) раздела.  
  
- [Переопределить IPropertyPageImpl::SetObjects](#vcconoverriding_ipropertypageimpl_setobjects) для проверки объектов, передаваемых на страницу свойств.  
  
- [Переопределить IPropertyPageImpl::Activate](#vcconoverriding_ipropertypageimpl_activate) инициализации интерфейса на странице свойств.  
  
- [Переопределить IPropertyPageImpl::Apply](#vcconoverride_ipropertypageimpl_apply) для обновления объекта с последние значения свойств.  
  
- [Отображения страницы свойств](#vccontesting_the_property_page) , создав простой вспомогательный объект.  
  
- [Создание макроса](#vcconcreating_a_macro) , проверить на странице свойств.  
  
##  <a name="vcconusing_the_atl_object_wizard"></a>Добавление класса страницы свойств ATL  
 Во-первых, создайте новый проект ATL для сервера библиотеки DLL, названного `ATLPages7`. Теперь с помощью [мастер страницы свойств ATL](../atl/reference/atl-property-page-wizard.md) для создания страницы свойств. Присвойте странице свойство **короткое имя** из **DocProperties** переключитесь в **строки** страницу, чтобы задать особые для страницы свойств элементов, как показано в следующей таблице.  
  
|Элемент|Значение|  
|----------|-----------|  
|Заголовок|TextDocument|  
|Строка документа|Свойства TextDocument VCUE|  
|Файл справки|*\<пустой >*|  
  
 Значения, заданные на этой странице мастера будет возвращаться к контейнеру страницы свойств, при вызове **IPropertyPage::GetPageInfo**. Что происходит на строки после зависит контейнера, но обычно они будут использоваться для идентификации страницы для пользователя. Заголовок обычно будет отображаться на вкладке выше страницы и строка документации могут отображаться в строке состояния или подсказки (несмотря на то, что стандартный фрейм свойства вообще не использовать эту строку).  
  
> [!NOTE]
>  Строки, которые здесь хранятся в виде строковых ресурсов в проекте с помощью мастера. Можно легко изменить эти строки, с помощью редактора ресурсов, если необходимо изменить эти данные после создания кода для страницы.  
  
 Нажмите кнопку **ОК** чтобы мастер создания страницы свойств.  
  
##  <a name="vcconediting_the_dialog_resource"></a>Изменение ресурса диалогового окна  
 Теперь, когда был создан на странице свойств, необходимо добавить несколько элементов управления в ресурс диалогового окна, представляющий страницу. Добавьте текстовое поле, статического текста и типа "флажок" и укажите их идентификаторы, как показано ниже:  
  
 ![Изменение ресурса диалогового окна](../atl/media/ppgresourcelabeled.gif "ppgresourcelabeled")  
  
 Эти элементы управления будут использоваться для отображения имени файла документа и его состояние только для чтения.  
  
> [!NOTE]
>  Ресурс диалогового окна не включает кадра или команду кнопки, а также имеет вид с вкладками, можно было бы ожидать. Эти функции предоставляются с помощью свойства фрейма страницы, такой файл создан путем вызова [OleCreatePropertyFrame](http://msdn.microsoft.com/library/windows/desktop/ms678437).  
  
##  <a name="vcconadding_message_handlers"></a>Добавление обработчиков сообщений  
 С элементами управления на месте можно добавить обработчики сообщений, чтобы обновить состояние «грязные» страницы при изменении значения любого из элементов управления.  
  
 [!code-cpp[NVC_ATL_Windowing#73](../atl/codesnippet/cpp/example-implementing-a-property-page_1.h)]  
  
 Этот код реагирует на изменения, внесенные в элемент управления или флажок путем вызова [IPropertyPageImpl::SetDirty](../atl/reference/ipropertypageimpl-class.md#setdirty), информирующий веб-узел страницы, страница была изменена. Обычно будет отвечать веб-узел страницы, включая или отключая **применить** кнопку во фрейме страницы свойств.  
  
> [!NOTE]
>  В собственных страницы свойств может потребоваться для отслеживания точно свойства, которые были изменены пользователем, чтобы избежать обновления свойств, которые еще не были изменены. Этот пример реализует этот код с отслеживает исходные значения свойств и сравнение их с текущими значениями из пользовательского интерфейса, когда придет время для применения изменений.  
  
##  <a name="vcconhousekeeping"></a>Вспомогательные  
 Теперь добавьте несколько `#import` DocProperties.h инструкции, чтобы компилятор знает об **документа** интерфейс:  
  
 [!code-cpp[NVC_ATL_Windowing#74](../atl/codesnippet/cpp/example-implementing-a-property-page_2.h)]  
  
 Кроме того, потребуется для ссылки на `IPropertyPageImpl` базового класса, добавьте следующий `typedef` для **CDocProperties** класса:  
  
 [!code-cpp[NVC_ATL_Windowing#75](../atl/codesnippet/cpp/example-implementing-a-property-page_3.h)]  
  
##  <a name="vcconoverriding_ipropertypageimpl_setobjects"></a>Переопределение IPropertyPageImpl::SetObjects  
 Первый `IPropertyPageImpl` — метод, который необходимо переопределить [SetObjects](../atl/reference/ipropertypageimpl-class.md#setobjects). Здесь вы добавите код, чтобы проверить прохождение только один объект, и что он поддерживает **документа** интерфейс, который вы ожидаете:  
  
 [!code-cpp[NVC_ATL_Windowing#76](../atl/codesnippet/cpp/example-implementing-a-property-page_4.h)]  
  
> [!NOTE]
>  Смысл поддерживает только один объект для этой страницы, так как позволяет пользователю задавать имя файла объекта, может существовать только один файл, все в одном месте.  
  
##  <a name="vcconoverriding_ipropertypageimpl_activate"></a>Переопределение IPropertyPageImpl::Activate  
 Следующим шагом является инициализировать страницу свойств со значениями свойств базового объекта при создании страницы.  
  
 В этом случае следует добавить следующие члены класса, так как вы также будете использовать исходные значения свойств для сравнения при пользователей страницы применять изменения:  
  
 [!code-cpp[NVC_ATL_Windowing#77](../atl/codesnippet/cpp/example-implementing-a-property-page_5.h)]  
  
 Базовая реализация [активировать](../atl/reference/ipropertypageimpl-class.md#activate) метод отвечает за создание диалогового окна и ее элементов управления, можно переопределить этот метод, а также добавлять собственные инициализации после вызова метода базового класса:  
  
 [!code-cpp[NVC_ATL_Windowing#78](../atl/codesnippet/cpp/example-implementing-a-property-page_6.h)]  
  
 Этот код использует методы COM **документа** интерфейс для получения свойств, которые вас интересуют. Затем он использует оболочки Win32 API, предоставляемые [CDialogImpl](../atl/reference/cdialogimpl-class.md) и его базовых классов для отображения значений свойств для пользователя.  
  
##  <a name="vcconoverride_ipropertypageimpl_apply"></a>Переопределение IPropertyPageImpl::Apply  
 Если требуется применять изменения к объектам сайта страницы свойств будет вызывать [применить](../atl/reference/ipropertypageimpl-class.md#apply) метод. Это место, выполните обратное кода в **активировать** , тогда как **активировать** заняло значения из объекта, при передаче их в элементах управления на странице свойств **применить** принимает значения из элементов управления на странице свойств и помещает их в объект.  
  
 [!code-cpp[NVC_ATL_Windowing#79](../atl/codesnippet/cpp/example-implementing-a-property-page_7.h)]  
  
> [!NOTE]
>  Проверка соответствия [m_bDirty](../atl/reference/ipropertypageimpl-class.md#m_bdirty) в начале этой реализации является начальной проверки, чтобы избежать ненужных обновлений объектов во время **применить** вызывается несколько раз. Существуют также проверки для каждого из значений свойств, чтобы гарантировать, что только изменения приведут к вызову метода для **документа**.  
  
> [!NOTE]
> **Документ** предоставляет **FullName** как свойство только для чтения. Чтобы обновить имя файла документа, основанные на изменения, внесенные на странице свойств, необходимо использовать **Сохранить** метод, чтобы сохранить файл с другим именем. Таким образом, код на странице свойств не нужно задать ограничение на получение или установку свойств.  
  
##  <a name="vccontesting_the_property_page"></a>Отображение страницы свойств  
 Чтобы открыть эту страницу, необходимо создать простой вспомогательный объект. Вспомогательный объект будет предоставляют метод, который упрощает **OleCreatePropertyFrame** API-Интерфейс для отображения на одной странице подключены к одному объекту. Этот вспомогательный будет разработана, чтобы его можно использовать из Visual Basic.  
  
 Используйте [диалоговое окно "Добавление класса"](../ide/add-class-dialog-box.md) и [мастер простых объектов ATL](../atl/reference/atl-simple-object-wizard.md) для создания нового класса и использования `Helper` короткого имени. После создания добавьте метод, как показано в следующей таблице.  
  
|Элемент|Значение|  
|----------|-----------|  
|Имя метода|`ShowPage`|  
|Параметры|`[in] BSTR bstrCaption, [in] BSTR bstrID, [in] IUnknown* pUnk`|  
  
 `bstrCaption` Параметр имеет заголовок, отображаемый в заголовке диалогового окна. `bstrID` — Это строка, представляющая CLSID или ProgID страницы свойств для отображения. `pUnk` Параметра будет `IUnknown` указатель объекта, свойства которого будет настроен при помощи страницы свойств.  
  
 Реализуйте метод, как показано ниже:  
  
 [!code-cpp[NVC_ATL_Windowing#80](../atl/codesnippet/cpp/example-implementing-a-property-page_8.cpp)]  
  
##  <a name="vcconcreating_a_macro"></a>Создание макроса  
 После создания проекта, можно проверить на странице свойств, а также вспомогательный объект, с помощью простой макрос, который можно создать и выполнить в среде разработки Visual Studio. Этот макрос создаст вспомогательный класс объекта, а затем вызвать его **ShowPage** метода с помощью ProgID **DocProperties** страницу свойств и **IUnknown** указатель документа активных в настоящий момент в редакторе Visual Studio. Ниже приведен исходный код, необходимый для этого макроса:  
  
```  
Imports EnvDTE  
Imports System.Diagnostics  
 
Public Module AtlPages  
 
    Public Sub Test()  
    Dim Helper  
    Helper = CreateObject("ATLPages7.Helper.1")  
 
    On Error Resume Next  
    Helper.ShowPage(_ 
    ActiveDocument.Name,
    _ 
 "ATLPages7Lib.DocumentProperties.1",
    _ 
    DTE.ActiveDocument _)  
    End Sub  
 
End Module  
```  
  
 При запуске этого макроса, на странице свойств отображается отображается имя файла и состояние только для чтения активного текстового документа. Состояние только для чтения документа только отражает возможность записи в документ в среде разработки; он не влияет на атрибут только для чтения файла на диске.  
  
## <a name="see-also"></a>См. также  
 [Страницы свойств](../atl/atl-com-property-pages.md)   
 [Пример ATLPages](../visual-cpp-samples.md)


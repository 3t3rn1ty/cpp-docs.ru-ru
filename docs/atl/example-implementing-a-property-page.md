---
title: "Example: Implementing a Property Page | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "страницы свойств, реализация"
ms.assetid: c30b67fe-ce08-4249-ae29-f3060fa8d61e
caps.latest.revision: 14
caps.handback.revision: 9
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Example: Implementing a Property Page
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этом примере показано, как создать страницу свойств, отображающее свойства \(и позволяет изменению\) интерфейса [Классы документов](../mfc/document-classes.md).  Этот интерфейс является предоставление документами в [Примеры модели объектов общей среды](../Topic/Common%20Environment%20Object%20Model%20Examples.md) Visual Studio \(хотя страница свойств, созданной не позаботит, где его обрабатывают объекты приденный из при условии, что они поддерживают необходимый интерфейс\).  
  
 Пример основан на [Образец ATLPages](../top/visual-cpp-samples.md).  
  
 Чтобы завершить этот пример, необходимо:  
  
-   [Добавление класса страницы свойств библиотеки ATL](#vcconusing_the_atl_object_wizard), используя диалоговое окно добавление класса мастера и страницы свойств библиотеки ATL.  
  
-   [Ресурс диалогового окна правка](#vcconediting_the_dialog_resource) путем добавления новых элементов управления для интересующих свойств интерфейса **Документ**.  
  
-   [Добавление обработчиков сообщений](#vcconadding_message_handlers) для хранения сайт страницы свойств сообщенный изменений, внесенных пользователем.  
  
-   Добавьте некоторые выписки `#import` и typedef в разделе [домоустройство](#vcconhousekeeping).  
  
-   [переопределите IPropertyPageImpl::SetObjects](#vcconoverriding_ipropertypageimpl_setobjects) для проверки объектов, переданного странице свойств.  
  
-   [Переопределение IPropertyPageImpl::Activate](#vcconoverriding_ipropertypageimpl_activate) для инициализации интерфейс страницы свойств.  
  
-   [Переопределение IPropertyPageImpl::Apply](#vcconoverride_ipropertypageimpl_apply) для обновления объекта с самыми последними значениями свойств.  
  
-   [Откройте страницу свойств](#vccontesting_the_property_page) путем создания простого вспомогательный объект.  
  
-   [создайте макрос](#vcconcreating_a_macro), которое проверяет страницу свойств.  
  
##  <a name="vcconusing_the_atl_object_wizard"></a> Добавление класса страницы свойств библиотеки ATL  
 Сначала создайте новый проект библиотеки ATL для сервера библиотеки DLL `ATLPages7`.  Теперь используйте [Мастер страниц свойств библиотеки ATL](../atl/reference/atl-property-page-wizard.md) чтобы создать страницу свойств.  Присвойте странице свойств **Короткое имяDocProperties** а затем перейдите на страницу в **Строки** задать элементы свойство\-страница\- определенного как показано в таблице ниже.  
  
|Элемент|Значение|  
|-------------|--------------|  
|Заголовок|TextDocument|  
|Строка документации|Свойства VCUE TextDocument|  
|Helpfile|*\<blank\>*|  
  
 Значения, которые устанавливаются на этой странице мастера будут возвращены к контейнеру страницы свойств, когда она вызывает **IPropertyPage::GetPageInfo**.  Что происходит на строки после зависящее от контейнере, но, как правило, они будут использоваться для определения странице пользователю.  Обычно заголовок появится на вкладке по конкретной страницей и строка документа может отображаться в строке состояния или подсказке \(хотя стандартный фрейм свойства не использует эту строку на всех\).  
  
> [!NOTE]
>  Строки, что набор здесь хранитесь как строковые ресурсы проекта мастером.  Можно легко правка эти строки с помощью редактора ресурсов если необходимо изменить эти сведения, после того как был создан код для страницы.  
  
 Нажмите кнопку **ОК** иметь мастер создания странице свойств.  
  
##  <a name="vcconediting_the_dialog_resource"></a> Ресурс диалогового окна редактирования  
 Теперь, когда страница свойств будет создана, необходимо добавить несколько элементов управления на ресурс диалогового окна, представляющий пользовательскую страницу.  Добавьте элемент управления "поле ввода", статический текст и их идентификаторы и установите флажок, как показано ниже:  
  
 ![Изменение ресурса диалогового окна](../atl/media/ppgresourcelabeled.png "PPGResourceLabeled")  
  
 Эти элементы управления используются для отображения имени файла документа и его только для чтения.  
  
> [!NOTE]
>  Ресурс диалогового окна не включает фрейм или кнопки, ни у него с вкладками, можно выбрать ожидается.  Эти функции предоставляются кадром страницы свойств, созданный путем вызова [OleCreatePropertyFrame](http://msdn.microsoft.com/library/windows/desktop/ms678437).  
  
##  <a name="vcconadding_message_handlers"></a> Добавление обработчиков сообщений  
 С элементами управления в месте, можно добавить обработчики сообщений для обновления пакостное состояние страницы, когда значение из изменений элементов управления:  
  
 [!code-cpp[NVC_ATL_Windowing#73](../atl/codesnippet/CPP/example-implementing-a-property-page_1.h)]  
  
 Этот код будет реагировать на изменения, сделанные в элемент управления "Поле ввода" или флажку путем вызова [IPropertyPageImpl::SetDirty](../Topic/IPropertyPageImpl::SetDirty.md), который информирует сайт страниц, что страница изменена.  Обычно страницы сайт отвечает, разрешить или запретить кнопку **Применить** во фрейме страницы свойств.  
  
> [!NOTE]
>  В собственных страницах свойств, можно отслеживать точно, свойствам редактирования пользователем, что позволяет избежать обновления свойств, которые не были изменены.  Инструменты этого примера, кодируют, отслеживать исходных значений свойств и сравнение их с текущими значениями из пользовательского интерфейса, если давно пора, чтобы применить изменения.  
  
##  <a name="vcconhousekeeping"></a> Домоустройство  
 Теперь добавьте несколько выписки `#import` к DocProperties.h, что компилятор знает об интерфейсе **Документ**:  
  
 [!code-cpp[NVC_ATL_Windowing#74](../atl/codesnippet/CPP/example-implementing-a-property-page_2.h)]  
  
 Кроме того, необходимо обратиться к базовому классу `IPropertyPageImpl`; добавьте следующий `typedef` к классу **CDocProperties**:  
  
 [!code-cpp[NVC_ATL_Windowing#75](../atl/codesnippet/CPP/example-implementing-a-property-page_3.h)]  
  
##  <a name="vcconoverriding_ipropertypageimpl_setobjects"></a> Переопределение IPropertyPageImpl::SetObjects  
 Первый метод `IPropertyPageImpl`, который необходимо переопределить [SetObjects](../Topic/IPropertyPageImpl::SetObjects.md).  Здесь можно добавить код для проверки того, что был передан только один объект, и что он поддерживает интерфейс **Документ**, который ожидается:  
  
 [!code-cpp[NVC_ATL_Windowing#76](../atl/codesnippet/CPP/example-implementing-a-property-page_4.h)]  
  
> [!NOTE]
>  Он имеет смысл поддерживать только один объект для данной страницы, поскольку вы разрешите пользователю задать имя файла объекта — только один файл может существовать в одном месте.  
  
##  <a name="vcconoverriding_ipropertypageimpl_activate"></a> Переопределение IPropertyPageImpl::Activate  
 Следующим шагом будет инициализировать страница свойств со значениями свойства базового объекта при первоначальном создана страницы.  
  
 В этом случае необходимо добавить следующие элементы в класс, поскольку также потребуется использовать исходные значения свойств для сравнения, если пользователи страницы применить свои изменения:  
  
 [!code-cpp[NVC_ATL_Windowing#77](../atl/codesnippet/CPP/example-implementing-a-property-page_5.h)]  
  
 Реализация базового класса метода [Активировать](../Topic/IPropertyPageImpl::Activate.md) отвечает за создание диалогового окна и ее элементам управления, таким образом можно переопределить этот метод и добавить собственную инициализация после вызова метода базового класса:  
  
 [!code-cpp[NVC_ATL_Windowing#78](../atl/codesnippet/CPP/example-implementing-a-property-page_6.h)]  
  
 Этот код использует методы интерфейса **Документ** модель COM для получения свойств, что нужно знать in.  Затем он использует программы\-оболочки API Win32, предоставляемых [CDialogImpl](../Topic/CDialogImpl%20Class.md) и его базовых классов для отображения значений свойств для пользователя.  
  
##  <a name="vcconoverride_ipropertypageimpl_apply"></a> Переопределение IPropertyPageImpl::Apply  
 Когда пользователи хотят применить свои изменения в объекты, будут вызывать метод [Применить](../Topic/IPropertyPageImpl::Apply.md) сайта страницы свойств.  Это размещение, чтобы сделать обратное кода в **Активировать** — тогда как в **Активировать** значения от объекта и отправляло их в элементы управления на странице свойств **Применить** принимает значения от элементов управления на странице свойств и помещает их в объект.  
  
 [!code-cpp[NVC_ATL_Windowing#79](../atl/codesnippet/CPP/example-implementing-a-property-page_7.h)]  
  
> [!NOTE]
>  Проверка на соответствие [m\_bDirty](../Topic/IPropertyPageImpl::m_bDirty.md) в начале этой реализации начальный проверьте, предотвращаются ненужные обновления объектов, если **Применить** вызываются несколько раз.  Также проверяет соответствие всех значений свойств, чтобы обеспечить, что только изменения приводят к вызову метода **Документ**.  
  
> [!NOTE]
>  Предоставляет **FullNameДокумент** как свойство, доступное только для чтения.  Чтобы обновить имя файла документа на основе изменениях, внесенных на странице свойств необходимо использовать метод **Сохранить** для сохранения файла под другим именем.  Таким образом, код на странице свойств не должен ограничить на получение или устанавливать свойства.  
  
##  <a name="vccontesting_the_property_page"></a> Отображение страницы свойств  
 Для отображения этой страницы необходимо создать простой вспомогательный объект.  Вспомогательный объект обеспечит метод, который упрощает API **OleCreatePropertyFrame** для отображения одной страницы подключенной к одному объекту.  Это вспомогательный объект был разработан так, что его можно использовать в Visual Basic.  
  
 Используйте [Диалоговое окно " добавление класса](../ide/add-class-dialog-box.md) и [Мастер объекта простой библиотеки ATL](../atl/reference/atl-simple-object-wizard.md) чтобы создать новый класс и использовать в качестве его `Helper` короткое имя.  Как только создан добавьте метод, как показано в таблице ниже.  
  
|Элемент|Значение|  
|-------------|--------------|  
|Имя метода|`ShowPage`|  
|Параметры|`[in] BSTR bstrCaption, [in] BSTR bstrID, [in] IUnknown* pUnk`|  
  
 Параметр `bstrCaption` заголовок, отображаемый в виде заголовка диалогового окна.  Параметр `bstrID` строка или CLSID или ProgID страницы свойств для отображения.  Параметр `pUnk` будет указателем `IUnknown` объекта свойства которого будут настроитьы страницей свойств.  
  
 Реализуйте метод, как показано ниже:  
  
 [!code-cpp[NVC_ATL_Windowing#80](../atl/codesnippet/CPP/example-implementing-a-property-page_8.cpp)]  
  
##  <a name="vcconcreating_a_macro"></a> Создать макрос  
 После построения проекта можно проверить страницы свойств и вспомогательный объект с помощью простой макрос, что можно создать и запустить в интегрированной среде разработки Visual Studio.  Этот макрос создает объект помощника, а затем вызывает метод **ShowPage**, используя идентификатор ProgID страницы свойств **DocProperties** и указатель **IUnknown** активного документа в данный момент в редакторе Visual Studio.  Код для этого макроса показано ниже:  
  
```  
Imports EnvDTE  
Imports System.Diagnostics  
  
Public Module AtlPages  
  
    Public Sub Test()  
        Dim Helper  
        Helper = CreateObject("ATLPages7.Helper.1")  
  
        On Error Resume Next  
        Helper.ShowPage( _  
            ActiveDocument.Name, _  
            "ATLPages7Lib.DocumentProperties.1", _  
            DTE.ActiveDocument _  
            )  
    End Sub  
  
End Module  
```  
  
 При выполнении этого макроса будет отображена страница свойств, указывающая имя файла и состояние только для чтения в настоящий момент активно текстового документа.  Состояние только для чтения документа отражает только возможность записи в документ в интегрированной среде разработки; она не затрагивает только для чтения, атрибут файла на диске.  
  
## См. также  
 [Страницы свойств](../atl/atl-com-property-pages.md)   
 [Образец ATLPages](../top/visual-cpp-samples.md)
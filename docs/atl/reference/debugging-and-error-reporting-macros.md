---
title: "Макросы, отладка и отчеты об ошибках | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-windows
ms.tgt_pltfrm: 
ms.topic: reference
f1_keywords:
- atldef/ATL::_ATL_DEBUG_INTERFACES
- atldef/ATL::_ATL_DEBUG_QI
- atldef/ATL::ATLASSERT
- afx/ATL::ATLENSURE
- atltrace/ATL::ATLTRACENOTIMPL
- atltrace/ATL::ATLTRACE
dev_langs: C++
helpviewer_keywords: macros, error reporting
ms.assetid: 4da9b87f-ec5c-4a32-ab93-637780909b9d
caps.latest.revision: "18"
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: 9098b944f70ab4e4448fe40aa2347b0128e6e1a7
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="debugging-and-error-reporting-macros"></a>Макросы, отладка и отчеты об ошибках
Эти макросы предоставляют полезные средства отладки и трассировки.  
  
|||  
|-|-|  
|[_ATL_DEBUG_INTERFACES](#_atl_debug_interfaces)|Записывает данные, в окне вывода утечек любому интерфейсу, при обнаружении `_Module.Term` вызывается.|  
|[_ATL_DEBUG_QI](#_atl_debug_qi)|Записывает все вызовы `QueryInterface` в окне вывода.|  
|[ATLASSERT](#atlassert)|Выполняет ту же функциональность, что [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) макрос, найденный в библиотеке времени выполнения C.|  
|[ATLENSURE](#atlensure)|Выполняет проверку параметров. Вызовите `AtlThrow` при необходимости|  
|[ATLTRACENOTIMPL](#atltracenotimpl)|Отправляет сообщение на устройстве дампа, что указанная функция не реализована.|  
|[ATLTRACE](#alttrace)|Сообщает о предупреждениях для выходного устройства, например окна отладчика, в соответствии с указанных флагов и уровней. Включено для обеспечения обратной совместимости.|  
|[ATLTRACE2](#atltrace2)|Сообщает о предупреждениях для выходного устройства, например окна отладчика, в соответствии с указанных флагов и уровней.|  
  
##  <a name="_atl_debug_interfaces"></a>_ATL_DEBUG_INTERFACES  
 Определить этот макрос перед включением любые файлы заголовков ATL. для отслеживания всех `AddRef` и **выпуска** вызывает по интерфейсам компонентов в окне вывода.  
  
```
#define _ATL_DEBUG_INTERFACES
```  
  
### <a name="remarks"></a>Примечания  
 Выходные данные трассировки отображаются так, как показано ниже:  
  
 `ATL: QIThunk - 2008         AddRef  :   Object = 0x00d81ba0   Refcount = 1   CBug - IBug`  
  
 В первой части каждой трассировки всегда будет `ATL: QIThunk`. Далее следует значение, идентифицирующее конкретного *интерфейс преобразователя* используется. Преобразователь интерфейса — это объект, который поддерживает счетчик ссылок и предоставляют возможность трассировки, используемые здесь. При каждом вызове создается новый интерфейс преобразователь `QueryInterface` за исключением запросов **IUnknown** интерфейс (в этом случае того же преобразователя возвращается каждый раз должен соответствовать правилам для идентификаторов COM).  
  
 Далее вы увидите `AddRef` или **выпуска** , указывающее, какой метод был вызван. После этого вы увидите значение, идентифицирующее объект был изменен, счетчик ссылок интерфейса. Трассируется оно **это** указатель объекта.  
  
 Счетчик ссылок, который трассируется имеет счетчик ссылок на этот преобразователь после `AddRef` или **выпуск** был вызван. Обратите внимание, что этот счетчик ссылок не может соответствовать счетчик ссылок для объекта. Каждый преобразователь ведется собственный счетчик ссылок помогут полностью соответствуют правилам подсчет ссылок COM.  
  
 Заключительная часть сведений является имя объекта и интерфейс влиял `AddRef` или **выпуска** вызова.  
  
 Любой интерфейс утечки, которые обнаруживаются при выключении сервера и `_Module.Term` вызывается будет регистрироваться следующим образом:  
  
 `ATL: QIThunk - 2005         LEAK    :   Object = 0x00d81ca0   Refcount = 1   MaxRefCount = 1   CBug - IBug`  
  
 Сведения, указанные здесь прямо сопоставляется с описано в предыдущей инструкции трассировки, чтобы вы могли изучить количество ссылок в течение всего времени существования интерфейс преобразователя. Кроме того предусмотрена значение, указывающее максимальное количество ссылок на этот интерфейс преобразователя.  
  
> [!NOTE]
> `_ATL_DEBUG_INTERFACES`можно использовать в окончательных сборках.  
  
##  <a name="_atl_debug_qi"></a>_ATL_DEBUG_QI  
 Записывает все вызовы `QueryInterface` в окне вывода.  
  
```
#define _ATL_DEBUG_QI
```  
  
### <a name="remarks"></a>Примечания  
 Если вызов `QueryInterface` сбой, будет отображаться в окне выходных данных:  
  
 *Имя интерфейса* - `failed`  
  
##  <a name="atlassert"></a>ATLASSERT  
 `ATLASSERT` Макрос выполняет ту же функциональность, что [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) макрос, найденный в библиотеке времени выполнения C.  
  
```
ATLASSERT(booleanExpression);
```  
  
### <a name="parameters"></a>Параметры  
 `booleanExpression`  
 Выражение (включая указатели), результат вычисления которого отличен от нуля или равен нулю.  
  
### <a name="remarks"></a>Примечания  
 В отладочных построениях `ATLASSERT` вычисляет `booleanExpression` и создает отчет об отладке, когда результат равен false.  

## <a name="requirements"></a>Требования  
 **Заголовок:** atldef.h  
    
##  <a name="atlensure"></a>ATLENSURE  
 Этот макрос используется для проверки параметров, передаваемых в функцию.  
  
```
ATLENSURE(booleanExpression);
ATLENSURE_THROW(booleanExpression, hr);
```  
  
### <a name="parameters"></a>Параметры  
 `booleanExpression`  
 Указывает логическое выражение, которое необходимо проверить.  
  
 `hr`  
 Указывает код ошибки для возврата.  
  
### <a name="remarks"></a>Примечания  
 Эти макросы обеспечивают механизм для обнаружения и уведомлять пользователя об использовании неправильный параметр.  
  
 Вызовов макросов `ATLASSERT` и, если условие не выполняется вызовов `AtlThrow`.  
  
 В **ATLENSURE** случае `AtlThrow` вызывается с E_FAIL.  
  
 В **ATLENSURE_THROW** случае `AtlThrow` вызывается с указанным HRESULT.  
  
 Разница между **ATLENSURE** и `ATLASSERT` является то, что **ATLENSURE** вызывает исключение в выпуске также создает как в отладочных построениях.  
  
### <a name="example"></a>Пример  
 [!code-cpp[NVC_ATL_Utilities#108](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_1.cpp)]  

## <a name="requirements"></a>Требования  
 **Заголовок:** afx.h  

##  <a name="atltracenotimpl"></a>ATLTRACENOTIMPL  
 В отладочных построениях ATL отправляет строку " `funcname` не реализован» устройство хранения и возвращает **E_NOTIMPL**.  
  
```
ATLTRACENOTIMPL(funcname);
```  
  
### <a name="parameters"></a>Параметры  
 `funcname`  
 [in] Строка, содержащая имя функции, который не реализован.  
  
### <a name="remarks"></a>Примечания  
 В сборках выпуска возвращает **E_NOTIMPL**.  
  
### <a name="example"></a>Пример  
 [!code-cpp[NVC_ATL_Utilities#127](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_2.cpp)]  
  
## <a name="requirements"></a>Требования  
 **Заголовок:** atltrace.h 

##  <a name="atltrace"></a>ATLTRACE
 Сообщает о предупреждениях для выходного устройства, например окна отладчика, в соответствии с указанных флагов и уровней. Включено для обеспечения обратной совместимости.  
  
```
ATLTRACE(exp);

ATLTRACE(  
    DWORD category,
    UINT  level,
    LPCSTR lpszFormat, ...);
```  
  
### <a name="parameters"></a>Параметры  
 `exp`  
 [in] Строки и переменные для передачи в окне вывода Visual C++ или любого приложения, который перехватывает эти сообщения.  
  
 `category`  
 [in] Тип события или метода, на котором для отчета. Список категорий см.  
  
 `level`  
 [in] Уровень трассировки для отчета. Дополнительные сведения см.  
  
 `lpszFormat`  
 [in] Форматированная строка для отправки устройство хранения.  
  
### <a name="remarks"></a>Примечания  
 В разделе [ATLTRACE2](#atltrace2) описание **ATLTRACE**. **ATLTRACE** и `ATLTRACE2` имеют одинаковое поведение **ATLTRACE** включена для обратной совместимости.  
  
##  <a name="atltrace2"></a>ATLTRACE2  
 Сообщает о предупреждениях для выходного устройства, например окна отладчика, в соответствии с указанных флагов и уровней.  
  
```
ATLTRACE2(exp);

ATLTRACE2(
    DWORD category,
    UINT level,
    LPCSTRlpszFormat,  ...);
```  
  
### <a name="parameters"></a>Параметры  
 `exp`  
 [in] Строка для отправки в окне вывода Visual C++ или любого приложения, который перехватывает эти сообщения.  
  
 `category`  
 [in] Тип события или метода, на котором для отчета. Список категорий см.  
  
 `level`  
 [in] Уровень трассировки для отчета. Дополнительные сведения см.  
  
 `lpszFormat`  
 [in] `printf`-Стиль строки формата для использования для создания строки для отправки устройство хранения.  
  
### <a name="remarks"></a>Примечания  
 Краткая форма `ATLTRACE2` записывает строку в отладчик окно вывода. Во второй форме `ATLTRACE2` также выводит данные в окне вывода, но зависит от параметров инструмент трассировки ATL/MFC (см. [ATLTraceTool выполняется образец](../../visual-cpp-samples.md)). Например, если задать `level` по 4 и инструмент трассировки ATL и MFC для уровня 0, не отобразится сообщение. *уровень* может быть 0, 1, 2, 3 или 4. Значение по умолчанию 0, сообщает только наиболее серьезные проблемы.  
  
 `category` Флаги трассировки, чтобы задать списки параметров. Эти флаги соответствуют типы методов, для которых следует включить в отчет. В приведенных ниже таблицах перечислены флаги трассировки, можно использовать для `category` параметра.  
  
### <a name="atl-trace-flags"></a>Флаги трассировки ATL  
  
|Категория ATL|Описание:|  
|------------------|-----------------|  
|`atlTraceGeneral`|Отчеты на все приложения ATL. По умолчанию.|  
|`atlTraceCOM`|Отчеты в методах COM.|  
|`atlTraceQI`|Сообщает об вызовы QueryInterface.|  
|`atlTraceRegistrar`|Сообщает о регистрации объектов.|  
|`atlTraceRefcount`|Отчеты об изменении счетчик ссылок.|  
|`atlTraceWindowing`|Отчеты о методах windows; Например отчеты неправильный код сообщения карты.|  
|`atlTraceControls`|Отчеты в элементе управления; Например отчеты, при удалении элемента управления или его окно.|  
|`atlTraceHosting`|Отчеты, размещение сообщений. Например отчеты при активации клиента в контейнере.|  
|`atlTraceDBClient`|Отчеты на шаблон потребителя OLE DB; Например при вызове метода GetData завершается ошибкой, выходных данных может содержать значение HRESULT.|  
|`atlTraceDBProvider`|Отчеты о шаблона поставщика OLE DB. Например отчеты, если не удалось создать столбец.|  
|`atlTraceSnapin`|Отчеты для приложения оснастку MMC.|  
|`atlTraceNotImpl`|Сообщает, что указанный функция не реализована.|  
|**atlTraceAllocation**|Содержит сведения о сообщениях, которые печатают средства отладки в atldbgmem.h память.|  
  
### <a name="mfc-trace-flags"></a>Флаги трассировки MFC  
  
|Категория MFC|Описание:|  
|------------------|-----------------|  
|**traceAppMsg**|Общее назначение сообщения MFC. Рекомендуется всегда.|  
|**traceDumpContext**|Сообщения от [CDumpContext](../../mfc/reference/cdumpcontext-class.md).|  
|**traceWinMsg**|Сообщения код обработки сообщений MFC.|  
|**traceMemory**|Сообщения от кода управления памяти в MFC.|  
|**traceCmdRouting**|Сообщения от MFC Windows команда код маршрута.|  
|**traceHtml**|Сообщения от службы технической поддержки диалоговое окно MFC DHTML.|  
|**traceSocket**|Сообщения от службы поддержки MFC сокета.|  
|**traceOle**|Сообщения от службы поддержки OLE MFC.|  
|**traceDatabase**|Сообщения от службы поддержки базы данных MFC.|  
|**traceInternet**|Сообщения от Интернет-поддержку MFC.|  
  
 Чтобы объявить категория пользовательской трассировки, объявить глобальный экземпляр класса `CTraceCategory` следующим образом:  
  
 [!code-cpp[NVC_ATL_Utilities#109](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_3.cpp)]  
  
 Имя категории `MY_CATEGORY` в этом примере — необходимо указать имя `category` параметра. Первый параметр — имя категории, которое будет отображаться в инструмент трассировки ATL/MFC. Второй параметр является уровень трассировки по умолчанию. Этот параметр является необязательным, и уровень трассировки по умолчанию — 0.  
  
 Чтобы использовать пользовательские категории:  
  
 [!code-cpp[NVC_ATL_Utilities#110](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_4.cpp)]  
  
 Можно указать, что для фильтрации сообщений трассировки, вставить определения для этих макросов в файле Stdafx.h до `#include <atlbase.h>` инструкции.  
  
 Кроме того, можно задать фильтр в директивах препроцессора в **страницы свойств** диалоговое окно. Нажмите кнопку **препроцессор** вкладку, а затем вставьте в глобальный **определения препроцессора** "Правка".  
  
 Atlbase.h содержит определения по умолчанию `ATLTRACE2` макросы и эти определения будут использоваться, если не определить эти символы, пока не будет обработан atlbase.h.  
  
 В сборках выпуска `ATLTRACE2` компилируется в `(void) 0`.  
  
 `ATLTRACE2`ограничивает содержимое строки должно отправляться устройство хранения не более 1023 знаков после форматирования.  
  
 **ATLTRACE** и `ATLTRACE2` имеют одинаковое поведение **ATLTRACE** включена для обратной совместимости.  
  
### <a name="example"></a>Пример  
 [!code-cpp[NVC_ATL_Utilities#111](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_5.cpp)]  
  
## <a name="see-also"></a>См. также  
 [Макросы](../../atl/reference/atl-macros.md)   
 [Глобальные функции для отладки и создания отчетов об ошибках](../../atl/reference/debugging-and-error-reporting-global-functions.md)

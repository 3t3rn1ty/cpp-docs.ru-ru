---
title: С помощью TCHAR. Типы данных H с кодом _MBCS | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-windows
ms.topic: conceptual
f1_keywords:
- tchar.h
- TCHAR
dev_langs:
- C++
helpviewer_keywords:
- mapping generic-text
- generic-text data types [C++]
- generic-text mappings [C++]
- MBCS [C++], generic-text mappings
- TCHAR.H data types, mapping
- mappings [C++], TCHAR.H
ms.assetid: 298583c5-22c3-40f6-920e-9ec96d42abd8
author: ghogen
ms.author: ghogen
ms.workload:
- cplusplus
ms.openlocfilehash: e80ecd123e3fc47705563156e33f46ecd99a0321
ms.sourcegitcommit: d55ac596ba8f908f5d91d228dc070dad31cb8360
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
ms.locfileid: "33858358"
---
# <a name="using-tcharh-data-types-with-mbcs-code"></a>Использование типов данных TCHAR.H с кодом _MBCS
Когда константа манифеста **_MBCS** — определена, заданного универсальную текстовую подпрограмму сопоставляется один из следующих видов:  
  
-   Подпрограмма для однобайтовой кодировки, которая правильно обрабатывает многобайтовые символы и строки. В этом случае ожидается строковые аргументы будут иметь тип **char\***. Например `_tprintf` сопоставляется `printf`; строковые аргументы функции `printf` имеют тип **char\***. Если вы используете **_TCHAR** типов универсальных текстовых данных строкового типа, типы формальных и фактических параметров для `printf` соответствует потому, что **_TCHAR** \* сопоставляется **char \***.  
  
-   Подпрограмма, специально созданная для многобайтовой кодировки. В этом случае ожидается строковые аргументы будут иметь тип `unsigned` **char\***. Например `_tcsrev` сопоставляется `_mbsrev`, которая ожидает и возвращает строку типа `unsigned` **char\***. Если вы используете **_TCHAR** универсального текстового типа данных для вашего типа string, имеется вероятность конфликта типов, так как **_TCHAR** сопоставляется с типом `char`.  
  
 Есть три способа предотвратить такой конфликт типов (и избежать предупреждений компилятора C или ошибок компиляции C++).  
  
-   Использовать поведение по умолчанию. Файл Tchar.h содержит прототипы универсальных текстовых подпрограмм в библиотеках времени выполнения, как показано в следующем примере.  
  
    ```  
    char * _tcsrev(char *);  
    ```  
  
     В случае по умолчанию прототип для `_tcsrev` сопоставляется `_mbsrev` через преобразователь в Libc.lib. При этом изменяется типы `_mbsrev` входного параметра и результата возвращаемое значение из **_TCHAR \***  (то есть `char` **\***) для `unsigned` `char` **\***. Этот метод гарантирует соответствие типов при использовании **_TCHAR**, но он является сравнительно медленным из-за дополнительного вызова функции.  
  
-   Использовать встраивание функций, включив в код следующую инструкцию препроцессора.  
  
    ```  
    #define _USE_INLINING  
    ```  
  
     Этот метод вызывает встроенный преобразователь функции, реализованный в файле Tchar.h, который непосредственно универсальную текстовую подпрограмму на соответствующую MBCS-подпрограмму. Следующий фрагмент кода из Tchar.h иллюстрирует, как это сделать.  
  
    ```  
    __inline char *_tcsrev(char *_s1)  
    {return (char *)_mbsrev((unsigned char *)_s1);}  
    ```  
  
     Это решение будет оптимальным, если используется встраивание, поскольку гарантирует соответствие типов и не замедляет работу.  
  
-   Используйте прямое сопоставление путем включения в код следующей инструкции препроцессора.  
  
    ```  
    #define _MB_MAP_DIRECT  
    ```  
  
     Такой подход позволяет быстро решить проблему, если вы не хотите использовать поведение по умолчанию или не можете использовать встраивание. Это вызывает универсальную текстовую подпрограмму на отображается через макрос непосредственно на MBCS-версию подпрограммы, как показано в следующем фрагменте из Tchar.h.  
  
    ```  
    #define _tcschr _mbschr  
    ```  
  
     При использовании этого подхода необходимо следить, чтобы использовать соответствующие типы данных для строковых аргументов и возвращаемого значения. Можно воспользоваться явным приведением типов, чтобы гарантировать соответствие типов, либо универсальным строковым типом данных **_TXCHAR**. **_TXCHAR** сопоставляется с типом `char` в коде с однобайтовой Кодировкой, но сопоставляется с типом `unsigned` `char` в коде с многобайтовой Кодировкой. Дополнительные сведения об универсальных текстовых макросах см. в разделе [универсальные текстовые сопоставления](../c-runtime-library/generic-text-mappings.md) в *Справочник по библиотеке времени выполнения*.  
  
## <a name="see-also"></a>См. также  
 [Универсальные текстовые сопоставления в файле Tchar.h](../text/generic-text-mappings-in-tchar-h.md)
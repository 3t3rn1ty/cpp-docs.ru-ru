---
title: "Набор записей: блокировка (ODBC) | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "данные [C++], блокировка"
  - "блокировки [C++], наборы записей"
  - "наборы записей ODBC [C++], блокирование записей"
  - "оптимистическая блокировка"
  - "оптимистическая блокировка, ODBC"
  - "пессимистическая блокировка (ODBC)"
  - "наборы записей [C++], блокирование записей"
ms.assetid: 8fe8fcfe-b55a-41a8-9136-94a7cd1e4806
caps.latest.revision: 8
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 8
---
# Набор записей: блокировка (ODBC)
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

Данный раздел относится к классам ODBC библиотеки MFC.  
  
 Содержание раздела:  
  
-   [Виды блокировки записей](#_core_record.2d.locking_modes).  
  
-   [Как блокировать записи в наборе во время обновлений](#_core_locking_records_in_your_recordset).  
  
 При использовании набора записей для обновления записи в источнике данных приложение может блокировать запись, в результате одновременное обновление записи другим пользователем невозможно.  Состояние записи, обновляемой одновременно двумя пользователями, остается неопределенным, если система не сможет гарантировать одновременное обновление записи двумя пользователями.  
  
> [!NOTE]
>  В этом разделе приведены сведения, относящиеся к объектам, производным от класса `CRecordset`, в котором групповая выборка строк не реализована.  Если групповая выборка строк реализована, некоторые сведения могут быть неприменимы.  Например, нельзя вызвать функции\-члены **Edit** и **Update**.  Дополнительные сведения о групповой выборке строк см. в разделе [Набор записей. Групповая выборка строк \(ODBC\)](../Topic/Recordset:%20Fetching%20Records%20in%20Bulk%20\(ODBC\).md).  
  
##  <a name="_core_record.2d.locking_modes"></a> Режимы блокировки записей  
 Классы базы данных предоставляют два [режима блокирования записей](../Topic/CRecordset::SetLockingMode.md):  
  
-   Оптимистическая блокировка \(по умолчанию\)  
  
-   Пессимистическая блокировка  
  
 Обновление записи происходит в три этапа:  
  
1.  Операция начинается с вызова функции\-члена [Edit](../Topic/CRecordset::Edit.md).  
  
2.  Вы меняете соответствующие поля текущей записи.  
  
3.  Операция завершена, после чего обычно выполняется обновление посредством вызова функции\-члена [Update](../Topic/CRecordset::Update.md).  
  
 При оптимистической блокировке запись на источнике данных блокируется только при вызове **Update**.  Если оптимистическая блокировка используется в многопользовательской среде, то приложение должно обрабатывать условие сбоя функции **Update**.  При выполнении пессимистической блокировки запись блокируется как только вызывается **Edit** и не высвобождается до тех пор, пока не будет вызвана функция **Update** \(сбои обозначаются с помощью механизма `CDBException`, а не значениями **FALSE**, возвращаемыми функцией **Update**\).  Пессимистическая блокировка создает потенциальные проблемы с производительностью для других пользователей, так как при одновременном доступе к одной и той же записи придется ждать завершения процесса **Update** вашего приложения.  
  
##  <a name="_core_locking_records_in_your_recordset"></a> Блокировка записей в наборе записей  
 Если требуется изменить [режим блокировки](#_core_record.2d.locking_modes) объекта набора записей, заданный по умолчанию, то этот режим должен быть изменен до того, как будет вызван метод **Edit**.  
  
#### Изменение текущего режима блокировки для набора записей  
  
1.  Вызовите функцию\-член [SetLockingMode](../Topic/CRecordset::SetLockingMode.md), указывая **CRecordset::pessimistic** или **CRecordset::optimistic**.  
  
 Новый режим блокировки будет оставаться в силе до тех пор, пока не будет изменен или пока набор записей не будет закрыт.  
  
> [!NOTE]
>  В настоящее время относительно немного драйверов ODBC поддерживают пессимистическую блокировку.  
  
## См. также  
 [Набор записей \(ODBC\)](../../data/odbc/recordset-odbc.md)   
 [Набор записей. Объединение \(ODBC\)](../Topic/Recordset:%20Performing%20a%20Join%20\(ODBC\).md)   
 [Набор записей. Добавление, обновление и удаление записей \(ODBC\)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)
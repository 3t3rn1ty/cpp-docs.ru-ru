---
title: "Обмен полями записей: Принцип работы RFX | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- cpp-windows
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- C++
helpviewer_keywords:
- record editing [C++], using RFX
- RFX (ODBC) [C++], updating data in recordsets
- scrolling [C++]
- ODBC [C++], RFX
- data binding [C++], DFX
- scrolling [C++], RFX
- RFX (ODBC) [C++], binding fields and parameters
ms.assetid: e647cacd-62b0-4b80-9e20-b392deca5a88
caps.latest.revision: 
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: 5eac97bb87103bd72dfd721515baf58324fc851f
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="record-field-exchange-how-rfx-works"></a>Обмен данными с полями записей: Принцип работы RFX
В этом разделе объясняется процесс RFX. Это подробное объяснение темы:  
  
-   [RFX и набор записей](#_core_rfx_and_the_recordset)  
  
-   [Процесс RFX](#_core_the_record_field_exchange_process)  
  
> [!NOTE]
>  Этот раздел относится к классы, производные от `CRecordset` в какой строке массовая выборка не был реализован. Если вы используете выборка строк, реализуется блочный обмен полей записей (Bulk RFX). Bulk RFX аналогичен RFX. О различиях в разделе [набор записей: групповая выборка записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  
  
##  <a name="_core_rfx_and_the_recordset"></a>RFX и набор записей  
 Члены данных полей объекта набора записей, взятые вместе, составляют буфер редактирования, содержит выбранные столбцы одной записи. При первом открытии набор записей и происходит считывание первой записи, RFX связывает (ассоциирует) каждого выбранного столбца в адрес элемента данных соответствующего поля. Когда набор записей обновляет запись, RFX вызывает функции ODBC библиотек API для отправки SQL **обновления** или **вставить** инструкции к драйверу. RFX использует имеющуюся информацию элементов данных полей, чтобы указать столбцы для записи.  
  
 Платформа создает резервную копию в буфере на определенных этапах, при необходимости можно было восстановить его содержимое. RFX производит резервное копирование в буфере перед добавлением новой записи и редактированием существующей записи. После восстановления в буфере, в некоторых случаях, например, **обновление** следующий вызов `AddNew`. Если вы отказаться от новое изменение буфера редактирования отменяется, например, перемещение к другой записи до вызова метода не восстанавливается в буфере **обновление**.  
  
 Помимо обмена данными между источником данных и элементами данных полей набора записей, RFX управляет параметрами связывания. При открытии набора записей порядка привязанных членов данных параметров «?» местозаполнители в инструкции SQL, `CRecordset::Open` конструкции. Дополнительные сведения см. в разделе [набор записей: Параметризация набора записей (ODBC)](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md).  
  
 Переопределение класса набора записей `DoFieldExchange` выполняет всю работу, перемещая данные в обоих направлениях. Как обмен данными диалоговых окон (DDX) RFX требуются сведения об элементах данных этого класса. Мастер предоставляет необходимую информацию путем написания реализации для конкретного набора записей из `DoFieldExchange` , на основе поля данных члена имена и типы данных указываются с помощью мастера.  
  
##  <a name="_core_the_record_field_exchange_process"></a>Процесс обмена данными поля записи  
 В этом разделе описана последовательность событий RFX при открытии объекта набора записей и по мере добавления, обновления и удаления записей. Таблица [последовательность операций RFX во время открытия набора записей](#_core_sequence_of_rfx_operations_during_recordset_open) и таблицей [последовательность операций RFX во время прокрутки](#_core_sequence_of_rfx_operations_during_scrolling) в этом разделе показано, как процессы RFX **переместить**в наборе записей, и как RFX управляет обновлением. В ходе этих процессов [DoFieldExchange](../../mfc/reference/crecordset-class.md#dofieldexchange) вызывается для выполнения различных операций. **M_nOperation** данными-членом [разделе](../../mfc/reference/cfieldexchange-class.md) объекта определяет, какие операции. Может оказаться полезным для чтения [набор записей: как наборы записей выберите записей (ODBC)](../../data/odbc/recordset-how-recordsets-select-records-odbc.md) и [набор записей: как наборы записей обновления записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md) перед прочтением данного материала.  
  
###  <a name="_mfc_rfx.3a_.initial_binding_of_columns_and_parameters"></a>RFX: Начальной привязки столбцов и параметров  
 Следующие действия RFX выполняются в указанном порядке, при вызове объекта набора записей [откройте](../../mfc/reference/crecordset-class.md#open) функции-члена:  
  
-   Если набор записей содержит параметризованные члены данных, платформа вызывает `DoFieldExchange` для привязки параметров соответствует заполнителям параметров в строке инструкции SQL набора записей. Данные, зависящие от типа представление значения параметра используется для каждого местозаполнителя найдены в **ВЫБЕРИТЕ** инструкции. Это происходит после подготовки инструкции SQL, но перед его выполнением. Сведения о подготовке инструкции см. в разделе **:: SQLPrepare** функции в ODBC *Справочник программиста*.  
  
-   Платформа вызывает `DoFieldExchange` второй раз для связывания значений выбранных столбцов с соответствующими элементами данных полей в наборе записей. Это устанавливает объекта набора записей в качестве буфера редактирования, содержащего столбцы первой записи.  
  
-   Набор записей выполняет инструкцию SQL и источника данных выбирает первую запись. Столбцы записи загружаются в элементам данных полей.  
  
 В следующей таблице показана последовательность операций RFX при открытии набора записей.  
  
### <a name="_core_sequence_of_rfx_operations_during_recordset_open"></a>Последовательность операций RFX при открытии набора записей  
  
|Операция|DoFieldExchange операции|Операция базы данных/SQL|  
|--------------------|-------------------------------|-----------------------------|  
|1. Открыть набор записей.|||  
||2. Построение инструкции SQL.||  
|||3. Отправьте код SQL.|  
||4. Связывание элементов данных параметров.||  
||5. Связывание элементов данных полей со столбцами.||  
|||6. ODBC выполняет перемещение и заполнение данных.|  
||7. Привязка данных для C++.||  
  
 Наборы записей используют подготовленное исполнение ODBC позволяет быстро обновления запросов с той же инструкции SQL. Дополнительные сведения о выполнении подготовленной см. в ODBC SDK *Справочник программиста* в библиотеке MSDN.  
  
###  <a name="_mfc_rfx.3a_.scrolling"></a>RFX: прокрутка  
 Во время перехода от одной записи в другую, платформа вызывает `DoFieldExchange` для замены значений, ранее хранившиеся в поля элементов данных со значениями для новой записи.  
  
 В следующей таблице показана последовательность операций RFX при переходе от записи к записи.  
  
### <a name="_core_sequence_of_rfx_operations_during_scrolling"></a>Последовательность операций RFX во время прокрутки  
  
|Операция|DoFieldExchange операции|Операция базы данных/SQL|  
|--------------------|-------------------------------|-----------------------------|  
|1. Вызовите `MoveNext` или другие функции перемещения.|||  
|||2. ODBC выполняет перемещение и заполнение данных.|  
||3. Привязка данных для C++.||  
  
###  <a name="_mfc_rfx.3a_.adding_new_records_and_editing_existing_records"></a>RFX: Добавление новых записей и изменения существующих записей  
 При добавлении новой записи набор записей выполняет действия буфера редактирования для построения содержимого новой записи. При добавлении записей, при редактировании записей задействуется изменение значений элементов данных полей набора записей. С точки зрения RFX последовательности выглядит следующим образом:  
  
1.  При вызове набора записей [AddNew](../../mfc/reference/crecordset-class.md#addnew) или [изменить](../../mfc/reference/crecordset-class.md#edit) функция-член вызывает RFX сохраняет текущий буфер редактирования, чтобы его можно было впоследствии восстановить.  
  
2.  `AddNew`или **изменить** подготавливает поля в буфере редактирования, чтобы RFX мог обнаружить элементы измененных данных полей.  
  
     Так как новая запись не имеет предыдущих значений для сравнения с, `AddNew` задает значение для каждого элемента данных поля для **PSEUDO_NULL** значение. Позже, при вызове **обновление**, RFX сравнивает значение каждого элемента данных с **PSEUDO_NULL** значение. Если есть различие, задан элемент данных. (**PSEUDO_NULL** является таким же, как столбец записи со значением Null значение true, и любой из этих не совпадает с C++ **NULL**.)  
  
     В отличие от **обновление** вызова для `AddNew`, **обновление** вызова для **изменить** сравнивает обновленные значения с ранее сохраненных значений, а не с помощью **PSEUDO_NULL**. Различие состоит в том `AddNew` не имеет ранее сохраненных значений для сравнения.  
  
3.  Вы непосредственно значения элементов данных полей, значения которых требуется изменить или заполнить для новой записи. Это могут быть вызовом `SetFieldNull`.  
  
4.  При вызове [обновление](../../mfc/reference/crecordset-class.md#update) проверяются элементы измененных данных полей, как описано в шаге 2 (см. в таблице [последовательность операций RFX во время прокрутки](#_core_sequence_of_rfx_operations_during_scrolling)). Если ничего не изменилось, **обновление** возвращает 0. Если элементы данных полей изменились, **обновление** подготавливает и выполняет SQL **вставить** инструкцию, которая содержит значения для всех обновленных полей в записи.  
  
5.  Для `AddNew`, **обновление** завершается путем восстановления ранее сохраненные значения записи, которая была текущей до `AddNew` вызова. Для **изменить**, новые, отредактированные значения остаются без изменений.  
  
 В следующей таблице показана последовательность операций RFX при добавлении новой записи или изменить существующую запись.  
  
### <a name="sequence-of-rfx-operations-during-addnew-and-edit"></a>Последовательность операций RFX во время AddNew и редактирования  
  
|Операция|DoFieldExchange операции|Операция базы данных/SQL|  
|--------------------|-------------------------------|-----------------------------|  
|1. Вызовите `AddNew` или **изменить**.|||  
||2. Создайте резервную копию в буфере.||  
||3. Для `AddNew`, элементы данных полей как «clean» и Null.||  
|4. Присвоения значений элементам данных полей.|||  
|5. Вызовите **обновление**.|||  
||6. Проверка измененных полей.||  
||7. Построение SQL **вставить** инструкции для `AddNew` или **обновление** инструкции для **изменить**.||  
|||8. Отправьте код SQL.|  
||9. Для `AddNew`, восстанавливается в буфере резервную копию. Для **изменить**, удалите резервную копию.||  
  
### <a name="rfx-deleting-existing-records"></a>RFX: Удаление существующих записей  
 При удалении записи RFX задает всем полям **NULL** Напомним, что запись удаляется, и необходимо выполнить перемещение. Любые другие сведения о последовательности RFX не обязательно.  
  
## <a name="see-also"></a>См. также  
 [Обмен полями записей (RFX)](../../data/odbc/record-field-exchange-rfx.md)   
 [Потребление MFC ODBC](../../mfc/reference/adding-an-mfc-odbc-consumer.md)   
 [Макросы, глобальные функции и глобальные переменные](../../mfc/reference/mfc-macros-and-globals.md)  
 [Класс разделе](../../mfc/reference/cfieldexchange-class.md)   
 [CRecordset::DoFieldExchange](../../mfc/reference/crecordset-class.md#dofieldexchange)
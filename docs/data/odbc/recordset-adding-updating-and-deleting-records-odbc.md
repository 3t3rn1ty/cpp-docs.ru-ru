---
title: "Набор записей: Добавление, обновление и удаление записей (ODBC) | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-windows
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: C++
helpviewer_keywords:
- records [C++], updating
- record editing [C++], in recordsets
- recordsets [C++], adding records
- records [C++], adding
- ODBC recordsets [C++], adding records
- recordsets [C++], editing records
- recordsets [C++], updating
- records [C++], deleting
- AddNew method
- ODBC recordsets [C++], deleting records
- data in recordsets [C++]
- record editing [C++]
- recordsets [C++], deleting records
- ODBC recordsets [C++], editing records
- records [C++], editing
ms.assetid: 760c8889-bec4-482b-a8f2-319792a6af98
caps.latest.revision: "9"
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: cad50d25f6b9e2cc619fb19e21c2b6575ababa47
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="recordset-adding-updating-and-deleting-records-odbc"></a>Набор записей. Добавление, обновление и удаление записей (ODBC)
Этот раздел относится к классам MFC ODBC.  
  
> [!NOTE]
>  Теперь можно добавить записи в большом количестве более эффективно. Дополнительные сведения см. в разделе [набор записей: добавление записей (ODBC)](../../data/odbc/recordset-adding-records-in-bulk-odbc.md).  
  
> [!NOTE]
>  Этот раздел относится к объектам, производным от `CRecordset` в какой строке массовая выборка не был реализован. Если используется выборка строк, см. раздел [набор записей: групповая выборка записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  
  
 Обновляемые моментальные снимки динамических подмножеств данных позволяют добавлять, изменять (обновлять) и удаления записей. Содержание раздела:  
  
-   [Как определить, является ли набор записей обновляемым](#_core_determining_whether_your_recordset_is_updatable).  
  
-   [Добавление новой записи](#_core_adding_a_record_to_a_recordset).  
  
-   [Изменение существующей записи](#_core_editing_a_record_in_a_recordset).  
  
-   [Как удалить запись](#_core_deleting_a_record_from_a_recordset).  
  
 Дополнительные сведения про обновления выполнение и способы их отображения другим пользователям см [набор записей: как наборы записей обновления записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md). Как правило добавить, изменить или удалить запись набора записей изменяется, если источник данных немедленно. Вместо этого можно объединять группы связанных обновлений в транзакции. Если транзакция выполняется обновление не становится окончательным до фиксации транзакции. Это позволяет сделать назад или откатить изменения. Сведения о транзакциях см. в разделе [транзакции (ODBC)](../../data/odbc/transaction-odbc.md).  
  
 В следующей таблице перечислены параметры, доступные для наборов записей с разными характеристиками обновления.  
  
### <a name="recordset-readupdate-options"></a>Параметры чтения или обновление набора записей  
  
|Тип|Чтение|Изменение записи|Удалить запись|Добавить новый (append)|  
|----------|----------|-----------------|-------------------|------------------------|  
|Только чтение|Y|в|в|в|  
|Только присоединение|Y|в|в|Y|  
|Полностью обновляемый|Y|Y|Y|Y|  
  
##  <a name="_core_determining_whether_your_recordset_is_updatable"></a>Определение ли набор записей является обновляемым  
 Объект набора записей может изменяться, если источник данных является обновляемым и открыть набор записей как обновляемый. Его обновляемости также зависит от инструкции SQL, можно использовать, возможности драйвер ODBC и является ли библиотека курсоров ODBC в памяти. Не удается обновить только для чтения записей или данных источника.  
  
#### <a name="to-determine-whether-your-recordset-is-updatable"></a>Чтобы определить, является ли набор записей обновляемым  
  
1.  Вызов объекта набора записей [CanUpdate](../../mfc/reference/crecordset-class.md#canupdate) функции-члена.  
  
     `CanUpdate`возвращает ненулевое значение, если набор записей является обновляемым.  
  
 По умолчанию наборы данных являются полностью обновляемыми (можно выполнять `AddNew`, **изменить**, и **удалить** операций). Но можно также использовать [appendOnly](../../mfc/reference/crecordset-class.md#open) возможность открытия обновляемых наборов данных. Набор записей, открытый таким образом, позволяет только добавлять новые записи с помощью `AddNew`. Нельзя изменять или удалять существующие записи. Можно проверить, является ли набор записей открыт только для присоединения, вызвав [CanAppend](../../mfc/reference/crecordset-class.md#canappend) функции-члена. `CanAppend`возвращает ненулевое значение, если набор записей полностью обновляем или открыт только для присоединения.  
  
 В следующем коде показано, как можно использовать `CanUpdate` объекта набора записей с именем `rsStudentSet`:  
  
```  
if( !rsStudentSet.Open( ) )  
    return FALSE;  
if( !rsStudentSet.CanUpdate( ) )  
{  
    AfxMessageBox( "Unable to update the Student recordset." );  
    return;  
}  
```  
  
> [!CAUTION]
>  При подготовке к обновлению набора записей путем вызова **обновление**, будьте внимательны, что набор записей включает все столбцы, составляющие первичный ключ таблицы (или все столбцы уникального индекса в таблице). В некоторых случаях платформу можно использовать для определения записи в таблице для обновления только столбцы, выбранные в наборе записей. Без необходимых столбцов может обновить несколько записей в таблице с возможным повреждением ссылочную целостность таблицы. В этом случае платформа создает исключения, при вызове **обновление**.  
  
##  <a name="_core_adding_a_record_to_a_recordset"></a>Добавление записи в наборе записей  
 Можно добавить новые записи в набор записей, если его [CanAppend](../../mfc/reference/crecordset-class.md#canappend) функция-член возвращает ненулевое значение.  
  
#### <a name="to-add-a-new-record-to-a-recordset"></a>Чтобы добавить новую запись в набор записей  
  
1.  Убедитесь, что набор записей имеет возможность присоединения.  
  
2.  Вызов объекта набора записей [AddNew](../../mfc/reference/crecordset-class.md#addnew) функции-члена.  
  
     `AddNew`подготавливает набор записей в качестве буфера редактирования. Все члены данных полей задаются специальное значение Null и помечен как неизмененные, поэтому значения записываются в источник данных («грязных» данных), изменяются при вызове [обновление](../../mfc/reference/crecordset-class.md#update).  
  
3.  Значения элементов данных полей новой записи.  
  
     Присвоение значений поля элементов данных. Те, которые не будут назначены не записываются в источник данных.  
  
4.  Вызов объекта набора записей **обновление** функции-члена.  
  
     **Обновление** завершает процесс добавления, написав новую запись в источник данных. Дополнительные сведения о последствиях, если не удалось вызвать **обновление**, в разделе [набор записей: как наборы записей обновления записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  
  
 Сведения о принципы добавления записей и когда добавленных записей являются видимыми в наборе записей см. в разделе [набор записей: как AddNew, Edit и Delete (ODBC)](../../data/odbc/recordset-how-addnew-edit-and-delete-work-odbc.md).  
  
 Следующий пример демонстрирует добавление новой записи:  
  
```  
if( !rsStudent.Open( ) )  
    return FALSE;  
if( !rsStudent.CanAppend( ) )  
    return FALSE;                      // no field values were set  
rsStudent.AddNew( );  
rsStudent.m_strName = strName;  
rsStudent.m_strCity = strCity;  
rsStudent.m_strStreet = strStreet;  
if( !rsStudent.Update( ) )  
{  
    AfxMessageBox( "Record not added; no field values were set." );  
    return FALSE;  
}  
```  
  
> [!TIP]
>  Чтобы отменить `AddNew` или **изменить** сделайте другой вызов `AddNew` или **изменить** или вызвать **переместить** с **AFX_MOVE_REFRESH**  параметра. Члены данных сбрасываются в первоначальные значения, а вы все еще являются **изменить** или **добавить** режим.  
  
##  <a name="_core_editing_a_record_in_a_recordset"></a>Изменение записи в наборе записей  
 Можно изменить существующие записи, если набора записей [CanUpdate](../../mfc/reference/crecordset-class.md#canupdate) функция-член возвращает ненулевое значение.  
  
#### <a name="to-edit-an-existing-record-in-a-recordset"></a>Для изменения существующей записи в наборе записей  
  
1.  Убедитесь, что набор записей может изменяться.  
  
2.  Прокрутите записи, которые требуется обновить.  
  
3.  Вызов объекта набора записей [изменить](../../mfc/reference/crecordset-class.md#edit) функции-члена.  
  
     **Изменить** подготавливает набор записей в качестве буфера редактирования. Все члены данных полей помечаются, чтобы набор записей может впоследствии сообщать об их изменении. Новые значения для элементов данных измененных полей записываются в источнике данных при вызове [обновление](../../mfc/reference/crecordset-class.md#update).  
  
4.  Значения элементов данных полей новой записи.  
  
     Присвоение значений поля элементов данных. Эти значения не будут назначены оставаться без изменений.  
  
5.  Вызов объекта набора записей **обновление** функции-члена.  
  
     **Обновление** завершает процесс изменения записывая измененную запись в источнике данных. Дополнительные сведения о последствиях, если не удалось вызвать **обновление**, в разделе [набор записей: как наборы записей обновления записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  
  
 После изменения записи изменения запись сохраняется в текущей записи.  
  
 В следующем примере показан **изменить** операции. Предполагается, что пользователь перешел на запись, которую требуется изменить.  
  
```  
rsStudent.Edit( );  
rsStudent.m_strStreet = strNewStreet;  
rsStudent.m_strCity = strNewCity;  
rsStudent.m_strState = strNewState;  
rsStudent.m_strPostalCode = strNewPostalCode;  
if( !rsStudent.Update( ) )  
{  
    AfxMessageBox( "Record not updated; no field values were set." );  
    return FALSE;  
}  
```  
  
> [!TIP]
>  Чтобы отменить `AddNew` или **изменить** сделайте другой вызов `AddNew` или **изменить** или вызвать **переместить** с **AFX_MOVE_REFRESH**  параметра. Члены данных сбрасываются в первоначальные значения, а вы все еще являются **изменить** или **добавить** режим.  
  
##  <a name="_core_deleting_a_record_from_a_recordset"></a>Удаление записи из набора записей  
 Можно удалить записи, если набора записей [CanUpdate](../../mfc/reference/crecordset-class.md#canupdate) функция-член возвращает ненулевое значение.  
  
#### <a name="to-delete-a-record"></a>Чтобы удалить запись  
  
1.  Убедитесь, что набор записей может изменяться.  
  
2.  Прокрутите записи, которые требуется обновить.  
  
3.  Вызов объекта набора записей [удалить](../../mfc/reference/crecordset-class.md#delete) функции-члена.  
  
     **Удалить** сразу же помечает запись как удаленную в наборе записей и в источнике данных.  
  
     В отличие от `AddNew` и **изменить**, **удаление** не имеет соответствующей **обновление** вызова.  
  
4.  Перейти к другой записи.  
  
    > [!NOTE]
    >  При перемещении по набору записей, удаленные записи не могут быть пропущены. Дополнительные сведения см. в разделе [IsDeleted](../../mfc/reference/crecordset-class.md#isdeleted) функции-члена.  
  
 В следующем примере показан **удалить** операции. В примере предполагается, что выбрана запись, которую необходимо удалить. После **удалить** — вызывается, очень важно переместить в новую запись.  
  
```  
rsStudent.Delete( );  
rsStudent.MoveNext( );  
```  
  
 Дополнительные сведения о влиянии `AddNew`, **изменить**, и **удаление** функций-членов, в разделе [набор записей: как наборы записей обновления записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  
  
## <a name="see-also"></a>См. также  
 [Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)   
 [Набор записей. Блокировка (ODBC)](../../data/odbc/recordset-locking-records-odbc.md)
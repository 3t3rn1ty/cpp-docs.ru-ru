---
title: "Набор записей. Добавление, обновление и удаление записей (ODBC) | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "AddNew - метод"
  - "данные в наборах записей [C++]"
  - "наборы записей ODBC [C++], добавление записей"
  - "наборы записей ODBC [C++], удаление записей"
  - "наборы записей ODBC [C++], изменение записей"
  - "редактирование записей [C++]"
  - "редактирование записей [C++], наборы записей"
  - "записи [C++], добавление"
  - "записи [C++], удаление"
  - "записи [C++], редактирование"
  - "записи [C++], обновление"
  - "наборы записей [C++], добавление записей"
  - "наборы записей [C++], удаление записей"
  - "наборы записей [C++], изменение записей"
  - "наборы записей [C++], обновление"
ms.assetid: 760c8889-bec4-482b-a8f2-319792a6af98
caps.latest.revision: 9
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 9
---
# Набор записей. Добавление, обновление и удаление записей (ODBC)
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

Данный раздел относится к классам ODBC библиотеки MFC.  
  
> [!NOTE]
>  В настоящий момент существуют более эффективные способы массового добавления записей.  Дополнительные сведения см. в разделе [Набор записей. Массовое добавление записей \(ODBC\)](../../data/odbc/recordset-adding-records-in-bulk-odbc.md).  
  
> [!NOTE]
>  В этом разделе приведены сведения, относящиеся к объектам, производным от класса `CRecordset`, в котором групповая выборка строк не реализована.  При использовании групповой выборки строк следует ознакомиться с разделом [Набор записей: групповая выборка записей \(ODBC\)](../Topic/Recordset:%20Fetching%20Records%20in%20Bulk%20\(ODBC\).md).  
  
 Обновляемые моментальные снимки и динамическое множество позволяют добавлять, изменять \(обновлять\) и удалять записи.  Содержание раздела:  
  
-   [Как определить, является ли набор записей обновляемым](#_core_determining_whether_your_recordset_is_updatable).  
  
-   [Как добавить новую запись](#_core_adding_a_record_to_a_recordset).  
  
-   [Как изменить существующую запись](#_core_editing_a_record_in_a_recordset).  
  
-   [Как удалить запись](#_core_deleting_a_record_from_a_recordset).  
  
 Дополнительные сведения про выполнение обновлений и способы их отображения другим пользователям см. в разделе [Набор записей. Способы обновления записей в наборе \(ODBC\)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  Как правило, при добавлении, редактировании или удалении записи набор записей сразу же изменяет источник данных.  Вместо этого можно объединять группы связанных обновлений в трансакции.  Во время выполнения трансакции и до ее полного завершения обновление не становится окончательным.  Это дает возможность отменить внесенные изменения.  Дополнительные сведения про транзакции см. в разделе [Трансакция \(ODBC\)](../../data/odbc/transaction-odbc.md).  
  
 В приведенной ниже таблице перечислены параметры, доступные для наборов записей с разными характеристиками обновления.  
  
### Параметры набора записей "Чтение\/обновление"  
  
|Тип|Read|Изменить запись|Удалить запись|Добавить \(присоединить\) новую|  
|---------|----------|---------------------|--------------------|-------------------------------------|  
|Только для чтения|Y|N|N|N|  
|Только присоединение|Y|N|N|Y|  
|Полностью обновляемый|Y|Y|Y|Y|  
  
##  <a name="_core_determining_whether_your_recordset_is_updatable"></a> Определение, является ли набор записей обновляемым  
 Объект набора записей считается обновляемым, если источник данных является обновляемым и набор записей открыт как обновляемый.  Обновляемость объекта также зависит от используемой инструкции SQL, возможностей драйвера ODBC и наличия библиотеки курсоров ODBC в памяти.  Нельзя обновлять набор записей или источник данных, которые используются только для чтения.  
  
#### Чтобы определить, является ли набор записей обновляемым, выполните следующее.  
  
1.  Вызовите набор записей функции\-члена объекта [CanUpdate](../Topic/CRecordset::CanUpdate.md).  
  
     Если набор записей обновляемый `CanUpdate` возвращает ненулевое значение.  
  
 По умолчанию наборы данных являются полностью обновляемыми \(можно выполнять `AddNew`, **Правку** и **Удаление** операций\).  Однако для открытия обновляемых наборов данных также может использоваться параметр [appendOnly](../Topic/CRecordset::Open.md).  Набор записей, открытый таким образом, позволяет только добавлять новые записи с помощью параметра `AddNew`.  Изменение или удаление существующих записей из такого набора записей невозможно.  Проверить, открыт ли набор записей только для присоединения, можно путем вызова функции\-члена [CanAppend](../Topic/CRecordset::CanAppend.md).  Если набор записей полностью обновляем или открыт только для присоединения, `CanAppend` возвращает ненулевое значение.  
  
 В приведенном ниже коде показан пример использования `CanUpdate` для объекта набора записей `rsStudentSet`:  
  
```  
if( !rsStudentSet.Open( ) )  
    return FALSE;  
if( !rsStudentSet.CanUpdate( ) )  
{  
    AfxMessageBox( "Unable to update the Student recordset." );  
    return;  
}  
```  
  
> [!CAUTION]
>  При обновлении набора записей путем вызова функции **Обновить** убедитесь в том, что набор записей включает все колонки, образующие первичный ключ таблицы \(или все столбцы любого уникального индекса в таблице\).  В некоторых случаях для определения записи в наборе, нуждающейся в обновлении, платформа может использовать только столбцы, выбранные в наборе данных.  При отсутствии необходимых столбцов некоторые записи могут обновляться в таблице с возможным повреждением целостности данных таблицы на уровне ссылок.  В таком случае при вызове функции **Update** платформа создает исключения.  
  
##  <a name="_core_adding_a_record_to_a_recordset"></a> Добавление записи к набору  
 Добавлять записи в набор можно, если функция\-член [CanAppend](../Topic/CRecordset::CanAppend.md) возвращает ненулевое значение.  
  
#### Чтобы добавить новую запись в набор, необходимо выполнить следующее.  
  
1.  Убедитесь в том, что набор записей имеет возможность присоединения.  
  
2.  Вызовите функцию\-член объекта набора записей [AddNew](../Topic/CRecordset::AddNew.md).  
  
     `AddNew` подготавливает набор записей к выполнению функций буфера редактирования.  Для всех элементов данных поля устанавливается значение "Null" а функции, и все элементы помечаются как неизменные, таким образом, только изменяемые \(черновые\) значения прописываются в источник данных при вызове функции [Обновить](../Topic/CRecordset::Update.md).  
  
3.  Установите значения для новых элементов полей данных записи.  
  
     Присвойте значения элементам полей данных.  Неприсвоенные значения не прописываются в источнике данных.  
  
4.  Сделайте вызов функции\-члена объекта набора записей **Обновить**.  
  
     **Обновить** завершает процесс добавления, прописывая новую запись в источнике данных.  Дополнительные сведения о последствиях пропущенного вызова функции **Обновить** см. в разделе [Набор записей. Способы обновления записей в наборе \(ODBC\)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  
  
 Подробнее про принципы работы функции добавления и время отображения добавленных записей в наборе данных см. в разделе [Набор записей. Принципы работы функций добавления, правки и удаления \(ODBC\)](../../data/odbc/recordset-how-addnew-edit-and-delete-work-odbc.md).  
  
 В следующем примере показано добавление записи:  
  
```  
if( !rsStudent.Open( ) )  
    return FALSE;  
if( !rsStudent.CanAppend( ) )  
    return FALSE;                      // no field values were set  
rsStudent.AddNew( );  
rsStudent.m_strName = strName;  
rsStudent.m_strCity = strCity;  
rsStudent.m_strStreet = strStreet;  
if( !rsStudent.Update( ) )  
{  
    AfxMessageBox( "Record not added; no field values were set." );  
    return FALSE;  
}  
```  
  
> [!TIP]
>  Чтобы отменить вызов `AddNew` и **Правка**, сделайте другой вызов `AddNew` и **Правка**, или вызовите **Перемещение** с помощью параметра **AFX\_MOVE\_REFRESH**.  Если в это время активирован режим **Правка** или **Добавить**, элементам данных будут возвращены первоначальные значения.  
  
##  <a name="_core_editing_a_record_in_a_recordset"></a> Изменение записи в наборе  
 Изменить текущие записи можно, если функция\-член набора записей [CanUpdate](../Topic/CRecordset::CanUpdate.md) возвращает нулевое значение.  
  
#### Чтобы изменить существующую запись в наборе, выполните следующее.  
  
1.  Убедитесь в том, что набор записей обновляемый.  
  
2.  Перейдите к записи, которую нужно обновить.  
  
3.  Вызовите функцию\-член объекта набора записей [Правка](../Topic/CRecordset::Edit.md).  
  
     **Правка** подготавливает набор записей к выполнению функций буфера редактирования.  Все элементы полей данных помечаются, таким образом, набор записей может впоследствии сообщать об их изменении.  Новые значения для элементов данных измененных полей прописываются в источнике данных при вызове функции [Обновить](../Topic/CRecordset::Update.md).  
  
4.  Установите значения для новых элементов полей данных записи.  
  
     Присвойте значения элементам полей данных.  Элементы, которым не будут присвоены значения, останутся неизменными.  
  
5.  Сделайте вызов функции\-члена объекта набора записей **Обновить**.  
  
     Функция **Обновить** завершает процесс изменения, прописывая измененную запись в источнике данных.  Дополнительные сведения о последствиях пропущенного вызова функции **Обновить** см. в разделе [Набор записей. Способы обновления записей в наборе \(ODBC\)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  
  
 После изменения запись сохраняется в качестве текущей записи.  
  
 В следующем примере показана операция **Правки**.  Предполагается, что выбрана запись, которую необходимо изменить.  
  
```  
rsStudent.Edit( );  
rsStudent.m_strStreet = strNewStreet;  
rsStudent.m_strCity = strNewCity;  
rsStudent.m_strState = strNewState;  
rsStudent.m_strPostalCode = strNewPostalCode;  
if( !rsStudent.Update( ) )  
{  
    AfxMessageBox( "Record not updated; no field values were set." );  
    return FALSE;  
}  
```  
  
> [!TIP]
>  Чтобы отменить вызов `AddNew` и **Правка**, сделайте другой вызов `AddNew` и **Правка**, или вызовите **Перемещение** с помощью параметра **AFX\_MOVE\_REFRESH**.  Если в это время активирован режим **Правка** или **Добавить**, элементам данных будут возвращены первоначальные значения.  
  
##  <a name="_core_deleting_a_record_from_a_recordset"></a> Удаление записи из набора  
 Удалить записи можно, если функция\-член набора записей [CanUpdate](../Topic/CRecordset::CanUpdate.md) возвращает ненулевое значение.  
  
#### Чтобы удалить запись, выполните следующее.  
  
1.  Убедитесь в том, что набор записей обновляемый.  
  
2.  Перейдите к записи, которую нужно обновить.  
  
3.  Вызовите функцию\-член объекта набора записей [Удалить](../Topic/CRecordset::Delete.md).  
  
     Функция **Удалить** сразу же помечает запись как удаленную в наборе данных и в источнике данных.  
  
     В отличие от `AddNew` и **Правка**, **Удалить** не имеет соответствующего вызова **Обновить**.  
  
4.  Перейдите к другой записи.  
  
    > [!NOTE]
    >  При перемещении по набору записей удаленные записи могут не пропускаться.  Дополнительные сведения см. в описании функции\-члена [IsDeleted](../Topic/CRecordset::IsDeleted.md).  
  
 В следующем примере показана выполненная операция **Удаления**.  Предполагается, что выбрана запись, которую необходимо удалить.  После вызова функции **Удалить** необходимо перейти к новой записи.  
  
```  
rsStudent.Delete( );  
rsStudent.MoveNext( );  
```  
  
 Дополнительные сведения про действие функций\-членов `AddNew`, **Правка** и **Удалить** см. в разделе [Набор записей. Способы обновления записей в наборе \(ODBC\)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  
  
## См. также  
 [Набор записей \(ODBC\)](../../data/odbc/recordset-odbc.md)   
 [Набор записей: блокировка \(ODBC\)](../../data/odbc/recordset-locking-records-odbc.md)
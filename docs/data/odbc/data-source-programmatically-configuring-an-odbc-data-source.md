---
title: "Источник данных: Программная настройка источника данных ODBC | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-windows
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords: SQLConfigDataSource
dev_langs: C++
helpviewer_keywords:
- ODBC data sources, configuring
- SQLConfigDataSource method example
- ODBC connections, configuring
- configuring ODBC data sources
ms.assetid: b8cabe9b-9e12-4d73-ae36-7cb12dee3213
caps.latest.revision: "10"
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: ac5756452a8b1c2d5dbf2f27ac7d3e1a8b069ca2
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="data-source-programmatically-configuring-an-odbc-data-source"></a>Источник данных. Программная настройка источника данных ODBC
В этом разделе объясняется, как программным образом можно настроить имена источников данных Open Database Connectivity (ODBC). Это обеспечивает гибкость для доступа к данным без перезагрузки пользователю явно использовать администратор ODBC или другие программы, чтобы указать имена источников данных.  
  
 Как правило пользователь запускает администратор ODBC, чтобы создать источник данных, если система управления связанной базы данных (СУБД) поддерживает эту операцию.  
  
 При создании источника данных Microsoft Access ODBC помощью администратора ODBC, предлагаются два варианта: можно выбрать существующий файл .mdb или можно создать новый файл. Нет программного метода для создания MDB-файла из приложения ODBC библиотеки MFC. Таким образом Если приложению требуется размещать данные в источник данных Microsoft Access (MDB-файл), скорее всего требуется пустой MDB-файл, который можно использовать или копировать всякий раз, когда он нужен.  
  
 Однако многие СУБД позволяют создавать источник данных программными средствами. Некоторые источники данных поддерживают спецификацию каталогов для баз данных. То есть каталог является источником данных, и каждая таблица в источнике данных хранится в отдельном файле (в случае dBASE, каждая таблица имеет DBF-файл). Драйверы для других баз данных ODBC, например Microsoft Access и SQL Server требует, что некоторые определенных критериев, прежде чем можно будет установить источника данных. Например при использовании драйвера ODBC для SQL Server, необходимо было установлено на компьютер SQL Server.  
  
##  <a name="_core_sqlconfigdatasource_example"></a>Пример SQLConfigDataSource  
 В следующем примере используется **:: SQLConfigDataSource** функции ODBC API для создания нового источника данных Excel вызывается новый источник данных для Excel:  
  
```  
SQLConfigDataSource(NULL,ODBC_ADD_DSN, "Excel Files (*.xls)",   
                   "DSN=New Excel Data Source\0"   
                   "Description=New Excel Data Source\0"   
                   "FileType=Excel\0"   
                   "DataDirectory=C:\\EXCELDIR\0"   
                   "MaxScanRows=20\0");  
```  
  
 Обратите внимание, что источник данных — это каталог (C:\EXCELDIR); Этот каталог должен существовать. Драйвер Excel использует каталоги как источники данных, а файлы как отдельные таблицы (по одной таблице на XLS-файл).  
  
 Дополнительные сведения о создании таблиц см. в разделе [источника данных: создание таблицы в источнике данных ODBC программным путем](../../data/odbc/data-source-programmatically-creating-a-table-in-an-odbc-data-source.md).  
  
 Следующие сведения, касающиеся параметров, которые должны быть переданы **:: SQLConfigDataSource** функции ODBC API. Для использования **:: SQLConfigDataSource**, необходимо включить файл заголовка Odbcinst.h и использовать библиотеку импорта Odbcinst.lib. Кроме того Odbccp32.dll должен находиться в пути во время выполнения (или Odbcinst.dll для 16-разрядных).  
  
 Можно создать имя источника данных ODBC с помощью администратора ODBC или другой подобной программы. Тем не менее иногда бывает нежелательно создавать имя источника данных непосредственно из приложения, чтобы получать доступ без взаимодействия с пользователем запускать отдельную программу.  
  
 Администратор ODBC (обычно устанавливается на панели управления) создает новый источник данных, размещая записи в реестре Windows (или, для 16-разрядных, в файле Odbc.ini). Диспетчер драйверов ODBC запрашивает этот файл, чтобы получить необходимую информацию об источнике данных. Важно понимать, какие сведения необходимо размещать в реестре, так как необходимо ввести его при вызове **:: SQLConfigDataSource**.  
  
 Хотя эти сведения можно записать непосредственно в реестр без использования **:: SQLConfigDataSource**, любое приложение, которое делает это полагается на текущий метод, который использует диспетчер драйверов хранит свои данные. Если в более поздней версии диспетчера драйверов ODBC реализует учета источники данных по-разному, любое приложение, которое использует этот метод будет нарушена. Обычно рекомендуется использовать функцию API, если она существует. Например, можно перенести на 16-разрядных на 32-разрядная версия кода при использовании **:: SQLConfigDataSource** работать, так как она всегда корректно записывает данные в файл Odbc.ini или в реестр.  
  
##  <a name="_core_sqlconfigdatasource_parameters"></a>Параметры SQLConfigDataSource  
 Ниже рассматриваются параметры **:: SQLConfigDataSource** функции. Значительная часть информации, берется из API-интерфейса ODBC *Справочник программиста* вместе с Visual C++ версии 1.5 и более поздних версий.  
  
###  <a name="_core_function_prototype"></a>Прототип функции  
  
```  
BOOL SQLConfigDataSource(HWND hwndParent,UINT fRequest, LPCSTR lpszDriver, LPCSTR lpszAttributes);  
```  
  
### <a name="remarks"></a>Примечания  
  
####  <a name="_core_parameters_and_usage"></a>Параметры и использование  
 *hwndParent*  
 Окна, указанную как владелец все диалоговые окна, создаваемые диспетчером драйверов ODBC или конкретный драйвер ODBC для получения дополнительных сведений от пользователя о новом источнике данных. Если `lpszAttributes` параметр не предоставляет достаточно сведений, появится диалоговое окно. *HwndParent* параметр может быть **NULL**.  
  
 `lpszDriver`  
 Описание драйвера. Это имя, представляемое пользователям вместо имени физического драйвера (DLL).  
  
 `lpszAttributes`  
 Список атрибутов в форме «keyname = значение». Эти строки разделяются символом конца с двух последовательных символы конца строки в конец списка. Эти атрибуты являются в первую очередь по умолчанию драйвера операций, которые записываются в реестре для нового источника данных. Важный параметр, не упоминается в справочнике по API-интерфейса ODBC для этой функции — «DSN» («имя источника данных»), который указывает имя нового источника данных. Остальная часть операции специфичны для драйвера для нового источника данных. Часто это необходимо для предоставления все записи, так как драйвер может предложить пользователю с диалоговыми окнами для новых значений. (Значение *hwndParent* для **NULL** вызвать это.) Можно явно задать значения по умолчанию, чтобы пользователю не предлагается.  
  
###### <a name="to-determine-the-description-of-a-driver-for-the-lpszdriver-parameter-using-odbc-administrator"></a>Чтобы определить описание драйвера для параметра lpszDriver с помощью администратора ODBC  
  
1.  Запустите администратор ODBC.  
  
2.  Нажмите кнопку **Добавить**.  
  
 Это дает список установленных драйверов и их описания. Используйте описание в качестве `lpszDriver` параметра. Обратите внимание, что используется всего описания, например «Файлы Excel (*.xls)», включая расширение имени файла и круглые скобки, если они существуют в описании.  
  
 Кроме того, можно просмотреть реестр (или, для 16-разрядных, файл Odbcinst.ini), который содержит список всех драйверов записи и описания раздела реестра «Драйверы ODBC» (или раздел [ODBC Drivers] файла Odbcinst.ini).  
  
 Чтобы найти имена параметров и их значения для `lpszAttributes` параметр является файл Odbc.ini для уже настроенного источника данных (возможно, настроенного администратором ODBC).  
  
###### <a name="to-find-keynames-and-values-for-the-lpszattributes-parameter"></a>Чтобы найти имена параметров и их значения для параметра lpszAttributes  
  
1.  Запустите редактор реестра Windows (или, для 16-разрядных, откройте файл Odbc.ini).  
  
2.  Найти сведения об источниках данных ODBC с помощью одного из следующих:  
  
    -   Для 32-разрядных найти ключ **HKEY_CURRENT_USER\Software\ODBC\ODBC. Источники данных INI\ODBC** в левой области.  
  
         В правой части перечислены записи в формате: «pub: REG_SZ:*<data source name>*», где  *<data source name>*  является источником данных, который уже был настроен с требуемыми параметрами для используемого драйвера для использования. Выберите источник данных, который требуется, например, SQL Server. Элементы за строкой «pub:» являются имя параметра и значение для использования в вашей `lpszAttributes` параметра.  
  
    -   В 16-разрядных найдите раздел в файле Odbc.ini, помеченного [*\<источник данных >*].  
  
         Строки, следующие за этой строкой, представляют собой формы «keyname = значение». Ниже приведены конкретные операции для использования в вашей `lpszAttributes` параметра.  
  
 Можно также изучить документацию по отдельному драйверу, который планируется использовать. Полезные сведения можно найти в разделе справки для драйвера, к которому можно получить, выполнив администратор ODBC. Эти файлы справки обычно размещаются в каталоге системную для Windows NT, Windows 95 или Windows 3.1.  
  
###### <a name="to-obtain-online-help-for-your-odbc-driver"></a>Чтобы получить справку в Интернете по драйверу ODBC  
  
1.  Запустите администратор ODBC.  
  
2.  Нажмите кнопку **Добавить**.  
  
3.  Выберите имя драйвера.  
  
4.  Нажмите кнопку **ОК**.  
  
 Администратор ODBC отобразит сведения для создания нового источника данных для этого драйвера, нажмите кнопку **справки**. Откроется файл справки для этого драйвера, в котором содержатся важные сведения по использованию драйвера.  
  
## <a name="see-also"></a>См. также  
 [Источник данных (ODBC)](../../data/odbc/data-source-odbc.md)
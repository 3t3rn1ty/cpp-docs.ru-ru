---
title: "Набор записей: Динамическая привязка столбцов данных (ODBC) | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- cpp-windows
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- C++
helpviewer_keywords:
- ODBC recordsets [C++], binding columns dynamically
- data binding [C++], recordset columns
- recordsets [C++], binding data
- data binding [C++], columns in recordsets
- columns [C++], binding to recordsets
ms.assetid: bff67254-d953-4ae4-9716-91c348cb840b
caps.latest.revision: 
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: 2e834820266e83d2c07bbe46f07e2ac48b0d18e0
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="recordset-dynamically-binding-data-columns-odbc"></a>Набор записей. Динамическая привязка столбцов данных (ODBC)
Этот раздел относится к классам MFC ODBC.  
  
 Наборы записей управляют привязкой столбцов таблицы, указанные во время разработки, но бывают случаи, когда может потребоваться привязать столбцы, неизвестные во время разработки. Содержание раздела:  
  
-   [Когда может потребоваться динамическая привязка столбцов к набору записей](#_core_when_you_might_bind_columns_dynamically).  
  
-   [Динамическая привязка столбцов во время выполнения как](#_core_how_to_bind_columns_dynamically).  
  
> [!NOTE]
>  Этот раздел относится к объектам, производным от `CRecordset` в какой строке массовая выборка не был реализован. При использовании выборка строк не рекомендуется использовать методы, описанные в этом разделе. Дополнительные сведения о массовой выборке строк см. в разделе [набор записей: групповая выборка записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  
  
##  <a name="_core_when_you_might_bind_columns_dynamically"></a>Когда вы может динамическая привязка столбцов  
 Во время разработки, мастер приложений MFC или [мастер потребителей ODBC MFC](../../mfc/reference/adding-an-mfc-odbc-consumer.md) (из **добавить класс**) создают классы набора записей на основе известных таблиц и столбцов в источнике данных. Базы данных могут измениться при их разработки и более поздней версии, когда приложение использует эти таблицы и столбцы во время выполнения. Пользователь может добавить или удалить таблицу или добавлять или удалять столбцы из таблицы, которая использует набор записей приложения. Это, скорее всего, не имеет значения для всех приложений, доступ к данным, но если это приложение пользователя, то он сможет обработать изменения в схему базы данных, отличный от переработки и повторной компиляции? В этом разделе, предназначена для ответа на этот вопрос.  
  
 В этом разделе описываются наиболее распространенный случай, в котором может привязывать столбцы динамически — начиная с набором записей, на основе схемы известные базы данных, необходимо обработать дополнительные столбцы во время выполнения. Далее предполагается, что эти дополнительные столбцы сопоставляются с `CString` полей с данными, наиболее распространенным случаем, несмотря на то, что предлагаются способы для обработки других типов данных.  
  
 С небольшой объем дополнительного кода вы можете:  
  
-   [Определить, какие столбцы доступны во время выполнения](#_core_how_to_bind_columns_dynamically).  
  
-   [Динамически привязать дополнительные столбцы к набору записей, во время выполнения](#_core_adding_the_columns).  
  
 Набор записей по-прежнему содержит элементы данных для столбцов, известных во время разработки. Он также содержит небольшой дополнительный код, который динамически определяет, были ли добавлены новые столбцы в целевую таблицу и привязывает эти новые столбцы для хранения, выделенных на динамически (а не для элементов данных набора записей).  
  
 В этом разделе не охватывает другие случаи динамической привязки, такие как удаление таблиц или столбцов. В тех случаях необходимо напрямую использовать вызовы ODBC API. Сведения см. в разделе ODBC SDK *Справочник программиста* на компакт-диске библиотеки MSDN.  
  
##  <a name="_core_how_to_bind_columns_dynamically"></a>Как динамическая привязка столбцов  
 Динамическая привязка столбцов, необходимо знать (или может определить) имена дополнительных столбцов. Необходимо также выделения хранилища для дополнительных полей элементов данных, указать их имена и типы и укажите количество столбцов, которые вы добавляете.  
  
 Ниже упоминаются два различных набора записей. Первый — основной набор записей для отбора записей из целевой таблицы. Второе — набор записей специальный столбец используется для получения сведений о столбцах в целевой таблице.  
  
###  <a name="_core_the_general_process"></a>Общий процесс  
 На самом общем уровне, выполните следующие действия.  
  
1.  Создания объекта основного набора записей.  
  
     При необходимости передать указатель на открытый `CDatabase` объекта или можно получить сведения о подключении к набору записей столбцов иным способом.  
  
2.  Выполните действия для динамической привязки столбцов.  
  
     Процесс, описанный в добавления столбцов ниже в разделе.  
  
3.  Откройте основного набора записей.  
  
     Набор записей выбирает записи и использует обмен полями записей (RFX) для привязки статических столбцов (сопоставленных с элементами данных полей набора) и динамических столбцов (сопоставляется дополнительное хранилище, которое можно выделить).  
  
###  <a name="_core_adding_the_columns"></a>Добавление столбцов  
 Динамическая привязка добавлены столбцы во время выполнения необходимо выполнить следующие действия:  
  
1.  Во время выполнения определите, какие столбцы расположены в целевой таблице. Получить список столбцов, которые были добавлены в таблицу, так как был разработан класса набора записей.  
  
     Рекомендуется использовать класс столбцов набора записей для запросов к источнику данных, сведений о столбце для целевой таблицы (например, столбец имя и тип данных).  
  
2.  Предоставление хранилища для новых членов данных поля. Поскольку класс основного набора записей нет элементов данных полей для неизвестных столбцов, необходимо указать место для хранения имен, результирующих значений и возможно сведения о типе данных (если столбцы имеют разные типы данных).  
  
     Один из подходов заключается в том, чтобы построить один или несколько динамических списков, один для имен новых столбцов, другой для результирующих значений, а третий — для их типы данных (при необходимости). Эти списки, в частности список значений, предоставляют сведения и хранилище для привязки. На следующем рисунке показано построение списков.  
     ![Построение списков столбцов для динамической привязки](../../data/odbc/media/vc37w61.gif "vc37w61")  
Построение списков столбцов для динамической привязки  
  
3.  Добавьте вызов функции RFX в основного набора записей `DoFieldExchange` функции для каждого добавленного столбца. Эти вызовы выполняют работу по выборке записи, включая дополнительные столбцы и привязки столбцов к элементам данных набора записей или к динамическому хранилищу для них.  
  
     Можно добавить цикл основного набора записей `DoFieldExchange` функцию, которая просматривает список новых столбцов и вызывающий соответствующую функцию RFX для каждого столбца в списке. При каждом вызове RFX следует передавайте имя столбца из списка имен столбцов и расположение хранилища в соответствующий элемент списка результирующих значений.  
  
###  <a name="_core_lists_of_columns"></a>Списки столбцов  
 В следующей таблице показаны четыре списка, необходимые для работы с.  
  
 **Столбцы текущей таблицы (список 1 на рисунке)** список столбцов в таблице в источнике данных. Этот список может совпадает со списком столбцов, в данный момент привязанных к набору записей.  
  
 **Список столбцов, привязанных к набору записей (список 2 на рисунке)**  
 Список столбцов, привязанных к набору записей. Эти столбцы уже есть инструкций RFX в вашей `DoFieldExchange` функции.  
  
 **Столбцы для-динамически привязать (список 3 на рисунке)**  
 Список столбцов в таблице, но не в наборе записей. Этими значениями являются столбцы, необходимые для динамической привязки.  
  
 **Значения динамических столбцов (список 4 на рисунке)**  
 Динамическая привязка столбцов получить список, содержащий значения. Элементы этого списка соответствуют элементам в столбцы для динамически привязать, один к одному.  
  
###  <a name="_core_building_your_lists"></a>Построение списков  
 С общая стратегия помните вы можете включить подробные сведения. Процедуры, описанные в остальной части этого раздела показано, как построить списки, показанные на рисунке [списки столбцов](#_core_lists_of_columns). Описываются процедуры:  
  
-   [Определение имен столбцов, отсутствующих в наборе записей](#_core_determining_which_table_columns_are_not_in_your_recordset).  
  
-   [Предоставление динамического хранилища для новых добавленных в таблицу столбцов](#_core_providing_storage_for_the_new_columns).  
  
-   [Динамическое добавление RFX вызывает для новых столбцов](#_core_adding_rfx_calls_to_bind_the_columns).  
  
###  <a name="_core_determining_which_table_columns_are_not_in_your_recordset"></a>Определение столбцов, отсутствующих в наборе записей  
 Постройте список (столбцы, привязанные к набору записей, список 2 на рисунке), содержащий список столбцов, которые уже привязаны к основному набору записей. Затем постройте список (столбцы для динамически привязать, производными от текущих столбцов в таблицы и столбцы привязанные к набору записей), содержащий имена столбцов, которые содержатся в таблице в источнике данных, но не в основного набора записей.  
  
##### <a name="to-determine-the-names-of-columns-not-in-the-recordset-columns-to-bind-dynamically"></a>Чтобы определить имена столбцов, отсутствующих в наборе записей (столбцы для динамически привязать)  
  
1.  Создает список столбцов уже привязаны к основному набору записей (столбцы привязанные к набору записей).  
  
     Один подход заключается в создании записей-столбцов, привязанных к во время разработки. Можно визуально изучить вызовы функций RFX в наборе записей `DoFieldExchange` функцию для получения этих имен. Затем настройте список как массив, инициализируемый именами.  
  
     Например на рисунке показан список столбцов, привязанных к набору записей (список 2) с тремя элементами. Набор записей-столбцов, привязанных к отсутствует столбец "Phone" отображаются в столбцах текущей таблицы (список 1).  
  
2.  Сравнение текущих столбцов в таблице и набор записей-столбцов, привязанных к для построения списка столбцов, которые еще не привязан к основному набору записей (столбцы для динамически привязать).  
  
     Одним из подходов является циклический перебор по списку столбцов в таблице во время выполнения (столбцов текущей таблицы) и список столбцов, которые уже привязаны в наборе записей (столбцы привязанные к набору записей) в параллельном режиме. В столбцы, которые необходимо привязать динамически, добавьте имена в текущий столбцов в таблице, не отображаются в столбцы привязанные к набору записей.  
  
     Например, на рисунке показан (список 3) с одним элементом: столбец "Phone" найдено в столбцах текущей таблицы (список 1), но не в список столбцов, привязанных к набору записей (список 2).  
  
3.  Постройте список столбцов значений динамических (как список 4 на рисунке), в котором для хранения значений данных, соответствующее имя каждого столбца хранятся в списке столбцов для динамической привязки (столбцы для динамически привязать).  
  
     Элементы этого списка играют роль нового набора записей поля элементов данных. Они являются места хранения, с которым связаны динамических столбцов. Описание списков см. в разделе [списки столбцов](#_core_lists_of_columns).  
  
###  <a name="_core_providing_storage_for_the_new_columns"></a>Предоставление хранилища для новых столбцов  
 Настройте места хранения для столбцов привязываться динамически. Идея состоит в предоставлении элемент списка, в котором для хранения значений каждого столбца. Эти расположения хранилища параллельных переменных-членов набора записей, в которых хранятся обычные привязанные столбцы.  
  
##### <a name="to-provide-dynamic-storage-for-new-columns-dynamic-column-values"></a>Предоставление динамического хранилища для новых столбцов (значений динамических столбцов)  
  
1.  Построение динамических значений столбцов, параллельно столбцы для динамически привязать, используется для хранения значения данных в каждом столбце.  
  
     Например, на рисунке значений динамических столбцов (список 4) с одним элементом: `CString` объект, содержащий фактический номер телефона для текущей записи: «555-1212».  
  
     В общем случае значений динамических столбцов содержатся элементы типа `CString`. При работе со столбцами в различных типов данных требуется список, который может содержать элементы различных типов.  
  
 Из предыдущих процедур станет двумя основными списками: столбцы к динамически привязать, содержащий имена столбцов и динамических значений столбцов со значениями в столбцах для текущей записи.  
  
> [!TIP]
>  Если новые столбцы не все тот же тип данных, может потребоваться дополнительный параллельный список, содержащий элементы, определяющие тип каждого элемента в списке столбцов. (Можно использовать значения **AFX_RFX_BOOL**, **AFX_RFX_BYTE**, и т. д., для его, если требуется. Эти константы определены в файле AFXDB. З.) Выберите тип списка, в зависимости от того, как представления типов данных столбцов.  
  
###  <a name="_core_adding_rfx_calls_to_bind_the_columns"></a>Добавление вызовов функций RFX для привязки столбцов  
 Наконец, выполните действия для динамической привязки, поместив вызовы функций RFX для новых столбцов в вашей `DoFieldExchange` функции.  
  
##### <a name="to-dynamically-add-rfx-calls-for-new-columns"></a>Динамическое добавление вызовов RFX для новых столбцов  
  
1.  В основной набор записей `DoFieldExchange` члена функции, добавьте код, который просматривает список новых столбцов (столбцы для динамически привязать). В каждой итерации цикла получайте имя столбца из столбцов, которые необходимо привязать динамически и результирующее значение для столбца из значений динамических столбцов. Передайте эти элементы в вызовах функций RFX подходящий для типа данных столбца. Описание списков см. в разделе [списки столбцов](#_core_lists_of_columns).  
  
 В общем случае в вашей `RFX_Text` вызовах функции `CString` объекты из списков, как показано в следующем кода, где столбцы, которые необходимо привязать динамически — `CStringList` вызывается `m_listName` и значенийдинамическихстолбцов`CStringList` вызывается `m_listValue`:  
  
```  
RFX_Text( pFX,   
            m_listName.GetNext( posName ),   
            m_listValue.GetNext( posValue ));  
```  
  
 Дополнительные сведения о функциях RFX см. в разделе [макросы и глобальные объекты](../../mfc/reference/mfc-macros-and-globals.md) в *Справочник по библиотеке классов*.  
  
> [!TIP]
>  Если новые столбцы имеют разные типы данных, следует используйте инструкцию switch в цикле вызов соответствующей функции RFX для каждого типа.  
  
 Когда платформа вызывает `DoFieldExchange` во время **откройте** процесса для привязки столбцов к набору записей, вызовы функций RFX для статических столбцов привязывают эти столбцы. Затем цикл многократно вызывает функции RFX для динамических столбцов.  
  
## <a name="see-also"></a>См. также  
 [Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)   
 [Набор записей. Работа с большими элементами данных (ODBC)](../../data/odbc/recordset-working-with-large-data-items-odbc.md)
---
title: "Набор записей. Создание и закрытие наборов записей (ODBC) | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "наборы записей ODBC, закрытие"
  - "наборы записей ODBC, создание"
  - "наборы записей ODBC, открытие"
  - "наборы записей, закрытие"
  - "наборы записей, создание"
  - "наборы записей, открытие"
ms.assetid: 8d2aac23-4396-4ce2-8c60-5ecf1b360d3d
caps.latest.revision: 8
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 8
---
# Набор записей. Создание и закрытие наборов записей (ODBC)
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

Данный раздел относится к классам ODBC библиотеки MFC.  
  
 Чтобы воспользоваться набором записей, создайте объект набора записей и затем вызовите его функцию\-член **Open**, чтобы выполнить запрос набора записей, и заполнить его.  После завершения работы с набором записей закройте и удалите этот объект.  
  
 Содержание раздела:  
  
-   [Когда и как следует создавать объект набора записей](#_core_creating_recordsets_at_run_time).  
  
-   [Когда и каким образом можно определять поведение набора записей путем его параметризации, фильтрации или блокировки](#_core_setting_recordset_options).  
  
-   [Когда и как следует закрывать объект набора записей](#_core_closing_a_recordset).  
  
##  <a name="_core_creating_recordsets_at_run_time"></a> Создание наборов записей во время выполнения  
 Перед тем, как создать объекты наборов записей в своей программе, обычно вы создаете классы наборов записей для конкретных приложений.  Дополнительные сведения об этом предварительном этапе см. в разделе [Добавление получателя MFC ODBC](../../mfc/reference/adding-an-mfc-odbc-consumer.md).  
  
 Откройте динамическое подмножество данных или создайте моментальный снимок объекта, если требуется выбрать записи из источника данных.  Тип создаваемого объекта зависит от того, какие операции с данными требуется выполнять в вашем приложении, а также от того, какие операции поддерживает ваш драйвер ODBC.  Дополнительные сведения см. в разделах [Динамическое подмножество данных](../../data/odbc/dynaset.md) и [Моментальный снимок](../Topic/Snapshot.md).  
  
#### Открытие набора записей  
  
1.  Создайте объект класса, производного от класса `CRecordset`.  
  
     Этот объект можно создать в куче или в кадре стека функции.  
  
2.  При необходимости измените свойства набора записей, заданные по умолчанию.  Дополнительные сведения о доступных параметрах см. в разделе [Настройка параметров набора записей](#_core_setting_recordset_options).  
  
3.  Вызовите функцию\-член [Open](../Topic/CRecordset::Open.md) этого объекта.  
  
 В конструкторе передайте указатель объекту `CDatabase` или передайте **NULL**, чтобы использовать временный объект базы данных, создаваемый и открываемый платформой в зависимости от строки подключения, возвращаемой функцией\-членом [GetDefaultConnect](../Topic/CRecordset::GetDefaultConnect.md).  Возможно, что объект `CDatabase` уже подключен к источнику данных.  
  
 При вызове функции **Open** используется SQL\-директива для выборки записей из источника данных.  Первая выбранная запись \(если имеется\) будет текущей записью.  Значения полей этой записи сохраняются в данных\-членах поля объекта набора данных.  Если выбраны записи, то функции\-члены `IsBOF` и `IsEOF` возвращают значение 0.  
  
 При выполнении вызова [Open](../Topic/CRecordset::Open.md) можно выполнять следующие действия:  
  
-   Указывать, является ли набор записей динамическим множеством или моментальным снимком.  По умолчанию наборы записей открываются как моментальные снимки.  Либо можно указать набор записей, просматриваемых вперед, при этом переходы в наборе записей разрешены только вперед и только по одной записи.  
  
     По умолчанию в наборе записей используется стандартный тип, хранящийся в данных\-членах `CRecordset` **m\_nDefaultType**.  С помощью мастеров можно записать код инициализации **m\_nDefaultType** в набор записей, выбираемый в мастере.  Вместо того, чтобы использовать параметры по умолчанию, можно подставить другой тип набора записей.  
  
-   Указать строку для замены стандартной SQL\-директивы **SELECT**, создаваемой набором записей.  
  
-   Указать, является ли набор записей доступным только для чтения или только для присоединения.  По умолчанию наборы записей могут полностью обновляться, но это свойство можно ограничить добавлением только новых записей, либо запретить все обновления.  
  
 В следующем примере показано, как открыть объект моментального снимка класса `CStudentSet`, зависящего от приложения:  
  
```  
// Construct the snapshot object  
CStudentSet rsStudent( NULL );  
// Set options if desired, then open the recordset  
if(!rsStudent.Open(CRecordset::snapshot, NULL, CRecordset::readOnly))  
    return FALSE;  
// Use the snapshot to operate on its records...  
```  
  
 После вызова **Open** можно использовать функции\-члены и данные члены объекта для работы с записями.  В некоторых случаях может потребоваться повторный запрос или обновление набора записей, чтобы отразить изменения в источнике данных.  Дополнительные сведения см. в разделе [Наборы записей: повторное обращение \(ODBC\)](../../data/odbc/recordset-requerying-a-recordset-odbc.md).  
  
> [!TIP]
>  Строка подключения, которую вы используете в процессе разработки, может не соответствовать той, что требуется вашим конечным пользователям.  Предложения и идеи по созданию универсальных в этом отношении приложений можно найти в разделе [Источники данных: управление подключениями \(ODBC\)](../../data/odbc/data-source-managing-connections-odbc.md).  
  
##  <a name="_core_setting_recordset_options"></a> Настройка параметров набора записей  
 После создания объекта набора записей и до вызова **Open** для выбора записей может потребоваться настройка некоторых параметров, управляющих поведением набора записей.  Для всех наборов записей можно выполнять следующие действия:  
  
-   Указывать [фильтр](../../data/odbc/recordset-filtering-records-odbc.md) для ограничения выбора записей.  
  
-   Указывать порядок [сортировки](../../data/odbc/recordset-sorting-records-odbc.md) записей.  
  
-   Указывать [параметры](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md) выбора записей на основе данных, полученных или вычисленных во время выполнения.  
  
 Можно также указывать следующий параметр, если для этого имеются соответствующие условия:  
  
-   Если набор записей является обновляемым и поддерживает параметры блокировки, укажите метод [блокировки](../../data/odbc/recordset-locking-records-odbc.md), используемый для обновлений.  
  
> [!NOTE]
>  Чтобы заданные условия повлияли на выбор записей, необходимо настроить эти параметры до вызова функции\-члена **Open**.  
  
##  <a name="_core_closing_a_recordset"></a> Закрытие набора записей  
 По завершении работы с набором записей необходимо удалить его и высвободить выделенную для него память.  
  
#### Закрытие набора записей  
  
1.  Выполните вызов его функции\-члена [Close](../Topic/CRecordset::Close.md).  
  
2.  Удалите объект набора записей.  
  
     Если он был объявлен в кадре стека функции, то этот объект будет удален автоматически после выхода за границы области действия.  В других случаях воспользуйтесь оператором **delete**.  
  
 Команда **Close** высвобождает дескриптор **HSTMT** набора записей.  Она не удаляет этот объект C\+\+.  
  
## См. также  
 [Набор записей \(ODBC\)](../../data/odbc/recordset-odbc.md)   
 [Набор записей. Прокрутка \(ODBC\)](../Topic/Recordset:%20Scrolling%20\(ODBC\).md)   
 [Набор записей. Добавление, обновление и удаление записей \(ODBC\)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)
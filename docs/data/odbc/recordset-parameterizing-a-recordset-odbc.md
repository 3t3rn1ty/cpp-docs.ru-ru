---
title: 'Набор записей: Параметризация набора записей (ODBC) | Документы Microsoft'
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-data
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- parameterizing recordsets
- ODBC recordsets, parameterizing
- recordsets, parameterizing
- passing parameters, to queries at runtime
ms.assetid: 7d1dfeb6-5ee0-45e2-aacc-63bc52a465cd
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: 275cd9d2ee7ccbd4c9972c00ae6fbb8f33166a0a
ms.sourcegitcommit: 76b7653ae443a2b8eb1186b789f8503609d6453e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33098554"
---
# <a name="recordset-parameterizing-a-recordset-odbc"></a>Набор записей. Параметризация набора записей (ODBC)
Этот раздел относится к классам MFC ODBC.  
  
 Иногда может потребоваться получить возможность выбора записей во время выполнения с использованием сведений о вычисленные или полученные от конечного пользователя. Параметры набора записей позволяют достичь этой цели.  
  
 Содержание раздела:  
  
-   [Назначение параметризированные наборы записей](#_core_parameterized_recordsets).  
  
-   [Когда и почему может потребоваться параметризация набора записей](#_core_when_to_use_parameters).  
  
-   [Способ объявления параметров члены данных в классе набора записей](#_core_parameterizing_your_recordset_class).  
  
-   [Как передать сведения о параметрах для объекта набора записей во время выполнения](#_core_passing_parameter_values_at_run_time).  
  
##  <a name="_core_parameterized_recordsets"></a> Параметризированные наборы записей  
 Параметризированные наборы записей позволяют передавать сведения о параметрах во время выполнения. Эта процедура двумя преимуществами:  
  
-   Он может привести к более высокую скорость выполнения.  
  
-   Он позволяет построить запрос во время выполнения, на основании информации, недоступной во время разработки, такие как сведения, полученные от пользователя или вычисляются во время выполнения.  
  
 При вызове **откройте** для выполнения запроса, набор записей использует сведения о параметрах для завершения его **SQL SELECT** инструкции. Можно параметризировать любого набора записей.  
  
##  <a name="_core_when_to_use_parameters"></a> Когда следует использовать параметры  
 Обычно параметры используются следующие.  
  
-   Передача аргументов времени выполнения для предопределенного запроса.  
  
     Для передачи параметров в хранимой процедуре, необходимо указать полный пользовательский ODBC **вызвать** инструкции — с помощью заполнителей параметров, при вызове **откройте**, переопределение инструкции SQL набора записей по умолчанию. Дополнительные сведения см. в разделе [CRecordset::Open](../../mfc/reference/crecordset-class.md#open) в *Справочник по библиотеке классов* и [SQL: инструкция SQL Настройка набора записей (ODBC)](../../data/odbc/sql-customizing-your-recordsets-sql-statement-odbc.md) и [ Набор записей: Объявление класса для предопределенного запроса (ODBC)](../../data/odbc/recordset-declaring-a-class-for-a-predefined-query-odbc.md).  

  
-   Эффективное выполнение нескольких повторных запросов с сведения о различных параметрах.  
  
     Например каждый раз, когда конечные пользователи ищет данные для определенного студента в базе данных регистрации студентов, можно указать имя или идентификатор студента как параметр, полученный от пользователя. Затем, при вызове набора записей **Requery** функция-член, запрос выбирает запись этого студента.  
  
     Строка фильтра набора записей, хранимая в **m_strFilter**, может выглядеть следующим образом:  
  
    ```  
    "StudentID = ?"  
    ```  
  
     Предположим, что получение идентификатора студента в переменной `strInputID`. Если для параметра задано значение `strInputID` (например, 100 идентификатор студента) значение переменной привязан к заполнителя параметра, представленного «?» в строке фильтра.  
  
     Значение параметра присваивается следующим образом:  
  
    ```  
    strInputID = "100";  
    ...  
    m_strParam = strInputID;  
    ```  
  
     Не может потребоваться настроить строку фильтра таким образом:  
  
    ```  
    m_strFilter = "StudentID = 100";   // 100 is incorrectly quoted  
                                       // for some drivers  
    ```  
  
     Описание того, как правильно использовать кавычки для фильтрации строк см. в разделе [набор записей: фильтрация записей (ODBC)](../../data/odbc/recordset-filtering-records-odbc.md).  
  
     Значение параметра изменяется при каждом набора записей для нового идентификатора студента.  
  
    > [!TIP]
    >  С помощью параметра является более эффективным, чем применение фильтра. Для параметризированного набора записей базы данных необходимо обработать SQL **ВЫБЕРИТЕ** инструкции только один раз. Для набора записей без параметров **ВЫБЕРИТЕ** инструкция обрабатывается каждый раз при **Requery** с новым значением фильтра.  
  
 Дополнительные сведения о фильтрах см. в разделе [набор записей: фильтрация записей (ODBC)](../../data/odbc/recordset-filtering-records-odbc.md).  
  
##  <a name="_core_parameterizing_your_recordset_class"></a> Параметризация класса набора записей  
  
> [!NOTE]
>  Этот раздел относится к объектам, производным от `CRecordset` в какой строке массовая выборка не был реализован. При использовании групповой выборки строк реализации параметров — это аналогичный процесс. Дополнительные сведения см. в разделе [набор записей: групповая выборка записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  
  
 Перед созданием класса набора записей, определите, какие параметры необходимо, их типы данных, и возможности их использования в наборе записей.  
  
#### <a name="to-parameterize-a-recordset-class"></a>Параметризация набора записей класса  
  
1.  Запустите [мастер потребителей ODBC MFC](../../mfc/reference/adding-an-mfc-odbc-consumer.md) из **добавить класс** для создания класса.  
  
2.  Укажите поля элементов данных для столбцов в наборе записей.  
  
3.  После мастер записывает файл в проекте класс, перейдите в h-файл и вручную добавить один или несколько элементов данных параметров в объявлении класса. Добавление может выглядеть как в следующем примере, поскольку часть этого класса моментальный снимок предназначен для ответа на запрос «какие студенты обучаются высшего класса?»  
  
    ```  
    class CStudentSet : public CRecordset  
    {  
    // Field/Param Data  
        CString m_strFirstName;  
        CString m_strLastName;  
        CString m_strStudentID;  
        CString m_strGradYear;  
  
        CString m_strGradYrParam;  
    };  
    ```  
  
     Добавьте элементы данных параметров после поля, создаваемые мастером члены данных. Соглашение заключается в добавлении слово «Param» имя каждого параметра определяемой пользователем.  
  
4.  Изменить [DoFieldExchange](../../mfc/reference/crecordset-class.md#dofieldexchange) определение функции-члена в CPP-файле. Добавьте вызов функции RFX для каждого элемента данных параметр, добавленный в класс. Сведения о написании функций RFX см. в разделе [обмен полями записей: принцип работы RFX](../../data/odbc/record-field-exchange-how-rfx-works.md). Предшествовать вызовам RFX для параметров с помощью одного вызова:  
  
    ```  
    pFX->SetFieldType( CFieldExchange::param );  
    // RFX calls for parameter data members  
    ```  
  
5.  В конструкторе класса набора записей, увеличить количество параметров `m_nParams`.  
  
     Сведения см. в разделе [обмен полями записей: работа с кодом мастера](../../data/odbc/record-field-exchange-working-with-the-wizard-code.md).  
  
6.  При написании кода для создания объекта набора записей этого класса, поместите «?» символ (вопросительный знак) в разных местах сравнения строк в инструкции SQL, где параметр — для замены.  
  
     Во время выполнения «?» заполнители заполняются по порядку, передать по значению параметра. После первого элемента данных для параметра значение [SetFieldType](../../mfc/reference/cfieldexchange-class.md#setfieldtype) вызов заменяет первый «? «в строке SQL, второй член данных параметра заменяет второй»?», и т. д.  
  
> [!NOTE]
>  Порядок параметров имеет значение: последовательность вызовов RFX для параметров в вашей `DoFieldExchange` функции должен соответствовать порядку параметров-местозаполнителей в строке SQL.  
  
> [!TIP]

>  Строка, скорее всего, для работы с является строка, указанная (если таковые имеются) для класса [m_strFilter](../../mfc/reference/crecordset-class.md#m_strfilter) член данных, но некоторые драйверы ODBC могут допускать параметры в других предложениях языка SQL.  
  
##  <a name="_core_passing_parameter_values_at_run_time"></a> Передача значений параметров во время выполнения  
 Необходимо указать значения параметров перед вызовом метода **откройте** (для нового объекта набора записей) или **Requery** (для существующего).  
  
#### <a name="to-pass-parameter-values-to-a-recordset-object-at-run-time"></a>Для передачи значений параметров для объекта набора записей во время выполнения  
  
1.  Создайте объект набора записей.  
  
2.  Подготовка строки или строк, таких как **m_strFilter** строкой, содержащей инструкцию SQL, или его части. Поместите «?» заполнители, где — сведения о параметрах для перехода.  
  
3.  Присвоить значение параметра во время выполнения для каждого элемента данных параметра объекта.  
  
4.  Вызовите **откройте** функция-член (или **Requery**, для существующего набора данных).  
  
 Например предположим, что необходимо указать строку фильтра для набора данных, используя информацию, полученную во время выполнения. Предположим, что набор записей класса `CStudentSet` ранее — называется `rsStudents` и теперь необходимо сделать его для получения определенной информации о студентах запрос.  
  
```  
// Set up a filter string with   
// parameter placeholders  
rsStudents.m_strFilter = "GradYear <= ?";  
  
// Obtain or calculate parameter values   
// to pass--simply assigned here   
CString strGradYear = GetCurrentAcademicYear( );  
  
// Assign the values to parameter data members  
rsStudents.m_strGradYrParam = strGradYear;  
  
// Run the query  
if( !rsStudents.Requery( ) )  
    return FALSE;  
```  
  
 В наборе записей будут отображены сведения о студентах, записи которых удовлетворяют условиям, указанным в фильтре, который был создан на основе параметров среды выполнения. В этом случае набор записей содержит записи для всех старший учащихся.  
  
> [!NOTE]
>  При необходимости можно задать значение члена данных параметра в значение Null, с помощью [члена SetParamNull](../../mfc/reference/crecordset-class.md#setparamnull). Проверить, можно ли член данных параметра имеет значение Null, с помощью [IsFieldNull](../../mfc/reference/crecordset-class.md#isfieldnull).  
  
## <a name="see-also"></a>См. также  
 [Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)   
 [Набор записей: Добавление, обновление и удаление записей (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)   
 [Набор записей. Порядок выборки записей в наборе (ODBC)](../../data/odbc/recordset-how-recordsets-select-records-odbc.md)
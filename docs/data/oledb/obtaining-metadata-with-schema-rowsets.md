---
title: "Получение метаданных в схеме набора строк | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- cpp-windows
ms.tgt_pltfrm: 
ms.topic: reference
dev_langs:
- C++
helpviewer_keywords:
- schema rowsets, getting OLE DB provider metadata
- OLE DB consumer templates, getting provider metadata
- metadata, getting (OLE DB Templates)
ms.assetid: 6b448461-82fb-4acf-816b-3cbb0ca1d186
caps.latest.revision: 
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: 1509bb4bd083331c36c3b699b4716945e4573d1d
ms.sourcegitcommit: d51ed21ab2b434535f5c1d553b22e432073e1478
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/23/2018
---
# <a name="obtaining-metadata-with-schema-rowsets"></a>Получение метаданных в схеме набора строк
Иногда вам необходимо получить информацию о поставщике, наборе строк, таблице, столбцах или другие сведения о базе данных без открытия набора строк. Данные о структуре базы данных называют метаданными, и их можно получить несколькими способами. Первый способ — использовать наборы строк схемы.  
  
 Шаблоны OLE DB предоставляют набор классов для получения сведений о схеме; Эти классы создают предопределенные наборы строк схемы и перечислены в [классы набора строк схемы и классы Typedef](../../data/oledb/schema-rowset-classes-and-typedef-classes.md).  
  
> [!NOTE]
>  Если вы используете OLAP и некоторые наборы строк не поддерживаются классами наборов строк схемы (например, количество столбцов переменное), следует рассмотреть возможность использования `CManualAccessor` или `CDynamicAccessor`. Вы можете пройти по столбцам и использовать операторы case для обработки возможных типов данных для каждого столбца.  
  
## <a name="catalogschema-model"></a>Модель каталога или схемы  
 ANSI SQL определяет модель каталога или схемы для хранилищ данных. Эта модель используется OLE DB. В ней каталоги (базы данных) содержат схемы, а схемы содержат таблицы.  
  
-   **Каталог** каталог — это другое имя для базы данных. Он представляет коллекцию связанных объектов. Чтобы получить список каталогов (баз данных), принадлежащих определенному источнику данных, [CCatalog](../../data/oledb/ccatalogs-ccataloginfo.md). Так как многие базы данных содержат только один каталог, метаданные часто называют просто сведениями о схеме.  
  
-   **Схемы** схема является коллекцией объектов базы данных, которые принадлежат либо были созданы определенным пользователем. Чтобы получить список схем, принадлежащих указанному пользователю, [CSchemata](../../data/oledb/cschemata-cschematainfo.md).  
  
     В Microsoft SQL Server и ODBC 2.x, схема — это владелец (например, dbo является это типичное имя схемы). Кроме того, SQL Server хранит метаданные в наборе таблиц: одна таблица содержит список всех таблиц, а другая таблица содержит список всех столбцов. У схемы базы данных Microsoft Access эквивалента нет.  
  
-   **Таблица** — это коллекции столбцов, расположенных в определенном порядке. Чтобы получить список таблиц, определенных в заданном каталоге (база данных) и сведения об этих таблицах, [CTables](../../data/oledb/ctables-ctableinfo.md)).  
  
## <a name="restrictions"></a>Ограничения  
 При запросе сведений о схеме можно использовать ограничения, чтобы указать тип данных, в которых вы заинтересованы. Ограничения можно представить как фильтр или квалификатор в запросе. Например, в запросе:  
  
```  
SELECT * FROM authors where l_name = 'pivo'  
```  
  
 `l_name` — это ограничение. Это очень простой пример с одним ограничением. Классы набора строк схемы поддерживают несколько ограничений.  
  
 [Классы typedef набора строк схемы](../../data/oledb/schema-rowset-classes-and-typedef-classes.md) инкапсулируют все наборы строк схемы OLE DB таким образом, чтобы доступ к набору строк схемы подобно любому другому набору строк, создав экземпляр и открыв его. Например, класс typedef [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md) определяется как:  
  
```  
CRestrictions<CAccessor<CColumnsInfo>  
```  
  
 [CRestrictions](../../data/oledb/crestrictions-class.md) класс предоставляет поддержку ограничений. После создания экземпляра набора строк схемы вызовите [CRestrictions::Open](../../data/oledb/crestrictions-open.md). Он возвращает результирующий набор, основанный на заданных ограничениях.  
  
 Чтобы указать ограничения, обратитесь к [приложение б. наборы строк схемы](http://go.microsoft.com/fwlink/p/?linkid=64681) и выполнять поиск строк, который вы используете. Например **CColumns** соответствует [набор строк COLUMNS](http://go.microsoft.com/fwlink/p/?linkid=64682); этого раздела перечислены столбцы ограничений в наборе строк COLUMNS: значениям TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME. Необходимо придерживаться этого порядка при указании ограничений.  
  
 Таким образом, например, если требуется ограничение по имени таблицы, обратите внимание, что TABLE_NAME — это третий столбец ограничений и затем вызвать **откройте**, укажите необходимое имя таблицы в качестве третьего параметра ограничения, как показано в следующем примере.  
  
#### <a name="to-use-schema-rowsets"></a>Использование наборов строк схемы  
  
1.  Вам необходимо включить файл заголовка Atldbsch.h (разумеется, также потребуется файл Atldbcli.h для поддержки получателя).  
  
2.  Создайте экземпляр объекта набора строк схемы в файле заголовка получателя или документа. Если необходимо получить сведения таблицы, объявите **CTables** объекта; Если вам нужны сведения о столбцах, объявите **CColumns** объекта. В этом примере показано, как извлечь столбцы в таблице authors.  
  
    ```  
    CDataSource ds;  
    ds.Open();  
    CSession ss;  
    ss.Open();  
    CColumns ColumnSchemaRowset;  
    // TABLE_NAME is the third restriction column, so  
    // specify "authors" as the third restriction parameter:  
    hr = ColumnSchemaRowset.Open(ss, NULL, NULL, "authors");  
    hr = ColumnSchemaRowset.MoveFirst();  
    while (hr == S_OK)  
    {  
       hr = ColumnSchemaRowset.MoveNext();  
    }  
    ```  
  
3.  Чтобы получить сведения, обратитесь к соответствующему элементу данных объекта набора строк схемы, например `ColumnSchemaRowset.m_szColumnName`. Он соответствует столбцу COLUMN_NAME. Столбец OLE DB, который соответствует каждому элементу данных в разделе [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md).  
  
 Дополнительные сведения о наборе строк схемы, классах typedef, предоставленных в шаблонах OLE DB (см. [классы набора строк схемы и классы Typedef](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)).  
  
 Дополнительные сведения о наборах строк схемы OLE DB, включая столбцы ограничений см [приложение б. наборы строк схемы](http://go.microsoft.com/fwlink/p/?linkid=64681) в справочнике программиста OLE DB.  
  
 Более сложные примеры использования классов набора строк схемы см. в разделе [CatDB](http://msdn.microsoft.com/en-us/003d516b-2bf6-444e-8be5-4ebaa0b66046) и [DBViewer](http://msdn.microsoft.com/en-us/07620f99-c347-4d09-9ebc-2459e8049832) образцов.  
  
 Сведения о поддержке поставщиками наборов строк схемы см. в разделе [поддержка наборов строк схемы](../../data/oledb/supporting-schema-rowsets.md).  
  
## <a name="see-also"></a>См. также  
 [Использование методов доступа](../../data/oledb/using-accessors.md)
---
title: Проверка на совместимость с OLE DB передача | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-data
ms.topic: reference
dev_langs:
- C++
helpviewer_keywords:
- testing, OLE DB providers
- testing providers
- conformance testing
- conformance testing [OLE DB]
- OLE DB providers, testing
ms.assetid: d1a4f147-2edd-476c-b452-0e6a0ac09891
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: 11677e6295956de768c7ebc0c113d775b066bb0c
ms.sourcegitcommit: 76b7653ae443a2b8eb1186b789f8503609d6453e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33110468"
---
# <a name="passing-ole-db-conformance-tests"></a>Проверка на совместимость с OLE DB
Чтобы обеспечить единообразие поставщиков, пакет SDK для доступа к данным предоставляет набор тестов на совместимость с OLE DB. Тесты проверяют все аспекты поставщика и дают возможность разумного гарантию того, что ваш поставщик работает правильно. Проверка на совместимость OLE DB можно найти в пакете Microsoft Data Access SDK. В этом разделе описываются действия, которые нужно выполнить для проверки на совместимость. Сведения о выполнении тестов на совместимость OLE DB см. в SDK.  
  
## <a name="running-the-conformance-tests"></a>Выполнение тестов на совместимость  
 В Visual C++ 6.0 шаблоны поставщика OLE DB добавлен ряд функций привязки, которые позволяют проверять значения и свойства. Большинство этих функций были добавлены в ответ тестов на совместимость.  
  
> [!NOTE]
>  Необходимо добавить несколько функций проверки для поставщика для проверки на совместимость OLE DB.  
  
 Для этого поставщика требуется две программы проверки. Первая программа, `CRowsetImpl::ValidateCommandID`, является частью класса набора строк. Вызывается во время создания набора строк шаблонами поставщика. В образце Эта процедура используется для информирования потребителей о том, что индексы не поддерживаются. Сначала вызывается `CRowsetImpl::ValidateCommandID` (Обратите внимание, что поставщик использует **_RowsetBaseClass** typedef, добавлены в схему интерфейсов для `CMyProviderRowset` в [Поддержка закладок поставщиками](../../data/oledb/provider-support-for-bookmarks.md), поэтому нет необходимости необходимость ввода длинной строки аргументов шаблона). Далее возвращается **значение DB_E_NOINDEX** Если параметр индекса не **NULL** (это значит, потребитель будет использовать индекс). Дополнительные сведения о идентификаторы команд см. в спецификации OLE DB и искать **IOpenRowset::OpenRowset**.  
  
 Следующий код является **ValidateCommandID** процедуры проверки:  
  
```cpp
/////////////////////////////////////////////////////////////////////  
// MyProviderRS.H  
// Class: CMyProviderRowset   
  
HRESULT ValidateCommandID(DBID* pTableID, DBID* pIndexID)  
{  
   HRESULT hr = _RowsetBaseClass::ValidateCommandID(pTableID, pIndexID);  
   if (hr != S_OK)  
      return hr;  
  
   if (pIndexID != NULL)  
      return DB_E_NOINDEX;    // Doesn't support indexes  
  
   return S_OK;  
}  
```  
  
 Шаблоны поставщика вызывают `OnPropertyChanged` метод при каждом изменении свойства на **DBPROPSET_ROWSET** группы. Если необходимо обрабатывать свойства для других групп, нужно добавить их в соответствующий объект (то есть **DBPROPSET_SESSION** проверок перейдите `CMyProviderSession` класса).  
  
 Код сначала проверяет связано ли свойство в другой. Если свойство является, он присваивает **DBPROP_BOOKMARKS** значение True. Приложение В спецификации OLE DB содержит сведения о свойствах. Эти сведения также рассказывается, является ли свойство присоединена к другой.  
  
 Вы также можете добавить `IsValidValue` в код. Шаблоны вызывают `IsValidValue` при попытке задать свойство. Если требуется дополнительная обработка при задании значения свойства нужно переопределить этот метод. Можно иметь одну из этих методов для каждого набора свойств.  
  
## <a name="threading-issues"></a>Проблемы потока  
 По умолчанию мастер поставщиков OLE DB в мастер поставщика ATL OLE DB создает код для запуска в модели подразделения поставщика. При попытке выполнения этого кода с помощью тестов на совместимость первоначально происходит сбой. Это поскольку Ltm.exe средство, используемое для выполнения тестов на совместимость OLE DB, по умолчанию используется для освобождения потоков. По умолчанию мастер поставщиков OLE DB код замкнутую модель производительности и удобства использования.  
  
 Чтобы устранить эту проблему, можно изменить LTM или изменять службу.  
  
#### <a name="to-change-ltm-to-run-in-apartment-threaded-mode"></a>Изменение LTM для запуска в потоке режима  
  
1.  В главном меню LTM, нажмите кнопку **средства**, а затем нажмите кнопку **параметры**.  
  
2.  На **Общие** измените потоковую модель из **свободных потоков** для **Apartment Threaded**.  
  
 Чтобы изменить поставщика для запуска в режиме free потоков:  
  
-   В проекте поставщика поиска для всех экземпляров `CComSingleThreadModel` и замените ее строкой `CComMultiThreadModel`, которые должны быть в заголовки источника, сеансов и строк данных.  
  
-   В RGS-файле измените потоковую модель из **подразделения** для **оба**.  
  
-   Используйте соответствующие правила бесплатно однопотоковое программирования (т. е. блокировка записи).  
  
## <a name="see-also"></a>См. также  
 [Дополнительные способы использования поставщика](../../data/oledb/advanced-provider-techniques.md)
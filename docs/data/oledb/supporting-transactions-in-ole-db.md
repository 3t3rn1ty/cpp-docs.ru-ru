---
title: "Поддержка транзакций в OLE DB | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "базы данных [C++], транзакции"
  - "распределенные транзакции [C++]"
  - "вложенные транзакции [C++]"
  - "OLE DB [C++], поддержка транзакций"
  - "шаблоны потребителей OLE DB [C++], поддержка транзакций"
  - "транзакции [C++], OLE DB - поддержка для"
ms.assetid: 3d72e583-ad38-42ff-8f11-e2166d60a5a7
caps.latest.revision: 10
caps.handback.revision: 10
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Поддержка транзакций в OLE DB
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

[Транзакция](../../data/transactions-mfc-data-access.md) представляет собой способ группировки \(пакетной обработки\) последовательности обновлений источника данных. Транзакция успешно выполняется, если успешно выполняются все входящие в ее состав операции \(в этом случае они выполняются одновременно\). Если хотя бы одна из этих операций завершается неудачей, выполняется откат всей транзакции \(не выполняется ни одна из операций\).  За счет этого обеспечивается целостность данных источника.  
  
 В OLE DB поддержка транзакций реализуется с использованием следующих трех методов:  
  
-   [\<caps:sentence id\="tgt4" sentenceid\="0699a86bb6d6316bff035b804a56f0aa" class\="tgtSentence"\>ITransactionLocal::StartTransaction\<\/caps:sentence\>](https://msdn.microsoft.com/en-us/library/ms709786.aspx)  
  
-   [\<caps:sentence id\="tgt5" sentenceid\="39299b0fea086b86052550bd165334f7" class\="tgtSentence"\>ITransaction::Commit\<\/caps:sentence\>](https://msdn.microsoft.com/en-us/library/ms713008.aspx)  
  
-   [\<caps:sentence id\="tgt6" sentenceid\="8e992150c28ae247d532408ca7828bfe" class\="tgtSentence"\>ITransaction::Abort\<\/caps:sentence\>](https://msdn.microsoft.com/en-us/library/ms709833.aspx)  
  
## Связь между сеансами и транзакциями  
 Для одного объекта источника данных допускается создание одного или нескольких объектов сеанса, каждый из которых в заданное время может находиться в области действия транзакции или вне ее.  
  
 Если сеанс не входит в транзакцию, все операции с хранилищем данных, выполняемые в течение этого сеанса, фиксируются немедленно при каждом вызове метода. \(В некоторых случаях такое поведение называется режимом автофиксации или неявным режимом.\)  
  
 Если сеанс входит в транзакцию, все операции с хранилищем данных, выполняемые в течение этого сеанса, сохраняются в составе транзакции и фиксируются или отменяются единым блоком. \(В некоторых случаях такое поведение называется режимом фиксации вручную.\)  
  
 Поддержка транзакции зависит от поставщика.  Если используемый поставщик поддерживает транзакции, объект сеанса, поддерживающий интерфейсы **ITransaction** и **ITransactionLocal**, может входить в простые \(невложенные\) транзакции.  Эти интерфейсы поддерживаются в классе шаблона OLE DB [CSession](../../data/oledb/csession-class.md), который рекомендуется использовать для реализации поддержки транзакций в Visual C\+\+.  
  
## Запуск и остановка транзакции  
 Методы `StartTransaction`, **Commit** и **Abort** вызываются в объекте набора строк поставщика.  
  
 При вызове метода **ITransactionLocal::StartTransaction** запускается новая локальная транзакция.  При выполнении транзакции любые изменения, используемые в последующих операциях, фактически сохраняются в хранилище данных только после фиксации транзакции.  
  
 При вызове метода **ITransaction::Commit** или **ITransaction::Abort** транзакция завершается.  При вызове метода **Commit** все изменения, выполненные в области действия транзакции, применяются к хранилищу данных.  При вызове метода **Commit** все изменения, выполненные в области действия транзакции, отменяются, а хранилище данных остается в состоянии, в котором оно находилось до запуска транзакции.  
  
## Вложенные транзакции  
 [Вложенная транзакция](https://msdn.microsoft.com/en-us/library/ms716985.aspx) выполняется при запуске новой локальной транзакции, если в сеансе уже существует активная транзакция.  Новая транзакция запускается в качестве вложенной в текущую.  Если поставщик не поддерживает вложенные транзакции, в случае вызове метода `StartTransaction` при наличии в сеансе активной транзакции возвращается значение **XACT\_E\_XTIONEXISTS**.  
  
## Распределенные транзакции  
 Распределенные транзакции предназначены для обновления распределенных данных, расположенных на одном или нескольких компьютерах в сети.  Чтобы обеспечить поддержку транзакций в распределенных системах, рекомендуется использовать функции поддержки транзакций платформы .NET Framework, а не OLE DB.  
  
## См. также  
 [Использование методов доступа](../../data/oledb/using-accessors.md)
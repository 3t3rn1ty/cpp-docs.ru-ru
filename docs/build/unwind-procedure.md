---
title: Процедура очистки | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-tools
ms.topic: conceptual
dev_langs:
- C++
ms.assetid: 82c5d0ca-70be-4d1a-a306-bfe01c29159f
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: 5e2a5af5d8db5974aa10595bbd3bac1cd032a0f4
ms.sourcegitcommit: be2a7679c2bd80968204dee03d13ca961eaa31ff
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
ms.locfileid: "32382027"
---
# <a name="unwind-procedure"></a>Процедура очистки
В массиве кодов очистки сортируется в порядке убывания. При возникновении исключения полный контекст сохраняется операционной системой в записи контекста. Затем вызывается логика обработки исключений, который многократно выполняет следующие действия, чтобы найти обработчик исключений.  
  
1.  Используйте текущий RIP, хранящиеся в записи контекста для поиска таблице RUNTIME_FUNCTION, описывающий текущую функцию (или часть функции, в случае связанных записей UNWIND_INFO).  
  
2.  При обнаружении записи в таблице функций будет в конечном функции и RSP будет напрямую к указателю возврата. Указатель возврата в [RSP] сохраняется в обновленном контексте, смоделированный RSP увеличивается на 8, и повторить шаг 1.  
  
3.  Если найдена запись в таблице функций, RIP может лежать в трех регионах) в заключительной части, b) в прологе или c) в коде, который может выполняться в обработчике исключений.  
  
    -   Case) если RIP лежит в эпилоге, затем управления выходит из функции, может быть обработчик исключения для этой функции и результаты заключительной части следует продолжить для вычисления контекста вызывающей функции. Чтобы определить ли RIP в заключительной части, поток кода из RIP на проверяется. Если поток кода могут быть сопоставлены с конечной части допустимого эпилога, то он находится в заключительной части и имитировать оставшуюся часть эпилога, с записи контекста, обновляются при каждой инструкцией по обработке. После этого повторяется шаг 1.  
  
    -   Случай b), если RIP находится в прологе, то элемент управления не вошел в функцию, может быть обработчик исключения для этой функции и результаты пролога должны быть отменены для вычисления контекста вызывающей функции. RIP лежит в прологе, если расстояние от начала функции до RIP меньше или равно размеру пролога, закодированные в информации об очистке. Результаты в прологе очищаются при просмотре вперед по в массиве кодов очистки для первой записи со смещением, меньшим или равным смещению RIP от начала функции, а затем Отмена результата для всех остальных элементов в массиве кодов очистки. Шаг 1 затем повторяется.  
  
    -   Случай c), если RIP не лежит в пределах пролога или эпилога и функция имеет обработчик исключений (UNW_FLAG_EHANDLER установлен), то вызывается обработчик конкретного языка. Обработчик просматривает данные и вызывает соответствующие функции фильтра. Обработчик конкретного языка может возвращать в том, что исключение было обработано или что поиск будет продолжен. Он может также инициировать очистку напрямую.  
  
4.  Если обработчик конкретного языка возвращается состояние обработано, то выполнение продолжается с использованием исходной записи контекста.  
  
5.  Если отсутствует обработчик конкретного языка или обработчик возвращается в состояние «продолжить поиск», запись контекста должен быть развернут состояние вызывающего объекта. Это достигается путем обработки всех элементов массива кода очистки, отменой результата для каждого элемента. Шаг 1 затем повторяется.  
  
 При объединении в цепочку очистки info, то по-прежнему выполняются следующие основные шаги. Единственное различие состоит в том, во время прохода в массиве кодов очистки для очистки для пролога, по достижении конца массива, затем связывается раскрутки родительского и просматривается в массиве кодов очистки всего отсутствуют. Это присоединение продолжается до раскрутки без флага UNW_CHAINED_INFO и завершения прохождения по массиву кода очистки.  
  
 Наименьший набор данных очистки имеет размер 8 байт. Этот объект представляет функцию, которая стека или менее 128 байтов и сэкономить один защищенный регистр. Кроме того, это размер связанной структуры данных очистки для пролога нулевой длины без кодов очистки.  
  
## <a name="see-also"></a>См. также  
 [Обработка исключений (x64)](../build/exception-handling-x64.md)
---
title: "Общие сведения о соглашениях о вызовах для архитектуры x64 | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
ms.assetid: a05db5eb-0844-4d9d-8b92-b1b2434be0ea
caps.latest.revision: 12
author: "corob-msft"
ms.author: "corob"
manager: "ghogen"
caps.handback.revision: 9
---
# Общие сведения о соглашениях о вызовах для архитектуры x64
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Двумя важнейшими различиями между архитектурами x86 и [!INCLUDE[vcprx64](../Token/vcprx64_md.md)] является возможность 64\-битной адресации и набор из 16 64\-битных регистров общего назначения.  Предоставляя расширенный набор регистров, [!INCLUDE[vcprx64](../Token/vcprx64_md.md)] использует только соглашение о вызовах [\_\_fastcall](../cpp/fastcall.md) и модель RISC\-архитектуры обработки исключений.  Модель соглашения о вызовах `__fastcall` использует регистры для первых четырех аргументов, а для передачи других параметров используется кадр стека.  
  
 Следующий параметр компилятора позволяет оптимизировать приложение для [!INCLUDE[vcprx64](../Token/vcprx64_md.md)]:  
  
-   [\/favor \(оптимизация для особенностей архитектуры\)](../build/reference/favor-optimize-for-architecture-specifics.md)  
  
## Соглашение о вызовах  
 Машинный интерфейс для приложений Application Binary Interface \(ABI\) [!INCLUDE[vcprx64](../Token/vcprx64_md.md)] — это 4 регистра соглашения о вызовах с возможностью последующего возвращения этих регистров в стек.  Существует точное однозначное соответствие между аргументами в функции и регистрами для этих аргументов.  Любые аргументы, не равные 8 байтам или 1, 2, 4 или 8 байтам, передаются по ссылке.  Попыток разместить один аргумент по нескольким регистрам не происходит.  Регистровый стек x87 не используется.  Его можно использовать, но он должен быть временным при вызове функций.  Все операции с плавающей запятой выполняются с помощью 16 регистров XMM.  Аргументы передаются в регистрах RCX, RDX, R8 и R9.  Если аргументы являются типами float или double, они передаются в регистрах XMM0L, XMM1L, XMM2L и XMM3L.  16\-байтовые аргументы передаются по ссылке.  Передача параметров подробно описана в разделе [Передача параметров](../build/parameter-passing.md).  Регистры RAX, R10, R11, XMM4 и XMM5 являются энергозависимыми.  Все остальные регистры являются энергонезависимыми.  Использование регистров подробно описано в разделах [Использование регистров](../build/register-usage.md) и [Сохраняемые регистры вызываемого и вызывающего объектов](../build/caller-callee-saved-registers.md).  
  
 Вызывающая функция отвечает за выделение пространства для параметров вызываемой функции и должна всегда выделять достаточное пространство для 4 параметров, даже если вызываемая функция не содержит такого количества параметров.  Это помогает упростить поддержку функций без прототипов и функций с переменным количеством аргументов \(vararg\) C\/C\+\+.  Для функций с переменным количеством аргументов или для функций без прототипов любое значение типа float должно быть продублировано в соответствующем регистре общего назначения.  Любые параметры, следующие после первых 4, до вызова должны сохраняться в стеке над резервным хранилищем для первых четырех.  Сведения о функции с переменным количеством аргументов представлены в разделе [Функции с переменным количеством аргументов \(Varargs\)](../build/varargs.md).  Сведения о функции без прототипов представлены в разделе [Функции без прототипа](../build/unprototyped-functions.md).  
  
## Выравнивание  
 Большинство структур выровнены естественным выравниванием.  Главными исключениями являются указатели стека и функции распределения памяти malloc или alloca, которые выровнены на 16 байт для сохранения производительности.  Выравнивание свыше 16 байт должно выполняться вручную, но начиная с 16 байт выполняется общее выравнивание размера для операций XMM, которого должно хватать для большей части кода.  Дополнительные сведения о структуре и выравнивании см. в разделе [Типы и хранилище](../build/types-and-storage.md).  Дополнительные сведения о стеке см. в разделе [Использование стека](../build/stack-usage.md).  
  
## Способность очищаться  
 Все конечные функции \(функции, которые никогда не вызывают функцию, а также никогда не выделяют пространство стека\) должны дополняться данными \(относится к типам данных xdata или ehdata, на которые есть указатель из pdata\), которые объясняют ОС, каким образом выполнять их очищение для сохранения неизменяемых регистров.  Прологи и эпилоги строго ограничены, следовательно, они могут быть правильно описаны в xdata.  Указатель стека должен быть выровнен на 16 байт, за исключением конечных функций, в любой области кода, которая не является частью эпилога или пролога.  Дополнительные сведения о структуре функции пролога и эпилога см. в разделе [Пролог и эпилог](../build/prolog-and-epilog.md).  Дополнительные сведения об обработке исключений и обработке исключений\/очистке pdata и xdata см. в разделе [Обработка исключений \(x64\)](../build/exception-handling-x64.md).  
  
## См. также  
 [Программные соглашения x64](../build/x64-software-conventions.md)
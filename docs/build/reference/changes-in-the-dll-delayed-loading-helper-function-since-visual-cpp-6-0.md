---
title: "Изменения вспомогательной функции отложенной загрузки библиотек DLL по сравнению с Visual C++ версии 6.0 | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "__delayLoadHelper2 - функция"
  - "отложенная загрузка библиотек DLL, изменения по сравнению с предыдущей версией"
  - "вспомогательные функции, изменения по сравнению с предыдущей версией"
  - "PFromRva - метод"
ms.assetid: 99f0be69-105d-49ba-8dd5-3be7939c0c72
caps.latest.revision: 6
caps.handback.revision: 6
author: "corob-msft"
ms.author: "corob"
manager: "ghogen"
---
# Изменения вспомогательной функции отложенной загрузки библиотек DLL по сравнению с Visual C++ версии 6.0
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

Если на компьютере установлено несколько версий Visual C\+\+, или если задается собственная вспомогательная функция, то изменения, внесенные в вспомогательную функцию отложенной загрузки библиотек DLL, могут оказать свое влияние.  Примеры.  
  
-   Функция **\_\_delayLoadHelper** — это теперь **\_\_delayLoadHelper2**;  
  
-   Функция **\_\_pfnDliNotifyHook** — это теперь **\_\_pfnDliNotifyHook2**;  
  
-   Функция **\_\_pfnDliFailureHook** — это теперь **\_\_pfnDliFailureHook2**;  
  
-   Функция **\_\_FUnloadDelayLoadedDLL** — это теперь **\_\_FUnloadDelayLoadedDLL2**;  
  
> [!NOTE]
>  При использовании вспомогательной функции, заданной по умолчанию, эти изменения никак не влияют на работу.  Отсутствуют также изменения, связанные со способом вызова компоновщика.  
  
## Установлено несколько версий Visual C\+\+  
 Если на компьютере установлено несколько версий Visual C\+\+, следует убедиться, что компоновщик соответствует библиотеке delayimp.lib.  Если имеется несоответствие, то возникнет ошибка компоновщика, сообщающая, что либо `___delayLoadHelper2@8`, либо `___delayLoadHelper@8` является неразрешенным внешним символом.  Первое означает, что новый компоновщик используется со старой библиотекой delayimp.lib, а второе означает, что старый компоновщик используется с новой библиотекой delayimp.lib.  
  
 Если была получена неустранимая ошибка компоновщика, следует выполнить команду [dumpbin \/linkermember](../../build/reference/linkermember.md):1 для той библиотеки delayimp.lib, в которой предположительно содержится вспомогательная функция, чтобы увидеть, какая именно вспомогательная функция задана.  Вспомогательная функция могла быть также задана в объектном файле; следует выполнить команду [dumpbin \/symbols](../../build/reference/symbols.md) и найти функцию `delayLoadHelper(2)`.  
  
 Если известно, что установлен компоновщик Visual C\+\+ 6.0:  
  
-   Выполните программу dumpbin для файла LIB или OBJ вспомогательной функции отложенной загрузки, чтобы определить, определен ли символ **\_\_delayLoadHelper2**.  В случае его отсутствия компоновка будет прервана.  
  
-   Определите символ **\_\_delayLoadHelper** в файле LIB или OBJ вспомогательной функции отложенной загрузки.  
  
## Заданная пользователем вспомогательная функция  
 Если задана собственная вспомогательная функция, и используется текущая версия Visual C\+\+, необходимо выполнить следующие действия:  
  
-   Переименуйте вспомогательную функцию, дав ей имя **\_\_delayLoadHelper2**.  
  
-   С тех пор как абсолютные адреса \(VA\) указателей дескриптора задержки \(ImgDelayDescr в delayimp.h\) были заменены на относительные адреса \(RVA\) для правильной работы как в 32\-разрядных, так и в 64\-разрядных программах, требуется преобразовывать их обратно в указатели.  Была введена новая функция, PfromRva; ее можно найти в файле delayhlp.cpp.  Эту функцию можно использовать в каждом из полей дескриптора для обратного преобразования их в 32\-разрядные или 64\-разрядные указатели.  Вспомогательную функцию отложенной загрузки, заданную по умолчанию, по\-прежнему можно использовать в качестве образца.  
  
## Загрузка всех импортов для библиотеки DLL с отложенной загрузкой  
 Компоновщик может загружать все импорты из библиотеки DLL, которая была задана как библиотека с отложенной загрузкой.  Дополнительные сведения см. в разделе [Загрузка всех импортов для библиотеки с отложенной загрузкой](../../build/reference/loading-all-imports-for-a-delay-loaded-dll.md).  
  
## См. также  
 [Understanding the Helper Function](http://msdn.microsoft.com/ru-ru/6279c12c-d908-4967-b0b3-cabfc3e91d3d)
---
title: "Параметр /LTCG (создание кода во время компоновки) | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "VC.Project.VCLinkerTool.LinkTimeCodeGeneration"
  - "VC.Project.VCConfiguration.WholeProgramOptimization"
  - "VC.Project.VCCLWCECompilerTool.WholeProgramOptimization"
  - "/ltcg"
  - "VC.Project.VCCLCompilerTool.WholeProgramOptimization"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "/LTCG - параметр компоновщика"
  - "создание кода во время компоновки (компоновщик C++)"
  - "LTCG - параметр компоновщика"
  - "-LTCG - параметр компоновщика"
ms.assetid: 788c6f52-fdb8-40c2-90af-4026ea2cf2e2
caps.latest.revision: 22
author: "corob-msft"
ms.author: "corob"
manager: "ghogen"
caps.handback.revision: 22
---
# Параметр /LTCG (создание кода во время компоновки)
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

```  
/LTCG[:INCREMENTAL|:NOSTATUS|:STATUS|:OFF|:PGINSTRUMENT|:PGOPTIMIZE|:PGUPDATE]  
```  
  
## Заметки  
 :INCREMENTAL \(необязательный\)  
 Указывает, что компоновщик применяет полную оптимизацию программы или создание кода во время компоновки \(LTCG\) только к набору файлов, в который были внесены изменения, а не ко всему проекту. По умолчанию этот флаг не задан, если указан параметр \/LTCG, и весь проект компонуется с помощью полной оптимизации программы.  
  
 :NOSTATUS &#124; :STATUS \(необязательный\)  
 Указывает, отображает ли компоновщик индикатор хода выполнения, который показывает процент завершенности компоновки. По умолчанию эти данные о состоянии не отображаются.  
  
 :OFF \(необязательный\)  
 Отключает создание кода во время компоновки. Это поведение аналогично тому, когда параметр \/LTCG не указан в командной строке.  
  
 :PGINSTRUMENT \(необязательный\)  
 Этот параметр устарел. Вместо него используйте **\/LTCG** и **\/GENPROFILE** или **\/FASTGENPROFILE**, чтобы создать инструментированную сборку для профильной оптимизации.  
  
 Данные, собранные из инструментированных запусков, используются для создания оптимизированного образа. Дополнительные сведения см. в статье [Оптимизация с использованием профиля](../../build/reference/profile-guided-optimizations.md). Краткая форма этого параметра — \/LTCG:PGI.  
  
 :PGOPTIMIZE \(необязательный\)  
 Этот параметр устарел. Вместо него используйте **\/LTCG** и **\/USEPROFILE** для сборки оптимизированного образа. Дополнительные сведения см. в статье [Оптимизация с использованием профиля](../../build/reference/profile-guided-optimizations.md). Краткая форма этого параметра — \/LTCG:PGO.  
  
 :PGUPDATE \(необязательный\)  
 Этот параметр устарел. Вместо него используйте **\/LTCG** и **\/USEPROFILE** для сборки оптимизированного образа. Дополнительные сведения см. в статье [Оптимизация с использованием профиля](../../build/reference/profile-guided-optimizations.md). Краткая форма этого параметра — \/LTCG:PGU.  
  
 Параметр \/LTCG запрашивает у компоновщика вызов компилятора и выполнение оптимизации всей программы. Вы можете также выполнить профильную оптимизацию. Дополнительные сведения см. в статье [Оптимизация с использованием профиля](../../build/reference/profile-guided-optimizations.md).  
  
 Со следующими исключениями вы не можете добавлять параметры компилятора в комбинацию PGO \/LTCG и \/USEPROFILE, которые не были указаны в предыдущей комбинации инициализации PGO параметров \/LTCG и \/GENPROFILE:  
  
-   [\/BASE](../../build/reference/base-base-address.md)  
  
-   [\/FIXED](../../build/reference/fixed-fixed-base-address.md)  
  
-   \/LTCG  
  
-   [\/MAP](../../build/reference/map-generate-mapfile.md)  
  
-   [\/MAPINFO](../../build/reference/mapinfo-include-information-in-mapfile.md)  
  
-   [\/NOLOGO](../../build/reference/nologo-suppress-startup-banner-linker.md)  
  
-   [\/OUT](../../build/reference/out-output-file-name.md)  
  
-   [\/PGD](../../build/reference/pgd-specify-database-for-profile-guided-optimizations.md)  
  
-   [\/PDB](../../build/reference/pdb-use-program-database.md)  
  
-   [\/PDBSTRIPPED](../../build/reference/pdbstripped-strip-private-symbols.md)  
  
-   [\/STUB](../../build/reference/stub-ms-dos-stub-file-name.md)  
  
-   [\/VERBOSE](../../build/reference/verbose-print-progress-messages.md)  
  
 Любые параметры компоновщика, которые были заданы с параметрами \/LTCG и \/GENPROFILE для инициализации PGO, не должны быть указаны при сборке с помощью \/LTCG и \/USEPROFILE; они подразумеваются.  
  
 В остальной части раздела описывается параметр \/LTCG в условиях создания кода во время компоновки.  
  
 \/LTCG подразумевается с [\/GL](../../build/reference/gl-whole-program-optimization.md).  
  
 Компоновщик вызывает создание кода во время компоновки, если ему передается модуль, скомпилированный с помощью модуля **\/GL** или MSIL \(см. статью [.NETMODULE\-файлы в качестве входных файлов компоновщика](../Topic/.netmodule%20Files%20as%20Linker%20Input.md)\). Если вы явно не укажете **\/LTCG** при передаче модулей **\/GL** или MSIL в компоновщик, он обнаружит это и перезапустит ссылку с помощью **\/LTCG**. Явно укажите **\/LTCG** при передаче модулей **\/GL** и MSIL в компоновщик для наивысшей производительности сборки.  
  
 Для еще большей производительности используйте **\/LTCG:INCREMENTAL**. Этот параметр указывает компоновщику повторно оптимизировать только набор файлов, затронутый изменениями в исходном файле, а не весь проект. Это может значительно сократить требуемое для компоновки время. Этот параметр отличается от инкрементной компоновки.  
  
 **\/LTCG** невозможно использовать с [\/INCREMENTAL](../../build/reference/incremental-link-incrementally.md).  
  
Когда **\/LTCG** используется для компоновки модулей, скомпилированных с помощью [\/Og](../../build/reference/og-global-optimizations.md), [\/O1](../../build/reference/o1-o2-minimize-size-maximize-speed.md), [\/O2](../../build/reference/o1-o2-minimize-size-maximize-speed.md) или [\/Ox](../../build/reference/ox-full-optimization.md), выполняется следующая оптимизация:  
  
-   кроссмодульное встраивание;  
  
-   межпроцедурное распределение регистров \(только 64\-разрядные операционные системы\);  
  
-   пользовательское соглашение об именовании \(только x86\)  
  
-   небольшое смещение TLS \(только x86\);  
  
-   двойное выравнивание стека \(только x86\);  
  
-   улучшенное устранение неоднозначности памяти \(более подробные данные о конфликтах для глобальных переменных и входных параметров\).  
  
> [!NOTE]
> Компоновщик определяет, какие оптимизации использовались для компиляции каждой функции, и применяет те же оптимизации во время компоновки.  
  
Использование **\/LTCG** и **\/Ogt** вызывает оптимизацию двойного выравнивания.  
  
Если указаны параметры **\/LTCG** и **\/Ogs**, двойное выравнивание не выполняется. Если большинство функций в приложении скомпилированы для повышения скорости, и несколько для уменьшения размера \(например, с помощью директивы [optimize](../../preprocessor/optimize.md)\), компилятор выполнит двойное выравнивание функций, которые были оптимизированы для уменьшения размера, если они вызывают функции, для которых требуется двойное выравнивание.  
  
Если компилятор может определить все вызываемые функцией объекты, компилятор игнорирует модификаторы явного соглашения об именовании в функции и пытается оптимизировать соглашение о вызове функции:  
  
-   передает параметры в регистраторах;  
  
-   переупорядочивает параметры для выравнивания;  
  
-   удаляет неиспользуемые параметры.  
  
Если функция вызывается через указатель на функцию или если она вызывается за пределами модуля, скомпилированного с помощью **\/GL**, компилятор не пытается оптимизировать соглашение о вызове функции.  
  
> [!NOTE]
> Если вы используете **\/LTCG** и переопределяете mainCRTStartup, в вашем приложении может возникнуть непредвиденное поведение, относящееся к коду пользователя, который выполняется до инициализации глобальных объектов.  Существует три способа решения этой проблемы: не переопределяйте mainCRTStartup, не компилируйте файл, который содержит mainCRTStartup, с помощью **\/LTCG** или инициализируйте глобальные переменные и объекты статически.  
  
## Модули \/LTCG и MSIL  
Модули, скомпилированные с помощью [\/GL](../../build/reference/gl-whole-program-optimization.md) и [\/clr](../../build/reference/clr-common-language-runtime-compilation.md), могут использоваться в качестве входных данных компоновщика, если указан параметр **\/LTCG**.  
  
-   **\/LTCG** может принять машинные файлы объектов, смешанные файлы объектов \(машинные и управляемые\) \(скомпилированные с помощью **\/clr**\) и чистые файлы объектов \(скомпилированные с помощью **\/clr:pure**\), а также безопасные файлы объектов \(скомпилированные с помощью **\/clr:safe**\)  
  
-   **\/LTCG** может принять безопасные NETMODULES\-файлы, которые могут быть созданы с помощью **\/clr:safe \/LN** в Visual C\+\+ и **\/target:module** в другом компиляторе Visual Studio. NETMODULES\-файлы, созданные с помощью **\/clr** или **\/clr:pure**, не принимаются **\/LTCG**.  
  
-   \/LTCG:PGI не принимает машинные модули, скомпилированные с помощью **\/GL** и **\/clr**, или чистые модули \(созданные с помощью **\/clr:pure**\)  
  
#### Установка данного параметра компилятора в среде разработки Visual Studio  
  
1.  Откройте диалоговое окно **Окна свойств** проекта. См. раздел [Работа со свойствами проектов](../../ide/working-with-project-properties.md).  
  
2.  Выберите папку **Свойства конфигурации**.  
  
3.  Выберите страницу свойств **Общие**.  
  
4.  Измените свойство **Оптимизация всей программы**.  
  
Вы можете также применить **\/LTCG** к конкретным сборкам, выбрав **Сборка**, **Профильная оптимизация** в строке меню, или щелкнув один из параметров профильной оптимизации в контекстном меню проекта.  
  
#### Установка данного параметра компилятора программным способом  
  
-   См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.LinkTimeCodeGeneration%2A>.  
  
## См. также  
[Настройка параметров компоновщика](../../build/reference/setting-linker-options.md)  
[Параметры компоновщика](../../build/reference/linker-options.md)
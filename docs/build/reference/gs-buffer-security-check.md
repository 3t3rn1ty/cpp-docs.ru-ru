---
title: "-GS (проверка безопасности буфера) | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- cpp-tools
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords:
- VC.Project.VCCLWCECompilerTool.BufferSecurityCheck
- VC.Project.VCCLCompilerTool.BufferSecurityCheck
- /GS
dev_langs:
- C++
helpviewer_keywords:
- buffers [C++], buffer overruns
- buffer overruns, compiler /GS switch
- GS compiler option [C++]
- /GS compiler option [C++]
- security check compiler option [C++]
- -GS compiler option [C++]
- buffers [C++], avoiding overruns
ms.assetid: 8d8a5ea1-cd5e-42e1-bc36-66e1cd7e731e
caps.latest.revision: 
author: corob-msft
ms.author: corob
manager: ghogen
ms.workload:
- cplusplus
ms.openlocfilehash: e5699830a090f42feb92b24ec43fbae36634c4df
ms.sourcegitcommit: 54035dce0992ba5dce0323d67f86301f994ff3db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2018
---
# <a name="gs-buffer-security-check"></a>Параметр /GS (проверка безопасности буфера)  
  
Обнаруживает некоторые переполнения буфера, которые перезаписывают адрес возврата функции, адрес обработчика исключения или определенные типы параметров. Вызов переполнения буфера — это методика, используемых злоумышленниками для использования кода, который не реализует ограничения на размер буфера.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
/GS[-]  
```  
  
## <a name="remarks"></a>Примечания  
  
**/ GS** по умолчанию. Если предполагается отсутствие проблем безопасности приложения, используйте **/GS-**. Дополнительные сведения о **/GS**, в разделе [компилятора безопасности проверяет в глубину](http://go.microsoft.com/fwlink/p/?linkid=7260). Дополнительные сведения о подавлении обнаружения переполнения буфера см. в разделе [safebuffers](../../cpp/safebuffers.md).  
  
## <a name="security-checks"></a>Проверки безопасности  
  
Для функций, которые компилятор распознает в зависимости от проблемы переполнения буфера компилятор выделяет место в стеке перед обратный адрес. При входе в функцию загрузки выделенного пространства с *cookie безопасности* , формируется один раз при загрузке модуля. На выходе функции, а также при очистке кадра на 64-разрядных операционных системах чтобы убедиться в том, что значение cookie остается неизменным называется вспомогательную функцию. Другое значение указывает, что мог произойти перезапись стека. Процесс завершается, если обнаружено другое значение.  
  
## <a name="gs-buffers"></a>Буферы GS  
  
Проверка безопасности на переполнение буфера выполняется на *буферы*. Буфер GS может принимать одно из них:  
  
-   Массив, размер которого превышает 4 байта, имеет более двух элементов и содержит тип элемента, который не является типом указателя.  
  
-   Структура данных, размер которых превышает 8 байт и не содержит указателей.  
  
-   Буфер, выделенный с помощью [_alloca](../../c-runtime-library/reference/alloca.md) функции.  
  
-   Любой класс или структуру, содержащую буфер GS.  
  
Например следующие инструкции объявляют буферы GS.  
  
```cpp  
char buffer[20];  
int buffer[20];  
struct { int a; int b; int c; int d; } myStruct;  
struct { int a; char buf[20]; };  
```  
  
Тем не менее следующие инструкции не объявляют буферы GS. Первые два объявления содержат элементы типа указателя. Третий и четвертый операторы объявления массивов, размер которых слишком мал. Пятый оператор объявляет структуру, размер которого x86 платформа не более 8 байт.  
  
```cpp  
char *pBuf[20];  
void *pv[20];  
char buf[4];  
int buf[2];  
struct { int a; int b; };  
```  
  
## <a name="initialize-the-security-cookie"></a>Инициализировать файл Cookie безопасности  
  
**/GS** параметр компилятора требует инициализации файла cookie безопасности перед запуском любая функция, которая использует файл cookie. Файл cookie безопасности должна быть инициализирована сразу на запись в файл EXE или DLL. Это выполняется автоматически при использовании точки входа по умолчанию VCRuntime: mainCRTStartup, wmainCRTStartup, случае wWinMainCRTStartup, или _DllMainCRTStartup. При использовании точки входа альтернативный объект безопасности cookie необходимо инициализировать вручную путем вызова [__security_init_cookie](../../c-runtime-library/reference/security-init-cookie.md).  
  
## <a name="what-is-protected"></a>Что защищается  
  
**/GS** параметр компилятора защищает следующие элементы:  
  
-   Обратный адрес вызова функции.  
  
-   Адрес обработчика исключений для функции.  
  
-   Параметры уязвимой функции.  
  
На всех платформах **/GS** пытается обнаружить переполнение буфера обратный адрес. Переполнение буфера чаще на платформах, например x86- и x64, который использовать соглашения о вызовах, в которых хранятся обратный адрес вызова функции в стеке.  
  
На x86 Если функция использует обработчик исключений, компилятор вставляет файл cookie безопасности для защиты адреса обработчика исключений. Куки-файл проверяется при очистке кадра.  
  
**/ GS** защищает *уязвимых параметров* , передаваемые в функцию. Уязвимым параметр является указателем, ссылкой на C++, C-структуру (тип C++ POD), содержит указатель, а также буферы.  
  
Уязвимым параметрам выделяется до объектов cookie и локальных переменных. Переполнение буфера может перезаписать эти параметры. И код в функцию, которая использует эти параметры может вызвать атаку, прежде чем функция возвращает и выполняется проверка безопасности. Чтобы свести к минимуму эту опасность, компилятор создает копию уязвимых параметров в прологе функции и помещает их ниже области хранения буферов.  
  
Компилятор не выполняет копии уязвимых параметров в следующих ситуациях:  
  
-   Функции, которые не содержат буфер GS.  
  
-   Оптимизация ([параметры /O](../../build/reference/o-options-optimize-code.md)) не включены.  
  
-   Функции, имеющие список аргументов переменных (...).  
  
-   Функции, помеченные [naked](../../cpp/naked-cpp.md).  
  
-   Функции, содержащие встроенный код ассемблера в первой инструкции.  
  
-   Параметр используется только теми способами, которые вряд ли быть использованы в случае переполнения буфера.  
  
## <a name="what-is-not-protected"></a>Что не защищается  
  
**/GS** параметр компилятора не защищает от атак на систему безопасности всех переполнение буфера. Например если в объекте используются буфер и таблица, переполнение буфера может повредить виртуальной таблице.  
  
Даже если вы используете **/GS**, всегда пытаться писать безопасный код, не имеющий переполнений буфера.  
  
### <a name="to-set-this-compiler-option-in-visual-studio"></a>Установка параметра компилятора в Visual Studio  
  
1.  В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **свойства**.  
  
     Дополнительные сведения см. в разделе [работа со свойствами проекта](../../ide/working-with-project-properties.md).  
  
2.  В **страницы свойств** диалоговое окно, нажмите кнопку **C/C++** папки.  
  
3.  Нажмите кнопку **создания кода** страницу свойств.  
  
4.  Изменить **проверка безопасности буфера** свойство.  
  
### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом  
  
-   См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCCLCompilerTool.BufferSecurityCheck%2A>.  
  
## <a name="example"></a>Пример  
  
В этом примере происходит переполнение буфера. Это приводит к сбою во время выполнения приложения.  
  
```C  
// compile with: /c /W1  
#include <cstring>  
#include <stdlib.h>  
#pragma warning(disable : 4996)   // for strcpy use  
  
// Vulnerable function  
void vulnerable(const char *str) {  
   char buffer[10];  
   strcpy(buffer, str); // overrun buffer !!!  
  
   // use a secure CRT function to help prevent buffer overruns  
   // truncate string to fit a 10 byte buffer  
   // strncpy_s(buffer, _countof(buffer), str, _TRUNCATE);  
}  
  
int main() {  
   // declare buffer that is bigger than expected  
   char large_buffer[] = "This string is longer than 10 characters!!";  
   vulnerable(large_buffer);  
}  
```  
  
## <a name="see-also"></a>См. также  
  
[Параметры компилятора](../../build/reference/compiler-options.md)   
[Настройка параметров компилятора](../../build/reference/setting-compiler-options.md)
---
title: / OPT (оптимизация) | Документы Microsoft
ms.custom: ''
ms.date: 05/18/2018
ms.technology:
- cpp-tools
ms.topic: reference
f1_keywords:
- VC.Project.VCLinkerTool.OptimizeReferences
- /opt
- VC.Project.VCLinkerTool.OptimizeForWindows98
- VC.Project.VCLinkerTool.EnableCOMDATFolding
- VC.Project.VCLinkerTool.OptimizeFolding
- VC.Project.VCLinkerTool.FoldingIterations
- VC.Project.VCLinkerTool.OptimizeFoldingIterations
dev_langs:
- C++
helpviewer_keywords:
- LINK tool [C++], controlling optimizations
- -OPT linker option
- linker [C++], optimizations
- OPT linker option
- optimization, linker
- /OPT linker option
ms.assetid: 8f229863-5f53-48a8-9478-243a647093ac
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: fc9f7f66b9bd0ee2c0da65d17eac33e1cbc8c316
ms.sourcegitcommit: da7b7533d1a4dc141cc0f09149e4e4196f2fe329
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/23/2018
---
# <a name="opt-optimizations"></a>Параметр /OPT (оптимизация)

Управляет оптимизацией, выполняемой во время сборки с помощью программы LINK.

## <a name="syntax"></a>Синтаксис

> **/ OPT:**{**REF** | **NOREF**}<br/>
> **/ OPT:**{**ICF**[**=**_итераций_] | **NOICF**}<br/>
> **/ OPT:**{**LBR** | **NOLBR**}

## <a name="arguments"></a>Аргументы

**REF** &AMP;#124; **NOREF**

**/ OPT: ref** исключает функции и данные, которые никогда не ссылаются; **/OPT: NOREF** хранит такие функции и данные, которые никогда не ссылаются.

При включении предотвратят LINK удаляет неиспользуемые упакованные функции и данные, называемые *COMDAT*. Такой способ оптимизации называется транзитивным исключением функций COMDAT. **/OPT: ref** параметр также отключает инкрементную компоновку.

Встроенных функций и определенные внутри объявления класса функции-члены всегда являются COMDAT. Все функции в объектный файл производится в записи COMDAT, если он компилируется с помощью [/Gy](../../build/reference/gy-enable-function-level-linking.md) параметр. Чтобы поместить **const** данные в записи COMDAT, необходимо объявить ее с помощью `__declspec(selectany)`. Сведения о способах указания данных для удаления или свертывание см [selectany](../../cpp/selectany.md).

По умолчанию **/OPT: ref** включен компоновщиком, если не **/OPT: NOREF** или [/DEBUG](../../build/reference/debug-generate-debug-info.md) указано. Чтобы переопределить поведение по умолчанию и сохранить функции COMDAT без ссылки в программе, укажите **/OPT: NOREF**. Можно использовать [/INCLUDE](../../build/reference/include-force-symbol-references.md) возможность переопределения удаления конкретного символа.

Если [/DEBUG](../../build/reference/debug-generate-debug-info.md) указан, значение по умолчанию для **/OPT** — **NOREF**, и в образе сохраняются все функции. Чтобы переопределить поведение по умолчанию и оптимизировать отладочную сборку, укажите **/OPT: ref**. Можно уменьшить размер исполняемого файла оно может быть полезным оптимизации даже в отладочных построений. Рекомендуется также указать **/OPT:NOICF** для сохранения идентичных функций в отладочных построений. Это упрощает чтение трассировки стека и задание точек останова в функциях, которые в противном случае были бы объединены.

**Брандмауэр подключения к Интернету**\[**=**_итераций_] &#124; **NOICF**

Используйте **ICF**\[**=**_итераций_] чтобы выполнить аналогичное свертывание записей COMDAT. Избыточные записи COMDAT можно удалить из выходных данных компоновщика. Необязательный *итераций* указывает количество проходов символов для поиска дубликатов. Число итераций по умолчанию — 1. При большем числе итераций возможно обнаружение дополнительных дубликатов, появляющихся после свертывания в предыдущих итерациях.

По умолчанию **/OPT: ICF** включен компоновщиком, если не **/OPT:NOICF** или [/DEBUG](../../build/reference/debug-generate-debug-info.md) указано. Чтобы переопределить поведение по умолчанию и предотвратить COMDAT помещенные в программе, укажите **/OPT:NOICF**.

В отладочной сборке, необходимо явно указать **/OPT: ICF** Чтобы включить свертывание записей COMDAT. Тем не менее поскольку **/OPT: ICF** может объединять идентичные данные или функции, он может изменять имена функций, которые отображаются в трассировках стека. Он может также привести невозможности задания точек останова в некоторых функциях или невозможности изучения некоторых данные в отладчике и можно перейти в непредвиденную функцию при вы пошагово выполнить код. Поведение кода идентична, но отладчик представления могут быть очень запутанными. Таким образом, не рекомендуется использовать **/OPT: ICF** в отладочных сборках, если только преимущества меньшего объема кода не перевешивают эти недостатки.

> [!NOTE]
> Поскольку **/OPT: ICF** приведет к тому же адресу, чтобы назначить различным функциям или данным-членам только для чтения (то есть **const** переменные при компиляции с помощью **/Gy**), Это может нарушить работу программы, которая зависит от уникальный адресов для функций и элементов данных только для чтения. Дополнительные сведения см. в разделе [/Gy (включение компоновки на уровне функций)](../../build/reference/gy-enable-function-level-linking.md).

**LBR** &AMP;#124; **NOLBR**

**/OPT:LBR** и **/OPT:NOLBR** параметры применяются только к двоичным файлам ARM. Поскольку некоторые инструкции ветвления процессора ARM имеют ограниченный диапазон, если компоновщик обнаруживает переход к адресу вне допустимого диапазона, он заменяет адрес места назначения инструкции ветвления адресом "островка" кода, содержащим инструкцию ветвления, нацеленную на фактическое место назначения. Можно использовать **/OPT:LBR** оптимизировать обнаружение длинных команд ветвления и размещения промежуточных островков кода для минимизации общего объема кода. **/OPT:NOLBR** указывает компоновщику на необходимость создания островков кода для длинных команд ветвления по мере их обнаружения, без оптимизации.

По умолчанию **/OPT:LBR** был установлен при инкрементная компоновка не включена. Если требуется неинкрементная компоновка, но не оптимизация длинных команд ветвления, укажите **/OPT:NOLBR**. **/OPT:LBR** отключает инкрементную компоновку.

## <a name="remarks"></a>Примечания

При использовании в командной строке параметры по умолчанию компоновщик **LBR/OPT: REF, ICF,**. Если **/DEBUG** указан, значение по умолчанию — **NOLBR/OPT: NOREF, NOICR,**.

**/OPT** оптимизация обычно уменьшить размер образа и повысить производительность программы. Эти усовершенствования могут быть значительными в большие программы, поэтому они включены по умолчанию для сборок розничной торговли.

Оптимизации компоновщика заранее выделите дополнительное время, но оптимизированного кода сокращают время, когда компоновщик меньше перемещения для устранения ошибок и создает меньше окончательного образа, и она сохраняет еще больше времени, когда он имеет меньше отладочную информацию для обработки и запись в PDB-ФАЙЛ. При включенной оптимизации, это может привести быстрее ссылку в целом, как небольшой дополнительной оплаты при анализе может быть больше, чем смещение по времени экономии компоновщика наводится двоичных файлов меньшего размера.

**/OPT** аргументов может быть указан вместе, разделенных запятыми. Например, а не из **предотвратят /OPT:NOICF**, можно указать **/OPT: REF, NOICF**.

Можно использовать [/VERBOSE](../../build/reference/verbose-print-progress-messages.md) компоновщика для функции, которые удаляются в разделе **/OPT: ref** и функции, которые создаются путем **/OPT: ICF**.

**/OPT** аргументы часто настраиваются для проектов, созданных с помощью **новый проект** диалогового окна в Visual Studio IDE и обычно имеют различные значения для отладки и конфигурации для выпуска. Если не задано значение для этих параметров компоновщика в проекте, может возникнуть проекта по умолчанию, которые могут отличаться от значений по умолчанию, используемые компоновщиком в командной строке.

### <a name="to-set-the-opticf-or-optref-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:ICF или OPT:REF в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [работа со свойствами проекта](../../ide/working-with-project-properties.md).

1. Выберите **свойства конфигурации** > **компоновщика** > **оптимизации** страницу свойств.

1. Измените одно из следующих свойств:

   - **Включить свертывание записей COMDAT**

   - **Ссылки**

### <a name="to-set-the-optlbr-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:LBR в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [задание свойств проекта Visual C++](../../ide/working-with-project-properties.md).

1. Выберите **свойства конфигурации** > **компоновщика** > **командной строки** страницу свойств.

1. Введите параметр в **Дополнительные параметры**:

   `/opt:lbr` или `/opt:nolbr`

### <a name="to-set-this-linker-option-programmatically"></a>Задание данного параметра компоновщика программным способом

- См. описание свойств <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.EnableCOMDATFolding%2A> и <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.OptimizeReferences%2A>.

## <a name="see-also"></a>См. также

- [Настройка параметров компоновщика](../../build/reference/setting-linker-options.md)
- [Параметры компоновщика](../../build/reference/linker-options.md)

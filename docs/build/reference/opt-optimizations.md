---
title: "-OPT (оптимизация) | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- cpp-tools
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords:
- VC.Project.VCLinkerTool.OptimizeReferences
- /opt
- VC.Project.VCLinkerTool.OptimizeForWindows98
- VC.Project.VCLinkerTool.EnableCOMDATFolding
- VC.Project.VCLinkerTool.OptimizeFolding
- VC.Project.VCLinkerTool.FoldingIterations
- VC.Project.VCLinkerTool.OptimizeFoldingIterations
dev_langs:
- C++
helpviewer_keywords:
- LINK tool [C++], controlling optimizations
- -OPT linker option
- linker [C++], optimizations
- OPT linker option
- optimization, linker
- /OPT linker option
ms.assetid: 8f229863-5f53-48a8-9478-243a647093ac
caps.latest.revision: 
author: corob-msft
ms.author: corob
manager: ghogen
ms.workload:
- cplusplus
ms.openlocfilehash: 86427dbf1ac6c3404daa36d2e02786aa80ed6453
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="opt-optimizations"></a>Параметр /OPT (оптимизация)
Управляет оптимизацией, выполняемой во время сборки с помощью программы LINK.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
/OPT:{REF | NOREF}  
/OPT:{ICF[=iterations] | NOICF}  
/OPT:{LBR | NOLBR}  
```  
  
## <a name="arguments"></a>Аргументы  
 **REF** &#124; **NOREF**  
 **/ OPT: ref** исключает функции и данные, которые никогда не ссылаются; **/OPT: NOREF** хранит такие функции и данные, которые никогда не ссылаются.  
  
 Если параметр /OFT:REF включен, программа LINK удаляет неиспользуемые упакованные функции и данные. Объект содержит упакованные функции и данные (COMDAT), если он был скомпилирован с помощью [/Gy](../../build/reference/gy-enable-function-level-linking.md) параметр. Такой способ оптимизации называется транзитивным исключением функций COMDAT. По умолчанию **/OPT: ref** включен в неотладочных сборках. Чтобы переопределить поведение по умолчанию и сохранить функции COMDAT без ссылки в программе, укажите **/OPT: NOREF**. Можно использовать [/INCLUDE](../../build/reference/include-force-symbol-references.md) возможность переопределения удаления конкретного символа.  
  
 Когда **/OPT: ref** включен явно или по умолчанию, ограниченную форму **/OPT: ICF** включен, только свертывание идентичных функций. Если вы хотите **/OPT: ref** , но не **/OPT: ICF**, необходимо указать либо **/OPT: REF, NOICF** или **/OPT:NOICF**.  
  
 Если [/DEBUG](../../build/reference/debug-generate-debug-info.md) указан, значение по умолчанию для **/OPT** — **NOREF**, и в образе сохраняются все функции. Чтобы переопределить это поведение по умолчанию и оптимизацию отладочной сборки, укажите **/OPT: ref**. Поскольку **/OPT: ref** подразумевает **/OPT: ICF**, рекомендуется также указать **/OPT:NOICF** для сохранения идентичных функций в отладочных сборках. Это упрощает чтение трассировки стека и задание точек останова в функциях, которые в противном случае были бы объединены. **/OPT: ref** отключает инкрементную компоновку.  
  
 Необходимо явно пометить `const` данные в виде COMDAT; используйте [__declspec(selectany)](../../cpp/selectany.md).  
  
 Указание **/OPT: ICF** не включает **/OPT: ref** параметр.  
  
 **ICF [=** `iterations` **] &#124; NOICF**   
 Используйте **/OPT: ICF [=**`iterations`**]** Чтобы выполнить аналогичное свертывание записей COMDAT. Избыточные записи COMDAT можно удалить из выходных данных компоновщика. Необязательный параметр `iterations` определяет количество проходов символов для поиска дубликатов. По умолчанию используется значение 2. При большем числе итераций возможно обнаружение дополнительных дубликатов, появляющихся после свертывания в предыдущих итерациях.  
  
 Компоновщик ведет себя по-разному при **/OPT: ref** указан — и **ICF** действует по умолчанию — не так, когда **/OPT: REF, ICF** определяются явно. Форме **ICF** с поддержкой с **/OPT: ref** отдельно не свертывает данных только для чтения — Сюда входят .rdata, pdata и xdata. Это приводит к уменьшению числа свертываемых функций при создании образов для [!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)], поскольку эти модули больше зависят от данных только для чтения (например, PDATA и XDATA). Чтобы получить полное **ICF** поведение, свертывания явно указать **/OPT: ICF**.  
  
 Чтобы поместить функции в записи COMDAT, используйте **/Gy** параметр компилятора; для вставки `const` данных, необходимо объявить ее `__declspec(selectany)`. Сведения о способах указания данных для свертывания см. в разделе [selectany](../../cpp/selectany.md).  
  
 По умолчанию **ICF** включен, если включен **REF** включен. Чтобы переопределить поведение по умолчанию, если **REF** будет указано, используйте **NOICF**. Когда **/OPT: ref** не указан в отладочном построении, необходимо явно указать **/OPT: ICF** Чтобы включить свертывание записей COMDAT. Тем не менее поскольку **/OPT: ICF** может объединять идентичные данные или функции, он может изменять имена функций, которые отображаются в трассировках стека. Он также может привести к невозможности задания точек останова в некоторых функциях или невозможности изучения некоторых данные в отладчике, а при пошаговом выполнении кода возможен переход в непредвиденную функцию. Таким образом, не рекомендуется использовать **/OPT: ICF** в отладочных сборках, если только преимущества меньшего объема кода не перевешивают эти недостатки.  
  
> [!NOTE]
>  Поскольку **/OPT: ICF** приведет к тому же адресу, чтобы назначить различным функциям или данным-членам только для чтения (`const` переменные, скомпилированные с помощью **/Gy**), это может нарушить работу программы, которая зависит от уникальные адреса для функции или данным-членам только для чтения. Дополнительные сведения см. в разделе [/Gy (включение компоновки на уровне функций)](../../build/reference/gy-enable-function-level-linking.md).  
  
 **LBR** &#124; **NOLBR**  
 **/OPT:LBR** и **/OPT:NOLBR** параметры применяются только к двоичным файлам ARM. Поскольку некоторые инструкции ветвления процессора ARM имеют ограниченный диапазон, если компоновщик обнаруживает переход к адресу вне допустимого диапазона, он заменяет адрес места назначения инструкции ветвления адресом "островка" кода, содержащим инструкцию ветвления, нацеленную на фактическое место назначения. Можно использовать **/OPT:LBR** оптимизировать обнаружение длинных команд ветвления и размещения промежуточных островков кода для минимизации общего объема кода. **/OPT:NOLBR** указывает компоновщику на необходимость создания островков кода для длинных команд ветвления по мере их обнаружения, без оптимизации.  
  
 По умолчанию **/OPT:LBR** был установлен при инкрементная компоновка не включена. Если требуется неинкрементная компоновка, но не оптимизация длинных команд ветвления, укажите **/OPT:NOLBR**. **/OPT:LBR** отключает инкрементную компоновку.  
  
## <a name="remarks"></a>Примечания  
 Оптимизация обычно позволяет уменьшить размер образа и повысить производительность программы, однако при этом увеличивается время компоновки.  
  
 Можно использовать [/VERBOSE](../../build/reference/verbose-print-progress-messages.md) возможность просмотра функции, которые будут удалены по **/OPT: ref** и функции, которые создаются путем **/OPT: ICF**.  
  
### <a name="to-set-the-opticf-or-optref-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:ICF или OPT:REF в среде разработки Visual Studio  
  
1.  Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [работа со свойствами проекта](../../ide/working-with-project-properties.md).  
  
2.  В левой области разверните **свойства конфигурации**, **компоновщика**, **оптимизации**.  
  
3.  Измените одно из следующих свойств:  
  
    -   **Включить свертывание записей COMDAT**  
  
    -   **Ссылки**  
  
### <a name="to-set-the-optlbr-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:LBR в среде разработки Visual Studio  
  
1.  Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [задание свойств проекта Visual C++](../../ide/working-with-project-properties.md).  
  
2.  Выберите **компоновщика** папки.  
  
3.  Выберите **командной строки** страницу свойств.  
  
4.  Введите параметр в **Дополнительные параметры**:  
  
     `/opt:lbr`  
  
### <a name="to-set-this-linker-option-programmatically"></a>Задание данного параметра компоновщика программным способом  
  
1.  См. описание свойств <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.EnableCOMDATFolding%2A> и <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.OptimizeReferences%2A>.  
  
## <a name="see-also"></a>См. также  
 [Настройка параметров компоновщика](../../build/reference/setting-linker-options.md)   
 [Параметры компоновщика](../../build/reference/linker-options.md)
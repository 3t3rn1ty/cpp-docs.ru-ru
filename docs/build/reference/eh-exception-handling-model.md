---
title: "-EH (модель обработки исключений) | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-tools
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords:
- VC.Project.VCCLWCECompilerTool.ExceptionHandling
- /eh
- VC.Project.VCCLCompilerTool.ExceptionHandling
dev_langs: C++
helpviewer_keywords:
- exception handling, compiler model
- cl.exe compiler, exception handling
- EH compiler option [C++]
- -EH compiler option [C++]
- /EH compiler option [C++]
ms.assetid: 754b916f-d206-4472-b55a-b6f1b0f2cb4d
caps.latest.revision: "29"
author: corob-msft
ms.author: corob
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: 1c56020d5013e951d9d43ed799d34641d114d612
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="eh-exception-handling-model"></a>Параметр /EH (модель обработки исключений)
Указывает тип обработки исключений, используемый компилятором, условия отказа от проверки исключений для оптимизации работы, а также необходимость уничтожения объектов C++, которые выходят за пределы области видимости в результате исключения. Если параметр **/EH** не указан, компилятор перехватывает как асинхронные структурированные исключения, так и исключения C++, но не удаляет объекты C++, которые выходят за пределы области видимости из-за асинхронного исключения.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
/EH{s|a}[c][r][-]  
```  
  
## <a name="arguments"></a>Аргументы  
 **a**  
 Модель обработки исключений, перехватывающая как асинхронные (структурированные), так и синхронные (C++) исключения.  
  
 **s**  
 Модель обработки исключений, перехватывающая только исключения C++ и предписывающая компилятору считать, что функции, объявленные как `extern "C"` , могут создавать исключения.  
  
 **c**  
 При использовании с параметром **s** (**/EHsc**) перехватываются только исключения C++, и предписывается компилятору считать, что функции, объявленные как `extern "C"` , не создают исключения C++.  
  
 **/EHca** эквивалентно **/EHa**.  
  
 **r**  
 Дает компилятору указание всегда создавать проверки завершения времени выполнения для всех функций `noexcept` . По умолчанию, если компилятор определяет, что функция вызывает только функции, не создающие исключения, проверки времени выполнения для `noexcept` могут быть исключены оптимизацией.  
  
## <a name="remarks"></a>Примечания  
 Параметр компилятора **/EHa** используется для поддержки асинхронной структурированной обработки исключений (SEH) с предложением `catch(...)` неуправляемого кода C++. Для реализации SEH без указания параметра **/EHa**разработчик может использовать синтаксис `__try`, `__except`и `__finally` . Хотя Windows и Visual C++ поддерживают SEH, настоятельно рекомендуется использовать обработку исключений C++ в соответствии со стандартом ISO (**/EHs** или **/EHsc**), поскольку это повышает переносимость и гибкость кода. Тем не менее, в имеющемся коде или для программ определенных видов — например, в коде, скомпилированном для поддержки общеязыковая среда выполнения ([/CLR (компиляция CLR)](../../build/reference/clr-common-language-runtime-compilation.md)), по-прежнему может потребоваться использовать SEH. Дополнительные сведения см. в разделе [Structured Exception Handling (C/C++)](../../cpp/structured-exception-handling-c-cpp.md).  
  
 Указание параметра **/EHa** и попытка обрабатывать все исключения с помощью предложения `catch(...)` может быть небезопасно. В большинстве случаев восстановление после асинхронного исключения невозможно, и такие исключения следует считать неустранимыми. При их перехвате и продолжении работы возможно повреждение процесса и возникновение ошибок, которые трудно обнаружить и исправить.  
  
 Если используется параметр **/EHs** или **/EHsc**, предложение `catch(...)` не перехватывает асинхронные структурированные исключения. Нарушения прав доступа и управляемые исключения <xref:System.Exception?displayProperty=fullName> не перехватываются, и объекты, которые находятся в области видимости при возникновении асинхронного исключения, не удаляются, даже если асинхронное исключение обрабатывается.  
  
 Если используется параметр **/EHa**размер образа может быть больше, а эффективность ниже, поскольку компилятор не так агрессивно оптимизирует блок `try` . Также он сохраняет фильтры исключений, которые автоматически вызывают деструкторы всех локальных объектов, даже если компилятор не видит код, который мог бы вызывать исключение C++. Это обеспечивает безопасное развертывание стека как для асинхронных исключений, так и для исключений C++. При использовании параметра **/EHs**компилятор предполагает, что исключения могут возникать только в операторе `throw` или при вызове функции. Это позволяет компилятору исключить код для отслеживания времени существования многих нераскручиваемых объектов, значительно уменьшая объем кода.  
  
 Не рекомендуется в одном исполняемом модуле использовать связывание объектов, скомпилированных с параметром **/EHa** , с объектами, скомпилированными с параметром **/EHs** . Если необходимо обрабатывать асинхронные исключения с помощью параметра **/EHa** в каком-либо месте модуля, используйте параметр **/EHa** для компиляции всего кода модуля. Можно использовать синтаксис структурированной обработки исключений в одном модуле с кодом, который компилируется с параметром **/EHs**, но нельзя смешивать синтаксис SEH с операторами `try`, `throw`и `catch` в одной функции.  
  
 Используйте параметр **/EHa** , если требуется перехватывать исключения, которые не созданы посредством `throw`. В этом примере создается и перехватывается структурированное исключение:  
  
```cpp  
// compiler_options_EHA.cpp  
// compile with: /EHa  
#include <iostream>  
#include <excpt.h>  
using namespace std;  
  
void fail() {   // generates SE and attempts to catch it using catch(...)  
   try {  
      int i = 0, j = 1;  
      j /= i;   // This will throw a SE (divide by zero).  
      printf("%d", j);   
   }  
   catch(...) {   // catch block will only be executed under /EHa  
      cout<<"Caught an exception in catch(...)."<<endl;  
   }  
}  
  
int main() {  
   __try {  
      fail();   
   }  
  
   // __except will only catch an exception here  
   __except(EXCEPTION_EXECUTE_HANDLER) {     
   // if the exception was not caught by the catch(...) inside fail()  
      cout << "An exception was caught in __except." << endl;  
   }  
}  
```  
  
 При использовании параметра **/EHc** необходимо указать параметр **/EHs** или **/EHa** . Параметр **/clr** подразумевает использование параметра **/EHa** (т. е. выражение **/clr /EHa** является избыточным). При использовании параметра **/EHs[c]** после **/clr**возникает ошибка компилятора. Оптимизации не влияют на это поведение. В случае перехвата исключения компилятор вызывает деструктор класса или деструкторы объектов, которые находятся в той же области видимости, что и исключение. Если исключение не перехватывается, эти деструкторы не выполняются.  
  
 Дополнительные сведения об ограничениях обработки исключений при использовании параметра **/clr**см. в разделе [_set_se_translator](../../c-runtime-library/reference/set-se-translator.md).  
  
 Параметр можно отменить с помощью символа **-**. Например, выражение **/EHsc-** интерпретируется как **/EHs /EHc-** и эквивалентно выражению **/EHs**.  
  
 Параметр компилятора **/EHr** вызывает принудительное выполнение проверки завершения времени выполнения во всех функциях, которые имеют атрибут `noexcept` . По умолчанию проверки времени выполнения могут быть исключены оптимизацией, если внутренний сегмент компилятора определяет, что функция вызывает только функции, *не создающие исключения* . К функциям, не создающим исключения, относятся все функции с атрибутом, указывающим, что исключения не создаются. К ним относятся функции, помеченные `noexcept`, `throw()`, `__declspec(nothrow)`, и, когда указан параметр **/EHc** , функции `extern "C"` . К функциям, не создающим исключения, также относятся функции, которые компилятор путем проверки определяет как не создающие исключения. Можно явно задать значение по умолчанию, используя **/EHr-**.  
  
 Тем не менее атрибут, запрещающий формирование исключений, не гарантирует, что функция не сможет создавать исключения. В отличие от поведения функции `noexcept` , компилятор Visual C++ рассматривает исключения, созданные функцией, объявленной с помощью `throw()`, `__declspec(nothrow)`или `extern "C"` , как неопределенное поведение. Функции, использующие эти три атрибута объявления, не выполняют проверки завершения времени выполнения для исключений. Можно использовать параметр **/EHr** , чтобы выявить такое неопределенное поведение, заставив компилятор создавать проверки времени выполнения для необработанных исключений, "ускользнувших" от функции `noexcept` .  
  
### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio  
  
1.  Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [работа со свойствами проекта](../../ide/working-with-project-properties.md).  
  
2.  В левой области разверните узел **Свойства конфигурации**, **C/C++**, **Создание кода**.  
  
3.  Измените значение свойства **Включить C++ исключения** .  
  
     Можно также задать для параметра **Включить C++ исключения** значение **Нет**, а затем на странице свойств **Командная строка** в поле **Дополнительные параметры** добавить параметр компилятора.  
  
### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом  
  
-   См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCCLCompilerTool.ExceptionHandling%2A>.  
  
## <a name="see-also"></a>См. также  
 [Параметры компилятора](../../build/reference/compiler-options.md)   
 [Настройка параметров компилятора](../../build/reference/setting-compiler-options.md)   
 [Обработка ошибок и исключений](../../cpp/errors-and-exception-handling-modern-cpp.md)   
 [Спецификации исключений (throw)](../../cpp/exception-specifications-throw-cpp.md)   
 [Структурированная обработка исключений (C/C++)](../../cpp/structured-exception-handling-c-cpp.md)
---
title: "Структура UNWIND_CODE | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-tools
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: C++
ms.assetid: 104955d8-7e33-4c5a-b0c6-3254648f0af3
caps.latest.revision: "8"
author: corob-msft
ms.author: corob
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: 76059ff24b46fd537db0c2670a30cf3f42ee2166
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="struct-unwindcode"></a>Структура UNWIND_CODE
В массиве кодов очистки используется для записи последовательности операций в прологе, влияющие на неизменяемые регистры и RSP. Каждый элемент кода имеет следующий формат:  
  
|||  
|-|-|  
|UBYTE|Смещение в прологе|  
|UBYTE: 4|Код операции очистки|  
|UBYTE: 4|Сведения об операции|  
  
 Массив сортируется по убыванию смещение в прологе.  
  
 **Смещение в прологе**  
 Смещение от начала пролога конца инструкции, которая выполняет данную операцию, плюс 1 (то есть смещение начала следующей инструкции).  
  
 **Код операции очистки**  
 Примечание: Некоторые коды операций требуется смещение без знака со значением в кадре стека локальной. Это смещение считается от начала (нижнего адреса) выделения основных стека. Если поле регистра кадра стека в UNWIND_INFO равно нулю, это смещение отсчитывается от RSP. Если поле регистра кадра отлично от нуля, это смещение от где RSP находился в момент регистра FP. Это соответствует значению FP минус смещение регистра FP (16 * масштабированное смещение регистра кадра стека в UNWIND_INFO). При использовании регистра FP затем любой код раскрутки смещением должен использоваться только после установки в прологе регистра FP.  
  
 Для всех кодов операций Кроме UWOP_SAVE_XMM128 и UWOP_SAVE_XMM128_FAR смещение будет кратна 8, так как все стеке значения хранятся в 8 байт (сам стек всегда является 16-байтовое выравнивание). Для кодов операций с коротким смещением (менее 512 КБ) завершающий USHORT в узлах кода содержит смещение, разделенное на 8. Для кодов операций длинным смещением (512 КБ < = смещение < 4 ГБ), окончательный два узла USHORT для этого кода содержат смещение (в формате с прямым порядком байтов).  
  
 Коды операций UWOP_SAVE_XMM128 и UWOP_SAVE_XMM128_FAR смещение всегда будут кратной 16, поскольку все 128-битные операции XMM должно находиться на 16-байтовый выровненную память. Таким образом коэффициент масштабирования 16 используется для UWOP_SAVE_XMM128 использовать смещение до 1 МБ.  
  
 Код операции очистки является одним из следующих:  
  
 UWOP_PUSH_NONVOL (0) 1 узел  
  
 Принудительная регистрация защищенным целочисленным, уменьшением значения RSP в 8. Сведения об операции является номер регистра. Обратите внимание, что, в связи с ограничениями на эпилог, коды очистки UWOP_PUSH_NONVOL должен отображаются первыми в прологе соответственно, последними в массиве кодов очистки. Этот относительный порядок применяется для всех кодов очистки, за исключением UWOP_PUSH_MACHFRAME.  
  
 UWOP_ALLOC_LARGE (1) двух или трех узлов.  
  
 Выделите большого объема памяти в стеке. Существует две формы. Если сведений об операции значение 0, то размер выделения, разделенное на 8 записывается в следующую ячейку, позволяя выделение до 512 КБ - 8. Если сведений об операции значение 1, то зависимым размер выделения записывается в следующие две ячейки в формате с прямым порядком байтов, что позволяет выделять до 4 ГБ — 8.  
  
 (2) UWOP_ALLOC_SMALL 1 узел  
  
 Выделите небольшого объема в стеке. Размер выделения является поле сведений об операции * 8 + 8, что позволяет выделять от 8 до 128 байт.  
  
 Код очистки для выделения памяти в стеке следует всегда использовать наиболее короткую кодировку:  
  
|||  
|-|-|  
|**Размер выделения**|**Код очистки**|  
|от 8 до 128 байт|UWOP_ALLOC_SMALL|  
|136 до 512 КБ - 8 байт|UWOP_ALLOC_LARGE сведений об операции = 0|  
|512 КБ до 4 ГБ — 8 байт|UWOP_ALLOC_LARGE сведений об операции = 1|  
  
 Коде завершения UWOP_SET_FPREG (3) 1 узел  
  
 Установите регистр указателя кадра, задав для некоторых смещение текущего RSP регистра. Смещение равно регистра кадра (масштабированное) поле сдвига UNWIND_INFO * 16, что позволяет смещения от 0 до 240. Использование смещения позволяет установить указатель кадра стека по центру фиксированного выделения стека, помогая плотности кода, позволяя несколько обращений к использовать форм коротких инструкций. Обратите внимание, что поле сведений об операции зарезервирован и не должны использоваться.  
  
 (4) UWOP_SAVE_NONVOL 2 узлов  
  
 Сохраните защищенным целочисленным регистр в стеке, используя функцию MOV вместо PUSH. Это в первую очередь для упаковка со сжатием, сохранения защищенный регистр в стеке в позиции, которая ранее была выделена. Сведения об операции является номер регистра. Смещение стека масштабируется по 8 записывается в следующей ячейке кода завершающей операции, как описано выше в примечании.  
  
 (5) UWOP_SAVE_NONVOL_FAR 3 узла  
  
 Сохраните защищенным целочисленным регистр в стеке с длинным смещением, используя функцию MOV вместо PUSH. Это в первую очередь для упаковка со сжатием, сохранения защищенный регистр в стеке в позиции, которая ранее была выделена. Сведения об операции является номер регистра. Смещение зависимым стека записывается в следующих двух кода завершающей операции, как описано выше в примечании.  
  
 UWOP_SAVE_XMM128 (8) 2 узлов  
  
 Сохраните все 128 байт энергонезависимого регистра XMM в стеке. Сведения об операции является номер регистра. Смещение стека масштабируется по 16 записывается в следующую ячейку.  
  
 UWOP_SAVE_XMM128_FAR (9) 3 узла  
  
 Сохраните все 128 байт энергонезависимого регистра XMM в стеке с длинным смещением. Сведения об операции является номер регистра. Смещение зависимым стека записывается в следующие две ячейки.  
  
 UWOP_PUSH_MACHFRAME (10) 1 узел  
  
 Передача машинного кадра.  Используется для записи воздействия аппаратного прерывания или исключения. Существует две формы. Если сведений об операции значение 0, следующие было помещено в стеке:  
  
|||  
|-|-|  
|RSP + 32|SS|  
|RSP + 24|Старый RSP|  
|RSP + 16|EFLAGS|  
|RSP + 8|CS|  
|RSP|ПРОТОКОЛ RIP|  
  
 Если сведений об операции равна 1, то вместо этого было помещено следующее:  
  
|||  
|-|-|  
|RSP + 40|SS|  
|RSP + 32|Старый RSP|  
|RSP + 24|EFLAGS|  
|RSP + 16|CS|  
|RSP + 8|ПРОТОКОЛ RIP|  
|RSP|Код ошибки|  
  
 Этот код очистки будут всегда отображаться в фиктивной пролога, который никогда не выполняется, но вместо этого появляется перед реальной точкой входа подпрограммы прерывания и существует только для того, чтобы предоставить место для имитации передачи машинного кадра. UWOP_PUSH_MACHFRAME записывает эту имитацию, что означает, что компьютер концептуально выполнил следующее:  
  
 Обратного адреса RIP с вершины стека в *Temp*  
  
 Передача SS  
  
 Старый RSP Push  
  
 Принудительная EFLAGS  
  
 Передача CS  
  
 Принудительная *Temp*  
  
 Передача кода ошибки (если сведений об операции значение 1)  
  
 Смоделированная операция UWOP_PUSH_MACHFRAME уменьшает RSP на 40 (сведений об операции значение 0) или 48 (сведений об операции значение 1).  
  
 **Сведения об операции**  
 Значение этих 4 байт зависит от кода операции. Для кодирования регистра общего назначения (целое число), используется следующее сопоставление.  
  
|||  
|-|-|  
|0|RAX|  
|1|RCX|  
|2|RDX|  
|3|RBX|  
|4|RSP|  
|5|RBP|  
|6|RSI|  
|7|RDI|  
|8 до 15|R8 для R15|  
  
## <a name="see-also"></a>См. также  
 [Данные раскрутки для обработки исключений и поддержки отладчика](../build/unwind-data-for-exception-handling-debugger-support.md)
---
title: "Пошаговое руководство: Создание и использование собственного динамической библиотеки ссылку (C++) | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-tools
ms.tgt_pltfrm: 
ms.topic: get-started-article
dev_langs: C++
helpviewer_keywords:
- libraries [C++], DLLs
- DLLs [C++], walkthroughs
ms.assetid: 3ae94848-44e7-4955-bbad-7d40f493e941
caps.latest.revision: "36"
author: corob-msft
ms.author: corob
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: bdcc02cf7c86b85684df0e8d8b7a1f0049ff7e25
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="walkthrough-create-and-use-your-own-dynamic-link-library-c"></a>Пошаговое руководство: Создание и использование собственного динамической библиотеки ссылку (C++)

Это пошаговое руководство показывает, как использовать интегрированную среду разработки Visual Studio для создания собственной библиотеки динамической компоновки (DLL), на языке C++, а затем использовать его из другого приложения C++. DLL-библиотеки являются одним из наиболее полезных виды компонентов Windows. Их можно использовать как способ совместного использования кода и ресурсов, для уменьшения размера приложения и чтобы упростить обслуживание и расширения приложений. В этом пошаговом руководстве создать библиотеку DLL, который реализует некоторые математические функции и затем создать консольное приложение, которое использует функции из библиотеки DLL. Попутно вы получаете вводные сведения о некоторых приемы программирования и соглашения, используемые в библиотеках DLL Windows.

В этом пошаговом руководстве рассматриваются следующие задачи:

- Создайте проект библиотеки DLL в Visual Studio.

- Добавьте библиотеку DLL экспортированных функций и переменных.

- Создайте проект консольного приложения в Visual Studio.

- Использование функций и переменных, импортированных из библиотеки DLL, в консольное приложение.

- Запустите приложение.

Статически скомпонованной библиотекой DLL, например _экспортирует_ переменных, функций и ресурсов по имени и приложения _импортирует_ эти имена для использования этих переменных, функций и ресурсов. В отличие от статической библиотеки Windows подключается imports в приложении на экспортируемые элементы в библиотеке DLL во время загрузки или во время выполнения, а не их во время компоновки. Windows может требоваться дополнительную информацию, которая не является частью стандартной модели компиляции C++, чтобы установить эти соединения. Компилятор Visual C++ реализует некоторые специальные расширения Microsoft для C++, чтобы предоставить эти дополнительные данные. Эти расширения обсуждаться при переходе.

В этом примере создается два решения Visual Studio; один, создающий библиотеку DLL и один, выполняющий построение клиентского приложения. Библиотека DLL использует соглашение о вызовах C, поэтому может вызываться из приложений, созданных с помощью других языков при условии, что соответствует платформы и вызывают и связывание соглашения. Клиент использует приложение _неявное связывание_, где Windows связано приложение с библиотекой DLL во время загрузки. Это позволяет приложению вызывать функции DLL указано так же, как функции в статически скомпонованной библиотекой.

В этом пошаговом руководстве не охватывает некоторые распространенные ситуации. Он не показывает использование библиотек DLL C++ в других языках программирования. Он не показывает, как создать Библиотеку ресурсов. Оно также не показывает использования явное связывание для загрузки библиотеки DLL во время выполнения, а не во время загрузки. Можно быть уверенным, Visual C++ можно использовать для выполнения этих действий. Ссылки на дополнительные сведения о библиотеках DLL см. в разделе [библиотеки DLL в Visual C++](../build/dlls-in-visual-cpp.md). Дополнительные сведения о неявное связывание и явное связывание см. в разделе [определение которого связывания метода](../build/linking-an-executable-to-a-dll.md#determining-which-linking-method-to-use). Сведения о создании библиотек DLL C++ для использования с языками, использующих соглашения о компоновки языка программирования см. в разделе [Экспорт функций C++ для использования в исполняемых файлах языка C](../build/exporting-cpp-functions-for-use-in-c-language-executables.md). Сведения о способах создания библиотек DLL для использования с языками .NET, см. в разделе [вызов функции DLL из приложений Visual Basic](../build/calling-dll-functions-from-visual-basic-applications.md).

В этом пошаговом руководстве используется Visual Studio 2017 г., но код и большая часть инструкции применимы к более ранним версиям. Шаги для создания новых проектов изменен, начиная с версии 15,3 2017 г. Visual Studio. В этом пошаговом руководстве описывается создание проектов для новые и старые версии. Поиск действия, соответствующие вашей версии Visual Studio.

## <a name="prerequisites"></a>Предварительные требования

- На компьютере под управлением Microsoft Windows 7 или более поздней версии. Для получения наилучших результатов разработки мы рекомендуем Windows 10.

- Копия Visual Studio 2017 г. Сведения о том, как загрузить и установить Visual Studio см. в разделе [установить Visual Studio 2017](/visualstudio/install/install-visual-studio). При запуске программы установки, убедитесь, что **разработки настольных приложений с помощью C++** проверяется рабочей нагрузки. Не беспокойтесь, если рабочая нагрузка не установлен, при установке Visual Studio. Можно еще раз запустите программу установки и установите его.

   ![Для разработки настольных приложений с помощью C++](media/desktop-development-with-cpp.png "разработки настольных приложений на C++")

- Основные сведения о основные принципы использования интегрированной среды разработки Visual Studio. При использовании классических приложений Windows, прежде чем вы, вероятно, справляется. Вводные сведения см. в разделе [Обзор возможностей Visual Studio IDE](/visualstudio/ide/visual-studio-ide).

- Понимание достаточно работы необходимо владеть основами языка C++ для выполнения этой процедуры. Не беспокойтесь, мы не предпринимать слишком сложное.

## <a name="create-the-dll-project"></a>Создание проекта библиотеки DLL

В этот набор задач создайте проект для библиотеки DLL, добавьте код и постройте его. Чтобы начать, запустите интегрированную среду разработки Visual Studio и войти, если необходимо. Инструкции по Visual Studio 2017 г. версия 15,3 идти первой. Инструкции для более ранних версий доступны позже, поэтому пропустить, если необходимо.

### <a name="to-create-a-dll-project-in-visual-studio-2017-version-153-or-later"></a>Чтобы создать проект библиотеки DLL в Visual Studio 2017 г. версия 15,3 или более поздней версии

1. В строке меню выберите **файл**, **New**, **проекта** Открытие **новый проект** диалоговое окно.

1. В левой области **новый проект** диалогового окна разверните **установленные** и **Visual C++** при необходимости, а затем выберите **Windows Desktop**. В центральной области выберите **мастер рабочего стола Windows**. Введите `MathLibrary` в **имя** поле, чтобы указать имя для проекта.

   ![Назовите проект MathLibrary](media/mathlibrary-new-project-name-153.png "имя проекта MathLibrary")

1. Выберите **ОК** кнопку, чтобы закрыть **новый проект** диалоговое окно и начала **проект рабочего стола Windows** мастера.

1. В **проект рабочего стола Windows** в разделе **тип приложения**выберите **библиотеки динамической компоновки (.dll)**.

   ![Создать библиотеку DLL в мастере проекта классического приложения Windows](media/mathlibrary-desktop-project-wizard-dll.png "создать библиотеку DLL в мастере проекта классического приложения Windows")

1. Нажмите кнопку **ОК**, чтобы создать проект.

> [!NOTE]
> При устранении неполадок в Visual Studio 2017 г. версия 15,3 необходимы дополнительные действия. Следуйте этим инструкциям, чтобы увидеть, если необходимо внести это изменение.
>
>1. В **обозревателе решений**, если он еще не выбран, выберите **MathLibrary** проект **решения «MathLibrary»**.
>
>1. В строке меню выберите **Проект**, **Свойства**.
>
>1. В левой области **страницы свойств** выберите **препроцессор** под **свойства конфигурации**, **C/C++**. Проверьте содержимое **определения препроцессора** свойство.<br/><br/>![Проверьте свойство определения препроцессора](media/mathlibrary-153bug-preprocessor-definitions-check.png "проверьте свойство определения препроцессора")<br/><br/>Если вы видите **MATHLIBRARY &#95; ЭКСПОРТЫ** в **определения препроцессора** список, вам не нужно изменять что-либо. Если вы видите **MathLibrary &#95; ЭКСПОРТЫ** вместо, затем продолжить выполните следующие действия.
>
>1. В верхней части **страницы свойств** диалогового окна, изменение **конфигурации** раскрывающийся список для **все конфигурации**.
>
>1. В панели «Свойства» выберите элемент управления раскрывающегося списка рядом с полем редактирования для **определения препроцессора**, а затем выберите **изменить**.<br/><br/>![Измените значение свойства определения препроцессора](media/mathlibrary-153bug-preprocessor-definitions-property.png "изменить свойства определения препроцессора")
>
>1. В верхней части **определения препроцессора** диалоговое окно, добавьте новый символ `MATHLIBRARY_EXPORTS`.<br/><br/>![Добавьте символ MATHLIBRARY_EXPORTS](media/mathlibrary-153bug-preprocessor-definitions-dialog.png "добавьте символ MATHLIBRARY_EXPORTS")
>
>1. Выберите **ОК** закрыть **определения препроцессора** диалоговое окно и нажмите кнопку **ОК** для сохранения изменений в свойствах проекта.

### <a name="to-create-a-dll-project-in-older-versions-of-visual-studio"></a>Чтобы создать проект библиотеки DLL в предыдущих версиях Visual Studio

1. В строке меню выберите **Файл**, **Создать**, **Проект**.

1. В левой области **новый проект** диалогового окна разверните **установленные**, **шаблоны**и выберите **Visual C++**, а затем в центре Выберите **консольное приложение Win32**. Введите `MathLibrary` в **имя** "Правка", чтобы указать имя для проекта.

   ![Назовите проект MathLibrary](media/mathlibrary-project-name.png "имя проекта MathLibrary")

1. Выберите **ОК** кнопку, чтобы закрыть **новый проект** диалоговое окно и начала **мастер приложений Win32**.

   ![Общие сведения о мастере приложения Win32](media/mathlibrary-project-wizard-1.png "Общие сведения о мастере приложения Win32")

1. Нажмите кнопку **Далее**. На **параметры приложения** в разделе **тип приложения**выберите **DLL**.

   ![Создать библиотеку DLL в мастере приложений Win32](media/mathlibrary-project-wizard-2.png "создать библиотеку DLL в мастере приложений Win32")

1. Нажмите кнопку **Готово** , чтобы создать проект.

После завершения работы мастера решения вы увидите созданные проекта и исходные файлы в **обозревателе решений** окна в Visual Studio.

![Сформировано решение в Visual Studio](media/mathlibrary-solution-explorer-153.png "сформировано решение в Visual Studio")

Право Теперь эта DLL-Библиотека не выполняет в значительной степени. Создайте файл заголовка для объявления функции библиотеки DLL экспортирует, а затем добавьте определения функций на библиотеку DLL, чтобы сделать его более полезным.

### <a name="to-add-a-header-file-to-the-dll"></a>Чтобы добавить файл заголовка библиотеки DLL

1. Чтобы создать файл заголовка для функций, в строке меню, выберите **проекта**, **Добавление нового элемента**.

1. В **Добавление нового элемента** в левой области выберите диалогового **Visual C++**. В центральной области выберите **Заголовочный файл (.h)**. Укажите `MathLibrary.h` как имя для файла заголовка.

   ![Добавить верхний колонтитул в диалоговом окне Добавление нового элемента](media/mathlibrary-add-new-item-header-file.png "добавить файл заголовка в диалоговом окне Добавление нового элемента")

1. Выберите **добавить** кнопку, чтобы создать пустой файл заголовка, который отображается в новом окне редактора.

   ![Пустой файл MathLibrary.h в редакторе](media/edit-empty-mathlibrary-header.png "MathLibrary.h пустой файл в редакторе")

1. Замените содержимое файла заголовка следующим кодом:

   ```cpp
   // MathLibrary.h - Contains declarations of math functions
   #pragma once

   #ifdef MATHLIBRARY_EXPORTS
   #define MATHLIBRARY_API __declspec(dllexport)
   #else
   #define MATHLIBRARY_API __declspec(dllimport)
   #endif

   // The Fibonacci recurrence relation describes a sequence F
   // where F(n) is { n = 0, a
   //               { n = 1, b
   //               { n > 1, F(n-2) + F(n-1)
   // for some initial integral values a and b.
   // If the sequence is initialized F(0) = 1, F(1) = 1,
   // then this relation produces the well-known Fibonacci
   // sequence: 1, 1, 2, 3, 5, 8, 13, 21, 34, ...

   // Initialize a Fibonacci relation sequence
   // such that F(0) = a, F(1) = b.
   // This function must be called before any other function.
   extern "C" MATHLIBRARY_API void fibonacci_init(
       const unsigned long long a, const unsigned long long b);

   // Produce the next value in the sequence.
   // Returns true on success and updates current value and index;
   // false on overflow, leaves current value and index unchanged.
   extern "C" MATHLIBRARY_API bool fibonacci_next();

   // Get the current value in the sequence.
   extern "C" MATHLIBRARY_API unsigned long long fibonacci_current();

   // Get the position of the current value in the sequence.
   extern "C" MATHLIBRARY_API unsigned fibonacci_index();
   ```

Этот файл заголовка объявляет некоторые функции для получения обобщенной последовательности Фибоначчи, заданного двумя начальные значения. Вызов `fibonacci_init(1, 1)` создает последовательность знакомы Фибоначчи.

Обратите внимание, в операторах препроцессора в верхней части файла. По умолчанию шаблон нового проекта библиотеки DLL добавляет  ***PROJECTNAME*&#95; ЭКСПОРТЫ** определенные макросы препроцессора для проекта DLL. В этом примере Visual Studio определяет **MATHLIBRARY &#95; ЭКСПОРТЫ** при построении проекта MathLibrary DLL. (Мастер в Visual Studio 2017 г. версия 15,3 не используется принудительное определение этого символа в верхний регистр. Если имя проекта «MathLibrary» определен символ является MathLibrary &#95; ЭКСПОРТЫ вместо MATHLIBRARY &#95; ЭКСПОРТИРУЕТ. That's почему есть дополнительные шаги, чтобы добавить этот символ.)

Когда **MATHLIBRARY &#95; ЭКСПОРТЫ** макрос определен, **MATHLIBRARY &#95; API** наборов макрос `__declspec(dllexport)` модификатор в объявлениях функций. Этот модификатор сообщает, компилятор и компоновщик, чтобы экспортировать функцию или переменную из библиотеки DLL, чтобы он может использоваться другими приложениями. Когда **MATHLIBRARY &#95; ЭКСПОРТЫ** не определен, например, когда клиентское приложение включен файл заголовка **MATHLIBRARY &#95; API** применяется `__declspec(dllimport)` модификатор объявления. Этот модификатор оптимизирует импорт функции или переменной в приложении. Дополнительные сведения см. в разделе [dllexport, dllimport](../cpp/dllexport-dllimport.md).

### <a name="to-add-an-implementation-to-the-dll"></a>Чтобы добавить реализацию библиотеки DLL

1. В окне редактора, перейдите на вкладку для **MathLibrary.cpp** , если он уже открыт. В противном случае в **обозревателе решений**откройте **MathLibrary.cpp** в **исходные файлы** папки **MathLibrary** проекта.

1. В редакторе Замените содержимое файла MathLibrary.cpp следующий код:

   ```cpp
   // MathLibrary.cpp : Defines the exported functions for the DLL.
   #include "stdafx.h"
   #include <utility>
   #include <limits.h>
   #include "MathLibrary.h"

   // DLL internal state variables:
   static unsigned long long previous_;  // Previous value, if any
   static unsigned long long current_;   // Current sequence value
   static unsigned index_;               // Current seq. position

   // Initialize a Fibonacci relation sequence
   // such that F(0) = a, F(1) = b.
   // This function must be called before any other function.
   void fibonacci_init(
       const unsigned long long a,
       const unsigned long long b)
   {
       index_ = 0;
       current_ = a;
       previous_ = b; // see special case when initialized
   }

   // Produce the next value in the sequence.
   // Returns true on success, false on overflow.
   bool fibonacci_next()
   {
       // check to see if we'd overflow result or position
       if ((ULLONG_MAX - previous_ < current_) ||
           (UINT_MAX == index_))
       {
           return false;
       }

       // Special case when index == 0, just return b value
       if (index_ > 0)
       {
           // otherwise, calculate next sequence value
           previous_ += current_;
       }
       std::swap(current_, previous_);
       ++index_;
       return true;
   }

   // Get the current value in the sequence.
   unsigned long long fibonacci_current()
   {
       return current_;
   }

   // Get the current index position in the sequence.
   unsigned fibonacci_index()
   {
       return index_;
   }
   ```

Чтобы проверить, пока все работает, Скомпилируйте библиотеку динамической компоновки. Чтобы скомпилировать, выберите **построения**, **построить решение** в строке меню. Результат должен выглядеть примерно следующим образом:

```Output
1>------ Build started: Project: MathLibrary, Configuration: Debug Win32 ------
1>stdafx.cpp
1>MathLibrary.cpp
1>dllmain.cpp
1>Generating Code...
1>   Creating library C:\Users\username\Source\Repos\MathLibrary\Debug\MathLibrary.lib and object C:\Users\username\Source\Repos\MathLibrary\Debug\MathLibrary.exp
1>MathLibrary.vcxproj -> C:\Users\username\Source\Repos\MathLibrary\Debug\MathLibrary.dll
1>MathLibrary.vcxproj -> C:\Users\username\Source\Repos\MathLibrary\Debug\MathLibrary.pdb (Partial PDB)
========== Build: 1 succeeded, 0 failed, 0 up-to-date, 0 skipped ==========
```

Итак, вы создали библиотеки DLL с помощью Visual C++. Затем вы создадите клиентского приложения, использующего функций, экспортируемых из библиотеки DLL.

## <a name="create-a-client-app-that-uses-the-dll"></a>Создание клиентского приложения, использующего библиотеку DLL

При создании библиотеки DLL, нужно решить, как можно использовать библиотеку DLL. Чтобы скомпилировать код, который вызывает функции, экспортируемые библиотеки DLL, объявления необходимо включить в исходном коде клиента. Во время компоновки, если разрешаются эти вызовы функций библиотеки DLL, компоновщик должен иметь *библиотека импорта*, это специальный файл библиотеки, который содержит сведения о том, как найти функции, а не фактический код для Windows. И во время выполнения, должны быть доступны клиенту в расположении, которое операционной системы можно найти библиотеку DLL.

Использовать библиотеку DLL ли ваш владельцем или сторонняя библиотека DLL проекта приложения клиент должен иметь возможность найти заголовки, объявите DLL экспортирует библиотеки импорта для компоновщика и самой библиотеки DLL. Один из способов сделать это является копирование всех файлов в проект клиента. Для сторонних библиотек DLL, которые, скорее всего, изменять, если клиент находится в разработке это может быть лучшим способом их использования. Тем не менее при создании библиотеки DLL, лучше избежать дублирования. При внесении копию DLL-файлы, которые находятся в разработке, можно случайно измените файл заголовка в одной копии, но не в другом, или использовать старую версию библиотеки. Чтобы избежать этой проблемы, рекомендуется задать в путь поиска включаемых в проекте клиента, чтобы включить файлы заголовка DLL из проекта DLL. Кроме того можно задайте путь к библиотеке в проекте клиента для включения библиотеки импорта библиотеки DLL из проекта DLL. И наконец, скопируйте собранную библиотеку DLL из проекта DLL в выходном каталоге сборки. Это гарантирует, что клиентское приложение использует один и тот же код DLL построении.

### <a name="to-create-a-client-app-in-visual-studio-2017-version-153-or-later"></a>Создание клиентского приложения в Visual Studio 2017 г. версия 15,3 или более поздней версии

1. Чтобы создать приложение на C++ с использованием библиотеки DLL, который вы только что создали, в строке меню выберите **файл**, **New**, **проекта**.

1. В левой области **новый проект** диалогового окна выберите **Windows Desktop** под **установленные**, **Visual C++**. В центральной области выберите **мастер рабочего стола Windows**. Укажите имя для проекта, `MathClient`в **имя** "Правка".

   ![Назовите проект клиента](media/mathclient-new-project-name-153.png "имя проекта клиента")

1. Выберите **ОК** запуск **проект рабочего стола Windows** мастера. В мастере выберите **ОК** Создание проект клиентского приложения.

### <a name="to-create-a-client-app-in-older-versions-of-visual-studio-2017"></a>Создание клиентского приложения в более ранних версиях Visual Studio 2017 г.

1. Чтобы создать приложение на C++ с использованием библиотеки DLL, который вы только что создали, в строке меню выберите **файл**, **New**, **проекта**.

1. В левой области **новый проект** диалогового окна выберите **Win32** под **установленные**, **шаблоны**, **Visual C++**. В центральной области выберите **Консольное приложение Win32**. Укажите имя для проекта, `MathClient`в **имя** "Правка".

   ![Назовите проект клиента](media/mathclient-project-name.png "имя проекта клиента")

1. Выберите **ОК** кнопку, чтобы закрыть **новый проект** диалоговое окно и начала **мастер приложений Win32**. На странице **Обзор** диалогового окна **Мастер приложений Win32** нажмите кнопку **Далее** .

1. На **параметры приложения** в разделе **тип приложения**выберите **консольное приложение** , если он еще не выбран.

1. Нажмите кнопку **Готово** , чтобы создать проект.

По завершении работы мастера создается минимальной консольное приложение. Имя основной исходный файл совпадает с ранее введенное имя проекта. В этом примере он называется **MathClient.cpp**. Можно выполнить его, но еще не использует библиотеки DLL.

Затем можно вызывать функции MathLibrary в исходном коде, проект должен содержать файл MathLibrary.h. Можно скопировать этот файл заголовка в ваш проект клиентского приложения, а затем добавить его в проект как существующий элемент. Это может быть хорошим выбором для сторонних библиотек. Тем не менее если вы работаете на код для библиотеки DLL в то же время как клиент, может привести к изменения в файле один заголовок, не отражаются в другом. Чтобы избежать этой проблемы, можно изменить **Дополнительные каталоги включаемых файлов** путь проекта, чтобы указать путь к исходный заголовок.

### <a name="to-add-the-dll-header-to-your-include-path"></a>Для добавления заголовка библиотеки DLL для вашего включают пути

1. Откройте **страницы свойств** диалоговое окно для **MathClient** проекта.

1. В **конфигурации** раскрывающегося списка выберите **все конфигурации** , если он еще не выбран.

1. В левой области выберите **Общие** под **свойства конфигурации**, **C/C++**.

1. В панели «Свойства» выберите элемент управления раскрывающегося списка рядом с **Дополнительные каталоги включаемых файлов** поле ввода, а затем выберите **изменить**.

   ![Измените значение свойства Дополнительные каталоги включаемых файлов](media/mathclient-additional-include-directories-property.png "измените свойство Дополнительные каталоги включаемых файлов")

1. Дважды щелкните в верхней части **Дополнительные каталоги включаемых файлов** диалоговое окно «», чтобы включить элемент управления редактированием.

1. В элементе управления, укажите путь к расположению **MathLibrary.h** файл заголовка. В этом случае можно использовать относительный путь:

   `..\..\MathLibrary\MathLibrary`

   ![Добавьте заголовок расположения в свойство Дополнительные каталоги включаемых файлов](media/mathclient-additional-include-directories.png "добавьте расположение заголовка в свойство Дополнительные каталоги включаемых файлов")

1. После ввода пути к файлу заголовка в вы **Дополнительные каталоги включаемых файлов** диалогового окна выберите **ОК** кнопку, чтобы вернуться к **страницы свойств** диалоговое окно, и Выберите **ОК** кнопку, чтобы сохранить изменения.

Теперь можно включить **MathLibrary.h** файл и использовать функции, он объявляется в клиентском приложении. Замените содержимое **MathClient.cpp** с помощью следующего кода:

```cpp
// MathClient.cpp : Client app for MathLibrary DLL.
#include "stdafx.h"
#include <iostream>
#include "MathLibrary.h"

int main()
{
    // Initialize a Fibonacci relation sequence.
    fibonacci_init(1, 1);
    // Write out the sequence values until overflow.
    do {
        std::cout << fibonacci_index() << ": "
            << fibonacci_current() << std::endl;
    } while (fibonacci_next());
    // Report count of values written before overflow.
    std::cout << fibonacci_index() + 1 <<
        " Fibonacci sequence values fit in an " <<
        "unsigned 64-bit integer." << std::endl;
}
```

Этот код может быть скомпилированы, но не связан, поскольку компоновщику не удается найти библиотеку импорта, необходимые для построения приложения еще. Компоновщик должен уметь найти файл MathLibrary.lib связывание успешно. Необходимо добавить файл MathLibrary.lib к построению, задав **Дополнительные зависимости** свойство. Как и раньше можно скопировать файл библиотеки в проект клиентского приложения, но библиотеки и клиентского приложения находятся в разработке, может привести к изменениям в одной копии, которые не отражены в других. Чтобы избежать этой проблемы, можно изменить **Дополнительные каталоги библиотек** путь проекта, чтобы указать путь к исходной библиотеки при компоновке.

### <a name="to-add-the-dll-import-library-to-your-project"></a>Чтобы добавить в проект DLL-библиотека импорта

1. Откройте **страницы свойств** диалоговое окно для **MathClient** проекта.

1. В **конфигурации** раскрывающегося списка выберите **все конфигурации** , если он еще не выбран.

1. В левой области выберите **ввода** под **свойства конфигурации**, **компоновщика**. В панели «Свойства» выберите элемент управления раскрывающегося списка рядом с **Дополнительные зависимости** поле ввода, а затем выберите **изменить**.

   ![Измените значение свойства Дополнительные зависимости](media/mathclient-additional-dependencies-property.png "изменить свойство Дополнительные зависимости")

1. В **Дополнительные зависимости** диалогового окна, добавление `MathLibrary.lib` в список в верхней части управления edit.

   ![Добавить зависимости библиотеки](media/mathclient-additional-dependencies.png "добавить зависимости библиотеки")

1. Выберите **ОК** для возврата к **страницы свойств** диалоговое окно.

1. В левой области выберите **Общие** под **свойства конфигурации**, **компоновщика**. В панели «Свойства» выберите элемент управления раскрывающегося списка рядом с **Дополнительные каталоги библиотек** поле ввода, а затем выберите **изменить**.

   ![Измените значение свойства Дополнительные каталоги библиотек](media/mathclient-additional-library-directories-property.png "измените свойство Дополнительные каталоги библиотек")

1. Дважды щелкните в верхней части **Дополнительные каталоги библиотек** диалоговое окно «», чтобы включить элемент управления редактированием. В элементе управления, укажите путь к расположению **MathLibrary.lib** файла. Введите это значение, чтобы использовать макрос, который подходит для отладочной и окончательной сборки:

   `..\..\MathLibrary\$(IntDir)`

   ![Добавьте каталог библиотеки](media/mathclient-additional-library-directories.png "добавьте каталог библиотеки")

1. После ввода пути к файлу библиотеки в **Дополнительные каталоги библиотек** диалогового окна выберите **ОК** кнопку, чтобы вернуться к **страницы свойств** диалоговое окно.

Клиентское приложение теперь выполнить компиляцию и компоновку успешно, но по-прежнему не включает все необходимое для запуска. При загрузке приложения операционная система выполняет поиск MathLibrary DLL. Не удается найти библиотеку DLL в определенные системные каталоги, путь к среды или каталоге локальное приложение, в случае сбоя загрузки. Чтобы избежать этой проблемы можно скопировать DLL в каталог, содержащий исполняемый файл клиента как часть процесса построения. Скопируйте библиотеку DLL, можно добавить **события после построения** в проект, чтобы добавить команду, копирует библиотеку DLL в выходном каталоге сборки. Команда, указанная здесь копирует библиотеку DLL только в том случае, если отсутствует или был изменен и используются макросы для копирования в и из правильных местоположений отладки или в розницу для вашей конфигурации.

### <a name="to-copy-the-dll-in-a-post-build-event"></a>Чтобы скопировать DLL в событие после построения

1. Откройте **страницы свойств** диалоговое окно для **MathClient** проекта, если он еще не открыт.

1. Выберите в раскрывающемся окне конфигурации **все конфигурации** , если он еще не выбран.

1. В левой области выберите **события после построения** под **свойства конфигурации**, **события построения**.

1. На панели свойств выберите поле редактирования в **командной строки** поле, а затем введите следующую команду:

   `xcopy /y /d "..\..\MathLibrary\$(IntDir)MathLibrary.dll" "$(OutDir)"`

   ![Добавьте команду после построения](media/mathclient-post-build-command-line.png "добавьте команду после построения")

1. Выберите **ОК** кнопку, чтобы сохранить изменения в свойствах проекта.

Теперь клиентское приложение содержит все необходимое для построения и запуска. Построить приложение, выбрав **построения**, **построить решение** в строке меню. **Выходной** в Visual Studio должна содержать примерно следующим образом:

```Output
1>------ Build started: Project: MathClient, Configuration: Debug Win32 ------
1>stdafx.cpp
1>MathClient.cpp
1>MathClient.vcxproj -> C:\Users\username\Source\Repos\MathClient\Debug\MathClient.exe
1>MathClient.vcxproj -> C:\Users\username\Source\Repos\MathClient\Debug\MathClient.pdb (Partial PDB)
1>1 File(s) copied
========== Build: 1 succeeded, 0 failed, 0 up-to-date, 0 skipped ==========
```

Поздравляем, вы создали приложение, которое вызывает функции в DLL-Библиотеку. Теперь запустите приложение, чтобы увидеть, что он делает. В строке меню выберите **отладки**, **Запуск без отладки**. Visual Studio откроется окно командной строки для программы для запуска в. Последняя часть выходных данных должна выглядеть следующим образом:

![Запуск клиентского приложения без отладки](media/mathclient-run-without-debugging.png "запустить клиентское приложение без отладки.")

Нажмите любую клавишу, чтобы закрыть командную строку.

Теперь, после создания библиотеки DLL и клиентское приложение, вы можете поэкспериментировать. Попробуйте установить точки останова в коде клиентского приложения и запустить приложение в отладчике. Посмотрим, что произойдет при выполнении шага с заходом в вызовы библиотеки. Добавление других функций в библиотеку или записи другого клиентского приложения, использующего библиотеку DLL.

При развертывании приложения необходимо также развернуть библиотек DLL, она использует. Для предоставления DLL при сборке или в числе сторонние приложения проще всего поместить их в том же каталоге, в котором находится приложение, также известный как *развертывания локальными для приложения*. Дополнительные сведения о развертывании см. в разделе [развертывания в Visual C++](..\ide\deployment-in-visual-cpp.md).

## <a name="see-also"></a>См. также

[DLL в Visual C++](../build/dlls-in-visual-cpp.md)  
[Развертывание приложений для настольных систем](../ide/deploying-native-desktop-applications-visual-cpp.md)  
[Пошаговое руководство. Развертывание программы (C++)](../ide/walkthrough-deploying-your-program-cpp.md)  
[Вызов функций библиотек DLL из приложений Visual Basic](../build/calling-dll-functions-from-visual-basic-applications.md)
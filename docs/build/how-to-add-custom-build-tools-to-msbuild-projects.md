---
title: "Практическое руководство. Добавление пользовательских средств построения в проекты MSBuild | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "msbuild.cpp.howto.addcustombuildtools"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "msbuild (c++), практическое руководство: добавление пользовательских средств построения"
ms.assetid: de03899a-371d-4396-9bf9-34f45a65e909
caps.latest.revision: 8
author: "corob-msft"
ms.author: "corob"
manager: "ghogen"
caps.handback.revision: 8
---
# Практическое руководство. Добавление пользовательских средств построения в проекты MSBuild
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Пользовательский инструмент построения — это определенная пользователем программа командной строки, связанная с конкретным файлом.  
  
 Для конкретного файла в файле проекта \(с расширением VCXPROJ\) указывается командная строка для выполнения, какие\-либо дополнительные входные и выходные файлы, а также сообщение для отображения.  Если **MSBuild** определяет, что выходные файлы неактуальны по отношению к входным файлам, то отображает сообщение и выполняет программу командной строки.  
  
 Для указания, когда следует выполнять пользовательский инструмент построения, в файле проекта используется один или оба XML\-элемента `CustomBuildBeforeTargets` и `CustomBuildAfterTargets`.  Например, можно указать, что пользовательский инструмент построения выполняется после компилятора MIDL и перед компилятором C\/C\+\+.  Чтобы выполнить пользовательский инструмент построения перед выполнением конкретного целевого объекта, следует указать элемент `CustomBuildBeforeTargets`; чтобы выполнить этот инструмент после конкретного целевого объекта, следует указать элемент `CustomBuildAfterTargets`; чтобы выполнить этот инструмент между выполнениями двух целевых объектов, следует указать оба элемента.  Если не указан ни один из элементов, то пользовательский инструмент построения выполняется в расположении по умолчанию, т. е. перед целевым объектом **MIDL**.  
  
 Пользовательские этапы построения и пользовательские инструменты построения совместно используют сведения, заданные в XML\-элементах `CustomBuildBeforeTargets` и `CustomBuildAfterTargets`.  Следует указывать эти целевые объекты в файле проекта только однократно.  
  
### Добавление пользовательского инструмента построения  
  
1.  Добавьте в файл проекта группу элементов, а затем добавьте по элементу для каждого входного файла.  Укажите команду, дополнительные входные и выходные данные, а также сообщение в качестве метаданных элемента, как показано далее.  В этом примере предполагается, что файл с именем "faq.txt" существует в одном каталоге с проектом.  
  
    ```  
    <ItemGroup>  
      <CustomBuild Include="faq.txt">  
        <Message>Copying readme...</Message>  
        <Command>copy %(Identity) $(OutDir)%(Identity)</Command>  
        <Outputs>$(OutDir)%(Identity)</Outputs>  
      </CustomBuild>  
    </ItemGroup>  
    ```  
  
### Определение места в построении, в котором будут выполняться пользовательские инструменты построения  
  
1.  Добавьте в файл проекта следующую группу свойств.  Следует указать хотя бы один целевой объект, и если планируется выполнение этапа построения только до \(или после\) конкретного целевого объекта, то остальные целевые объекты можно не указывать.  В данном примере пользовательский этап выполняется после компиляции и перед компоновкой.  
  
    ```  
    <PropertyGroup>  
      <CustomBuildAfterTargets>ClCompile</CustomBuildAfterTargets>  
      <CustomBuildBeforeTargets>Link</CustomBuildBeforeTargets>  
    </PropertyGroup>  
    ```  
  
## См. также  
 [Пошаговое руководство. Использование MSBuild для создания проекта Visual C\+\+](../build/walkthrough-using-msbuild-to-create-a-visual-cpp-project.md)   
 [Практическое руководство. Использование событий построения в проектах MSBuild](../build/how-to-use-build-events-in-msbuild-projects.md)   
 [Практическое руководство. Добавление пользовательского шага построения в проекты MSBuild](../Topic/How%20to:%20Add%20a%20Custom%20Build%20Step%20to%20MSBuild%20Projects.md)
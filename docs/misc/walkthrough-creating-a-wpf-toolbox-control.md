---
title: "Пошаговое руководство. Создание элемента управления панели элементов WPF | Microsoft Docs"
ms.custom: ""
ms.date: "12/14/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-csharp"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "панель элементов"
  - "wpf"
ms.assetid: 8223c06e-f327-4778-8709-e0cc7eae2c78
caps.latest.revision: 15
caps.handback.revision: 15
manager: "douge"
---
# Пошаговое руководство. Создание элемента управления панели элементов WPF
Шаблон элемента управления панели элементов WPF, включенный в пакет SDK для Visual Studio, позволяет создавать элементы управления Windows Presentation Foundation \(WPF\), которые автоматически добавляются на **панель элементов** при установке расширения. В этом пошаговом руководстве показано, как использовать шаблон для создания элемента управления счетчика, который можно передавать другим пользователям.  
  
## Обязательные компоненты  
 Для выполнения этого пошагового руководства необходимо установить пакет SDK для Visual Studio. Дополнительные сведения см. в разделе [SDK для Visual Studio](../Topic/Visual%20Studio%20SDK.md).  
  
## Поиск шаблона элемента управления панели элементов WPF в Visual Studio  
 Шаблон элемента управления панели элементов WPF доступен в диалоговом окне **Новый проект** в разделе **Установленные шаблоны** в следующих местах:  
  
-   **Visual Basic**, **Расширяемость**. Язык проекта — Visual Basic.  
  
-   **Visual C\#**, **Расширяемость**. Язык проекта — C\#.  
  
## Создание проекта элемента управления панели элементов WPF  
 Шаблон элемента управления панели элементов WPF создает неопределенный пользовательский элемент управления и предоставляет все функциональные возможности, необходимые для добавления элемента управления на **панель элементов**.  
  
#### Создание проекта  
  
1.  В меню **Файл** последовательно выберите пункты **Создать** и **Проект**.  
  
2.  В диалоговом окне **Новый проект** в разделе **Установленные шаблоны** щелкните узел предпочтительного языка программирования, а затем выберите пункт **Расширяемость**. В списке типов проектов выберите пункт **Элемент управления панели элементов WPF**.  
  
3.  В поле **Имя** введите имя, которое вы хотите использовать для проекта. \(В этом пошаговом руководстве используется имя `Counter`.\) Нажмите кнопку **ОК**.  
  
     Будет создано решение, которое содержит пользовательский элемент управления, атрибут для размещения элемента управления на **панели элементов** и манифест VSIX для развертывания. Поле **Имя** задает имя решения и имя пространства имен, но не задает имя элемента управления, отображаемое на **панели элементов**. Оно будет задано далее в этом пошаговом руководстве.  
  
### Создание пользовательского интерфейса для элемента управления  
 Элемент управления `Counter` требует трех дочерних элементов управления: двух элементов управления <xref:System.Windows.Controls.Label> для отображения текста и текущего счетчика и элемента управления <xref:System.Windows.Controls.Button> для сброса счетчика в значение 0. Другие дочерние элементы управления не требуются, так как размещение приложений приводит к увеличению значения счетчика программным способом.  
  
##### Создание пользовательского интерфейса  
  
1.  В **обозревателе решений** дважды щелкните файл ToolboxControl.cs, чтобы открыть его в конструкторе.  
  
     В конструкторе показан элемент управления <xref:System.Windows.Controls.Grid>, содержащий элемент управления <xref:System.Windows.Controls.Button>.  
  
2.  Выберите элемент управления <xref:System.Windows.Controls.Grid>, а затем щелкните синие полоски, отображаемые в верхней и левой частях сетки, чтобы разделить ее на две строки и два столбца.  
  
3.  Перетащите элемент управления <xref:System.Windows.Controls.Label> с **панели элементов** в каждую ячейку верхней строки сетки.  
  
     На этом этапе можно задать макет элемента управления, разместив элементы в сетке. Вместо этого можно также отредактировать разметку XAML напрямую, чтобы размер элемента управления динамически менялся в соответствии с текстом.  
  
4.  В области **XAML** установите высоту элементов `RowDefinition` и ширину элементов `ColumnDefinition` в значение `"auto"`.  
  
5.  Измените разметку для кнопки и двух меток, как показано в приведенном ниже примере.  
  
     [!code-xml[ToolboxControlWPF#11](../misc/codesnippet/Xaml/walkthrough-creating-a-wpf-toolbox-control_1.xaml)]  
  
     Атрибуты `Grid.Row` и `Grid.Column` задают положение элементов в сетке. Атрибут `Grid.ColumnSpan` кнопки позволяет изменять размер первого столбца независимо от ширины кнопки.  
  
     Атрибуты `Content` меток используют синтаксис `{Binding}` для привязки к свойствам, которые будут определены позже в этом пошаговом руководстве.  
  
### Написание кода пользовательского элемента управления  
 Элемент управления `Counter` будет предоставлять метод для увеличения значения счетчика, событие, которое будет наступать всякий раз, когда значение счетчика увеличивается, кнопку `Reset` и три свойства для хранения текущего значения счетчика, отображаемого текста и значения, определяющего, должна ли кнопка `Reset` отображаться или скрываться. Атрибут `ProvideTolboxControl` определяет место на **панели элементов**, в котором будет отображаться элемент управления `Counter`.  
  
 Вы можете написать код этого элемента управления так же, как для элемента управления Windows Forms, то есть с помощью обработчиков событий и открытых методов для задания содержимого меток. Однако в WPF можно задать контекст данных для элемента управления, чтобы привязать атрибуты элемента XAML напрямую к свойствам в коде. Эта модель также предоставляет уровень абстракции для разделения основных функциональных возможностей и пользовательского интерфейса элемента управления.  
  
 В этом пошаговом руководстве показано, как создать класс модели данных, а затем привязать контекст данных элемента управления к модели данных.  
  
##### Создание модели данных  
  
1.  Дважды щелкните кнопку, чтобы открыть окно кода.  
  
2.  Добавьте в начало файла директиву `using` для пространства имен <xref:System.ComponentModel>.  
  
3.  После созданного класса создайте открытый класс для определения контекста данных.  
  
     [!code-cs[ToolboxControlWPF#01](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_2.cs)]  
  
     Этот класс реализует интерфейс <xref:System.ComponentModel.INotifyPropertyChanged>, позволяющий привязывать элементы XAML к определенным свойствам.  
  
4.  Щелкните правой кнопкой мыши объявление интерфейса <xref:System.ComponentModel.INotifyPropertyChanged>, выберите пункт **Реализовать интерфейс**, а затем выберите пункт **Реализовать интерфейс** еще раз.  
  
     Visual Studio объявляет событие `PropertyChanged`.  
  
5.  После объявления события создайте приведенный ниже закрытый метод для вызова события.  
  
     [!code-cs[ToolboxControlWPF#02](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_3.cs)]  
  
6.  Создайте приведенные ниже закрытые поля и открытые свойства для хранения значений двух меток в элементе управления.  
  
     [!code-cs[ToolboxControlWPF#03](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_4.cs)]  
  
     Вызов события `PropertyChanged` приводит к обновлению привязкой XAML содержимого связанных элементов управления. Задание свойств как `public` делает их доступными конструктору, но не другим программам, если они не привязаны к этому контексту данных.  
  
 После создания модели данных можно реализовать функции программной части элемента управления.  
  
##### Реализация элемента управления  
  
1.  В определении разделяемого класса, который реализует элемент управления, щелкните правой кнопкой мыши имя класса, выберите пункт **Рефакторинг**, щелкните **Переименовать** и измените имя класса на `Counter`. Это имя, которое будет отображаться на **панели элементов** при установке расширения.  
  
2.  Непосредственно над определением класса в объявлении атрибута `ProvideToolboxControl` измените значение первого параметра с `"Counter"` на `"General"`. Таким образом задается имя группы элементов, в которой будет размещаться элемент управления на **панели элементов**.  
  
     В приведенном ниже примере показаны атрибут `ProvideToolboxControl` и скорректированное определение класса.  
  
     [!code-cs[ToolboxControlWPF#04](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_5.cs)]  
  
3.  Создайте закрытое поле для хранения контекста данных элемента управления, а затем в конструкторе присвойте контекст данных классу `MyDataModel`, как показано в приведенном ниже примере.  
  
     [!code-cs[ToolboxControlWPF#05](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_6.cs)]  
  
4.  Создайте приведенные ниже открытые свойства для отражения свойств `Text` и `Count` из контекста данных.  
  
     [!code-cs[ToolboxControlWPF#06](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_7.cs)]  
  
     Эти свойства делают содержимое контекста данных доступным любому приложению, содержащему элемент управления.  
  
5.  Создайте приведенный ниже открытый метод для увеличения значения счетчика и событие для уведомления ведущего приложения.  
  
     [!code-cs[ToolboxControlWPF#07](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_8.cs)]  
  
6.  Реализуйте обработчик щелчка для кнопки `Reset`, как показано ниже.  
  
     [!code-cs[ToolboxControlWPF#08](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_9.cs)]  
  
7.  Добавьте приведенное ниже открытое свойство для отображения или скрытия кнопки `Reset`.  
  
     [!code-cs[ToolboxControlWPF#09](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_10.cs)]  
  
## Тестирование элемента управления  
 Чтобы протестировать элемент управления **панели элементов**, сначала протестируйте его в среде разработки, а затем — в ведущем приложении.  
  
#### Тестирование элемента управления  
  
1.  Нажмите клавишу F5.  
  
     Будет создан проект, и откроется второй экземпляр Visual Studio с установленным элементом управления.  
  
2.  В новом экземпляре Visual Studio создайте проект приложения WPF.  
  
3.  В **обозревателе решений** дважды щелкните файл MainWindow.xaml, чтобы открыть его в конструкторе.  
  
4.  Из раздела **Общиепанели элементов** перетащите элемент управления **Счетчик** в форму, а затем выберите его.  
  
     Свойства `Text` и `ShowReset` должны отображаться в окне **Свойства** вместе с другими свойствами, унаследованными от <xref:System.Windows.Controls.UserControl>. Свойство `Count` не должно отображаться, так как оно доступно только для чтения.  
  
5.  Измените значение свойства `Text`.  
  
     Текст метки в конструкторе должен измениться.  
  
6.  Присвойте свойству `ShowReset` значение `Hidden`, а затем верните значение `Visible`.  
  
     Кнопка `Reset` в элементе управления должна исчезнуть, а затем снова появиться.  
  
7.  Перетащите элемент управления <xref:System.Windows.Controls.Button> в форму, присвойте его атрибуту `Content```значение `Test`, а затем дважды щелкните кнопку, чтобы открыть ее обработчик щелчка в представлении кода.  
  
8.  Реализуйте обработчик щелчка для вызова метода `Increment` элемента управления.  
  
     [!code-cs[ToolboxControlWPF#21](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_11.cs)]  
  
9. В функции конструктора после вызова `InitializeComponent` введите `counter1.Implemented +=`, а затем дважды нажмите клавишу TAB, чтобы создать обработчик события `Counter.Incremented`.  
  
10. Реализуйте новый обработчик, как показано в приведенном ниже примере.  
  
     [!code-cs[ToolboxControlWPF#22](../misc/codesnippet/CSharp/walkthrough-creating-a-wpf-toolbox-control_12.cs)]  
  
11. Нажмите клавишу F5.  
  
     Должно открыться приложение WPF.  
  
12. Нажмите кнопку **Test**.  
  
     Значение счетчика должно увеличиться, а кнопка должна немного поблекнуть.  
  
13. Нажмите кнопку **Test** еще четыре раза.  
  
     Значение счетчика должно увеличиться, а кнопка должна поблекнуть еще сильнее и, наконец, полностью исчезнуть. Если вы продолжите щелкать мышью в том месте, где была кнопка, значение счетчика будет увеличиваться дальше.  
  
14. Нажмите кнопку **Reset**.  
  
     Счетчик должен сброситься в значение **0**.  
  
## Следующие действия  
 При создании элемента управления **панели элементов** Visual Studio создает файл с именем *Имя\_проекта*.vsix в папке \\bin\\debug\\ проекта. Чтобы развернуть элемент управления, можно отправить VSIX\-файл в сеть или на веб\-сайт. Когда пользователь открывает VSIX\-файл, элемент управления устанавливается и добавляется на **панель элементов** Visual Studio. Кроме того, если вы отправили VSIX\-файл на веб\-сайт [коллекции Visual Studio](http://go.microsoft.com/fwlink/?LinkID=123847), пользователи смогут найти его в **диспетчере расширений**.  
  
## См. также  
 [Расширение панели элементов](../misc/extending-the-toolbox.md)   
 [Создание элементов управления Windows Forms](../Topic/Creating%20a%20Windows%20Forms%20Toolbox%20Control.md)   
 [Расширение других частей Visual Studio](../Topic/Extending%20Other%20Parts%20of%20Visual%20Studio.md)   
 [Работа с элементами управления в конструкторе WPF](http://msdn.microsoft.com/ru-ru/c6235492-b10d-4c3c-ba67-6b6a545faee1)   
 [Общие сведения о разработке элементов управления](../Topic/Control%20Authoring%20Overview.md)
---
title: "Пошаговое руководство: как опубликовать шаблон для проектов веб-элемента управления | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-csharp"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "шаблоны, веб-элементы управления"
  - "шаблоны веб-элементов управления"
ms.assetid: b56490f8-38bd-4220-a17e-5ebb30d3ac78
caps.latest.revision: 22
caps.handback.revision: 22
manager: "douge"
---
# Пошаговое руководство: как опубликовать шаблон для проектов веб-элемента управления
Вы можете создать шаблон, чтобы использовать его как основу для других проектов веб\-элемента управления. Такие шаблоны можно также распределять как расширение VSIX.  
  
 Для распределения расширения VSIX рекомендуется добавить его на веб\-сайт коллекции Visual Studio, так как разработчики могут использовать диспетчер расширений для поиска новых и обновленных расширений. Кроме того, вы можете распределять расширение, поместив его на другом сервере или записав на компакт\-диск или другой носитель.  
  
 В этом пошаговом руководстве показано, как создавать и распределять шаблоны для проектов веб\-элемента управления. Его дополняет другое подробное руководство,[Пошаговое руководство: Публикация расширения Visual Studio](../Topic/Walkthrough:%20Publishing%20a%20Visual%20Studio%20Extension.md), в котором объясняется, как создавать и распределять веб\-элементы управления.  
  
 Это пошаговое руководство содержит следующие разделы:  
  
-   "Создание шаблона для проектов веб\-элемента управления в расширении VSIX";  
  
-   "Публикация шаблона в коллекции Visual Studio";  
  
-   "Установка шаблона из коллекции Visual Studio";  
  
-   "Тестирование установленного шаблона";  
  
-   "Добавление в шаблон мастера действий при отладке".  
  
## Обязательные компоненты  
 В этом пошаговом руководстве предполагается, что вы знакомы с веб\-элементами управления, умеете создавать проекты и задавать их свойства, а также используете экспериментальный экземпляр Visual Studio. На компьютере необходимо установить Visual Studio и пакет SDK для Visual Studio. Прежде чем начать выполнение этого пошагового руководства, обязательно ознакомьтесь с разделом [Пошаговое руководство: Публикация расширения Visual Studio](../Topic/Walkthrough:%20Publishing%20a%20Visual%20Studio%20Extension.md).  
  
## "Создание шаблона для проектов веб\-элемента управления в расширении VSIX";  
 Чтобы создать шаблон проекта веб\-элемента управления, сначала создайте проект веб\-элемента управления. Приступая к этому пошаговому руководству, начните с проекта ColorTextControl \(веб\-элемента управления\), создание которого показано в статье [Пошаговое руководство: Публикация расширения Visual Studio](../Topic/Walkthrough:%20Publishing%20a%20Visual%20Studio%20Extension.md).  
  
 Прежде чем публиковать шаблон проектов в коллекции Visual Studio, экспортируйте его с помощью мастера **экспорта шаблонов как VSIX**, а также добавьте для него значок, чтобы его проще было найти в **диспетчере расширений**, и изображение, иллюстрирующее его возможности.  
  
#### Как подготовить проект веб\-элемента управления для распределения  
  
1.  Откройте проект MyWebControls в Visual Studio.  
  
2.  С помощью **диспетчера расширений** скачайте **мастер экспорта шаблонов** с веб\-сайта с [коллекцией Visual Studio](http://go.microsoft.com/fwlink/?LinkId=194329).  
  
     После установки мастера при открытии проекта в меню **Файл** появится пункт **Export Template as VSIX** \(Экспорт шаблона как VSIX\).  
  
3.  В меню **Файл** выберите команду **Export Template as VSIX** \(Экспорт шаблона как VSIX\).  
  
     ![File menu Export Project as VSIX](../misc/media/pcwc_exportasvsix.png "PCWC\_ExportAsVsix")  
  
4.  На странице **выбора типа шаблона** выберите **Шаблон проекта**, а затем выберите MyWebControls.csproj. Нажмите кнопку **Далее**.  
  
     ![Выбор шаблона проекта](../misc/media/pcwc_choosetemplate.png "PCWC\_ChooseTemplate")  
  
5.  На странице **выбора параметров шаблона** в поле **Имя шаблона** введите `Extensibility Color Text Web Toolbox Control`, а в поле **Описание шаблона** — `Color text web control project that produces a VSIX extension.`  
  
6.  Рядом с полем **Изображение значка** нажмите кнопку **Обзор**. В поле **Имя файла** введите `*.*`. Найдите файл Color.bmp и нажмите кнопку **Открыть**.  
  
7.  Рядом с полем **Просмотр изображения** нажмите кнопку **Обзор**. В поле **Имя файла** введите `*.*`. Найдите файл ScreenShot.bmp и нажмите кнопку **Открыть**. Нажмите кнопку **Далее**.  
  
     ![Выбор параметров шаблона](../misc/media/pcwc_selecttemplateoptions2.png "PCWC\_SelectTemplateOptions2")  
  
8.  На странице **выбора параметров VSIX** измените **имя продукта** на `Extensibility Color Text Web Control Template`.  
  
9. Если хотите, можно изменить **название компании**, **версию**, **лицензию** и **URL\-адрес руководства по началу работы**.  
  
10. Снимите флажок **Автоматически импортировать шаблон в Visual Studio**. Нажмите кнопку **Готово**.  
  
     ![Снятие флажка автоматического импорта шаблона](../misc/media/pcwc_.png "PCWC\_")  
  
     После этого вы сможете найти файл Color Text Web Control Template.vsix, открыв в проводнике папку ..\\My Documents\\Visual Studio *\<версия\>*\\My Exported Templates\\.  
  
## "Публикация шаблона в коллекции Visual Studio";  
 Теперь шаблон проекта готов к публикации в коллекции Visual Studio.  
  
#### Публикация шаблона в коллекции Visual Studio  
  
1.  В веб\-браузере откройте веб\-сайт [коллекции Visual Studio](http://go.microsoft.com/fwlink/?LinkId=194329).  
  
2.  В правом верхнем углу нажмите кнопку **Войти**.  
  
3.  Войдите с помощью своей учетной записи Майкрософт. Если у вас нет учетной записи Майкрософт, ее можно создать здесь.  
  
4.  Нажмите кнопку **Выгрузка**.  
  
5.  В разделе **Шаг 1:Тип расширения** установите флажок **Шаблон проекта или элемента** и нажмите кнопку **Далее**.  
  
6.  В разделе **Шаг 2:Выгрузка** нажмите кнопку **Обзор**. В папке "My Exported Templates" выберите файл Extensibility Color Text Web Control Template.vsix. Нажмите кнопку **Далее**.  
  
7.  В разделе **Шаг 3. Основные сведения** отображаются сведения из **мастера экспорта шаблона как VSIX**.  
  
8.  В поле **Категория** задайте `ASP.NET`, а в поле **Теги** — `toolbox, web control, templates`.  
  
9. Прочтите соглашение о вкладах, согласитесь с ним, а затем введите в соответствующем поле отображаемый текст.  
  
10. Щелкните **Создать вклад**, а затем нажмите кнопку **Публиковать**.  
  
11. В коллекции Visual Studio выполните поиск шаблона Extensibility Color Text Web Control Template. Должен появиться список для этого шаблона.  
  
     ![Список новых шаблонов веб&#45;элементов управления](../misc/media/pcwc_templatelisting.png "PCWC\_TemplateListing")  
  
## "Установка шаблона из коллекции Visual Studio";  
 Теперь, когда шаблон проекта веб\-элемента управления опубликован, установите и протестируйте его в Visual Studio.  
  
#### Как установить шаблон для проектов веб\-элемента управления в Visual Studio  
  
1.  В меню **Сервис** Visual Studio выберите пункт **Диспетчер расширений**.  
  
2.  Щелкните пункт **Интерактивная коллекция** и выполните поиск шаблона Extensibility Color Text Web Control Template. Должен появиться список для этого шаблона.  
  
3.  Нажмите **Загрузить**. После скачивания расширения нажмите кнопку **Установить**.  
  
## "Тестирование установленного шаблона";  
 Теперь можно использовать шаблон проекта Extensibility Color Text Web Control для создания пользовательских веб\-элементов управления. Не обязательно создавать каждый из них вручную. В этом разделе показано, как с помощью этого шаблона создать веб\-элемент управления BlueColorTextControl.  
  
#### Создание веб\-элемента управления на основе шаблона  
  
1.  В меню **Файл** выберите пункт **Создать**, а затем команду **Проект**.  
  
2.  В левой области щелкните **Шаблоны в Интернете**, разверните узел **Шаблоны**, а затем щелкните **ASP.NET**. В центральной области выберите шаблон **Extensibility Color Text Web Control Template**.  
  
     ![Select the extensibility color text web template](../misc/media/pcwc_newprojecttemplate.png "PCWC\_NewProjectTemplate")  
  
3.  В качестве **имени** задайте `MoreWebControls`. Нажмите кнопку **ОК**.  
  
4.  В **обозревателе решений** переименуйте ColorTextControl.cs на BlueColorTextControl.cs.  
  
5.  Дважды щелкните файл BlueColorTextControl.cs, чтобы открыть его в редакторе.  
  
6.  В атрибуте `ToolboxData` замените оба экземпляра `ColorTextControl` на `BlueColorTextControl`.  
  
     Эти значения задают открывающий и закрывающий теги, которые создаются для элемента управления при его перетаскивании из **панели элементов** на веб\-страницу во время разработки.  Они должны соответствовать имени класса элемента управления, являющемуся также именем элемента управления, которое будет отображаться в **панели элементов**.  
  
     Начало исходного кода класса элемента управления теперь должно выглядеть примерно следующим образом.  
  
    ```  
    namespace MoreWebControls { [DefaultProperty("Text")] [ToolboxData("<{0}:BlueColorTextControl runat=server> </{0}:BlueColorTextControl>")] [ProvideToolboxControl("MoreWebControls", false)] public class BlueColorTextControl : WebControl {  
  
    ```  
  
7.  В методе `get` измените `color:green` на `color:blue`.  
  
    ```  
    get { String s = (String)ViewState["Text"]; return "<span style='color:blue'>" + s + "</span>"; }  
    ```  
  
     Это перенесет текст в тег диапазона, который сделает его синим.  
  
8.  Создайте проект MoreWebControls.  
  
## Тестирование нового веб\-элемента управления  
 Теперь можно проверить, доступен ли новый веб\-элемент управления на **панели элементов**. Однако хотя проект MoreWebControls открыт, при нажатии клавиши F5 не будет запущен экспериментальный экземпляр Visual Studio для проверки элемента управления. Это происходит потому, что проект основан на шаблоне Extensibility Color Text Web Control Template, который еще не установил действие при отладке. \(В следующем разделе показано, как добавить в шаблон мастер, который задает действие при отладке.\) Сейчас для проверки элемента управления выполните следующие действия.  
  
#### Тестирование нового веб\-элемента управления  
  
1.  Чтобы открыть экспериментальный экземпляр Visual Studio, запустите его.  
  
    1.  В [!INCLUDE[win7](../build/includes/win7_md.md)] воспользуйтесь меню **Пуск** \(**Пуск\/Все программы\/Microsoft Visual Studio \<версия\> SDK\/Сервис\/Запустить экспериментальный экземпляр Microsoft Visual Studio \<версия\>**.  
  
    2.  В [!INCLUDE[win81](../misc/includes/win81_md.md)] на **начальном экране** наберите **Запустить экспериментальный экземпляр Microsoft Visual Studio \<версия\>**.  
  
2.  Создайте проект веб\-приложения.  
  
3.  В этом проекте откройте страницу default.aspx. Убедитесь, что отображается представление **источника**.  
  
4.  В категории **MoreWebControls** на **панели элементов** должен отображаться элемент **BlueColorTextControl**.  
  
     ![BlueColorTextControl в списке MoreWebControls](../misc/media/pcwc_toolbox2.png "PCWC\_Toolbox2")  
  
5.  Перетащите BlueColorTextControl куда\-нибудь в теге `body` веб\-страницы.  
  
6.  В теге `ColorTextControl` добавьте атрибут `Text` и установите его значение `Think Blue!`. Полученный тег должен быть похож на следующий.  
  
    ```  
    <cc1:BlueColorTextControl ID="BlueColorTextControl1" Text="Think Blue!" runat="server" />  
  
    ```  
  
7.  Нажмите клавишу F5, чтобы запустить ASP.NET Development Server.  
  
     Отображение BlueColorTextControl должно быть похоже на показанное на следующем рисунке.  
  
     ![Визуализация Think Blue посредством BlueColorTextControl](../misc/media/pcwc_thinkblue.png "PCWC\_ThinkBlue")  
  
8.  Закройте ASP.NET Development Server.  
  
9. Закройте экспериментальный экземпляр Visual Studio.  
  
## "Добавление в шаблон мастера действий при отладке".  
 Как отмечалось в предыдущем разделе, если нажать клавишу F5 при открытом проекте MoreWebControls, экспериментальный экземпляр Visual Studio не открывается. Вместо него отображается сообщение "Проект, создающий библиотеку классов, не может быть непосредственно запущен". Это происходит, когда проекту не известно расположение экспериментального экземпляра. Однако можно включить в шаблоне определение расположения экспериментального экземпляра на целевом компьютере и установить соответствующее действие при отладке. После этого все проекты на компьютере, созданные на основе этого шаблона, будут реагировать на нажатие клавиши F5 соответствующим образом.  
  
 Каждый шаблон проекта расширения, включенный в пакет SDK для Visual Studio, содержит мастер, который выполняется во время установки, находит экспериментальный экземпляр на целевом компьютере и задает действие при отладке. Вы можете создать свой собственный мастер, чтобы он делал это, и включать его в каждый распределяемый шаблон.  
  
 Чтобы добавить мастер действий при отладке в шаблон Extensibility Color Text Web Control Template, вы должны удалить первую версию шаблона, добавить в него мастер и повторно его создать.  
  
#### Удаление первой версии шаблона  
  
1.  На веб\-сайте коллекции Visual Studio в верхнем левом углу выберите **Мои вклады**. Появится список **Extensibility Color Text Web Control Template**.  
  
2.  Чтобы окончательно удалить этот шаблон проекта из коллекции Visual Studio, нажмите **Удалить**.  
  
3.  В меню **Сервис** Visual Studio выберите пункт **Диспетчер расширений**.  
  
4.  Выберите **Extensibility Color Text Web Control Template**, а затем нажмите кнопку **Удалить**.  
  
5.  Закройте **диспетчер расширений**.  
  
6.  Закройте решение MoreWebControls.  
  
7.  Закройте Visual Studio.  
  
8.  Удалите папку решения MoreWebControls.  
  
9. Чтобы завершить удаление, перезапустите Visual Studio.  
  
 Мастер действий при отладке должен иметь открытую реализацию `Microsoft.VisualStudio.TemplateWizard.IWizard` и должен быть подписан с помощью строгого имени сборки.  
  
#### Создание мастера действий при отладке  
  
1.  В диалоговом окне **Создание проекта** разверните узлы **Visual C\#**, **Windows**, выберите элемент **Библиотека классов** и назовите проект `MyWizard`.  
  
2.  В новом проекте переименуйте узел class1.cs в MyWizard.cs.  
  
3.  Замените содержимое MyWizard.cs следующим кодом.  
  
    ```  
    using System; using System.Collections.Generic; using System.Linq; using System.Text; using Microsoft.VisualStudio.TemplateWizard; using System.Globalization; using EnvDTE; namespace MyWizard { public class MyWizard : IWizard { public void BeforeOpeningFile(ProjectItem projectItem) { } public void ProjectFinishedGenerating(Project project) { foreach (Configuration config in project.ConfigurationManager) { //Set up the debug options to run "devenv /rootsuffix Exp"; config.Properties.Item("StartAction").Value = 1; //Get the full path to devenv.exe through DTE.FullName config.Properties.Item("StartProgram").Value = project.DTE.FullName; config.Properties.Item("StartArguments").Value = "/rootsuffix Exp"; } } public void ProjectItemFinishedGenerating(ProjectItem projectItem) { } public void RunFinished() { } public void RunStarted(object automationObject, Dictionary<string, string> replacementsDictionary, WizardRunKind runKind, object[] customParams) { } public bool ShouldAddProjectItem(string filePath) { return true; } } }  
  
    ```  
  
4.  Добавьте в проект следующие ссылки. Если есть несколько вариантов, выберите ссылку, которая указывает на [!INCLUDE[vs_dev10_long](../build/includes/vs_dev10_long_md.md)].  
  
    -   EnvDTE  
  
    -   Microsoft.VisualStudio.TemplateWizardInterface  
  
5.  Щелкните правой кнопкой мыши проект MyWizard и выберите пункт **Свойства**. На вкладке **Подписывание** выберите пункт **Подписать сборку**.  
  
6.  В списке **Выберите файл ключа строгого имени** выберите **\<Создать...\>**. Появится диалоговое окно **Создание ключа строгого имени**.  
  
7.  В качестве **имени файла ключа** задайте `key.snk` и снимите флажок **Защитить мой файл ключей паролем**.  
  
     ![Указание файла ключа](../misc/media/pcwc_strongname.png "PCWC\_StrongName")  
  
8.  Нажмите кнопку **ОК**, чтобы добавить key.snk в проект.  
  
9. Выполните сборку проекта MyWizard как сборку выпуска. Теперь мастер готов к использованию.  
  
10. Закройте решение MyWizard.  
  
#### Включение мастера и пересоздание шаблона  
  
1.  Выполните действия, описанные в предыдущем разделе "Создание шаблона проекта веб\-элемента управления в расширении VSIX", но внесите следующие изменения и дополнения.  
  
    -   Не нужно снова скачивать мастер **экспорта шаблона как VSIX**.  
  
    -   В мастере **экспорта шаблона как VSIX** на странице **выбора параметров VSIX** в поле **Мастер** перейдите к файлу \\bin\\Release\\MyWizard.dll, созданному на предыдущих шагах, и выберите его.  
  
         ![Указание сборки мастера](../misc/media/pcwc_wizardassembly.png "PCWC\_WizardAssembly")  
  
    -   При запросе перезаписи существующего выходного файла расширения VSIX нажмите кнопку **Да**.  
  
2.  Дойдя до раздела "Тестирование нового веб\-элемента управления", нажмите клавишу F5. Должен запуститься экспериментальный экземпляр Visual Studio.  
  
## Следующие действия  
 В этом пошаговом руководстве показано, как использовать мастер **экспорта шаблона как VSIX** для создания и распределения шаблона проекта. Если требуется большая степень управления шаблоном проекта, например чтобы выбирать значок, который отображается в диалоговом окне **создания проекта**, необходимо явно создать шаблон проекта и поместить его в расширение VSIX. Дополнительные сведения см. в статье [Creating and Sharing Project & Item Templates](http://go.microsoft.com/fwlink/?LinkId=194551) \(Создание и совместное использование шаблонов для проектов и элементов\) на веб\-сайте блога, посвященного Visual Studio.  
  
## См. также  
 [Расширения Visual Studio доставки](../Topic/Shipping%20Visual%20Studio%20Extensions.md)
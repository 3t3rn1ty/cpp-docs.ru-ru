---
title: "Контексты | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-windows
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: C++
helpviewer_keywords: contexts [Concurrency Runtime]
ms.assetid: 10c1d861-8fbb-4ba0-b2ec-61876b11176e
caps.latest.revision: "11"
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: 01ec145de3c41aeb30bdd308794d9f8d90a3f3e1
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="contexts"></a>Контексты

В этом документе описывается роль контекстов в среде выполнения с параллелизмом. Поток, который присоединен к планировщику известен как *контекст выполнения*, или просто *контекста*. [Concurrency::wait](reference/concurrency-namespace-functions.md#wait) функции и параллелизма::[класс контекста](../../parallel/concrt/reference/context-class.md) позволяют управлять поведением контекстов. Используйте `wait` функция приостанавливает текущий контекст в указанное время. Используйте `Context` класс при необходим больший контроль над при контексты блокировать, разблокировать и yield, или когда требуется превышать лимит подписки текущего контекста.  
  
> [!TIP]
>  Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, и таким образом не требуется создавать планировщик в приложении. Поскольку планировщик задач помогает оптимизировать производительность приложений, рекомендуется начать с [библиотеки параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) или [библиотеки асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md) при наличии новые и среда выполнения с параллелизмом.  
  
## <a name="the-wait-function"></a>Функция ожидания  

 [Concurrency::wait](reference/concurrency-namespace-functions.md#wait) функция совместно передает выполнение текущего контекста для указанного числа миллисекунд. Среда выполнения использует время передачи для выполнения других задач. После истечения указанного времени, среда выполнения переносит выполнение контекст для выполнения. Таким образом `wait` функция может приостановить больше времени, чем указанное значение для текущего контекста `milliseconds` параметра.  
  
 Передача значения 0 (ноль) `milliseconds` параметр заставляет среду выполнения приостанавливает текущий контекст, пока все другие активные контексты получат возможность выполнять работу. Это позволяет передать задачу всем активным задачам.  
  
### <a name="example"></a>Пример  
 Пример, использующий `wait` для передачи текущего контекста и таким образом разрешить другим контекстам выполнения см. в разделе [как: используйте группы расписаний для влияние порядка выполнения](../../parallel/concrt/how-to-use-schedule-groups-to-influence-order-of-execution.md).  
  
## <a name="the-context-class"></a>Класс контекста  
 Уровень параллелизма::[класс контекста](../../parallel/concrt/reference/context-class.md) предоставляет программную абстракцию для контекста выполнения, а также две важные функции: возможность совместно блокировать, разблокировать и выполнять текущий контекст и возможность превышать лимит подписки текущего контекста.  
  
### <a name="cooperative-blocking"></a>Совместное блокирование  
 `Context` Класс позволяет блокировать или разрешать текущий контекст выполнения. Блокирование или разрешение полезно, когда текущий контекст не может продолжаться, поскольку ресурс не поддерживается.  
  

 [Concurrency::Context:: Block](reference/context-class.md#block) метод блокирует текущий контекст. Контекст, который блокируется дает свои ресурсы для обработки, чтобы среда выполнения может выполнять другие задачи. [Concurrency::Context:: Unblock](reference/context-class.md#unblock) метод разблокирует Заблокированный контекст. `Context::Unblock` Метод должен вызываться в контексте, отличном от того, который называется `Context::Block`. Среда выполнения создает [concurrency::context_self_unblock](../../parallel/concrt/reference/context-self-unblock-class.md) Если контекст пытается разблокировать себя.  
  
 Для совместного блокирования и разблокирования контекста, обычно вызывается [Concurrency::Context:: CurrentContext](reference/context-class.md#currentcontext) Чтобы получить указатель на `Context` объект, связанный с текущим потоком и сохранить результат. Затем вызовите `Context::Block` метод для блокирования текущего контекста. Необходимо вызвать `Context::Unblock` из отдельного контекста разблокировать заблокированный контекст.  
  
 Необходимо сопоставить каждой пары вызовов `Context::Block` и `Context::Unblock`. Среда выполнения создает [concurrency::context_unblock_unbalanced](../../parallel/concrt/reference/context-unblock-unbalanced-class.md) при `Context::Block` или `Context::Unblock` метод последовательно вызывается без соответствующего вызова другой метод. Тем не менее, не нужно вызывать `Context::Block` перед вызовом метода `Context::Unblock`. Например, если один контекст вызывает `Context::Unblock` прежде, чем другой контекст вызовет `Context::Block` для того же контекста, контекст остается незаблокированным.  
  
 [Concurrency::Context:: yield](reference/context-class.md#yield) метод передает выполнение, чтобы среда выполнения могла выполнять другие задачи и затем перепланировать контекст для выполнения. При вызове `Context::Block` метода, среда выполнения не перепланировать контекст.  

  
#### <a name="example"></a>Пример  
 Пример, использующий `Context::Block`, `Context::Unblock`, и `Context::Yield` методов для реализации класса семафора, см. [как: использование класса Context для реализации семафора совместной](../../parallel/concrt/how-to-use-the-context-class-to-implement-a-cooperative-semaphore.md).  
  
##### <a name="oversubscription"></a>Превышение лимита подписки  
 Планировщик по умолчанию создает одинаковое число потоков, сколько имеется доступных аппаратных потоков. Можно использовать *превышение лимита подписки* для создания дополнительных потоков для заданного аппаратного потока.  
  
 Для операций с большим объемом вычислений превышение лимита подписки обычно не является масштабируемым, так как она порождает дополнительную нагрузку. Тем не менее для выполнения задач с высоким объемом задержки, например, чтение данных с диска или из сетевого подключения, превышение лимита подписки может повысить общую эффективность некоторых приложений.  
  
> [!NOTE]
>  Разрешать превышение лимита подписки следует только в потоке, созданном средой выполнения с параллелизмом. Превышение лимита подписки не имеет значения при вызове из потока, который не был создан средой выполнения (включая главный поток).  
  
 Чтобы разрешить превышение лимита подписки в текущем контексте, вызовите [Concurrency::Context:: Oversubscribe](reference/context-class.md#oversubscribe) метод с `_BeginOversubscription` равным `true`. При включении превышение лимита подписки в потоке, который был создан средой выполнения с параллелизмом, то среда выполнения создает один дополнительный поток. После завершения всех задач, требующих превышения лимита подписки, вызовите `Context::Oversubscribe` с `_BeginOversubscription` равным `false`.  

  
 Можно разрешить превышение лимита подписки, несколько раз из текущего контекста, но его необходимо отключить одинаковое количество раз, которые позволяют его. Превышение лимита подписки также могут быть вложенными; то есть задачу, которая создается с другой задачей, которая использует превышение лимита подписки можно также использовать превышение лимита подписки его контекста. Однако если и вложенная задача и родительская принадлежат к одному контексту только внешнего вызова `Context::Oversubscribe` вызывает создание дополнительных потоков.  
  
> [!NOTE]
>  Среда выполнения создает [concurrency::invalid_oversubscribe_operation](../../parallel/concrt/reference/invalid-oversubscribe-operation-class.md) при отключении превышение лимита подписки для ее включения.  
  
###### <a name="example"></a>Пример  
 Пример, использующий превышение лимита подписки для смещения задержки, вызванные чтение данных из сетевого подключения см. в разделе [как: превышение лимита подписки используется для смещения задержки](../../parallel/concrt/how-to-use-oversubscription-to-offset-latency.md).  
  
## <a name="see-also"></a>См. также  
 [Планировщик задач](../../parallel/concrt/task-scheduler-concurrency-runtime.md)   
 [Как: использование групп планирования для определения порядка выполнения](../../parallel/concrt/how-to-use-schedule-groups-to-influence-order-of-execution.md)   
 [Как: использование класса Context для реализации семафора](../../parallel/concrt/how-to-use-the-context-class-to-implement-a-cooperative-semaphore.md)   
 [Практическое руководство. Использование лимита подписки для устранения задержек](../../parallel/concrt/how-to-use-oversubscription-to-offset-latency.md)


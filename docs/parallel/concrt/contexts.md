---
title: "Контексты | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "контексты [среда выполнения с параллелизмом]"
ms.assetid: 10c1d861-8fbb-4ba0-b2ec-61876b11176e
caps.latest.revision: 11
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 11
---
# Контексты
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

В этом документе описана роль контекстов в среде выполнения с параллелизмом. Поток, прикрепленный к планировщику, известен как *контекст выполнения*, или просто *контекста*.  [Concurrency::wait](../Topic/wait%20Function.md) функции и параллелизма::[класс контекста](Context%20Class.md) позволяют управлять поведением контекстов. Используйте `wait` функция приостановки текущего контекста в указанное время. Используйте `Context` класса, когда необходим больший контроль над при контексты блокировать, разблокировать и yield, или когда требуется превышать лимит подписки текущего контекста.  
  
> [!TIP]
>  Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, и таким образом не требуется создавать планировщик в приложении. Поскольку планировщик заданий помогает оптимизировать производительность приложений, мы рекомендуем начать с [библиотеки параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) или [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) Если вы новичок в среде выполнения с параллелизмом.  
  
## <a name="the-wait-function"></a>Функция ожидания  
  [Concurrency::wait](../Topic/wait%20Function.md) функция совместно передает выполнение текущего контекста для указанного числа миллисекунд. Среда выполнения использует время передачи для выполнения других задач. По истечении заданного времени среда выполнения перепланирует контекст для выполнения. Таким образом `wait` функция может приостановить дольше, чем значение, указанное для текущего контекста `milliseconds` параметр.  
  
 Передача значения 0 (ноль) `milliseconds` параметр заставляет среду выполнения приостанавливает текущий контекст, пока все другие активные контексты получат возможность выполнять работу. Это позволяет передать задачу для всех активных задач.  
  
### <a name="example"></a>Пример  
 Пример, использующий `wait` для передачи текущего контекста и таким образом позволить другим контекстам выполнения см. в разделе [Практическое руководство: использование групп расписаний в порядке выполнения влияют](../../parallel/concrt/how-to-use-schedule-groups-to-influence-order-of-execution.md).  
  
## <a name="the-context-class"></a>Класс контекста  
 Параллелизм::[класс контекста](Context%20Class.md) предоставляет программную абстракцию для контекста выполнения, а также две важные функции: возможность совместно блокировать, разблокировать и передавать текущий контекст и возможность превышать лимит подписки текущего контекста.  
  
### <a name="cooperative-blocking"></a>Совместное блокирование  
  `Context` Класс позволяет блокировать или разрешать текущий контекст выполнения. Блокирование или разрешение полезно, когда текущий контекст не может продолжаться, так как ресурс недоступен.  
  
  [Concurrency::Context:: Block](../Topic/Context::Block%20Method.md) метод блокирует текущий контекст. Контекст, который блокируется дает свои ресурсы для обработки, чтобы среда выполнения может выполнять другие задачи.  [Concurrency::Context:: Unblock](../Topic/Context::Unblock%20Method.md) метод разблокирует Заблокированный контекст.  `Context::Unblock` Метод должен вызываться в контексте, отличном от того, который называется `Context::Block`. Среда выполнения создает [concurrency::context_self_unblock](../../parallel/concrt/reference/context-self-unblock-class.md) если контекст пытается разблокировать себя.  
  
 Для совместного блокирования и разблокирования контекста, обычно вызывают [Concurrency::Context:: CurrentContext](../Topic/Context::CurrentContext%20Method.md) Чтобы получить указатель на `Context` объект, связанный с текущим потоком и сохранения результата. Затем вызовите `Context::Block` метод для блокирования текущего контекста. Необходимо вызвать `Context::Unblock` из отдельного контекста для разблокирования заблокированного контекста.  
  
 Необходимо сопоставить каждой пары вызовов `Context::Block` и `Context::Unblock`. Среда выполнения создает [concurrency::context_unblock_unbalanced](../../parallel/concrt/reference/context-unblock-unbalanced-class.md) при `Context::Block` или `Context::Unblock` метод вызывается последовательно без соответствующего вызова другого метода. Тем не менее, нет необходимости вызывать `Context::Block` перед вызовом метода `Context::Unblock`. Например, если один контекст вызывает `Context::Unblock` до другой контекст вызовет метод `Context::Block` для того же контекста, контекст остается незаблокированным.  
  
  [Concurrency::Context:: yield](../Topic/Context::Yield%20Method.md) метод передает выполнение, чтобы среда выполнения может выполнять другие задачи и затем перепланировать контекст для выполнения. При вызове `Context::Block` метода, среда выполнения не перепланировать контекст.  
  
#### <a name="example"></a>Пример  
 Пример, использующий `Context::Block`, `Context::Unblock`, и `Context::Yield` методов для реализации класса семафора, в разделе [Практическое руководство: использование класса Context для реализации семафора совместной](../../parallel/concrt/how-to-use-the-context-class-to-implement-a-cooperative-semaphore.md).  
  
##### <a name="oversubscription"></a>Превышение лимита подписки  
 Планировщик по умолчанию создает одинаковое число потоков, существуют доступных аппаратных потоков. Можно использовать *превышение лимита подписки* для создания дополнительных потоков для заданного аппаратного потока.  
  
 Для операций с большим объемом вычислений превышение лимита подписки обычно не масштабируется, так как она порождает дополнительную нагрузку. Тем не менее для выполнения задач, имеющих большое количество задержки, например, чтение данных с диска или из сетевого подключения, превышение лимита подписки может повысить общую эффективность некоторых приложений.  
  
> [!NOTE]
>  Разрешать превышение лимита подписки следует только в потоке, созданном средой выполнения с параллелизмом. Превышение лимита подписки не оказывает влияния при вызове из потока, который не был создан средой выполнения (включая главный поток).  
  
 Чтобы разрешить превышение лимита подписки в текущем контексте, нужно вызвать [Concurrency::Context:: Oversubscribe](../Topic/Context::Oversubscribe%20Method.md) метод `_BeginOversubscription` параметра `true`. При включении превышение лимита подписки в потоке, который был создан средой выполнения с параллелизмом, он заставляет среду выполнения создает один дополнительный поток. После завершения всех задач, требующих превышения лимита подписки, вызовите `Context::Oversubscribe` с `_BeginOversubscription` параметра `false`.  
  
 Можно разрешить превышение лимита подписки несколько раз из текущего контекста, но его необходимо отключить одинаковое количество раз, которые позволяют его. Превышение лимита подписки также могут быть вложенными; то есть задачу, которая создается с другой задачей, которая использует превышение лимита подписки можно также использовать превышение лимита подписки контекста. Однако если и вложенная задача и родительская принадлежат к одному контексту только внешний вызов `Context::Oversubscribe` вызывает создание дополнительных потоков.  
  
> [!NOTE]
>  Среда выполнения создает [concurrency::invalid_oversubscribe_operation](../../parallel/concrt/reference/invalid-oversubscribe-operation-class.md) при отключении превышение лимита подписки для ее включения.  
  
###### <a name="example"></a>Пример  
 Например, превышение лимита подписки используется для смещения задержки, вызванной чтение данных из сетевого подключения, в разделе [как: превышение лимита подписки используется для смещения задержки](../../parallel/concrt/how-to-use-oversubscription-to-offset-latency.md).  
  
## <a name="see-also"></a>См. также раздел  
 [Планировщик заданий](../../parallel/concrt/task-scheduler-concurrency-runtime.md)   
 [Практическое руководство: использование групп расписаний для определения порядка выполнения](../../parallel/concrt/how-to-use-schedule-groups-to-influence-order-of-execution.md)   
 [Практическое руководство: использование класса Context для реализации семафора](../../parallel/concrt/how-to-use-the-context-class-to-implement-a-cooperative-semaphore.md)   
 [Практическое руководство: использование превышения лимита подписки для устранения задержек](../../parallel/concrt/how-to-use-oversubscription-to-offset-latency.md)


---
title: "Общие сведения о среде выполнения с параллелизмом | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "Среда выполнения с параллелизмом, архитектура"
  - "Среда выполнения с параллелизмом, лямбда-выражения"
  - "Среда выполнения с параллелизмом, общие сведения"
  - "Среда выполнения с параллелизмом, требования"
ms.assetid: 56237d96-10b0-494a-9cb4-f5c5090436c5
caps.latest.revision: 22
caps.handback.revision: 19
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Общие сведения о среде выполнения с параллелизмом
[!INCLUDE[vs2017banner](../../assembler/inline/includes/vs2017banner.md)]

В этом документе содержатся общие сведения о среде выполнения с параллелизмом.  Здесь рассматриваются преимущества среды выполнения с параллелизмом, указывается, когда следует ее использовать, и описывается, как ее компоненты взаимодействуют друг с другом, с операционной системой и приложениями.  
  
> [!IMPORTANT]
>  В Visual Studio 2015 и более поздних версиях планировщик задач среды выполнения с параллелизмом более не является планировщиком класса задач и связанных типов в ppltasks.h.  Эти типы теперь используют Windows ThreadPool для повышения производительности и взаимодействия с примитивами синхронизации Windows.  Параллельные алгоритмы, например parallel\_for, продолжают использовать планировщик задач среды выполнения с параллелизмом.  
  
##  <a name="top"></a> Разделы  
 Этот документ содержит следующие разделы.  
  
-   [Почему важна среда выполнения с параллелизмом](#runtime)  
  
-   [Архитектура](#architecture)  
  
-   [Лямбда\-выражения в C\+\+](#lambda)  
  
-   [Требования](#requirements)  
  
##  <a name="runtime"></a> Почему важна среда выполнения с параллелизмом  
 Среда выполнения с параллелизмом обеспечивает единообразие и предсказуемость приложений и компонентов приложений, выполняемых одновременно.  Два примера преимуществ среды выполнения с параллелизмом — *совместное планирование задач* и *совместное блокирование*.  
  
 Среда выполнения с параллелизмом использует совместный планировщик задач, реализующий алгоритм переноса нагрузки для эффективного распределения вычислительных ресурсов.  Например, рассмотрим приложение, имеющее два потока, управляемых одной средой выполнения.  Если один поток завершает свою запланированную задачу, он может разгрузить другой поток.  Этот механизм позволяет балансировать общую рабочую нагрузку приложения.  
  
 Среда выполнения с параллелизмом также предоставляет примитивы синхронизации, использующие совместное блокирование для синхронизации доступа к ресурсам.  Например, рассмотрим задачу, которая должна получить монопольный доступ к общему ресурсу.  Выполняя совместное блокирование, среда выполнения может использовать оставшийся квант времени для выполнения другой задачи, пока первая задача ожидает ресурс.  Этот механизм обеспечивает максимально эффективное использование вычислительных ресурсов.  
  
 \[[В начало](#top)\]  
  
##  <a name="architecture"></a> Архитектура  
 Среда выполнения с параллелизмом состоит из четырех компонентов: библиотеки параллельных шаблонов \(PPL\), библиотеки асинхронных агентов, планировщика задач и диспетчера ресурсов.  Эти компоненты распределены между операционной системой и приложениями.  На следующем рисунке показано взаимодействие компонентов среды выполнения с параллелизмом в операционной системе и приложениях.  
  
 **Архитектура среды выполнения с параллелизмом**  
  
 ![Архитектура параллельной среды выполнения](../Image/ConcurrencyRun.png "ConcurrencyRun")  
  
> [!IMPORTANT]
>  Компоненты «Планировщик задач» и «Диспетчер ресурсов» недоступны в приложениях [!INCLUDE[win8_appname_long](../../build/includes/win8_appname_long_md.md)] или при использовании класса задач или других типов из файла ppltasks.h.  
  
 Среда выполнения с параллелизмом имеет высокую степень *компоновки*, то есть вы можете объединять существующие функциональные возможности, чтобы выполнять более широкий спектр действий.  Среда выполнения с параллелизмом объединяет множество возможностей, таких как параллельные алгоритмы, от компонентов более низкого уровня.  
  
 Среда выполнения с параллелизмом также предоставляет примитивы синхронизации, использующие совместное блокирование для синхронизации доступа к ресурсам.  Дополнительные сведения об этих примитивах синхронизации см. в разделе [Структуры данных синхронизации](../Topic/Synchronization%20Data%20Structures.md).  
  
 В следующих разделах представлен краткий обзор возможностей каждого компонента и рекомендации по его использованию.  
  
### Библиотека параллельных шаблонов  
 Библиотека параллельных шаблонов \(PPL\) предоставляет алгоритмы и контейнеры общего назначения для выполнения детального параллелизма.  PPL обеспечивает поддержку *императивного параллелизма данных*, предоставляя параллельные алгоритмы, которые распределяют вычисления в коллекциях или наборах данных по вычислительным ресурсам.  Она также позволяет *параллелизм задач*, предоставляя объекты задач, которые распределяют несколько независимых операций по вычислительным ресурсам.  
  
 Используйте библиотеку параллельных шаблонов при наличии локальных вычислений, которые могут использовать преимущества параллельного выполнения.  Например, можно использовать алгоритм [concurrency::parallel\_for](../Topic/parallel_for%20Function.md) для преобразования существующего цикла `for` для параллельной работы.  
  
 Дополнительные сведения о библиотеке параллельных шаблонов см. в разделе [Библиотека параллельных шаблонов](../../parallel/concrt/parallel-patterns-library-ppl.md).  
  
### Библиотека асинхронных агентов  
 Библиотека асинхронных агентов \(или просто *библиотека агентов*\) предоставляет модель программирования на основе субъектов и интерфейсы передачи сообщений для недетализированного потока данных и задач конвейеризации.  Асинхронные агенты позволяют эффективно использовать задержку, выполняя работу, пока другие компоненты ожидают данные.  
  
 Используйте библиотеку агентов, если существует несколько сущностей, асинхронно взаимодействующих друг с другом.  Например, можно создать агент, который читает данные из файла или сетевого подключения, а затем использует интерфейсы передачи сообщений для отправки этих данных другому агенту.  
  
 Дополнительные сведения о библиотеке агентов см. в разделе [Библиотека асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md).  
  
### Планировщик заданий  
 Планировщик задач планирует и координирует задачи во время выполнения.  Планировщик задач является совместным и использует алгоритм переноса нагрузки для максимально эффективного использования вычислительных ресурсов.  
  
 Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, поэтому нет необходимости управлять деталями инфраструктуры.  Однако для удовлетворения качественных требований приложения можно также предоставить собственную политику планирования или связать конкретные планировщики с конкретными задачами.  
  
 Дополнительные сведения о планировщике задач см. в разделе [Планировщик задач](../../parallel/concrt/task-scheduler-concurrency-runtime.md).  
  
### Диспетчер ресурсов  
 Роли диспетчера ресурсов заключается в управлении вычислительными ресурсами, такими как процессоры и память.  Диспетчер ресурсов реагирует на изменение рабочих нагрузок во время выполнения, назначая ресурсы тем нагрузкам, где они могут быть наиболее эффективными.  
  
 Диспетчер ресурсов выступает в качестве абстракции вычислительных ресурсов и в основном взаимодействует с планировщиком задач.  Хотя диспетчер ресурсов можно использовать для точной настройки производительности библиотек и приложений, обычно используются функциональные возможности, предоставляемые библиотекой параллельных шаблонов, библиотекой агентов и планировщиком задач.  Эти библиотеки используют диспетчер ресурсов для динамической балансировки ресурсов при изменении рабочей нагрузки.  
  
 \[[В начало](#top)\]  
  
##  <a name="lambda"></a> Лямбда\-выражения в C\+\+  
 Многие типы и алгоритмы, определяемые средой выполнения с параллелизмом, реализованы как шаблоны C\+\+.  Некоторые из этих типов и алгоритмов принимают в качестве параметра подпрограмму, которая выполняет работу.  Этот параметр может быть лямбда\-функцией, объектом функции или указателем функции.  Эти сущности также называются *рабочими функциями* или *рабочими подпрограммами*.  
  
 Лямбда\-выражения — важный новый компонент языка Visual C\+\+, так как они позволяют в сжатой форме определять рабочие функции для параллельной обработки.  Объекты функций и указатели функций позволяют использовать среду выполнения с параллелизмом с существующим кодом.  Тем не менее рекомендуется использовать лямбда\-выражения при написании нового кода из\-за преимуществ безопасности и производительности, которые они предоставляют.  
  
 В следующем примере сравнивается синтаксис лямбда\-функций, объектов функций и указателей функций в нескольких вызовах алгоритма [concurrency::parallel\_for\_each](../Topic/parallel_for_each%20Function.md).  Все вызовы `parallel_for_each` используют разные способы вычисления квадрата каждого элемента в объекте [std::array](../../standard-library/array-class-stl.md).  
  
 [!code-cpp[concrt-comparing-work-functions#1](../../parallel/concrt/codesnippet/CPP/overview-of-the-concurrency-runtime_1.cpp)]  
  
 **Вывод**  
  
  **1**  
**256**  
**6561**  
**65536**  
**390625** Дополнительные сведения о лямбда\-функциях в C\+\+ см. в разделе [Лямбда\-выражения](../../cpp/lambda-expressions-in-cpp.md).  
  
 \[[В начало](#top)\]  
  
##  <a name="requirements"></a> Требования  
 В следующей таблице показаны файлы заголовков, связанные с каждым компонентом среды выполнения с параллелизмом.  
  
|Компонент|Заголовочные файлы|  
|---------------|------------------------|  
|Библиотека параллельных шаблонов|ppl.h<br /><br /> concurrent\_queue.h<br /><br /> concurrent\_vector.h|  
|Библиотека асинхронных агентов|agents.h|  
|Планировщик заданий|concrt.h|  
|Диспетчер ресурсов|concrtrm.h|  
  
 Среда выполнения с параллелизмом объявляется в пространстве имен [Concurrency](../../parallel/concrt/reference/concurrency-namespace.md).  \(Можно также использовать [concurrency](../../parallel/concrt/reference/concurrency-namespace.md) — псевдоним для этого пространства имен\). Пространство имен `concurrency::details` поддерживает инфраструктуру среды выполнения с параллелизмом и не предназначено для использования непосредственно из кода.  
  
 Среда выполнения с параллелизмом предоставляется как часть библиотеки времени выполнения C \(CRT\).  Дополнительные сведения о сборке приложения, использующего CRT, см. в разделе [Особенности библиотеки CRT](../../c-runtime-library/crt-library-features.md).  
  
 \[[В начало](#top)\]
---
title: Многостраничные документы | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- pagination [MFC]
- overriding [MFC], View class functions for printing
- OnPrepareDC method [MFC]
- CPrintInfo structure [MFC], multipage documents
- OnEndPrinting method [MFC]
- protocols [MFC], printing protocol
- document pages vs. printer pages [MFC]
- printer mode [MFC]
- printing [MFC], multipage documents
- printers [MFC], printer mode
- documents [MFC], printing
- OnPreparePrinting method [MFC]
- OnPrint method [MFC]
- DoPreparePrinting method and pagination [MFC]
- OnDraw method [MFC], printing
- pagination [MFC], printing multipage documents
- printing [MFC], protocol
- pages [MFC], printing
- OnBeginPrinting method [MFC]
- multipage documents [MFC]
- printing [MFC], pagination
- documents [MFC], paginating
ms.assetid: 69626b86-73ac-4b74-b126-9955034835ef
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: 24ad3e99399e4d5db45606accfd58512f3950f26
ms.sourcegitcommit: 76b7653ae443a2b8eb1186b789f8503609d6453e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="multipage-documents"></a>Многостраничные документы
В этой статье описывается протокол печати Windows и описание печати документов, содержащих более одной страницы. Статья содержит следующие разделы:  
  
-   [Протокол печати](#_core_the_printing_protocol)  
  
-   [Переопределение функции класса представлений](#_core_overriding_view_class_functions)  
  
-   [Разбиение на страницы](#_core_pagination)  
  
-   [Страницы принтера и страницы документа](#_core_printer_pages_vs.._document_pages)  
  
-   [Разбиение на страницы во время печати](#_core_print.2d.time_pagination)  
  
##  <a name="_core_the_printing_protocol"></a> Протокол печати  
 Печать многостраничных документов, framework и представление взаимодействуют следующим образом. Во-первых, платформа отображает **печати** диалоговом создает контекст устройства для принтера и вызовы [StartDoc](../mfc/reference/cdc-class.md#startdoc) функцию-член [CDC](../mfc/reference/cdc-class.md) объекта. Затем вызывается платформой для каждой страницы документа [StartPage](../mfc/reference/cdc-class.md#startpage) функцию-член `CDC` объекта, указывает, что объект представления для печати на странице, а также вызовы [EndPage](../mfc/reference/cdc-class.md#endpage) функции-члена. Если необходимо изменить режим печати перед запуском определенную страницу, представление вызывает [ResetDC](../mfc/reference/cdc-class.md#resetdc), какие обновления [DEVMODE](http://msdn.microsoft.com/library/windows/desktop/dd183565) структуру, содержащую сведения о новом режиме принтера. При печати всего документа платформа вызывает [EndDoc](../mfc/reference/cdc-class.md#enddoc) функции-члена.  
  
##  <a name="_core_overriding_view_class_functions"></a> Переопределение функции класса представлений  
 [CView](../mfc/reference/cview-class.md) класс определяет несколько функций-членов, вызывается средой во время печати. Путем переопределения этих функций в классе представления, укажите соединения между framework печати логика и логика печати класс представления. В следующей таблице перечислены эти функции-члены.  
  
### <a name="cviews-overridable-functions-for-printing"></a>Переопределяемые функции CView для печати  
  
|name|Причина переопределения|  
|----------|---------------------------|  
|[OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting)|Чтобы вставить значения в диалоговом окне печати, особенно длине документа|  
|[OnBeginPrinting](../mfc/reference/cview-class.md#onbeginprinting)|Для выделения шрифтов или других ресурсов GDI|  
|[OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc)|Для настройки атрибутов контекста устройства для данной страницы или сделать разбиение на страницы во время печати|  
|[OnPrint](../mfc/reference/cview-class.md#onprint)|Для печати на данной странице|  
|[OnEndPrinting](../mfc/reference/cview-class.md#onendprinting)|Для освобождения ресурсов GDI|  
  
 Можно выполнять обработку, связанные с печатью, в другие функции, но эти функции являются те, которые диска процесс печати.  
  
 Следующий рисунок иллюстрирует шаги, необходимые для процесса печати и показано, где каждый из `CView`печати вызываются функции члена. В оставшейся части этой статьи объясняется большинство этих шагов более подробно. В статье описаны дополнительные части процесс печати [выделение ресурсов GDI](../mfc/allocating-gdi-resources.md).  
  
 ![Процесс цикла печати](../mfc/media/vc37c71.gif "vc37c71")  
Цикл печати  
  
##  <a name="_core_pagination"></a> Разбиение на страницы  
 Платформа хранит основную часть сведений о задании печати в [CPrintInfo](../mfc/reference/cprintinfo-structure.md) структуры. Несколько значений в `CPrintInfo` относятся к разбиению на страницы; эти значения доступны, как показано в следующей таблице.  
  
### <a name="page-number-information-stored-in-cprintinfo"></a>Номер страницы сведений, хранящихся в CPrintInfo  
  
|Переменная-член или<br /><br /> имя функции|Ссылка на номер страницы|  
|-----------------------------------------------|----------------------------|  
|`GetMinPage`/`SetMinPage`|Первая страница документа|  
|`GetMaxPage`/`SetMaxPage`|Последней страницы документа|  
|`GetFromPage`|Первой страницы для печати|  
|`GetToPage`|На печать последней страницы|  
|`m_nCurPage`|В настоящее время печать страницы|  
  
 Страница номера начинаются с 1, то есть первую страницу нумеруется 1, не равно 0. Дополнительные сведения об этих и других членов [CPrintInfo](../mfc/reference/cprintinfo-structure.md), в разделе *Справочник по библиотеке MFC*.  
  
 В начале процесса печати, платформа вызывает это представление [OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) передачу указателя для функции-члена `CPrintInfo` структуры. Мастер приложений предоставляет реализацию `OnPreparePrinting` , который вызывает [DoPreparePrinting](../mfc/reference/cview-class.md#doprepareprinting), другой функции-члена `CView`. `DoPreparePrinting` — функция, которая отображает диалоговое окно «Печать» и создает контекст устройства принтера.  
  
 На этом этапе приложение не знает, сколько страниц находятся в документе. Он использует значения по умолчанию 1 и 0xFFFF номера первой и последней страницы документа. Если вы знаете, сколько страниц у документа, переопределите `OnPreparePrinting` и вызвать [SetMaxPage]--brokenlink--(reference/cprintinfo-class.md#setmaxpage) для `CPrintInfo` структуры, прежде чем отправить `DoPreparePrinting`. Это позволяет указать длину документа.  
  
 `DoPreparePrinting` затем отображается диалоговое окно печати. При возвращении `CPrintInfo` структура содержит значения, указанные пользователем. Если пользователь хочет напечатать выбранный диапазон страниц, он или она можно указать начальный и конечный номера страницы в окне «Печать». Платформа извлекает этих значений с помощью `GetFromPage` и `GetToPage` функции [CPrintInfo](../mfc/reference/cprintinfo-structure.md). Если пользователь не указан диапазон страниц, платформа вызывает `GetMinPage` и `GetMaxPage` и использует значения, возвращенные Печать всего документа.  
  
 Для каждой страницы документа на печать, платформа вызывает две функции-члена в классе представления [OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc) и [OnPrint](../mfc/reference/cview-class.md#onprint)и каждой функции, которой передаются два аргумента: указатель на [ CDC](../mfc/reference/cdc-class.md) объекта и указатель на `CPrintInfo` структуры. Вызывается при каждом запуске `OnPrepareDC` и `OnPrint`, он передает другое значение в `m_nCurPage` членом `CPrintInfo` структуры. Таким образом платформа сообщает представление печатаемых страниц.  
  
 [OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc) функция-член также используется для отображения на экране. Прежде чем рисование выполняется таким образом корректировки на контекст устройства. `OnPrepareDC` выполняет ту же роль в печати, однако существует несколько различий: во-первых, `CDC` представляет объект контекста устройства принтера, а не экрана контекста устройства и второй, `CPrintInfo` объект передается в качестве второго параметра. (Этот параметр является **NULL** при `OnPrepareDC` вызывается для отображения на экране.) Переопределить `OnPrepareDC` для корректировки на контекст устройства, в зависимости от того, какую страницу печатается. Например можно переместить начало координат окна просмотра и области обрезки, чтобы убедиться, что возвращает печатать соответствующую часть документа.  
  
 [OnPrint](../mfc/reference/cview-class.md#onprint) функция-член выполняет фактическую печать страницы. Статья [как по умолчанию печати выполняется](../mfc/how-default-printing-is-done.md) показано, как платформа вызывает [OnDraw](../mfc/reference/cview-class.md#ondraw) с на контекст устройства принтера для выполнения печати. Точнее, платформа вызывает `OnPrint` с `CPrintInfo` структуры и контекста устройства и `OnPrint` передает контекст устройства для `OnDraw`. Переопределить `OnPrint` для выполнения любой отрисовки, которое должно выполняться только во время печати, а не для отображения на экране. Например, для печати верхние и нижние колонтитулы (см. в статье [верхние и нижние колонтитулы](../mfc/headers-and-footers.md) для получения дополнительной информации). Затем вызовите `OnDraw` из переопределение метода `OnPrint` делать подготовки отчетов, общие для отображения на экране и просмотра и печати.  
  
 Тот факт, `OnDraw` осуществляет отрисовку и отображение на экране и печати означает, что приложение WYSIWYG: «отображается вы получаете.» Однако предположим, что не создающие WYSIWYG приложения. Например рассмотрим текстовый редактор, который использует полужирного шрифта для печати, но отображает коды элементов управления, чтобы указать полужирный текст на экране. В таком случае используйте `OnDraw` исключительно для отображения на экране. При переопределении `OnPrint`, замените вызов `OnDraw` вызовом рисования отдельную функцию. Эта функция выводит документ внешний вид на бумаге, с помощью атрибутов, которые не отображаются на экране.  
  
##  <a name="_core_printer_pages_vs.._document_pages"></a> Vs страницы принтера. Страницы документа  
 Ссылаясь на номера страниц, иногда бывает необходимо различать принтера понятие страницы и понятие страницы документа. С точки зрения принтера страница находится в одном листе. Тем не менее одного листа бумаги не обязательно равен одной страницы документа. Например при печати информационный бюллетень, где листы будут храниться, одном листе может содержать первой и последней страницах документа, рядом. Аналогично при печати листа, документ не состоят из страниц во всех. Вместо этого одном листе может содержать от 1 до 20, столбцы 6-10 строк.  
  
 Порядковые номера страницы в [CPrintInfo](../mfc/reference/cprintinfo-structure.md) структуры см. страницы принтера. Платформа вызывает `OnPrepareDC` и `OnPrint` один раз для каждого листа бумаги, который будет проходить принтера. При переопределении [OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) функцию, чтобы указать длину документа, необходимо использовать страницы принтера. Если имеется однозначное соответствие (то есть одной страницы принтера совпадает с одной страницы документа), а затем просто. Если, с другой стороны, страницы документа и принтера не соответствуют напрямую, необходимо преобразовать между ними. Например рассмотрим Печать листа. При переопределении метода `OnPreparePrinting`, необходимо рассчитать, сколько листов, потребуется выполнить печать всей таблицы и затем это значение используется при вызове `SetMaxPage` функции-члена `CPrintInfo`. Аналогичным образом Переопределяя `OnPrepareDC`, необходимо преобразовать `m_nCurPage` в диапазон строк и столбцов, которые будут отображаться на этот лист и соответствующим образом настроить начало координат окна просмотра.  
  
##  <a name="_core_print.2d.time_pagination"></a> Разбиение на страницы во время печати  
 В некоторых ситуациях классе представления может не знать заранее продолжительность документ является пока фактически печати. Например предположим, что ваше приложение не WYSIWYG, поэтому длина документа на экране не соответствует его длина при печати.  
  
 Это вызывает проблему при переопределении [OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) для представления класса: невозможно передать значение `SetMaxPage` функция [CPrintInfo](../mfc/reference/cprintinfo-structure.md) структуры, так как вы не знаете, длина документ. Если пользователь не указывает номер страницы для остановки в диалоговом окне «Печать», платформа не знает, когда нужно прекратить печати цикла. Единственным способом для определения момента остановки цикла печати является печати документа и по ее завершении. в разделе. Представление класса должен проверять наличие конца документа во время его вывода на печать и сообщите платформы, при достижении конца.  
  
 Платформа использует класс представления [OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc) функции о том, когда нужно прекратить. После каждого вызова `OnPrepareDC`, платформа проверяет, является членом `CPrintInfo` структуры, которая называется `m_bContinuePrinting`. Значением по умолчанию является **значение TRUE.** При условии, что он останется таким образом, платформа продолжения цикла печати. Если задано значение **FALSE**, framework останавливается. Чтобы выполнить разбиение на страницы во время печати, переопределите `OnPrepareDC` для проверки ли конец документа содержит был достигнут и значение `m_bContinuePrinting` для **FALSE** котором.  
  
 Реализация по умолчанию `OnPrepareDC` задает `m_bContinuePrinting` для **FALSE** Если текущая страница больше 1. Это означает, что если длина документа не был указан, платформа предполагает, что документ состоит из одной страницы долго. Следствием этого является то, будьте внимательны при вызове версию базового класса `OnPrepareDC`. Не следует полагать, что `m_bContinuePrinting` будет **TRUE** после вызова версии базового класса.  
  
### <a name="what-do-you-want-to-know-more-about"></a>Выберите Дополнительные сведения  
  
-   [Верхние и нижние колонтитулы](../mfc/headers-and-footers.md)  
  
-   [Выделение ресурсов GDI](../mfc/allocating-gdi-resources.md)  
  
## <a name="see-also"></a>См. также  
 [Печать](../mfc/printing.md)   
 [CView-класс](../mfc/reference/cview-class.md)   
 [Класс CDC](../mfc/reference/cdc-class.md)
---
title: "Многостраничные документы | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "CPrintInfo - структура, многостраничные документы"
  - "страницы документа или страницы принтера"
  - "документы, разбивка на страницы"
  - "документы, печать"
  - "DoPreparePrinting - метод и разбивка на страницы"
  - "многостраничные документы"
  - "OnBeginPrinting - метод"
  - "OnDraw - метод, печать"
  - "OnEndPrinting - метод"
  - "OnPrepareDC - метод"
  - "OnPreparePrinting - метод"
  - "OnPrint - метод"
  - "переопределение, Функции класса представлений для печати"
  - "страницы, печать"
  - "разбивка на страницы"
  - "разбивка на страницы, печать многостраничных документов"
  - "режим печати"
  - "принтеры, режим печати"
  - "печать [MFC], многостраничные документы"
  - "печать [MFC], разбивка на страницы"
  - "печать [MFC], протокол"
  - "протоколы, протокол печати"
ms.assetid: 69626b86-73ac-4b74-b126-9955034835ef
caps.latest.revision: 9
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 5
---
# Многостраничные документы
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этом разделе описываются Windows ввод протокола и объясняет, как печатать документы, содержащие более одной страницы.  Раздел охватывает следующее:  
  
-   [Протокол печати](#_core_the_printing_protocol)  
  
-   [Переопределение функции класса представления.](#_core_overriding_view_class_functions)  
  
-   [Разбиение на страницы](#_core_pagination)  
  
-   [Страниц принтера и страниц документа](#_core_printer_pages_vs.._document_pages)  
  
-   [Разбиение на страницы PRINT\-Time](#_core_print.2d.time_pagination)  
  
##  <a name="_core_the_printing_protocol"></a> Протокол печати  
 Для печати документа multipage платформа и представление взаимодействуют следующим образом.  Сначала платформа отображает диалоговое окно **Печать**, создает контекст устройства для принтера и вызывает функцию\-член [StartDoc](../Topic/CDC::StartDoc.md) объекта [CDC](../Topic/CDC%20Class.md).  Затем для каждой страницы документа, платформа вызывает функцию\-член [StartPage](../Topic/CDC::StartPage.md) объекта `CDC`, указывает объект представления для печати страницы и вызывает функцию\-член [EndPage](../Topic/CDC::EndPage.md).  Если нужно изменить режим принтера перед началом указанную страницу, представление вызывает функцию [ResetDC](../Topic/CDC::ResetDC.md), которая обновляет структура [DEVMODE](http://msdn.microsoft.com/library/windows/desktop/dd183565), содержащий новые сведения о режиме принтера.  Когда весь документ был напечатан, платформа вызывает функцию\-член [EndDoc](../Topic/CDC::EndDoc.md).  
  
##  <a name="_core_overriding_view_class_functions"></a> Переопределение функции класса представления.  
 Класс [CView](../Topic/CView%20Class.md) определяет несколько функций\-членов, вызываются средой во время печати.  Можно переопределить эти функции по в представлении класса необходимо сначала проводилась логику печати логических связей между платформы ввод и класса представления.  В следующей таблице перечислены этих функций\-членов.  
  
### Функции переопределяемого метода CView для печати  
  
|Name|Причина переопределения|  
|----------|-----------------------------|  
|[OnPreparePrinting](../Topic/CView::OnPreparePrinting.md)|Вставка значений в диалоговое окно печати, особенно длина документа|  
|[OnBeginPrinting](../Topic/CView::OnBeginPrinting.md)|Выбор шрифты или других ресурсов GDI|  
|[OnPrepareDC](../Topic/CView::OnPrepareDC.md)|Настроить атрибуты контекста устройства для данной страницы или разбиение на страницы PRINT\- время задачи|  
|[OnPrint](../Topic/CView::OnPrint.md)|Печать заданного страницу|  
|[OnEndPrinting](../Topic/CView::OnEndPrinting.md)|Отменить ресурсов GDI|  
  
 Это можно сделать печать\- связанный обработки в других функциях, но эти функции один, управляющих процессом печати.  
  
 На следующем рисунке показаны действия, которые участвуют в процесс печати и показано, где каждое из `CView` ввод функции\-члены называется.  В оставшейся части этой статьи в большинство этих шагов более подробно.  Дополнительные части процесса печати описаны в статье [Выделение ресурсов GDI](../mfc/allocating-gdi-resources.md).  
  
 ![Процесс цикла печати](../Image/vc37C71.gif "vc37C71")  
Цикл печати  
  
##  <a name="_core_pagination"></a> Разбиение на страницы  
 Платформа сохраняет многие сведения о задании печати в структуре [CPrintInfo](../mfc/reference/cprintinfo-structure.md).  Несколько значений в `CPrintInfo` относятся к разбиению на страницы; эти значения доступны, как показано в следующей таблице.  
  
### Данные номера страниц, хранящиеся в CPrintInfo  
  
|Переменную\-член или<br /><br /> имена функций|Указанный номер страницы|  
|--------------------------------------------|------------------------------|  
|`GetMinPage`\/`SetMinPage`|Первая страница документа|  
|`GetMaxPage`\/`SetMaxPage`|Последняя страница документа|  
|`GetFromPage`|Первая страница, который нужно напечатать|  
|`GetToPage`|Последняя страница, который нужно напечатать|  
|`m_nCurPage`|В настоящее время, печатанной страницы|  
  
 Номера страниц от 1, то есть первая страница пронумерована 1, а не 0.  Дополнительные сведения о это и другие члены из *ссылку MFC* см. в разделе [CPrintInfo](../mfc/reference/cprintinfo-structure.md).  
  
 В начале процесса печати, платформа вызывает функцию\-член [OnPreparePrinting](../Topic/CView::OnPreparePrinting.md) представления, передав указатель на структуру `CPrintInfo`.  Мастер приложений предоставляет реализацию `OnPreparePrinting`, которая вызывает функцию\-член [DoPreparePrinting](../Topic/CView::DoPreparePrinting.md), другой `CView`.  `DoPreparePrinting` функция, которая выводит диалоговое окно печати и создает контекст устройства принтера.  
  
 На этом этапе приложение не знает количество страниц в документе.  Он использует значения по умолчанию 1 и 0xFFFF чисел для первой и последней страницы документа.  Если известно, количество страниц в документ содержит, переопределите `OnPreparePrinting` и вызов [SetMaxPage](../Topic/CPrintInfo::SetMaxPage.md) для структуры `CPrintInfo` перед отправить его в `DoPreparePrinting`.  Это позволяет определить длину документа.  
  
 `DoPreparePrinting` затем отображается диалоговое окно печати.  Если возвращается, структура `CPrintInfo` содержит значения определенных пользователем.  Если желания пользователя для печати только выделенный диапазон страниц, его или ее могут указывать начальный и конечный номер страницы диалогового окна печати.  Платформа получает эти значения с помощью функции `GetFromPage` и `GetToPage`[CPrintInfo](../mfc/reference/cprintinfo-structure.md).  Если пользователь не задает диапазон страниц, платформа вызывает `GetMinPage` и `GetMaxPage` и использует значения, возвращаемые для печати весь документ.  
  
 Для каждой страницы документа, который должен быть напечатан, платформа вызывает функцию\-член по 2 в представлении классом, [OnPrepareDC](../Topic/CView::OnPrepareDC.md) и [OnPrint](../Topic/CView::OnPrint.md), и передает каждой функции 2 параметра: указатель на объект [CDC](../Topic/CDC%20Class.md) и указатель на структуру `CPrintInfo`.  Каждый раз, когда платформа вызывает `OnPrepareDC` и `OnPrint`, она передает изменения значения в элементе `m_nCurPage` структуры `CPrintInfo`.  Таким образом, платформа это представление, страница должна быть напечатана.  
  
 Функцию\-член [OnPrepareDC](../Topic/CView::OnPrepareDC.md) используется также для экранного отображения.  Это делает коррекции к контексту устройства до рисования происходит.  `OnPrepareDC` служит как роль в печати, но некоторые отличия. во\-первых, объект `CDC` представляет контекст устройства принтера вместо контекста устройства экрана, а во\-вторых, объект `CPrintInfo` передается в качестве второго параметра. \(Этот параметр **NULL** при `OnPrepareDC` вызывается для экранного отображения\). Переопределите `OnPrepareDC` для внесения исправлений к контексту устройства основанному на страницу печатается.  Например, можно переместить координата просмотра и областью обрезки обеспечить соответствующую часть документа получает напечатанной.  
  
 Функцию\-член [OnPrint](../Topic/CView::OnPrint.md) выполняет фактическую печать страницы.  На статью [Как принтер по умолчанию выполняется](../Topic/How%20Default%20Printing%20Is%20Done.md) показано, как платформа вызывает функцию [OnDraw](../Topic/CView::OnDraw.md) с контекстом устройства принтера, чтобы запустить печать.  Точнее, платформа вызывает `OnPrint` со структурой `CPrintInfo` и контекстом устройства, `OnPrint` передает контекст на устройства `OnDraw`.  Переопределите `OnPrint` для выполнения любой отрисовку, которая должна быть создана только во время печати, а не для экранного отображения.  Например, чтобы напечатать заголовок или нижние колонтитулы \(см. статью [Заголовки и нижние колонтитулы](../mfc/headers-and-footers.md) дополнительные сведения\).  Затем вызовите `OnDraw` из переопределения задачи `OnPrint` отрисовкой общими, как в экранному дисплею, так и для печати.  
  
 Тот факт, что `OnDraw` выполняет отрисовку как для экранного отображения, так и для печати означает, что приложение режим представления WYSIWYG: «, Который представлен, чтобы получить». Однако предположим, вы не записывает режим представления WYSIWYG приложение.  Например, рассмотрим текстовый редактор, который использует полужирный шрифт для кодов элемента управления печати и отображения для отображения полужирный шрифт на экране.  В таком случае используется `OnDraw` строго для экранного отображения.  При переопределении `OnPrint` замените вызов `OnDraw` с вызовом отдельную функцию рисования.  Эта функция рисуется документ отображается на способ его бумагу, используя атрибуты, которые не отображаются на экране.  
  
##  <a name="_core_printer_pages_vs.._document_pages"></a> Страниц принтера и страниц документа  
 При ссылке на числа страниц, иногда необходимо различать понятием принтера страницы и понятием документа страницы.  Со стороны зрения принтера, страница один лист бумаги.  Однако один лист бумаги не обязательно соответствует одной страницы документа.  Например, если ввести информационный бюллетень, где таблицы должны быть сложенным, один лист бумаги могут содержать обе первой и последней страницы документа, не параллельно.  Аналогично, если ввести электронную таблицу, документ не состоит из страниц вообще.  Вместо этого один лист бумаги может содержать строки с 1 по 20, столбцы от 6 до 10.  
  
 Все числа страниц в структуре [CPrintInfo](../mfc/reference/cprintinfo-structure.md) относятся к страницам принтера.  Платформа вызывает `OnPrepareDC` и `OnPrint` один раз для каждого листа бумаги, который должна пройти через принтера.  При переопределении функции [OnPreparePrinting](../Topic/CView::OnPreparePrinting.md) для определения длины документ, необходимо использовать страниц принтера.  Если однозначное соответствие \(то есть одна страница принтера соответствует одной страницы документа\), это легко.  Если, с другой стороны, страницы документа и страниц принтера непосредственно не совпадают, необходимо перевести между ними.  Например, рассмотрим печать электронную таблицу.  При переопределении `OnPreparePrinting` необходимо вычислить, необходимые напечатали всю электронную таблицу и затем используется число листов бумаги это значение при вызове функции\-члена `SetMaxPage``CPrintInfo`.  Аналогично, при переопределении `OnPrepareDC` необходимо перевести `m_nCurPage` в диапазон строк и столбцов, которые отображаются на эту определенную таблицу и затем отрегулируются координату просмотра соответственно.  
  
##  <a name="_core_print.2d.time_pagination"></a> Разбиение на страницы PRINT\-Time  
 В некоторых случаях класс представления не может заранее знать, как долго документ, пока он фактически не будет напечатан.  Например, предположим, что приложение не режим представления WYSIWYG, поэтому длина документа на экране не соответствует его длину напечатан.  
  
 В этом случае проблемы при переопределении [OnPreparePrinting](../Topic/CView::OnPreparePrinting.md) для класса представления: невозможно передать значение функции `SetMaxPage` структуры [CPrintInfo](../mfc/reference/cprintinfo-structure.md), так как неизвестно длину документа.  Если пользователь не задает число страниц для остановки на использовании диалогового окна печати, платформа не знает при остановки цикла печати.  Единственный способ определить время остановки цикла печати напечатать документ и просмотреть время его выполнения.  Класс представления должен проверять конца документа во время его печатается, а затем сообщить платформе, когда будет достигнут конец.  
  
 Платформа основан на функции [OnPrepareDC](../Topic/CView::OnPrepareDC.md) класса представления, чтобы указать, когда ее остановки.  После каждого вызова в `OnPrepareDC` платформа проверяет член структуры с именем `CPrintInfo``m_bContinuePrinting`.  Значение по умолчанию **TRUE.** Если он остается таким образом, платформа цикл продолжает печати.  Если оно задано значение **ЛОЖЬ**, то платформа останавливается.  Выполнить разбиение на страницы PRINT\- Time, переопределение `OnPrepareDC` для проверки факта достижения конца документа и набор `m_bContinuePrinting` значение **ЛОЖЬ**, если он имеется.  
  
 Реализация по умолчанию `OnPrepareDC` задает `m_bContinuePrinting` значение **ЛОЖЬ**, если текущая страница больше 1.  Это означает, что если не задана длина документа, платформа принимает документ одной страницы текста.  Следствием этого является то, что следует проявлять осторожность при вызове версию базового класса `OnPrepareDC`.  Не высказывать `m_bContinuePrinting` будет **TRUE** после вызова версию базового класса.  
  
### Дополнительные сведения  
  
-   [Заголовки и нижние колонтитулы](../mfc/headers-and-footers.md)  
  
-   [Выделение ресурсов GDI](../mfc/allocating-gdi-resources.md)  
  
## См. также  
 [Печать](../mfc/printing.md)   
 [CView Class](../Topic/CView%20Class.md)   
 [Класс CDC](../Topic/CDC%20Class.md)
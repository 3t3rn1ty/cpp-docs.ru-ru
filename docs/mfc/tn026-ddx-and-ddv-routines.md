---
title: "TN026. Процедуры DDX и DDV | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "DDX"
  - "DDV"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "DDV (проверка данных диалогового окна), процедуры"
  - "обмен данными диалоговых окон (DDX), процедуры"
  - "TN026"
ms.assetid: c2eba87a-4b47-4083-b28b-e2fa77dfb4c4
caps.latest.revision: 10
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 6
---
# TN026. Процедуры DDX и DDV
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

> [!NOTE]
>  Следующее техническое примечание не было обновлено, поскольку сначала оно было включено в электронную документацию.  В результате некоторые процедуры и разделы могут быть устаревшими или неверными.  Для получения последних сведений рекомендуется выполнить поиск интересующей темы в алфавитном указателе документации в Интернете.  
  
 Эта заметка описание архитектуры \(DDV\) обмена данных \(DDX\) и проверки данных диалогового окна.  Она также описывается, как создавать DDX\_ или процедуры DDV\_ и как можно расширить ClassWizard для использования пользовательских процедур.  
  
## Обзор обмена данными с диалоговым окном  
 Все функции данных диалогового окна с кодом C\+\+.  Никаких особых ресурсы или волшебные макросов.  Является основой механизма виртуальная функция, переопределена в каждом классе диалогового окна, который выполняет проверку и обмена данными с диалоговым окном.  Он всегда находится в этой форме:  
  
```  
void CMyDialog::DoDataExchange(CDataExchange* pDX)  
{  
    CDialog::DoDataExchange(pDX);    // call base class  
  
    //{{AFX_DATA_MAP(CMyDialog)  
        <data_exchange_function_call>  
        <data_validation_function_call>  
    //}}AFX_DATA_MAP  
}  
```  
  
 Специальные комментарии формата AFX позволяют ClassWizard для поиска и отредактировав код внутри этой функции.  Код, который не совместим с ClassWizard следует поместить вне специальных комментариев формата.  
  
 В предыдущем примере, \<data\_exchange\_function\_call\> в форме:  
  
```  
DDX_Custom(pDX, nIDC, field);  
```  
  
 и \<data\_validation\_function\_call\> является необязательной и в форме:  
  
```  
DDV_Custom(pDX, field, ...);  
```  
  
 Несколько пар DDX\_\/DDV\_ может быть включена в каждой функции `DoDataExchange`.  
  
 В разделе «afxdd\_.h» список всех процедур обмена данными с диалоговым окном и процедур проверки данных диалогового окна, передаваемых с MFC.  
  
 Данные диалогового окна только то: данные элемента в классе **CMyDialog**.  Он не хранится в структуре или любые подобные.  
  
## Примечания  
 Хотя мы будем называть эти данные «диалогового окна» все функции, доступные в любом классе, производном от `CWnd` и не ограничиваются только диалоговые окна.  
  
 Начальные значения данных задаются в стандартный конструктор C\+\+, обычно в блоке с `//{{AFX_DATA_INIT` и комментариями `//}}AFX_DATA_INIT`.  
  
 `CWnd::UpdateData` операция, которая производит инициализацию и обработки ошибок вокруг вызова `DoDataExchange`.  
  
 Можно вызвать `CWnd::UpdateData` в любое время для выполнения обмена данными и проверки.  По умолчанию `UpdateData`\(ИСТИННОЕ\) вызывается в обработчике и `UpdateData``CDialog::OnOK` по умолчанию \(ЛОЖНЫХ\) вызывается в режиме по умолчанию `CDialog::OnInitDialog`.  
  
 Процедура DDV\_ должна следовать процедура DDX\_ для *поля*.  
  
## Принципы ее работы?  
 Нет необходимости понимать следующее для использования данных диалогового окна.  Однако понимание того, как это работает в фоновом режиме позволяет написать собственную процедура обмена или проверки.  
  
 Функция\-член `DoDataExchange` подобно функцию\-член `Serialize` — он отвечает за получение или параметра данные в внешней формы \(в данном случае элементов управления в диалоговом окне\) from\/to данных члена класса.  Параметр `pDX` контекст для такой обмен данными и аналогичен параметру `CArchive` в `CObject::Serialize`.  `pDX` \(объект `CDataExchange` \) имеет флаг направления подобно `CArchive` имеет флаг направления:  
  
-   Если **\!m\_bSaveAndValidate**, а затем загружает состояние данных в элементы управления.  
  
-   Если `m_bSaveAndValidate`, затем устанавливается состояние данных от элементов управления.  
  
 Проверка возникает только при `m_bSaveAndValidate` ".  Значение `m_bSaveAndValidate` определяется параметром BOOL в `CWnd::UpdateData`.  
  
 3 Других интересных члена `CDataExchange`:  
  
-   `m_pDlgWnd`: Окно \(обычно диалоговое окно\), содержащий элементы управления.  Это не вызывающие объекты глобальных функций DDX\_ и DDV\_ из передачи «this» к каждой процедуре DDX\/DDV.  
  
-   `PrepareCtrl` и `PrepareEditCtrl`: Добавляется элемент управления диалогового окна для обмена данными.  Сохраняет этот дескриптор элемента управления для параметра фокус при неудачном завершении.  `PrepareCtrl` используется для элементов управления nonedit и `PrepareEditCtrl` используется для элементов управления "Поле ввода".  
  
-   **Не пройдено**: Вызывается после получения вверх окно сообщения оповестя пользователь с ошибкой.  Эта процедура восстановления фокус к последнему элементу управления \(последней возможности в `PrepareCtrl`\/`PrepareEditCtrl`\) и создает исключение.  Этот функции\-члена может вызываться из процедур и DDX\_ и DDV\_.  
  
## Расширения пользователя  
 Существует несколько способов расширения механизм DDX\/DDV по умолчанию.  Можно выполнить следующие действия.  
  
-   Добавление новых типов данных.  
  
    ```  
    CTime  
    ```  
  
-   Добавьте новые процедуры обмена \(DDX\_???\).  
  
    ```  
    void PASCAL DDX_Time(CDataExchange* pDX, int nIDC, CTime& tm);  
    ```  
  
-   Добавьте новые процедуры проверки \(DDV\_???\).  
  
    ```  
    void PASCAL DDV_TimeFuture(CDataExchange* pDX, CTime tm, BOOL bFuture);  
    // make sure time is in the future or past  
    ```  
  
-   Передайте произвольные выражения на процедуры проверки.  
  
    ```  
    DDV_MinMax(pDX, age, 0, m_maxAge);  
    ```  
  
    > [!NOTE]
    >  Такие произвольные выражения не могут редактироваться ClassWizard и поэтому не должны быть слева специальные комментарии формата \(" {{AFX\_DATA\_MAP \(CMyClass\).  
  
 Наличие функции\-члена **DoDialogExchange** включить условных выражениях или другие допустимые формулировки C\+\+ с перемешанными обменом вызовами функций проверки.  
  
```  
//{{AFX_DATA_MAP(CMyClass)  
DDX_Check(pDX, IDC_SEX, m_bFemale);  
DDX_Text(pDX, IDC_EDIT1, m_age);  
//}}AFX_DATA_MAP  
if (m_bFemale)  
    DDV_MinMax(pDX, age, 0, m_maxFemaleAge);  
else  
    DDV_MinMax(pDX, age, 0, m_maxMaleAge);  
```  
  
> [!NOTE]
>  Как показано выше, такой код не может быть изменен ClassWizard и должен использоваться только вне специальных комментариев формата.  
  
## Поддержка ClassWizard  
 ClassWizard поддерживает подмножество настроек DDX\/DDV с позволяет интеграции собственные процедуры DDX\_ и DDV\_ в интерфейс пользователя ClassWizard.  Это только стоят полезную, если планируется повторно использовать определенные процедуры DDX и DDV в проекте или во многих проектах.  
  
 Чтобы сделать это, специальные записи выполняется в DDX.CLW \(в предыдущих версиях Visual C\+\+, эти сведения в APSTUDIO.INI\) или в файле .CLW проекта.  Специальные записи можно вводить или в разделе \[\] общие сведения .CLW файла проекта или в разделе \[ExtraDDX\] DDX.CLW файла в каталоге Files\\Microsoft визуального Studio\\Visual C \+\+\\bin \\Program.  Можно создать файл DDX.CLW, если она еще не существует.  Если планируется использовать пользовательские процедуры DDX\_\/DDV\_ только в определенном проекте, добавьте записи в раздел \[общие сведения\] файла проекта .CLW вместо.  Если планируется использовать процедуры по множеству проектов, добавьте записи в раздел \[ExtraDDX\] DDX.CLW.  
  
 Общий формат специальных записей выглядит следующим образом:  
  
```  
ExtraDDXCount=n  
```  
  
 , где n — номер ExtraDDX? линии, должны следовать  
  
```  
ExtraDDX?=<keys>;<vb-keys>; <prompt>; <type>; <initValue>; <DDX_Proc>  
[;<DDV_Proc>; <prompt1>; <arg1>; [<prompt2>; <fmt2>]]  
```  
  
 где? 1 — отображение n, DDX типа в список, определяется.  
  
 Каждое поле размежевано «; ».  Поля и их назначение описаны ниже.  
  
 \<keys\>  
 \= одных список символов, для элементов управления диалогового окна, этот тип переменной разрешен.  
  
 E \= правка  
  
 C \= 2 — состояния checkbox  
  
 C\- \= флажок три\-состояния  
  
 R \= сначала переключатель в группе  
  
 L \= nonsorted список  
  
 l \= окно отсортированного списка  
  
 M \= поле со списком \(с элементом правки\)  
  
 N \= nonsorted список размещения  
  
 n \= упорядоченный список размещения  
  
 1 \= вставка при обмене данными в диалоговых окнах добавляется в начале списка, \(по умолчанию\) добавляет к концу это обычно используется для процедур DDX, которые перемещают свойство «элемента управления».  
  
 \<vb\-keys\>  
 Это поле используется только в 16 разрядном продукта для элементов управления VBX \(управления VBX не поддерживаются в 32 разрядном продукте\)  
  
 \<prompt\>  
 Строка, которую требуется установить в поле со списком свойства \(без кавычек\)  
  
 \<тип\>  
 Один идентификатор для типа, передаваемый в файле заголовка.  В приведенном выше примере с DDX\_Time, это будет присвоено значение CTime.  
  
 \<vb\-keys\>  
 Не используется в данной версии и всегда быть пустым  
  
 \<initValue\>  
 Начальное значение — 0 или пробел.  Если оно пустое, линия инициализации не будет записана в \/\/{{AFX\_DATA\_INIT раздел файла реализации.  Пустую запись должна использоваться для объектов C\+\+ \(например, `CString`, `CTime` и т д\), которые имеют конструкторы, которые гарантируют правильность инициализацию.  
  
 \<DDX\_Proc\>  
 Один идентификатор для процедуры DDX\_.  Имя функции C\+\+ должно начинаться с «DDX\_», но не включает «DDX\_» в \<DDX\_Proc\> идентификаторе.  В приведенном выше примере, \<DDX\_Proc\> идентификатор был бы раз.  При вызове функции ClassWizard записывает в файл реализации в разделе {{AFX\_DATA\_MAP, он добавляет это имя в DDX\_, таким образом приезжающ в DDX\_Time.  
  
 \<comment\>  
 Прокомментируйте для отображения в диалоговом окне для переменной с этим DDX.  Задайте любой текст, который необходимо было бы здесь, и обычно убедитесь, описывает операцию, выполненную парами DDX\/DDV.  
  
 \<DDV\_Proc\>  
 Часть DDV записи необязательна.  Не все процедуры DDX имеют соответствующие процедуры DDV.  Зачастую более просто включить этап проверки как целая часть передачи.  Это часто случай, когда процедура DDV не требует никаких параметров, поскольку ClassWizard не поддерживает процедуры DDV без каких\-либо дополнительных параметров.  
  
 \<arg\>  
 Один идентификатор для процедуры DDV\_.  Имя функции C\+\+ должно начинаться с «DDV\_», но не включает «DDX\_» в \<DDX\_Proc\> идентификаторе.  
  
 за 1 или 2 DDV аргументами.  
  
 \<promptX\>  
 строка в локальном перед элементом \(для правки с & сочетанием клавиш\)  
  
 \<fmtX\>  
 символ формата для типа, один из аргументов  
  
 d \= int  
  
 u \= удалить  
  
 D \= long int \(т е long\)  
  
 U \= долго удаленный подписи \(т е DWORD\)  
  
 f \= float  
  
 F \= double  
  
 s \= строка  
  
## См. также  
 [Технические примечания по номеру](../mfc/technical-notes-by-number.md)   
 [Технические примечания по категории](../mfc/technical-notes-by-category.md)
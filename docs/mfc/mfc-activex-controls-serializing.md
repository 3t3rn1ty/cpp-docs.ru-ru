---
title: "Элементы управления ActiveX в MFC. Сериализация | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "_wVerMinor"
  - "DoPropExchange"
  - "_wVerMajor"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "DoPropExchange - метод"
  - "ExchangeVersion - метод"
  - "GetVersion - метод"
  - "MFC ActiveX - элементы управления, сериализация"
  - "MFC ActiveX - элементы управления, поддержка версий"
  - "управление версиями элементов управления ActiveX"
  - "wVerMajor - глобальная константа"
  - "wVerMinor - глобальная константа"
ms.assetid: 9d57c290-dd8c-4853-b552-6f17f15ebedd
caps.latest.revision: 10
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 6
---
# Элементы управления ActiveX в MFC. Сериализация
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Этот раздел описывает, как выполнить сериализацию элементов управления ActiveX.  Сериализация представляет собой процесс из чтения или записи в постоянное носителю записи, например дисковый файл.  Библиотеки Microsoft Foundation Class \(MFC\) предоставляет встроенную поддержку сериализации в классе `CObject`.  `COleControl` передает эта поддержка с элементами управления ActiveX с помощью механизма обмена свойства.  
  
 Сериализация для элементов управления ActiveX реализуется путем переопределения [COleControl::DoPropExchange](../Topic/COleControl::DoPropExchange.md).  Эта функция, вызываемая во время загрузки и сохранения объекта управления, содержит все свойства, реализованные с переменной\-членом или переменной\-членом с уведомления об изменении.  
  
 В следующих разделах приведены сведения о связанных основных проблем в сериализации элемента управления ActiveX.  
  
-   Реализации функций `DoPropExchange`  для сериализации находится объект управления  
  
-   [Настраивать процесс сериализации](#_core_customizing_the_default_behavior_of_dopropexchange)  
  
-   [Реализация поддержки версии](#_core_implementing_version_support)  
  
##  <a name="_core_implementing_the_dopropexchange_function"></a> Реализации функций DoPropExchange  
 При использовании мастера элементов управления ActiveX для создания проекта элемента управления, несколько функций обработчика по умолчанию автоматически добавляются в класс элемента управления, включая реализацию по умолчанию [COleControl::DoPropExchange](../Topic/COleControl::DoPropExchange.md).  В следующем примере показан код добавлен к классам, созданным с помощью элемента управления ActiveX.  
  
 [!code-cpp[NVC_MFC_AxUI#43](../mfc/codesnippet/CPP/mfc-activex-controls-serializing_1.cpp)]  
  
 Если требуется создать свойство упорным, измените `DoPropExchange` путем добавления вызов функции обмена свойства.  В следующем примере демонстрируется сериализации пользовательского свойства логического CircleShape, где свойство CircleShape имеет значение по умолчанию **TRUE**.  
  
 [!code-cpp[NVC_MFC_AxSer#1](../mfc/codesnippet/CPP/mfc-activex-controls-serializing_2.cpp)]  
[!code-cpp[NVC_MFC_AxSer#2](../mfc/codesnippet/CPP/mfc-activex-controls-serializing_3.cpp)]  
  
 В следующей таблице перечислены возможные обмена функции свойств можно использовать для сериализации свойства элемента управления.  
  
|Функции обмена свойства|Назначение|  
|-----------------------------|----------------|  
|**PX\_Blob \(\)**|Сериализует свойства данных \(BLOB\) большого двоичного объекта типа.|  
|**PX\_Bool \(\)**|Сериализует логическое свойство типа.|  
|**PX\_Color \(\)**|Сериализует свойства типа цвета.|  
|**PX\_Currency \(\)**|Сериализует свойства типа валюты \( **CY** \).|  
|**PX\_Double \(\)**|Сериализует свойства типа **double**.|  
|**PX\_Font \(\)**|Сериализует свойства типа шрифта.|  
|**PX\_Float \(\)**|Сериализует свойства типа **плавающее**.|  
|**PX\_IUnknown \(\)**|Сериализует свойства типа `LPUNKNOWN`.|  
|**PX\_Long \(\)**|Сериализует свойства типа **long**.|  
|**PX\_Picture \(\)**|Сериализует свойство фигуры типа.|  
|**PX\_Short \(\)**|Сериализует свойства типа **short**.|  
|**PX\_String \(\)**|Сериализует свойство `CString` типа.|  
|**PX\_ULong \(\)**|Сериализует свойства типа **ulong**.|  
|**PX\_UShort \(\)**|Сериализует свойства типа **ushort**.|  
  
 Дополнительные сведения об этих функциях обмена свойств см. в разделе [Сохранение элементов управления OLE](../mfc/reference/persistence-of-ole-controls.md) в *справочнике по MFC*.  
  
##  <a name="_core_customizing_the_default_behavior_of_dopropexchange"></a> Настраивать реакция на событие по умолчанию DoPropExchange  
 Реализация по умолчанию **DoPropertyExchange** \(как показано в предыдущем разделе\) вызовет базовый класс `COleControl`.  Это сериализует набор свойств автоматически поддерживается `COleControl`, который использует больше дискового пространства, чем издающ сериализации только пользовательские свойства элемента управления.  Удалить этот вызов позволяет данный объект для сериализации только те свойства, безопасные важным.  Любое стандартное свойство заявляет, что не будет сериализуется в элемент управления, реализовал сохранения или загрузка объект управления, если явно не задано добавление вызовов **PX\_** для них.  
  
##  <a name="_core_implementing_version_support"></a> Реализация поддержки версии  
 Поддержка версий позволяет измененного элемента управления ActiveX добавлять новые доступные свойства и по\-прежнему может найти и загрузить постоянные, созданный в более ранней версии состояние элемента управления.  Чтобы сделать версии элемента управления доступен как часть его упорных данных, вызовите функции [COleControl::ExchangeVersion](../Topic/COleControl::ExchangeVersion.md) в `DoPropExchange` элемента управления.  Этот вызов автоматически вставляется, если элемент управления ActiveX было создано с помощью мастера элементов управления ActiveX.  Его можно удалить, если не нужна поддержка версии.  Однако затраты размера элемента управления очень мала \(4 байта\) для добавленной гибкости, поддержка предоставляет версии.  
  
 Если элемент управления не был создан с помощью мастера элементов управления ActiveX, добавьте вызов `COleControl::ExchangeVersion`, вставив следующей линии в начале функции `DoPropExchange` \(перед вызовом `COleControl::DoPropExchange`\).  
  
 [!code-cpp[NVC_MFC_AxSer#1](../mfc/codesnippet/CPP/mfc-activex-controls-serializing_2.cpp)]  
[!code-cpp[NVC_MFC_AxSer#3](../mfc/codesnippet/CPP/mfc-activex-controls-serializing_4.cpp)]  
  
 Можно использовать любое `DWORD` как номер версии.  Проекты, созданные использованием **\_wVerMinor** и **\_wVerMajor** мастера элементов управления ActiveX по умолчанию.  Эти глобальные константы, определенные в файле реализации класса элемента управления ActiveX проекта.  В пределах остальной функции `DoPropExchange`, можно вызвать [CPropExchange::GetVersion](../Topic/CPropExchange::GetVersion.md) в любое время, чтобы получить версию сохранении или извлечении.  
  
 В следующем примере, версия 1 управления этого примера «имеет только свойства ReleaseDate».  Версия 2 добавляет свойство «OriginalDate».  Если элемент управления проинструктирован для загрузки постоянное состояние из старой версии, он инициализирует переменную\-член для нового свойства значение по умолчанию.  
  
 [!code-cpp[NVC_MFC_AxSer#4](../mfc/codesnippet/CPP/mfc-activex-controls-serializing_5.cpp)]  
[!code-cpp[NVC_MFC_AxSer#3](../mfc/codesnippet/CPP/mfc-activex-controls-serializing_4.cpp)]  
  
 По умолчанию элемент управления «преобразования» старые данные на последний по времени формат.  Например, если версия 2 элемента управления загружает данные, сохраненного версия 1, он записывает формат версии 2 при его сохранении снова.  Если последним или требуется элемент управления сохранения данных в формате, передайте **ЛОЖЬ** в качестве третьего параметра при вызове `ExchangeVersion`.  Этот параметр является необязательным и третий **TRUE** по умолчанию.  
  
## См. также  
 [Элементы управления ActiveX MFC](../mfc/mfc-activex-controls.md)
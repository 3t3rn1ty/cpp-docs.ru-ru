---
title: "Архитектура предварительного просмотра | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "предварительный просмотр печати"
  - "предварительный просмотр, архитектура"
  - "предварительный просмотр, изменения в MFC"
  - "предварительный просмотр, процесс"
  - "печать [MFC], предварительный просмотр"
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
caps.latest.revision: 10
caps.handback.revision: 6
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Архитектура предварительного просмотра
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этой статье описывается, как платформы MFC реализует функцию предварительного просмотра.  В разделе рассматриваются следующие вопросы:  
  
-   [Процесс предварительного просмотра](#_core_the_print_preview_process)  
  
-   [Изменение предварительный просмотр](#_core_modifying_print_preview)  
  
 Предварительный просмотр несколько отличается от отображение на экране и печать, поскольку вместо непосредственно создать образ на устройстве, приложение должно имитировать принтера с помощью экрана.  Для включения этого библиотеки Microsoft Foundation Class определяет специальный \(незадокументированный\) класс, производный от [Класс CDC](../Topic/CDC%20Class.md), с именем **CPreviewDC**.  Все объекты `CDC` содержат 2 контекста устройства, но обычно они идентичны.  В объекте **CPreviewDC**, они отличаются: первый представляет, сымитированным принтера, а вторая представляет экран, на котором фактически результат.  
  
##  <a name="_core_the_print_preview_process"></a> Процесс предварительного просмотра  
 Когда пользователь выбирает команду предварительного просмотра в меню **Файл** платформа создает объект **CPreviewDC**.  Когда приложение выполняет операцию, которая задает контекста характеристики устройства принтера, платформа также выполняет операцию, в контексте устройства экрана.  Например, если приложение выделяет шрифт для печати, платформа выделяет шрифт для экранного отображения, который моделирует шрифт принтера.  Когда приложение отправитьTfо бы выходные данные на принтер, платформа вместо отправляет выходные данные на экране.  
  
 Предварительный просмотр также отличается от печати в порядке, каждый из которых рисуются страницы документа.  Во время печати платформа печати цикл продолжается до тех пор, пока не будет представлен определенный диапазон страниц.  Во время предварительного просмотра, одна или две страницы отображаются в любое время, а затем приложение ожидает; никакие дополнительные действия страницы не отображается до тех пор, пока пользователь не будет отвечать.  Во время предварительного просмотра, приложение также должно реагировать на них `WM_PAINT`, так как он принимает во время обычного экранного отображения.  
  
 Функция [CView::OnPreparePrinting](../Topic/CView::OnPreparePrinting.md) вызывается при вызове режим просмотра, точно так же как в начале заданий печати.  Структура [CPrintInfo Structure](../mfc/reference/cprintinfo-structure.md), переданная функции, содержит несколько членов, значения которых можно настроить для настройки определенных характеристик операции предварительного просмотра.  Например, можно задать элемент **m\_nNumPreviewPages**, чтобы определить, нужно ли предварительный просмотр документа с страницы или режиме 2 — страницы.  
  
##  <a name="_core_modifying_print_preview"></a> Изменение предварительный просмотр  
 Можно изменить расширение функциональности и внешний вид предварительного просмотра несколькими способами довольно легко.  Например, можно, помимо прочего:  
  
-   Сбой окно предварительного просмотра для отображения полосу прокрутки для упрощения доступа к любой странице документа.  
  
-   Сбой предварительный просмотр поддерживать положение пользователя в документе с начала его отображение на текущей странице.  
  
-   Сбой другую инициализацию, выполняемых для предварительного просмотра и печати.  
  
-   Сбой предварительный просмотр для отображения числа страниц в пользовательских форматах.  
  
 Если известно, как долго документ и вызывает `SetMaxPage` с соответствующим значением платформа может использовать эти сведения в режиме просмотра, так и во время печати.  После того как платформа знает длину документа, она может реализовать окно просмотра с полоса прокрутки, предоставляя пользователю туда и обратно с помощью страницы документа в режиме предварительного просмотра.  Если не задано длину документа, платформа не может расположить ползунок полосы прокрутки, чтобы отобразить текущее положение, поэтому платформа не добавляет полосы прокрутки.  В этом случае пользователь должен использовать следующие кнопки страница и предыдущей страницы на панели элементов управления окна просмотра на странице по документу.  
  
 Для предварительного просмотра он может оказаться полезным для присвоения значения на член `m_nCurPage``CPrintInfo`, даже если не выполнить, а для обычной печати.  Во время обычной печати, этот член передает сведения из платформы в класс представления.  Это представление, как платформа сообщает страница должна быть напечатана.  
  
 Напротив, если режим предварительного просмотра запущен, член `m_nCurPage` передает сведения в противоположном направлении: из представления в платформе.  Платформа использует значение этого элемента, чтобы определить, какая страница должна быть предварительно сканирования первым.  Значение по умолчанию этого члена 1, поэтому первая страница отображается исходного документа.  Можно переопределить `OnPreparePrinting` для задания этот член в число, просмотренной страницы во время предварительного просмотра команда была вызвана функцией.  Таким образом, приложение поддерживает текущее положение пользователя переход с режима отображения в режим предварительного просмотра.  
  
 Иногда может потребоваться `OnPreparePrinting` выполнять другую инициализацию в зависимости от того, является ли она вызывается для задания печати или для предварительного просмотра.  Можно указать это прогнозы переменной\-члена **m\_bPreview** в структуре `CPrintInfo`.  Этот элемент имеет значение **TRUE**, если предварительный просмотр вызывается.  
  
 Структура `CPrintInfo` также содержит элемент с именем **m\_strPageDesc**, который используется для форматирования строки отображаются в нижней части окна в режимах одной страницы и нескольких страниц.  По умолчанию эти строки страницы формы « *n*» и «страниц *n* \- *m*», но можно изменить **m\_strPageDesc** из `OnPreparePrinting` и задает строки на что\-нибудь более уточнить.  В разделе [CPrintInfo Structure](../mfc/reference/cprintinfo-structure.md) в справочнике по MFC дополнительные сведения.  
  
## См. также  
 [Печать и предварительный просмотр печати](../mfc/printing-and-print-preview.md)   
 [Печать](../mfc/printing.md)   
 [CView Class](../Topic/CView%20Class.md)   
 [Класс CDC](../Topic/CDC%20Class.md)
---
title: Архитектура предварительного просмотра | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- print preview [MFC], process
- previewing printing
- print preview [MFC], architecture
- printing [MFC], print preview
- print preview [MFC], modifications to MFC
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: 26771ba3f5a79716a759327f485a92391fada8c7
ms.sourcegitcommit: 76b7653ae443a2b8eb1186b789f8503609d6453e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="print-preview-architecture"></a>Архитектура предварительного просмотра
В этой статье объясняется, как платформа MFC реализует функции предварительного просмотра. Рассмотрены следующие темы.  
  
-   [Процесс предварительного просмотра печати](#_core_the_print_preview_process)  
  
-   [Изменение предварительного просмотра печати](#_core_modifying_print_preview)  
  
 Предварительного несколько отличается от отображения на экране и печати, поскольку вместо непосредственно рисование изображения на устройстве, приложение необходимо имитировать принтера на экране. Чтобы решить эту проблему, библиотеки классов Microsoft Foundation определяет специальные (недокументированные) класса, производного от [CDC-класс](../mfc/reference/cdc-class.md), который называется **CPreviewDC**. Все `CDC` объекты содержат два контексты устройств, но обычно они совпадают. В **CPreviewDC** объекта, они различаются: первый представляет принтер смоделированные, а второй — экран, на котором отображаются выходные данные.  
  
##  <a name="_core_the_print_preview_process"></a> Процесс предварительного просмотра печати  
 Когда пользователь выбирает команду Предварительный **файл** меню, платформа создает **CPreviewDC** объекта. Каждый раз, когда приложение выполняет операцию, которая задает характеристикой контекста принтера, платформа также выполняет аналогичную операцию в контексте экрана устройства. Например если приложение выбирает шрифт для печати, платформа выбирает шрифт для отображения на экране, которое имитирует шрифт принтера. Каждый раз, когда приложение будет отправить выходные данные на принтер, платформа вместо этого отправляет выходные данные на экране.  
  
 Режим предварительного просмотра также отличается от печать в том порядке, что каждый рисует страницы документа. Во время печати, framework продолжается цикл печати до отрисовки диапазон страниц. Во время предварительного просмотра одна или две страницы отображаются в любое время, а затем ждет приложения; Дальнейшие страницы не отображаются, пока пользователь не ответит. Во время предварительного просмотра, приложение должно также реагировать на `WM_PAINT` сообщений, так же, как при обычной дисплеем.  
  
 [CView::OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) функция вызывается при вызове режим предварительного просмотра, так же, как он находится в начале задания печати. [CPrintInfo-структура](../mfc/reference/cprintinfo-structure.md) структура, переданная функции содержит несколько элементов, значения которых можно задать для настройки определенных характеристик предварительного операции. Например, можно задать **m_nNumPreviewPages** элемента можно указать для предварительного просмотра документа в режиме или двумя.  
  
##  <a name="_core_modifying_print_preview"></a> Изменение предварительного просмотра печати  
 Довольно легко можно изменить поведение и внешний вид предварительного несколькими способами. Например можно, помимо прочего:  
  
-   Вызвать окно предварительного просмотра печати для отображения полосы прокрутки для упрощения доступа к любой странице документа.  
  
-   Причина предварительного поддерживать положение пользователя в документе с начала его отображение на текущей странице.  
  
-   Вызывает другой инициализацию для предварительного просмотра и печати.  
  
-   Причина режим предварительного просмотра для отображения номеров страниц в собственных форматах.  
  
 Если знать, сколько времени документа и вызов `SetMaxPage` с соответствующим значением платформа эти сведения можно использовать в режиме предварительного просмотра, а также при печати. Когда платформа известна длина документа, он может предоставить окно предварительного просмотра полоса прокрутки, чтобы пользователи могли просматривать документ в режиме предварительного просмотра страницы и обратно. Если вы не настроили длине документа, платформа не может определить положение полосы прокрутки для указания текущей позиции, поэтому платформа не добавить полосу прокрутки. В этом случае пользователь должен использовать следующую страницу и кнопки предыдущей страницы на окно предварительного просмотра панели управления страницу с помощью документа.  
  
 Для предварительного просмотра, может оказаться полезным для присвоения значения для `m_nCurPage` членом `CPrintInfo`, даже если бы не сделать это для обычной печати. При обычной печати, этот член содержит сведения об от платформы в классе представления. Это, как платформа сообщает представление печатаемых страниц.  
  
 Напротив, при запуске режима просмотра печати `m_nCurPage` член содержит конфиденциальную информацию в обратном направлении: из представления для платформы. Платформа использует значение этого элемента для определения, следует сначала предварительного просмотра страниц. Этот член значение по умолчанию-1, поэтому первоначального отображения первой страницы документа. Можно переопределить `OnPreparePrinting` присваивается номер страницы, во время была вызвана команда предварительного просмотра этого элемента. Таким образом, приложение сохраняет сведения о текущей позиции пользователя при переходе от обычному режиму отображения в режим просмотра печати.  
  
 Иногда требуется `OnPreparePrinting` для выполнения различных инициализации в зависимости от того, является ли он вызывается для задания печати или предварительного просмотра печати. Это можно определить с помощью проверки **m_bPreview** переменной-члена в `CPrintInfo` структуры. Этот член имеет значение **TRUE** при вызове предварительного просмотра печати.  
  
 `CPrintInfo` Структура также содержит элемент с именем **m_strPageDesc**, который используется для форматирования строк, отображаемых в нижней части экрана в режиме одной страницы и нескольких страниц. По умолчанию эти строки имеют форму «страницы *n*» и «страницы *n* - *m*,», но можно изменить **m_strPageDesc** из в пределах `OnPreparePrinting` и набор строк на что-нибудь более сложных. В разделе [CPrintInfo-структура](../mfc/reference/cprintinfo-structure.md) в *Справочник по библиотеке MFC* для получения дополнительной информации.  
  
## <a name="see-also"></a>См. также  
 [Печать и предварительный просмотр](../mfc/printing-and-print-preview.md)   
 [Печать](../mfc/printing.md)   
 [CView-класс](../mfc/reference/cview-class.md)   
 [Класс CDC](../mfc/reference/cdc-class.md)

---
title: 'Элементы управления ActiveX MFC: Лицензирование элемента управления ActiveX | Документы Microsoft'
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-mfc
ms.topic: conceptual
f1_keywords:
- COleObjectFactory
dev_langs:
- C++
helpviewer_keywords:
- COleObjectFactory class [MFC], licensing controls
- MFC ActiveX controls [MFC], licensing
- VerifyLicenseKey method [MFC]
- VerifyUserLicense method [MFC]
- GetLicenseKey method [MFC]
- licensing ActiveX controls
ms.assetid: cacd9e45-701a-4a1f-8f1f-b0b39f6ac303
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: b0b1e8f0c54cf4d409aedb99fc3195b927d5f127
ms.sourcegitcommit: 060f381fe0807107ec26c18b46d3fcb859d8d2e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2018
ms.locfileid: "36929748"
---
# <a name="mfc-activex-controls-licensing-an-activex-control"></a>Элементы управления ActiveX в MFC. Лицензирование элемента управления ActiveX
Поддержки лицензирования, дополнительный компонент, элементов управления ActiveX, можно контролировать, кто может использовать или распространять элемент управления. (Дополнительные сведения о вопросы лицензирования см. вопросы лицензирования в [обновление существующего элемента управления ActiveX](../mfc/upgrading-an-existing-activex-control.md).)  
  
 В этой статье рассматриваются следующие вопросы:  
  
-   [Общие сведения о лицензировании элементов управления ActiveX](#_core_overview_of_activex_control_licensing)  
  
-   [Создание лицензированный элемент управления](#_core_creating_a_licensed_control)  
  
-   [Поддержка лицензирования](#_core_licensing_support)  
  
-   [Настройка Лицензирование элементов управления ActiveX](#_core_customizing_the_licensing_of_an_activex_control)  
  
 Элементы управления ActiveX, которые реализуют лицензирования можно, как разработчик элемента управления, чтобы определить, как другие пользователи будут использовать элемент управления ActiveX. Укажите покупатель элемента управления с помощью элемента управления и. Файл: лицензионное соглашение, а соглашение, что покупатель может распространять, но не элемент управления. Файл: лицензионное соглашение с приложение, использующее элемент управления. При этом пользователи этого приложения от записи новых приложений, использующих элемент управления без первого элемента управления от вас лицензирования.  
  
##  <a name="_core_overview_of_activex_control_licensing"></a> Общие сведения о лицензировании элементов управления ActiveX  
 Для обеспечения поддержки лицензирования для элементов управления ActiveX, [COleObjectFactory](../mfc/reference/coleobjectfactory-class.md) класс предоставляет реализацию для нескольких функций в `IClassFactory2` интерфейса: `IClassFactory2::RequestLicKey`, `IClassFactory2::GetLicInfo`, и `IClassFactory2::CreateInstanceLic`. Когда разработчик приложения контейнера отправляет запрос для создания экземпляра элемента управления, вызов `GetLicInfo` вносится убедитесь, что элемент управления. Отсутствует файл: лицензионное соглашение. Если элемент управления, а лицензируется экземпляр элемента управления можно создать и разместить в контейнере. После завершения построения приложения-контейнера разработчику другой вызов функции, в данный момент `RequestLicKey`, выполняется. Эта функция возвращает лицензионный ключ (простая символьная строка) для приложения-контейнера. Возвращаемый ключ включается в приложении.  
  
 На следующем рисунке показано проверку лицензии элемента управления ActiveX, который будет использоваться во время разработки приложения-контейнера. Как упоминалось ранее, разработчик приложения контейнера должен иметь правильно. Файл: лицензионное соглашение, установленный на компьютере разработчика для создания экземпляра элемента управления.  
  
 ![Лицензия управления ActiveX, проверяемый на этапе разработки](../mfc/media/vc374d1.gif "vc374d1")  
Проверка лицензированный элемент управления ActiveX во время разработки  
  
 Следующий процесс, показанный на следующем рисунке происходит, когда пользователь запускает приложение контейнера.  
  
 Когда приложение запускается, экземпляр элемента управления обычно необходимо создать. Контейнер это достигается путем вызова `CreateInstanceLic`, передавая внедренные лицензионный ключ в качестве параметра. Сравнение строк становятся между внедренные лицензионный ключ и элемента управления собственную копию лицензионный ключ. Если сопоставление выполняется успешно, создать экземпляр элемента управления, и приложение продолжает выполнение в обычном режиме. Обратите внимание, что. Файл: лицензионное соглашение должны отсутствовать на компьютере пользователя элемента управления.  
  
 ![Лицензия управления ActiveX, проверяемый на этапе выполнения](../mfc/media/vc374d2.gif "vc374d2")  
Проверка лицензированный элемент управления ActiveX во время выполнения  
  
 Лицензирование элементов управления состоит из двух основных компонентов: конкретного кода в реализации элемента управления DLL и файл лицензии. Код состоит из двух (или возможно три) вызовов функций и далее — «лицензии строка», содержащего уведомление об авторском праве символьную строку. Эти вызовы и строка лицензии найдены в реализации элемента управления (. Файл CPP). Файл лицензии, созданные с помощью мастера управления ActiveX, является файлом с заявление об авторских правах. Он имеет имя, имя проекта с помощью. Расширение: лицензионное соглашение для примера образец. : ЛИЦЕНЗИОННОЕ СОГЛАШЕНИЕ. Лицензированный элемент управления должен сопровождаться файл лицензии при необходимости использования во время разработки.  
  
##  <a name="_core_creating_a_licensed_control"></a> Создание лицензированный элемент управления  
 При использовании мастера элементов управления ActiveX для создания платформы управления можно легко для включения поддержки лицензирования. При указании, что элемент управления должен иметь лицензию во время выполнения, мастер элементов управления ActiveX добавляет код в класс элемента управления для поддержки лицензирования. Код состоит из функции, использующие файл ключа и лицензий для проверки лицензии. Эти функции также могут быть изменены для настройки Лицензирование элементов управления. Дополнительные сведения о настройке лицензий см. в разделе [Настройка Лицензирование элементов управления ActiveX](#_core_customizing_the_licensing_of_an_activex_control) далее в этой статье.  
  
#### <a name="to-add-support-for-licensing-with-the-activex-control-wizard-when-you-create-your-control-project"></a>Чтобы добавить поддержку для лицензирования с помощью мастера элементов управления ActiveX, при создании проекта элемента управления  
  
1.  Используйте инструкции в [Создание элемента управления ActiveX MFC](../mfc/reference/creating-an-mfc-activex-control.md). **Параметры приложения** страница мастера элементов управления ActiveX содержит параметр, чтобы создать элемент управления с лицензией во время выполнения.  
  
 Мастер элементов управления ActiveX создает платформу управления ActiveX, который включает в себя базовую поддержку лицензирования. Подробное описание лицензирования кода см. в разделе Далее.  
  
##  <a name="_core_licensing_support"></a> Поддержка лицензирования  
 При использовании мастера элементов управления ActiveX для добавления поддержки лицензирования в элемент управления ActiveX, мастер элементов управления ActiveX добавляет код, который объявляет и реализует возможности лицензирования будет добавлен заголовок элемента управления и реализации файлы. Этот код состоит из `VerifyUserLicense` функции-члена и `GetLicenseKey` функция-член, который переопределить реализации по умолчанию, в [COleObjectFactory](../mfc/reference/coleobjectfactory-class.md) . Эти функции извлечения и проверки лицензии управления.  
  
> [!NOTE]
>  Третья функция-член `VerifyLicenseKey` не формируются мастера элементов управления ActiveX, но может быть переопределен для настройки поведения проверки ключа лицензии.  
  
 Эти функции-члены являются:  
  
-   [VerifyUserLicense](../mfc/reference/coleobjectfactory-class.md#verifyuserlicense)  
  
     Проверяет, что элемент управления позволяет использования во время разработки, проверьте компьютер на наличие файла лицензии для элемента управления. Эта функция вызывается платформой при обработке `IClassFactory2::GetLicInfo` и `IClassFactory::CreateInstanceLic`.  
  
-   [GetLicenseKey](../mfc/reference/coleobjectfactory-class.md#getlicensekey)  
  
     Запрашивает уникальный ключ из библиотеки DLL элемента управления. Этот раздел внедренных в приложение контейнера и использовать более поздней версии, в сочетании с `VerifyLicenseKey`, для создания экземпляра элемента управления. Эта функция вызывается платформой при обработке `IClassFactory2::RequestLicKey`.  
  
-   [VerifyLicenseKey](../mfc/reference/coleobjectfactory-class.md#verifylicensekey)  
  
     Проверяет, что внедренный ключ и уникальные ключи элемента управления совпадают. Это позволяет контейнера для создания экземпляра элемента управления для использования. Эта функция вызывается платформой при обработке `IClassFactory2::CreateInstanceLic` и может быть переопределен для проверки настроенного лицензионного ключа. Реализация по умолчанию выполняет сравнение строк. Дополнительные сведения см. в разделе [Настройка Лицензирование элементов управления ActiveX](#_core_customizing_the_licensing_of_an_activex_control)далее в этой статье.  
  
###  <a name="_core_header_file_modifications"></a> Изменения файла заголовка  
 Мастер элементов управления ActiveX переводит следующий код в файле заголовка элемента управления. В этом примере две функции-члены `CSampleCtrl`этого объекта `factory` объявлены, который проверяет наличие элемента управления. Файл: лицензионное соглашение и другой, извлекающий лицензионный ключ для использования в приложении, содержащей элемент управления:  
  
 [!code-cpp[NVC_MFC_AxUI#39](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_1.h)]  
  
###  <a name="_core_implementation_file_modifications"></a> Изменения файла реализации  
 Мастер элементов управления ActiveX помещает следующие две инструкции в файле реализации элемента управления для объявления имени файла лицензии и лицензии строки:  
  
 [!code-cpp[NVC_MFC_AxUI#40](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_2.cpp)]  
  
> [!NOTE]
>  При изменении `szLicString` каким-либо образом, необходимо также изменить первую строку в элементе управления. Файл: лицензионное соглашение или лицензирования будет работать неправильно.  
  
 Мастер элементов управления ActiveX помещает следующий код в файле реализации элемента управления для определения класса элемента управления `VerifyUserLicense` и `GetLicenseKey` функции:  
  
 [!code-cpp[NVC_MFC_AxUI#41](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_3.cpp)]  
  
 Наконец **мастер элементов управления ActiveX** вносит изменения в проект элемента управления. IDL-файл. **Лицензированных** добавляется ключевое слово объявления компонентного класса элемента управления, как показано в следующем примере:  
  
 [!code-cpp[NVC_MFC_AxUI#42](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_4.idl)]  
  
##  <a name="_core_customizing_the_licensing_of_an_activex_control"></a> Настройка Лицензирование элементов управления ActiveX  
 Поскольку `VerifyUserLicense`, `GetLicenseKey`, и `VerifyLicenseKey` объявляются как виртуальные функции-члены класса фабрики управления можно настроить лицензирования поведение элемента управления.  
  
 Например, можно указать несколько уровней лицензирования для элемента управления путем переопределения `VerifyUserLicense` или `VerifyLicenseKey` функции-члены. В этой функции может изменить какие свойства или методы предоставленные пользователю согласно было выявлено лицензионного уровня.  
  
 Можно также добавить код для `VerifyLicenseKey` функция, которая предоставляет настраиваемый метод, сообщая пользователю, управления созданием сбой. Например, в вашей `VerifyLicenseKey` поле функция-член можно отобразить сообщение о том, что элемент управления не удалось инициализировать и почему.  
  
> [!NOTE]
>  Другой способ настройки проверка лицензии для элемента управления ActiveX — проверьте регистрации базы данных для определенного раздела реестра, вместо вызова метода `AfxVerifyLicFile`. Пример реализации по умолчанию см. в разделе [изменения файла реализации](#_core_implementation_file_modifications) этой статьи.  
  
 Дополнительные сведения о вопросы лицензирования см. вопросы лицензирования в [обновление существующего элемента управления ActiveX](../mfc/upgrading-an-existing-activex-control.md).  
  
## <a name="see-also"></a>См. также  
 [Элементы ActiveX библиотеки MFC](../mfc/mfc-activex-controls.md)   
 [Мастер элементов ActiveX MFC](../mfc/reference/mfc-activex-control-wizard.md)


---
title: Элементы управления ActiveX в Интернете | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- ActiveX controls [MFC], creating
- ActiveX controls [MFC], Internet
- downloading data with ActiveX controls
- OLE controls [MFC], upgrading to ActiveX
- Internet applications [MFC], ActiveX controls
- networks [MFC], downloading with ActiveX controls
ms.assetid: 7ab943c8-2022-41df-9065-d629b616eeec
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: 02a4c2e8d9da553ffe14c8d9d061d11d7357c19c
ms.sourcegitcommit: 060f381fe0807107ec26c18b46d3fcb859d8d2e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2018
ms.locfileid: "36931981"
---
# <a name="activex-controls-on-the-internet"></a>Элементы управления ActiveX в Интернете
Элементы управления ActiveX — обновленная версия спецификации элемента управления OLE. Элементы управления являются основной архитектурой для разработки программных компонентов, которые могут использоваться в различных контейнерах, включая поддержкой COM веб-браузеров в Интернете. Любой элемент управления ActiveX могут быть элементом управления Интернет и можно добавить его функциональность активного документа или входить в состав веб-страницы. Элементы управления на веб-страницы могут взаимодействовать друг с другом с помощью сценариев.  
  
 Элементы управления ActiveX не ограничиваются Интернета. Элемент управления ActiveX могут также использоваться в любом контейнере при условии, что элемент управления поддерживает интерфейсы, необходимые для этого контейнера.  
  
 **Элементы управления ActiveX имеют несколько преимуществ, включая:**  
  
-   Меньше необходимые интерфейсы, чем предыдущие элементы управления OLE.  
  
-   Возможность иметь окон и активным всегда на месте.  
  
 **Чтобы элемент управления ActiveX, элемент управления должен:**  
  
-   Поддержка `IUnknown` интерфейса.  
  
-   Быть COM-объектом.  
  
-   Экспорт **DLLRegisterServer** и **DLLUnRegisterServer**.  
  
-   Поддерживает дополнительные интерфейсы, необходимые для функции.  
  
## <a name="making-your-existing-controls-internet-friendly"></a>Внесение существующих элементов управления Интернет-понятного имени  
 Проектирование элемента управления, который будет работать в среде Интернета необходимо учитывать скорости передачи сравнительно мало в Интернете. Можно использовать существующие элементы управления; Однако существуют действия, которые необходимо предпринять для уменьшения размера вашего кода, а также загружают асинхронно свойства элемента управления.  
  
 Чтобы повысить производительность для элементов управления, следуйте приведенным ниже советам эффективность вопросы:  
  
-   Реализуйте методы, описанные в статье [элементы управления ActiveX: оптимизация](../mfc/mfc-activex-controls-optimization.md).  
  
-   Рассмотрим, как создать экземпляр элемента управления.  
  
-   Быть асинхронным; не выдерживает других программ.  
  
-   Загрузите данные в небольших блоков.  
  
     При загрузке больших потоков, таких как растровые изображения или видео данные, доступ к данных элемента управления асинхронно совместно с контейнером. Получение данных в добавочное или последовательной манере, работать совместно с другими элементами управления, которые может также извлечение данных. Также можно асинхронную загрузку кода.  
  
-   Загрузите код и свойства в фоновом режиме.  
  
-   Пользовательского интерфейса становится активной, как можно быстрее.  
  
-   Рассмотрим способ хранения постоянных данных, свойства и большие объемы данных больших двоичных объектов (например, растровое изображение данных изображения или видео).  
  
     Элементы управления с значительное количество постоянных данных, таких как большие точечные рисунки или AVI-файлов, требуют особого внимания к загрузке метода. Документа или страницы можно становятся видимыми, как можно быстрее и пользователи могут взаимодействовать со страницей, а элементы управления получают данные в фоновом режиме.  
  
-   Писать эффективные процедуры для поддержания объем кода и время выполнения.  
  
     Небольших элементов управления кнопку и метку, с помощью всего нескольких байтов постоянные данные, пригодные для использования в среде Интернета и рабочих также и в браузерах.  
  
-   Рассмотрите возможность передачи выполняется в контейнер.  
  
     Уведомите контейнера хода выполнения асинхронной загрузки, когда пользователь может запустить взаимодействовать со страницей, а после завершения загрузки. Контейнер можно отображать ход выполнения (таких как процент завершения) для пользователя.  
  
-   Рассмотрим, как элементы управления регистрируются на клиентском компьютере.  
  
## <a name="creating-a-new-activex-control"></a>Создание нового элемента управления ActiveX  
 При создании нового элемента управления с использованием мастера приложений, можно включить поддержку асинхронных моникеров, а также другие виды оптимизации. Чтобы добавить поддержку для асинхронной загрузки свойства элемента управления, выполните следующие действия.  
  
#### <a name="to-create-your-project-using-the-mfc-activex-control-wizard"></a>Для создания проекта с помощью мастера элементов управления ActiveX MFC  
  
1.  Нажмите кнопку **New** на **файл** меню.  
  
2.  Выберите **мастер элементов управления ActiveX MFC** из Visual C++ проектов и имя проекта.  
  
3.  На **параметры управления** выберите **асинхронно загружает свойства**. При выборе этого параметра устанавливает свойство состояние готовности и событие готовности изменения состояния для вас.  
  
     Можно также выбрать другие виды оптимизации, такие как **активации без окна**, который описан в [элементы управления ActiveX: оптимизация](../mfc/mfc-activex-controls-optimization.md).  
  
4.  Выберите **Готово** для создания проекта.  
  
#### <a name="to-create-a-class-derived-from-cdatapathproperty"></a>Чтобы создать класс, производный от CDataPathProperty  
  
1.  Создайте класс, производный от `CDataPathProperty`.  
  
2.  В каждом из исходные файлы, которые содержатся в файле заголовка для элемента управления добавьте файл заголовка для этого класса перед ним.  
  
3.  В этом классе переопределите `OnDataAvailable`. Эта функция вызывается каждый раз, когда данные недоступны для отображения. Когда данные становятся доступны, можно настроить обработку любым способом, выбрать, например, постепенно подготовки к просмотру.  
  
     Фрагмент кода ниже приведен простой пример постепенно отображения данных в элемент управления редактированием. Обратите внимание на использование флага **BSCF_FIRSTDATANOTIFICATION** очистить поле редактирования.  
  
     [!code-cpp[NVC_MFCActiveXControl#1](../mfc/codesnippet/cpp/activex-controls-on-the-internet_1.cpp)]  
  
     Обратите внимание, что необходимо включить AFXCMN. H, чтобы использовать `CListCtrl` класса.  
  
4.  Когда элемент управления общей состояние изменяется (например, от загрузки на инициализированный или интерактивного пользователя), вызов `COleControl::InternalSetReadyState`. Если элемент управления имеет свойство данных только один путь, можно добавить код в **BSCF_LASTDATANOTIFICATION** для уведомления контейнера, что загрузка завершена. Пример:  
  
     [!code-cpp[NVC_MFCActiveXControl#2](../mfc/codesnippet/cpp/activex-controls-on-the-internet_2.cpp)]  
  
5.  Переопределите метод `OnProgress`. В `OnProgress`, передаются номер, показывающий максимальный диапазон и число отображается расстояние вдоль текущей загрузки именно. Эти номера можно использовать для отображения состояния, например процент завершения для пользователя.  
  
 Следующая процедура добавляет свойство управления, чтобы использовать только производный класс.  
  
#### <a name="to-add-a-property"></a>Добавление свойства  
  
1.  В **представление классов**, щелкните правой кнопкой мыши интерфейс под узлом библиотеки и выберите **добавить**, затем **добавить свойство**. Это приведет к запуску **мастер добавления свойств**.  
  
2.  В **мастер добавления свойств**выберите **методов Set или Get** переключатель, тип **имя свойства**, например, EditControlText и выберите BSTR как **Тип свойства**.  
  
3.  Нажмите кнопку **Готово**.  
  
4.  Объявите переменную-член для вашего `CDataPathProperty`-класса, производного класса элемента управления ActiveX.  
  
     [!code-cpp[NVC_MFCActiveXControl#3](../mfc/codesnippet/cpp/activex-controls-on-the-internet_3.h)]  
  
5.  Реализуйте методы `Get/Set`. Для `Get`, возвращается строка. Для `Set`, загрузить свойство и вызвать `SetModifiedFlag`.  
  
     [!code-cpp[NVC_MFCActiveXControl#4](../mfc/codesnippet/cpp/activex-controls-on-the-internet_4.cpp)]  
  
6.  В [DoPropExchange](../mfc/reference/colecontrol-class.md#dopropexchange), добавьте следующую строку:  
  
     [!code-cpp[NVC_MFCActiveXControl#5](../mfc/codesnippet/cpp/activex-controls-on-the-internet_5.cpp)]  
  
7.  Переопределить [ResetData](../mfc/reference/cdatapathproperty-class.md#resetdata) известить свойство, чтобы сбросить свой элемент управления, добавив эту строку:  
  
     [!code-cpp[NVC_MFCActiveXControl#6](../mfc/codesnippet/cpp/activex-controls-on-the-internet_6.cpp)]  
  
## <a name="deciding-whether-to-derive-from-cdatapathproperty-or-ccacheddatapathproperty"></a>Принятие решения об являются производными от CDataPathProperty или CCachedDataPathProperty  
 Предыдущий пример описывает шаги для извлечения свойства элемента управления из `CDataPathProperty`. Это хороший вариант, если вы загружаете данные в реальном времени, часто изменяются, и по которым не требуется хранить все данные, но только текущее значение. Например, элемент управления биржевые сводки.  
  
 Можно также создавать производные `CCachedDataPathProperty`. В этом случае загруженные данные кэшируются в памяти файла. Это хороший вариант, если необходимо сохранить все загруженные данные — например, элемент управления, который постепенно отображает растровое изображение. В этом случае класс имеет переменную-член с данными:  
  
 `CMemFile m_Cache;`  
  
 В классе элемента управления ActiveX, можно использовать этот размещенный в памяти файл в `OnDraw` для отображения данных. В элементе управления ActiveX `CCachedDataPathProperty`-производного класса Переопределите функцию-член `OnDataAvailable` и сделать недействительным элемент управления после вызова реализации базового класса.  
  
 [!code-cpp[NVC_MFCActiveXControl#7](../mfc/codesnippet/cpp/activex-controls-on-the-internet_7.cpp)]  
  
## <a name="downloading-data-asynchronously-using-activex-controls"></a>Загрузка данных в асинхронном режиме с помощью элементов управления ActiveX  
 Загрузка данных в сети должна быть выполнена асинхронно. Преимущество этого случае, если передается большой объем данных или используется медленное подключение, процесс загрузки не будет блокировать другие процессы на клиентском компьютере.  
  
 Асинхронные моникеры предоставляют способ загрузки данных асинхронно по сети. Операция чтения асинхронного моникера возвращает немедленно, даже если операция не завершена.  
  
 Например если только 10 байт доступны и чтения вызывается асинхронно с файлом 1 КБ, чтения не блокирует, но возвращает которых в настоящее время доступна 10 байт.  
  
 Реализации [асинхронных моникеров](../mfc/asynchronous-monikers-on-the-internet.md) с помощью `CAsyncMonikerFile` класса. Тем не менее, можно использовать элементы управления ActiveX `CDataPathProperty` класс, который является производным от `CAsyncMonikerFile`, чтобы реализовать свойства асинхронного элемента управления.  
  
 В образце ASYNDOWN показано, как настроить асинхронном цикле, используя таймеры для чтения данных. ASYNDOWN подробно описывается в статье базы знаний «Практическое руководство: AsyncDown демонстрирует асинхронные данных загрузка» (Q177244) и доступны для загрузки из центра загрузки Майкрософт. (Дополнительные сведения о загрузке файлов из центра загрузки Майкрософт, см. в статье «Как для получения службы поддержки Майкрософт файлы из сети» (Q119591) в базе знаний Майкрософт.) Можно найти статьи базы знаний в [ http://support.microsoft.com/support ](http://support.microsoft.com/support).  
  
 Основной метод, используемый в ASYNDOWN является задание таймера в **CDataPathProperty::OnDataAvailable** для указания возможности данных. При получении сообщения таймера, приложение считывает в 128 байт блоки данных и заполняет элемент управления редактированием. Если данные недоступны при обработке сообщения таймера, таймер отключается. `OnDataAvailable` Включение таймера, если дополнительные данные получены более поздней версии.  
  
## <a name="displaying-a-control-on-a-web-page"></a>Отображение элемента управления на веб-странице  
 Ниже приведен пример тег объекта и атрибуты для добавления элемента управления на веб-странице.  
  
 `<OBJECT`  
  
 `CLASSID="clsid:FC25B780-75BE-11CF-8B01-444553540000"`  
  
 `CODEBASE="/ie/download/activex/iechart.ocx"`  
  
 `ID=chart1`  
  
 `WIDTH=400`  
  
 `HEIGHT=200`  
  
 `ALIGN=center`  
  
 `HSPACE=0`  
  
 `VSPACE=0`  
  
 `>`  
  
 `<PARAM NAME="BackColor" value="#ffffff">`  
  
 `<PARAM NAME="ForeColor" value="#0000ff">`  
  
 `<PARAM NAME="url" VALUE="/ie/controls/chart/mychart.txt">`  
  
 `</OBJECT>`  
  
## <a name="updating-an-existing-ole-control-to-use-new-activex-control-features"></a>Обновление существующего элемента управления OLE для использования новых возможностей элементов управления ActiveX  
 Если элемент управления OLE был создан с помощью версии Visual C++ до 4.2, существуют действия, которые можно предпринять для повышения производительности и расширить его функциональные возможности. Подробное рассмотрение этих изменений см. в разделе [элементы управления ActiveX: оптимизация](../mfc/mfc-activex-controls-optimization.md).  
  
 При добавлении поддержки асинхронного свойства в существующий элемент управления, необходимо добавить свойство состояние готовности и `ReadyStateChange` событие самостоятельно. В конструкторе для элемента управления добавьте следующую команду:  
  
 [!code-cpp[NVC_MFCActiveXControl#8](../mfc/codesnippet/cpp/activex-controls-on-the-internet_8.cpp)]  
  
 Обновит состояние готовности, как код загружается путем вызова [COleControl::InternalSetReadyState](../mfc/reference/colecontrol-class.md#internalsetreadystate). Централизованно, вы можете вызвать `InternalSetReadyState` из `OnProgress` переопределение `CDataPathProperty`-производного класса.  
  

  
## <a name="see-also"></a>См. также  
 [Задачи программирования для Интернет MFC](../mfc/mfc-internet-programming-tasks.md)   
 [Основы программирования для интернет-решений MFC](../mfc/mfc-internet-programming-basics.md)


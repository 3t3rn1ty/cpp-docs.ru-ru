---
title: "TN028: Поддержка контекстной справки | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-windows
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords: vc.help
dev_langs: C++
helpviewer_keywords:
- context-sensitive Help [MFC], MFC applications
- TN028
- resource identifiers, context-sensitive Help
ms.assetid: 884f1c55-fa27-4d4c-984f-30907d477484
caps.latest.revision: "13"
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: d8054fe4fae4aafa88c34833a5a2a92a6b9b44bf
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="tn028-context-sensitive-help-support"></a>TN028. Поддержка контекстной справки
Эта заметка описывает правила назначения идентификаторов контексты справки и других проблем справки в MFC. Поддержка контекстной справки требуется компилятор справки, который доступен в Visual C++.  
  
> [!NOTE]
>  Помимо реализации контекстной справки, с помощью WinHelp, MFC также поддерживает использование справки HTML. Дополнительные сведения об этой поддержки и программирование с использованием HTML-справки см. в разделе [HTML-справки: Справка по Context-Sensitive для ваших программ](../mfc/html-help-context-sensitive-help-for-your-programs.md).  
  
## <a name="types-of-help-supported"></a>Типы поддерживаемых справки  
 Существует два вида контекстной справки, которые реализованы в приложениях Windows. Первый, называется «Справки F1» включает в себя запуск WinHelp с помощью соответствующего контекста, на основе текущего активного объекта. Второй — в режиме «Shift + F1». В этом режиме изменение курсора мыши на курсор справки, и пользователь переходит к щелкните объект. На этом этапе WinHelp запускается для предоставления справки для объекта, который щелкнул пользователь.  
  
 Microsoft Foundation Classes реализовать оба этих форм справки. Кроме того платформа поддерживает две команды простой справки указателя справки и с помощью справки.  
  
## <a name="help-files"></a>Файлы справки  
 Microsoft Foundation classes предполагается один файл справки. Этот файл справки должен иметь одно и то же имя и путь приложения. Например если исполняемый файл — C:\MyApplication\MyHelp.exe файл справки необходимо C:\MyApplication\MyHelp.hlp. Задайте путь через `m_pszHelpFilePath` переменной-члена [CWinApp-класс](../mfc/reference/cwinapp-class.md).  
  
## <a name="help-context-ranges"></a>Диапазоны контекст справки  
 Реализация по умолчанию MFC требуется программа следовать правилам, некоторые сведения о назначении контекста справки идентификаторы. Эти правила являются диапазон идентификаторов выделенного для определенных элементов управления. Эти правила можно переопределить, указав различные реализации различных функций-членов, связанных со справкой.  
  
```  
0x00000000 - 0x0000FFFF : user defined  
0x00010000 - 0x0001FFFF : commands (menus/command buttons)  
0x00010000 + ID_  
(note: 0x18000-> 0x1FFFF is the practical range since command IDs are>=0x8000)  
0x00020000 - 0x0002FFFF : windows and dialogs  
0x00020000 + IDR_  
(note: 0x20000-> 0x27FFF is the practical range since IDRs are <= 0x7FFF)  
0x00030000 - 0x0003FFFF : error messages (based on error string ID)  
0x00030000 + IDP_  
0x00040000 - 0x0004FFFF : special purpose (non-client areas)  
0x00040000 + HitTest area  
0x00050000 - 0x0005FFFF : controls (those that are not commands)  
0x00040000 + IDW_  
```  
  
## <a name="simple-help-commands"></a>Команды простой «Справка»  
 Существует два простых команд справки, реализованным в Microsoft Foundation Classes:  
  
-   ID_HELP_INDEX, который реализован [CWinApp::OnHelpIndex](../mfc/reference/cwinapp-class.md#onhelpindex)  
  
-   ID_HELP_USING, который реализован [CWinApp::OnHelpUsing](../mfc/reference/cwinapp-class.md#onhelpusing)  
  
 Первая команда показывает индекса справки для приложения. Во втором показан справку по использованию программы WinHelp.  
  
## <a name="context-sensitive-help-f1-help"></a>Контекстная справка (Справка F1)  
 Клавиши F1, обычно преобразуется в команду с Идентификатором `ID_HELP` , ускоритель, помещаются в таблицу сочетаний клавиш для главного окна. `ID_HELP` Команды также можно создавать с помощью кнопки с Идентификатором `ID_HELP` в окне главного окна или диалогового окна.  
  
 Независимо от того, как `ID_HELP` создается команда, оно будет направлено как обычной командной, пока не достигнет обработчика команд. Дополнительные сведения об архитектуре маршрутизация команд MFC см. [Технические заметки 21](../mfc/tn021-command-and-message-routing.md). Если приложение имеет справки включен, `ID_HELP` команда будет обрабатываться [CWinApp::OnHelp](../mfc/reference/cwinapp-class.md#onhelp). Объект приложения получает справочное сообщение и затем направляет команду соответствующим образом. Это необходимо, поскольку маршрутизация команд по умолчанию не достаточно для определения наиболее контекста.  
  
 `CWinApp::OnHelp`предпринимает попытку запустить WinHelp в следующем порядке:  
  
1.  Проверяет наличие активной `AfxMessageBox` вызов с идентификатором справки. Если отображается сообщение, в данный момент активен, WinHelp запускается с контекстом, подходящим для этого окна сообщения.  
  
2.  Отправляет сообщение WM_COMMANDHELP активного окна. Если это окно не отвечает, запустив WinHelp, то же сообщение затем отправляется предков этого окна до обработки сообщения или текущее окно является окном верхнего уровня.  
  
3.  Отправляет команду ID_DEFAULT_HELP главного окна. Это вызывает справку по умолчанию. Эта команда обычно сопоставляется `CWinApp::OnHelpIndex`.  
  
 Чтобы глобально переопределить значения по умолчанию идентификатор базового (например 0x10000 для команд и 0x20000 ресурсы, такие как диалоговые окна), приложения должны переопределять [CWinApp::WinHelp](../mfc/reference/cwinapp-class.md#winhelp).  
  
 Чтобы переопределить эту функцию и способом, что определяется контекстом справки, должен обрабатывать сообщение WM_COMMANDHELP. Вы можете для обеспечения более точной справки маршрутизации не предоставляет платформу, как только происходит как глубоко текущее дочернее окно MDI. Можно также предоставить более конкретные справку для определенного окна или диалогового окна, возможно, основываясь на текущей внутреннее состояние объекта или активный элемент управления в диалоговом окне.  
  
## <a name="wmcommandhelp"></a>WM_COMMANDHELP  
  
```  
 
afx_msg LRESULT CWnd::OnCommandHelp(WPARAM wParam, LPARAM lParam)  
 
```  
  
 WM_COMMANDHELP является закрытого сообщения Windows MFC, получаемого активного окна при запросе справки. Когда окно получает это сообщение, оно может вызвать `CWinApp::WinHelp` с контекстом, который соответствует внутреннее состояние окна.  
  
 `lParam`  
 Содержит контекст справки в настоящее время недоступно. `lParam`равно нулю, если контекст справки не было определено. Реализация `OnCommandHelp` можно использовать идентификатор контекста в `lParam` для определения различных контекста или просто передать его в `CWinApp::WinHelp`.  
  
 `wParam`  
 Не используется и должен быть равен нулю.  
  
 Если `OnCommandHelp` вызовов функций `CWinApp::WinHelp`, он должен возвращать `TRUE`. Возвращение `TRUE` останавливает маршрутизации эту команду для других классов и других окон.  
  
## <a name="help-mode-shiftf1-help"></a>Режим справки (Справка Shift + F1)  
 Это вторая форма контекстной справки. Как правило этот режим вводится, нажав клавиши SHIFT + F1 или с помощью панели инструментов или меню. Оно реализовано как команду (**ID_CONTEXT_HELP**). Обработчик фильтра сообщений не используется для преобразования этой команды при модального диалогового окна или меню активен, поэтому эта команда доступна только для пользователя при выполнении цикла обработки сообщений приложения (`CWinApp::Run`).  
  
 После ввода в этом режиме, курсор мыши справки отображается по всем областям приложения, даже если приложение обычно отобразит собственный курсора для этой области (например, изменяющей размер границы вокруг окна). Пользователь является возможность использовать мышь или клавиатуру для выбора команды. Вместо выполнения команды, отображается справка по этой команде. Кроме того пользователь может щелкнуть объект отображается на экране, таких как кнопка на панели инструментов и будет отображаться Справка для этого объекта. Этот режим справки обеспечивается `CWinApp::OnContextHelp`.  
  
 Во время выполнения этот цикл все сочетания входных данных неактивна, за исключением ключи, доступа к меню. Кроме того, преобразование команды по-прежнему выполняется через `PreTranslateMessage` чтобы разрешить пользователю нажмите сочетание клавиш и получение справки по этой команде.  
  
 Если определенный переводы или действиях, поместите в `PreTranslateMessage` функцию, которая не должен быть отображен во время режим справки клавиши SHIFT + F1, следует проверить `m_bHelpMode` членом `CWinApp` перед выполнением этих операций. `CDialog` Реализация `PreTranslateMessage` проверяет это перед вызовом `IsDialogMessage`, например. Таким образом отключаются «диалогового окна «нажатие клавиши на немодальное диалоговое окно в режиме клавиши SHIFT + F1. Кроме того `CWinApp::OnIdle` по-прежнему вызывается во время этого цикла.  
  
 Если пользователь выбирает команду меню, она обрабатывается как справку по этой команде (через **WM_COMMANDHELP**, см. ниже). Если пользователь щелкает видимой области окна приложения, производится относительно щелчок вне окна или клиент, нажмите кнопку. `OnContextHelp`сопоставление дескрипторов неклиентской щелкает щелчков клиента автоматически. Если клиент, нажмите кнопку, после этого он отправляет **WM_HELPHITTEST** окна, который был щелкнут. Если это окно возвращает ненулевое значение, это значение используется как контекст для справки. Если он возвращает значение 0, `OnContextHelp` пытается родительского окна (и произошел сбой, его родителя и так далее). Если не удается определить контекст справки, по умолчанию используется для отправки **ID_DEFAULT_HELP** в главном окне (обычно) сопоставляется `CWinApp::OnHelpIndex`.  
  
## <a name="wmhelphittest"></a>WM_HELPHITTEST  
  
```  
 
afx_msg LRESULT CWnd::OnHelpHitTest(
WPARAM, LPARAM lParam)  
```  
  
 **WM_HELPHITTEST** сообщение закрытый windows MFC, полученные при нажатии клавиши SHIFT + F1 справка в режиме активного окна. Когда окно получает это сообщение, он возвращает DWORD идентификатор справки для использования, WinHelp.  
  
 LOWORD(lParam)  
 содержит устройства координат по оси x, где выполнен щелчок относительно клиентской области окна.  
  
 HIWORD(lParam)  
 содержит координату по оси y.  
  
 `wParam`  
 Не используется и должен быть равен нулю. Если возвращаемое значение имеет ненулевое значение, WinHelp вызывается с этим контекстом. Если возвращаемое значение равно нулю, родительское окно отправляется запрос для получения справки.  
  
 Во многих случаях можно использовать код проверки нажатия, возможно, уже имеется. В разделе реализации **CToolBar::OnHelpHitTest** пример обработки **WM_HELPHITTEST** сообщений (код использует код проверки нажатия, используемый для кнопок и подсказки в `CControlBar`).  
  
## <a name="mfc-application-wizard-support-and-makehm"></a>Поддержка мастера приложений MFC и MAKEHM  
 Мастер приложений MFC создает файлы, необходимые для построения файла справки (файлы .cnt .hpj). Она также включает ряд готовых RTF-файлы, которые принимаются компилятором справки Майкрософт. Во многих разделах завершены, но некоторые может потребоваться внести изменения для конкретного приложения.  
  
 Автоматическое создание файла «help сопоставления» поддерживается служебная программа MAKEHM. Программа MAKEHM может преобразовывать РЕСУРСОВ приложения. H-файл сопоставления файла справки. Пример:  
  
```  
#define IDD_MY_DIALOG   2000  
#define ID_MY_COMMAND   150  
```  
  
 преобразуется в:  
  
```  
HIDD_MY_DIALOG    0x207d0  
HID_MY_COMMAND    0x10096  
```  
  
 Этот формат совместим с механизмом компилятор справки, который сопоставляет идентификаторы контекста (номера справа) с именами раздела (символы слева).  
  
 Исходный код для MAKEHM доступен в образец программ программирования MFC [MAKEHM](../visual-cpp-samples.md).  
  
## <a name="adding-help-support-after-running-the-mfc-application-wizard"></a>Добавление поддержки справки после выполнения мастера приложений MFC  
 Добавление справки приложения рекомендуется установить флажок «Справка по Context-sensitive» на странице "Дополнительные функции" мастера приложений MFC перед созданием приложения. В этом случае мастер приложений MFC автоматически добавляет записей карты сообщений, необходимые для вашего `CWinApp`-производный класс для поддержки справки.  
  
## <a name="help-on-message-boxes"></a>Получить справку в окнах сообщений  
 Справку в окнах сообщений (иногда называется предупреждения) поддерживается с помощью `AfxMessageBox` функция, программа-оболочка для `MessageBox` Windows API.  
  
 Существуют две версии `AfxMessageBox`, один — для использования с идентификатора строки, а другой для использования с указателем на строку (`LPCSTR`):  
  
```  
int AFXAPI AfxMessageBox(LPCSTR lpszText,
    UINT nType,
    UINT nIDHelp);

int AFXAPI AfxMessageBox(UINT nIDPrompt,
    UINT nType,
    UINT nIDHelp);
```  
  
 В обоих случаях имеется необязательный идентификатора справки.  
  
 В первом случае nIDHelp по умолчанию — 0, означающее Справка для данного окна сообщения. Если пользователь нажимает клавишу F1, например сообщение флажок активен, пользователь не получит справки (даже если приложение поддерживает справки). Если это нежелательно, для nIDHelp необходимо указать идентификатор справки.  
  
 Во втором случае значением по умолчанию для nIDHelp — -1, что означает, что идентификатор справки совпадает со значением nIDPrompt. Справка будет работать только в том случае, если приложение включен справки, конечно). Необходимо предоставить 0 для nIDHelp, если требуется наличие отсутствует поддержка справки в окне сообщения. Следует требуется, чтобы сообщение справки включен, но нужен идентификатор справочные чем nIDPrompt, просто укажите положительное значение для nIDHelp, отличному от nIDPrompt.  
  
## <a name="see-also"></a>См. также  
 [Технические примечания по номеру](../mfc/technical-notes-by-number.md)   
 [Технические примечания по категории](../mfc/technical-notes-by-category.md)


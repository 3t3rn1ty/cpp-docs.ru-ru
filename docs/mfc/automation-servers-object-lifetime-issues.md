---
title: "Серверы автоматизации. Вопросы времени жизни объектов | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "Серверы автоматизации, время существования объекта"
  - "время существования, сервер автоматизации"
  - "объекты [C++], время существования"
  - "серверы, время жизни автоматизации"
ms.assetid: 342baacf-4015-4a0e-be2f-321424f1cb43
caps.latest.revision: 11
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 7
---
# Серверы автоматизации. Вопросы времени жизни объектов
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Когда клиент автоматизации создает или активировать элемент OLE, сервер передает клиентом указатель на этот объект.  Клиент задает ссылку на объект OLE через вызов функции [IUnknown::AddRef](http://msdn.microsoft.com/library/windows/desktop/ms691379).  Эта ссылка действует до тех пор, пока клиент не вызовет [IUnknown::Release](http://msdn.microsoft.com/library/windows/desktop/ms682317). \(Клиентским приложениям, созданном с класс OLE библиотеки Microsoft Foundation Class не требуется выполнять эти; платформа выполняется\). Система сама OLE и сервер могут устанавливать ссылки на объект.  Сервер не должен удалить объект, если внешние ссылки на объект остаются действительными.  
  
 Платформа поддерживает внутреннее количество ссылок на стороне сервера любой объект, производный от [CCmdTarget](../Topic/CCmdTarget%20Class.md).  Этот счетчик обновляется, когда клиент автоматизации или другую сущность добавляют и выпуски ссылку на объект.  
  
 Когда число ссылок будет 0 платформа вызывает виртуальная функция [CCmdTarget::OnFinalRelease](../Topic/CCmdTarget::OnFinalRelease.md).  Реализация по умолчанию этого вызовы функций оператор **удалить** для удаления этого объекта.  
  
 Библиотеки Microsoft Foundation Class предоставляет дополнительные средства для управления расширения функциональности приложения во внешних клиентов имеются ссылки на объекты приложения.  Помимо сохранения числа ссылок к каждому объекту, серверы поддерживают глобальное число активных объектов.  Глобальные функции [AfxOleLockApp](../Topic/AfxOleLockApp.md) и [AfxOleUnlockApp](../Topic/AfxOleUnlockApp.md) в ходе обновления приложения число активных объектов.  Если это число отлично от нуля, приложение не заканчивается, когда пользователь выбирает закрыть меню или выхода из системы из меню "Файл".  Вместо этого главное окно приложения скрыто \(но не уничтоженному\) до тех пор, пока всех ожидающих запросов клиентов, не будут выполнены.  Как правило, `AfxOleLockApp` и `AfxOleUnlockApp` вызываются в конструкторах деструкторах и, соответственно, классов, поддержки автоматизации.  
  
 В некоторых случаях выполнение сервер для выполнения пока клиент по\-прежнему содержит ссылку на объект.  Например, ресурс, на котором сервер зависит могут стать недоступными, что может возникнуть ошибка сервера.  Пользователь также может закрыть серверный документ, содержащий объекты, на которые ссылаются другие приложения.  
  
 В [!INCLUDE[winSDK](../atl/includes/winsdk_md.md)] см. в разделе `IUnknown::AddRef` и `IUnknown::Release`.  
  
## См. также  
 [Серверы автоматизации](../mfc/automation-servers.md)   
 [AfxOleCanExitApp](../Topic/AfxOleCanExitApp.md)
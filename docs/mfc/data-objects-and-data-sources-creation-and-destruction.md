---
title: "Объекты и источники данных. Создание и деструкция | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "объекты данных [С++], создание"
  - "объекты данных [С++], уничтожение"
  - "объекты источников данных [C++], создание"
  - "объекты источников данных [C++], уничтожение"
  - "источники данных [C++], и объекты данных"
  - "источники данных [C++], создание"
  - "источники данных [C++], уничтожение"
  - "источники данных [C++], роль"
  - "уничтожение объектов данных"
  - "уничтожение [C++], объекты данных"
  - "уничтожение [C++], источники данных"
  - "создание объектов [C++], объекты источников данных"
ms.assetid: ac216d54-3ca5-4ce7-850d-cd1f6a90d4f1
caps.latest.revision: 14
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 10
---
# Объекты и источники данных. Создание и деструкция
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Как описано в статье [Объекты и источники данных \(OLE\)](../mfc/data-objects-and-data-sources-ole.md), объекты и источники данных представляют обе стороны передачи данных.  В этой статье объясняется, когда нужно создавать и удалять эти объекты и источники для правильной передачи данных. В том числе описываются следующие операции:  
  
-   [создание объектов данных;](#_core_creating_data_objects)  
  
-   [уничтожение объектов данных;](#_core_destroying_data_objects)  
  
-   [создание источников данных;](#_core_creating_data_sources)  
  
-   [уничтожение источников данных.](#_core_destroying_data_sources)  
  
##  <a name="_core_creating_data_objects"></a> Создание объектов данных  
 Объекты данных используются конечным приложением: клиентом или сервером.  Объект данных в конечном приложении — это один конец соединения между исходным и конечным приложениями.  Объект данных в конечном приложении используется для доступа к данным источника данных и взаимодействия с ними.  
  
 Существует две стандартные ситуации, когда требуется объект данных.  Первая ситуация: данные переносятся в приложение с помощью перетаскивания.  Вторая ситуация: выбор команды "Вставка" или "Специальная вставка" в меню "Правка".  
  
 В первой ситуации необходимо создать объект данных.  Указатель на существующий объект данных будет передан функции `OnDrop`.  Этот объект данных создается платформой как часть операции перетаскивания и также будут уничтожен платформой.  Это не всегда так при вставке другим способом.  Подробнее: [Уничтожение объектов данных](#_core_destroying_data_objects).  
  
 Если приложение выполняет вставку или специальную вставку, вам необходимо создать объект `COleDataObject` и вызвать его функцию\-член `AttachClipboard`.  При этом объект данных связывается с данными в буфере обмена.  Затем можно использовать этот объект данных в функции вставки.  
  
##  <a name="_core_destroying_data_objects"></a> Уничтожение объектов данных  
 Если следовать схеме, описанной в разделе [Создание объектов данных](#_core_creating_data_objects), уничтожение объектов данных становится тривиальным аспектом передачи данных.  Объект данных, который был создан в функции вставки, будет уничтожен MFC при возврате из функции вставки.  
  
 Если использовать другой способ обработки операций вставки, необходимо убедиться, что объект данных уничтожается после завершения вставки.  До уничтожения объекта данных никакое приложение не сможет успешно скопировать данные в буфер обмена.  
  
##  <a name="_core_creating_data_sources"></a> Создание источников данных  
 Источники данных используются источником передачи данных, которым может быть клиент или сервер.  Источник данных в исходном приложении — это один конец соединения между исходным и конечным приложениями.  Объект данных в конечном приложении используется для взаимодействия с данными источника данных.  
  
 Источники данных создаются, когда приложению требуется скопировать данные в буфер обмена.  Типичный сценарий выполняется следующим образом.  
  
1.  Пользователь выбирает некоторые данные.  
  
2.  Пользователь выбирает команду **Копировать** \(или **Вырезать**\) в меню **Правка** или начинает операцию перетаскивания.  
  
3.  В зависимости от структуры программы приложение создает объект `COleDataSource` или объект класса, производного от `COleDataSource`.  
  
4.  Выбранные данные вставляются в источник данных путем вызова одной из функций в группе `COleDataSource::CacheData` или `COleDataSource::DelayRenderData`.  
  
5.  Приложение вызывает функцию\-член `SetClipboard` \(или `DoDragDrop`, если это операция перетаскивания\) объекта, созданного на шаге 3.  
  
6.  Если это операция **Вырезать**  или `DoDragDrop` возвращает `DROPEFFECT_MOVE`, данные, выбранные на шаге 1, удаляется из документа.  
  
 Этот сценарий реализуется в примерах MFC OLE [OCLIENT](../top/visual-cpp-samples.md) и [HIERSVR](../top/visual-cpp-samples.md).  Посмотрите на источник производного от `CView` класса каждого приложения для всех функций, за исключением `GetClipboardData` и `OnGetClipboardData`.  Эти две функции находятся в реализации производных от `COleClientItem` или `COleServerItem` классов.  Эти примеры служат хорошим примером реализации этих концепций.  
  
 Еще одна ситуация, в которой может потребоваться создать объект `COleDataSource`, возникает при изменении поведения операции перетаскивания по умолчанию.  Подробнее: [Перетаскивание: настройка](../Topic/Drag%20and%20Drop:%20Customizing.md).  
  
##  <a name="_core_destroying_data_sources"></a> Уничтожение источников данных  
 Источники данных должно уничтожить приложение, которое в данный момент отвечает за них.  При передаче источника данных OLE, например при вызове [COleDataSource::DoDragDrop](../Topic/COleDataSource::DoDragDrop.md), необходимо вызвать **InternalRelease \-\> pDataSrc**.  Пример:  
  
 [!code-cpp[NVC_MFCListView#1](../mfc/codesnippet/CPP/data-objects-and-data-sources-creation-and-destruction_1.cpp)]  
  
 Если вы не передали источник данных OLE, то вы отвечаете за его уничтожение, как для любого типичного объекта C\+\+.  
  
 Подробнее см. в разделах [Перетаскивание](../mfc/drag-and-drop-ole.md), [Буфер обмена](../mfc/clipboard.md) и [Обработка объектов и источников данных](../mfc/data-objects-and-data-sources-manipulation.md).  
  
## См. также  
 [Объекты и источники данных \(OLE\)](../mfc/data-objects-and-data-sources-ole.md)   
 [COleDataObject Class](../mfc/reference/coledataobject-class.md)   
 [COleDataSource Class](../mfc/reference/coledatasource-class.md)
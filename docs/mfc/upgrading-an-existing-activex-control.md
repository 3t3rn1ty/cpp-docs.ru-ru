---
title: Обновление существующего элемента управления ActiveX | Документы Microsoft
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- ActiveX controls [MFC], Internet
- LPK files for Internet controls
- safe for scripting and initialization (controls)
- OLE controls [MFC], upgrading to ActiveX
- CAB files, for ActiveX controls
- Internet applications [MFC], ActiveX controls
- Internet applications [MFC], packaging code for download
- upgrading ActiveX controls
- licensing ActiveX controls
ms.assetid: 4d12ddfa-b491-4f9f-a0b7-b51458e05651
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: e40240367d3e8350cee030b2c08dc5a48325e05f
ms.sourcegitcommit: 76b7653ae443a2b8eb1186b789f8503609d6453e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33385311"
---
# <a name="upgrading-an-existing-activex-control"></a>Обновление существующего элемента управления ActiveX
Элементы управления ActiveX в существующих (ранее элементах управления OLE) может использоваться в Интернете, без изменений. Тем не менее можно изменять элементы управления, чтобы повысить их производительность. При использовании элемента управления на веб-странице, существуют дополнительные рекомендации. Соответствующий файл и все вспомогательные файлы должны быть на конечном компьютере или загрузить через Интернет. Это делает объем кода и важным аспектом время загрузки. Загружаемые файлы могут быть скомпонованы в подписанных CAB-файл. Можно пометить как безопасные для использования, а также как безопасный для инициализации элемента управления.  
  
 В этой статье рассматриваются следующие вопросы:  
  
- [Упаковка кода для загрузки](#_core_packaging_code_for_downloading)  
  
- [Пометка безопасный элемент управления для создания сценариев и инициализации](#_core_marking_a_control_safe_for_scripting_and_initializing)  
  
- [Вопросы лицензирования](#_core_licensing_issues)  
  
- [Подписывание кода](#_core_signing_code)  
  
- [Управление палитры](#_core_managing_the_palette)  
  
- [Уровни безопасности обозревателя Internet Explorer и поведение элемента управления](#_core_internet_explorer_browser_safety_levels_and_control_behavior)  
  
 Можно также добавить оптимизации, как описано в [элементы управления ActiveX: оптимизация](../mfc/mfc-activex-controls-optimization.md). Моникеры может использоваться для загрузки свойства и большие двоичные объекты асинхронно, как описано в [элементы управления ActiveX в Интернете](../mfc/activex-controls-on-the-internet.md).  
  
##  <a name="_core_packaging_code_for_downloading"></a> Упаковка кода для загрузки  
 Дополнительные сведения по этому вопросу см. в статье базы знаний «Упаковки MFC элементов управления для использования Over the Internet» (Q167158). Можно найти статьи базы знаний в [ http://support.microsoft.com/support ](http://support.microsoft.com/support).  
  
### <a name="the-codebase-tag"></a>Тег CODEBASE  
 Внедренные элементы управления ActiveX в веб-страницы с помощью `<OBJECT>` тег. `CODEBASE` Параметр `<OBJECT>` тег указывает расположение, из которого требуется загрузить элемент управления. `CODEBASE` можно указать на ряд различных типах файлов успешно.  
  
### <a name="using-the-codebase-tag-with-an-ocx-file"></a>С помощью CODEBASE тега с файлом OCX  
  
```  
CODEBASE="http://example.microsoft.com/mycontrol.ocx#version=4,
    70,
    0,
    1086"  
```  
  
 Это решение загружает только элемента управления OCX-файл и требуется любые вспомогательные библиотеки DLL, уже будет установлен на клиентском компьютере. Для элементов управления Internet Explorer и ActiveX в MFC, созданные с помощью Visual C++ будет работать так, как Internet Explorer поставляется с вспомогательные библиотеки DLL для элементов управления Visual C++. Если другой Интернет-браузер, поддерживающий управления ActiveX используется для просмотра этого элемента управления, это решение не будет работать.  
  
### <a name="using-the-codebase-tag-with-an-inf-file"></a>С помощью CODEBASE тега со INF-файла  
  
```  
CODEBASE="http://example.microsoft.com/trustme.inf"  
```  
  
 INF-файл будет контролировать процесс установки ocx; и ее вспомогательные файлы. Этот метод не рекомендуется, поскольку не удается подписать INF-файл (см. [подписи кода](#_core_signing_code) для указателей на подписывание кода).  
  
### <a name="using-the-codebase-tag-with-a-cab-file"></a>С помощью CODEBASE тега с CAB-файла  
  
```  
CODEBASE="http://example.microsoft.com/acontrol.cab#version=1,
    2,
    0,
    0"  
```  
  
 CAB-файлы — это рекомендуемый способ упаковки элементов управления ActiveX, использующих MFC. Упаковка элемента управления MFC ActiveX в CAB-файле позволяет INF-файл для включения в установку элементов управления ActiveX элемента управления и все зависимые библиотеки DLL (например, библиотеки DLL MFC). С помощью CAB-файл автоматически сжимает кода для более быстрой загрузки. При использовании CAB-файл для загрузки компонентов происходит быстрее для подписывания всей CAB-файла от каждого компонента.  
  
### <a name="creating-cab-files"></a>Создание CAB-файлы  
 Пакет средств разработки CAB-файл можно загрузить из статьи базы знаний [310618: средств разработки программного обеспечения Майкрософт CAB-файл](http://go.microsoft.com/fwlink/p/?linkid=148204). В этот пакет можно найти необходимые средства для создания CAB-файлов.  
  
 CAB-файл, на который указывает `CODEBASE` должен содержать соответствующий файл для элемента управления ActiveX и INF-файл для его установки. Вы создадите CAB-файл, указав имя файла элемента управления и INF-файл. Не включайте зависимых библиотек DLL, которые могут уже существовать в системе в CAB-файл. Например библиотеки DLL MFC упаковываются в отдельный CAB-файл и ссылается управляющий INF-файла.  
  
 Дополнительные сведения о создании CAB-файла см. в разделе [создании CAB-файла](http://msdn.microsoft.com/en-us/cc52fd09-bdf6-4410-a693-149a308f36a3).  
  
### <a name="the-inf-file"></a>INF-файл  
 Следующий пример, spindial.inf, списками вспомогательные файлы и сведения о версии требуется для MFC Spindial управления. Обратите внимание, что расположение библиотеки DLL MFC: веб-сайта Майкрософт. Mfc42.cab предоставляется и подписываемых Microsoft.  
  
```  
Contents of spindial.inf:  
[mfc42installer]   
file-win32-x86=http://activex.microsoft.com/controls/vc/mfc42.cab   
[Olepro32.dll] - FileVersion=5,
    0,
    4261,
    0  
[Mfc42.dll] - FileVersion=6,
    0,
    8168,
    0  
[Msvcrt.dll] - FileVersion=6,
    0,
    8168,
    0  
```  
  
### <a name="the-object-tag"></a>\<ОБЪЕКТА > тег  
 В следующем примере демонстрируется использование `<OBJECT>` тег, чтобы упаковать Образец MFC Spindial элемента управления.  
  
```  
<OBJECT ID="Spindial1" WIDTH=100 HEIGHT=51  
    CLASSID="CLSID:06889605-B8D0-101A-91F1-00608CEAD5B3" 
    CODEBASE="http://example.microsoft.com/spindial.cab#Version=1,0,0,001"> 
 <PARAM NAME="_Version" VALUE="65536">  
 <PARAM NAME="_ExtentX" VALUE="2646">  
 <PARAM NAME="_ExtentY" VALUE="1323">  
 <PARAM NAME="_StockProps" VALUE="0">  
 <PARAM NAME="NeedlePosition" VALUE="2">  
</OBJECT>  
```  
  
 В этом случае spindial.cab будет содержать два файла, spindial.ocx и spindial.inf. Следующая команда создаст CAB-файл:  
  
```  
C:\CabDevKit\cabarc.exe -s 6144 N spindial.cab spindial.ocx spindial.inf   
```  
  
 `-s 6144` Параметра резервирует пространство в CAB-файл для подписывания кода.  
  
### <a name="the-version-tag"></a>Тег версии  
 Обратите внимание, что `#Version` сведения, указанные с помощью CAB-файл применяется для управления, указанный в `CLASSID` параметр `<OBJECT>` тег.  
  
 В зависимости от того, указана версия можно выполнить принудительную загрузку элемента управления. Для завершения спецификации `OBJECT` включая тег `CODEBASE` параметра, см. в разделе W3C ссылка.  
  
##  <a name="_core_marking_a_control_safe_for_scripting_and_initializing"></a> Пометка безопасный элемент управления для создания сценариев и инициализации  
 Элементы управления ActiveX, используемые в веб-страницы должен быть помечен как безопасный для сценариев и инициализации, если на самом деле они безопасны. Безопасный элемент управления будет выполнять операции ввода-ВЫВОДА диска или не прямого доступа к памяти или регистры машины.  
  
 Элементы управления может быть помечен как безопасный для сценариев и инициализации в реестре. Изменение `DllRegisterServer` для добавления записей, подобных приведенному ниже, чтобы пометить элемент управления как безопасный для сценариев и сохраняемость в реестре. Альтернативным способом является реализация `IObjectSafety`.  
  
 Необходимо определить идентификаторы GUID (глобально уникальные идентификаторы) для элемента управления пометить его как безопасный для сценариев и для постоянного хранения. Элементы управления, которые можно безопасно скрипт будет содержать запись реестра следующего вида:  
  
```  
HKEY_CLASSES_ROOT\Component Categories\{7DD95801-9882-11CF-9FA9-00AA006C42C4}  
```  
  
 Элементы управления, которые можно безопасно инициализировать из постоянных данных помеченных как безопасные для сохраняемости запись реестра, следующего:  
  
```  
HKEY_CLASSES_ROOT\Component Categories\{7DD95802-9882-11CF-9FA9-00AA006C42C4}  
```  
  
 Добавить записи следующего вида (подстановка элемента управления класса идентификатор вместо `{06889605-B8D0-101A-91F1-00608CEAD5B3}`) чтобы связать ключи со следующим Идентификатором класса:  
  
```  
HKEY_CLASSES_ROOT\CLSID\{06889605-B8D0-101A-91F1-00608CEAD5B3}\Implemented Categories\{7DD95801-9882-11CF-9FA9-00AA006C42C4}   
HKEY_CLASSES_ROOT\CLSID\{06889605-B8D0-101A-91F1-00608CEAD5B3}\Implemented Categories\{7DD95802-9882-11CF-9FA9-00AA006C42C4}   
```  
  
##  <a name="_core_licensing_issues"></a> Вопросы лицензирования  
 Если вы хотите использовать лицензированный элемент управления на веб-странице, необходимо убедиться, что лицензионное соглашение позволяет использовать его в Интернете и создать файл пакета (LPK) с лицензией для него.  
  
 Лицензированный элемент управления ActiveX не загрузит должным образом на HTML-странице, если на компьютере установлен Internet Explorer не имеет лицензии на использование элемента управления. Например если лицензированный элемент управления был создан с помощью Visual C++, HTML-страницу с помощью элемента управления будет загружен должным образом на компьютере, на котором был создан элемент управления, но не загрузит на другом компьютере, если только не включены сведения о лицензировании.  
  
 Чтобы использовать лицензированный элемент управления ActiveX в Internet Explorer, необходимо проверить поставщика лицензионное соглашение, чтобы убедиться, что разрешает лицензии для элемента управления:  
  
-   Распространяемая версия  
  
-   Использование элемента управления в Интернете  
  
-   Использование параметра базы кода  
  
 Чтобы использовать лицензированный элемент управления в HTML-страницы на nonlicensed компьютере, необходимо создать файл пакета с лицензией (LPK). Файл LPK содержит лицензий во время выполнения для Лицензированные элементы управления HTML-странице. Этот файл создается с помощью LPK_TOOL. EXE, который поставляется вместе с пакетом SDK ActiveX. Дополнительные сведения см. в разделе веб-сайте MSDN по [ http://msdn.microsoft.com ](http://msdn.microsoft.com).  
  
#### <a name="to-create-an-lpk-file"></a>Чтобы создать файл LPK  
  
1.  Запустите LPK_TOOL. Исполняемого файла на компьютере, на котором лицензии на использование элемента управления.  
  
2.  В **средства разработки пакета лицензий** диалогового **доступных элементов управления** списка, выберите каждый лицензии управления ActiveX, который будет использоваться на HTML-страницы и нажмите кнопку **добавить**.  
  
3.  Нажмите кнопку **сохранить и выйти из** и введите имя для файла LPK. Это создаст LPK-файл и закройте приложение.  
  
#### <a name="to-embed-a-licensed-control-on-an-html-page"></a>Чтобы внедрить лицензированный элемент управления HTML-страницы  
  
1.  Редактирование HTML-страницы. Вставьте в HTML-страницу \<ОБЪЕКТА > тег объекта диспетчера лицензий перед любыми другими \<ОБЪЕКТА > тегов. Диспетчер лицензий является элементом управления ActiveX, который устанавливается вместе с Internet Explorer. Идентификатор класса приведен ниже. Задайте свойство LPKPath объекта диспетчера лицензий путь и имя файла LPK. Может иметь только один файл LPK на HTML-страницу.  
  
 ```  
 <OBJECT CLASSID = "clsid:5220cb21-c88d-11cf-b347-00aa00a28331">  
 <PARAM NAME="LPKPath" VALUE="relative URL to .LPK file">  
 </OBJECT>  
 ```  
  
2.  Вставить \<ОБЪЕКТА > тег для лицензированный элемент управления после тега диспетчера лицензий.  
  
     Например HTML-страницы, в котором отображается элемент управления Microsoft Masked Edit показан ниже. Первый класс, когда идентификатор для элемента управления диспетчера лицензий, второй класс, когда идентификатор для элемента управления Masked Edit. Измените теги, чтобы она указывала на относительный путь файла файл с расширением LPK, созданную ранее и добавьте тег объекта, включая идентификатор класса для элемента управления.  
  
3.  Вставить \<ВНЕДРЕНИЯ > атрибут файла LPK, если с помощью подключаемого модуля NCompass ActiveX.  
  
     Если элемент управления можно просмотреть в других браузерах с поддержкой Active — например, Netscape, с помощью подключаемого модуля NCompass ActiveX, необходимо добавить \<ВНЕДРЕНИЯ > синтаксис, как показано ниже.  
  
 ```  
 <OBJECT CLASSID="clsid:5220cb21-c88d-11cf-b347-00aa00a28331">  
 <PARAM NAME="LPKPath" VALUE="maskedit.lpk">  
 
 <EMBED SRC = "maskedit.LPK">  
 
 </OBJECT>  
 <OBJECT CLASSID="clsid:C932BA85-4374-101B-A56C-00AA003668DC" WIDTH=100 HEIGHT=25>  
 </OBJECT>  
 ```  
  
 Дополнительные сведения о лицензирование элементов управления см. в разделе [элементы управления ActiveX: Лицензирование элемента управления ActiveX](../mfc/mfc-activex-controls-licensing-an-activex-control.md).  
  
##  <a name="_core_signing_code"></a> Подписывание кода  
 Подписывание кода предназначен для определения источника кода, и гарантировать, что код не изменился с момента его подписания. В зависимости от параметров безопасности браузера пользователей может отобразиться предупреждение до загрузки кода. Пользователи могут выбирать доверять определенных владельцев сертификатов или компании, в которых вариантов код, подписанный те доверенные будут загружены без предупреждения. Код имеет цифровую подпись для предотвращения подделки.  
  
 Убедитесь, что окончательный код подписан, чтобы элемент управления можно автоматически загрузить без отображения предупреждений доверия. Дополнительные сведения о том, как подписать код см. в документации на Authenticode в пакете SDK ActiveX и в разделе [подписи CAB-файл](http://msdn.microsoft.com/en-us/04d8b47a-8f1c-4b54-ab90-730fcdc03747).  
  
 В зависимости от отношения доверия и браузера настройки уровня безопасности для идентификации подписи человека или компании могут отображаться сертификат. Если уровень безопасности имеет значение none или подписанного элемента управления сертификат является доверенным, сертификат не отобразится. В разделе [уровня безопасности обозревателя Internet Explorer и поведение элемента управления](#_core_internet_explorer_browser_safety_levels_and_control_behavior) сведения о как определить параметры безопасности браузера, загружается ли элемент управления и сертификат отображается.  
  
 Так как он подписан цифровой подписи гарантии код не изменен. Хэш-код берется и внедренных в сертификате. Этот хэш-код позже по сравнению с хэш-код, выполняемые после загрузки кода, но перед его выполнением. Компаниям, таким как Verisign можно указать открытые и закрытые ключи для подписывания кода. Пакет SDK ActiveX поставляется с MakeCert, служебная программа для создания тестовые сертификаты.  
  
##  <a name="_core_managing_the_palette"></a> Управление палитры  
 Контейнеры определить палитры и сделать его доступным в качестве внешнего свойства **DISPID_AMBIENT_PALETTE**. Контейнер (например, Internet Explorer) выбирает палитру, которая используется для всех элементов управления ActiveX на странице для определения собственных палитры. Это позволяет предотвратить мерцание отображения и представляется согласованного внешнего вида.  
  
 Элемент управления может переопределить `OnAmbientPropertyChange` для обработки уведомления об изменениях в палитре.  
  
 Элемент управления может переопределить `OnGetColorSet` для возвращения набора для рисования палитры цветов. Контейнеры используют возвращаемое значение, чтобы определить, является ли элемент управления поддержкой палитры.  
  
 В группе правила OCX 96 элемент управления всегда должен реализовать свою палитру в фоновом режиме.  
  
 Старые контейнеров, которые не используют свойство окружения палитры отправит `WM_QUERYNEWPALETTE` и `WM_PALETTECHANGED` сообщений. Элемент управления может переопределить `OnQueryNewPalette` и `OnPaletteChanged` для обработки этих сообщений.  
  
##  <a name="_core_internet_explorer_browser_safety_levels_and_control_behavior"></a> Уровни безопасности обозревателя Internet Explorer и поведение элемента управления  
 Браузер позволяет настраивать параметры уровень безопасности, настраиваемый пользователем. Поскольку веб-страницы могут содержать активное содержимое, которое может повредить компьютер пользователя, браузеры позволяют пользователю для выбора параметров уровня безопасности. В зависимости от способа браузера реализует уровни безопасности элемент управления не могут быть загружены во всех или отобразит сертификат или предупреждающее сообщение, чтобы разрешить пользователю выбирать во время выполнения загрузки элемента управления или нет. Поведение элементов управления ActiveX при уровнях высокий, средний и низкий безопасности в Internet Explorer, перечислены ниже.  
  
### <a name="high-safety-mode"></a>Режим высокой безопасности  
  
-   Неподписанные элементы управления не будут загружаться.  
  
-   Подписанные элементы управления отобразит сертификат, если недоверенные (пользователь может выбрать возможность теперь всегда доверять кода от владельца этого сертификата).  
  
-   Только элементов, помеченных как безопасные будет иметь постоянных данных и/или выполняться с помощью сценариев.  
  
### <a name="medium-safety-mode"></a>Режим Средняя безопасность  
  
-   Неподписанные элементы будут показывать предупреждение перед загрузкой.  
  
-   Если недоверенный подписанные элементы управления выдаст сертификат.  
  
-   Элементы управления, не помеченных как безопасные выводит предупреждение.  
  
### <a name="low-safety-mode"></a>Режим безопасности низкий  
  
-   Элементы управления, загружаются без предупреждения.  
  
-   Выполнение сценариев и сохраняемости происходит без предупреждения.  
  
## <a name="see-also"></a>См. также  
 [Задачи программирования для Интернет MFC](../mfc/mfc-internet-programming-tasks.md)   
 [Основы программирования для Интернет MFC](../mfc/mfc-internet-programming-basics.md)   
 [Элементы ActiveX в MFC. Лицензирование элемента ActiveX](../mfc/mfc-activex-controls-licensing-an-activex-control.md)


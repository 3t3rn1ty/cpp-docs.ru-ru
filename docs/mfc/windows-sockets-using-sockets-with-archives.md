---
title: "Сокеты Windows. Использование сокетов с архивами | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "архивы [C++], и сокеты Windows"
  - "CSocket - класс, модель программирования"
  - "сокеты [C++], с архивами"
  - "Сокеты Windows [C++], архивы"
ms.assetid: 17e71a99-a09e-4e1a-9fda-13d62805c824
caps.latest.revision: 12
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 8
---
# Сокеты Windows. Использование сокетов с архивами
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этом разделе описываются [Модель программирования CSocket](#_core_the_csocket_programming_model).  Поддержка сокета предоставляет [CSocket](../mfc/reference/csocket-class.md) класса на более высоком уровне абстракции, что и класс [CAsyncSocket](../Topic/CAsyncSocket%20Class.md).  `CSocket` использует версию протокола сериализации MFC для передачи данных и обратное преобразование объекта сокета через объект [CArchive](../mfc/reference/carchive-class.md) библиотеки MFC.  `CSocket` предоставляет блокировку \(пока управление фоновый обработки сообщений Windows\) и предоставляет доступ к `CArchive`, управляющий множество аспектов сообщений, необходимо сделать использование или необработанные API или класс `CAsyncSocket`.  
  
> [!TIP]
>  Класс можно `CSocket` использоваться сама по себе, как более удобной версия `CAsyncSocket`, но наиболее простая модель программирования использовать `CSocket` с объектом `CArchive`.  
  
 Дополнительные сведения о, как реализация сокетов с архивами работает, см. в разделе [Сокеты Windows. Работа сокетов с архивами](../mfc/windows-sockets-how-sockets-with-archives-work.md).  Например код см. в разделах [Сокеты Windows. Последовательность операций](../Topic/Windows%20Sockets:%20Sequence%20of%20Operations.md) и [Сокеты Windows. Пример сокетов с использованием архивов](../mfc/windows-sockets-example-of-sockets-using-archives.md).  Дополнительные сведения о некоторых функций можно увеличить свои собственные классы, производные от классов сокетов, см. в разделе [Сокеты Windows. Наследование от классов сокета](../mfc/windows-sockets-deriving-from-socket-classes.md).  
  
> [!NOTE]
>  При создании клиентской программы MFC для связи с установленными серверами библиотек \(\), не отправлять объекты C\+\+ по архивным.  Если сервер не будет приложение MFC, понимает типы объектов требуется отправить, он не сможет получить и поиск объекты.  Для соответствующих материала на предмете взаимодействия с приложениями библиотеки также см. статью [Сокеты Windows. Порядок байтов](../mfc/windows-sockets-byte-ordering.md).  
  
##  <a name="_core_the_csocket_programming_model"></a> Модель программирования CSocket  
 С помощью объекта `CSocket` включает в себя создание и связать вместе несколько объектов классов MFC.  В общей процедуре ниже, каждый предпринят сокетом как сервера, так и сокетом клиента, за исключением шага 3, в котором каждый тип сокета различаются действия.  
  
> [!TIP]
>  Во время выполнения, серверное приложение обычно запускается, чтобы быть готово «и требуется передачи данных», когда клиентское приложение ищет подключение.  Если сервер не готов, когда клиент пытается подключиться, обычно требует пользователя приложения попытаться подключиться попытку позже.  
  
#### Настройка связь между сокетом сокетом клиента и сервера  
  
1.  Создайте объект [CSocket](../mfc/reference/csocket-class.md).  
  
2.  Использование объекта для создания основной дескриптор **SOCKET**.  
  
     Для клиентской объектной `CSocket` необходимо обычно используются параметры по умолчанию в [Создать](../Topic/CAsyncSocket::Create.md), если вам не будет необходимости сокет датаграмм.  Для серверного объекта `CSocket` необходимо указать порт в вызове **Создать**.  
  
    > [!NOTE]
    >  `CArchive` не работает с сокетами датаграмм.  Если необходимо использовать `CSocket` для сокета датаграмм, необходимо использовать класс, как можно использовать `CAsyncSocket`, т е не архива.  Поскольку датаграммы ненадежны \(не существует гарантированного, что приехал и может быть повторен или из последовательности\), они не совместимы с сериализацией по архивным.  Предполагается, что операция сериализации для выполнения всегда и в последовательности.  При попытке использовать `CSocket` с объектом `CArchive` для датаграммы, утверждение MFC завершается неудачей.  
  
3.  Если клиент сокет, вызов [CAsyncSocket::Connect](../Topic/CAsyncSocket::Connect.md) для подключения объект сокета сокета сервера.  
  
     – или –  
  
     Если сервер сокет, вызов [CAsyncSocket::Listen](../Topic/CAsyncSocket::Listen.md), чтобы начать прослушивает попытки подключения от клиента.  При получении запроса подключения, примите его с помощью метода [CAsyncSocket::Accept](../Topic/CAsyncSocket::Accept.md).  
  
    > [!NOTE]
    >  Функцию\-член **Принять** принимает ссылку на новый, пустой объект `CSocket` в качестве параметра.  Необходимо построить этот объект перед вызовом **Принять**.  Если этот объект сокета выходит за пределы области, закроет подключение.  Не вызывайте метод **Создать** для нового объекта сокета.  
  
4.  Создайте объект [CSocketFile](../Topic/CSocketFile%20Class.md) и сопоставляет объект `CSocket` с ним.  
  
5.  Создайте объект [CArchive](../mfc/reference/carchive-class.md) для получения или загрузки \(\) или хранить сведения \(отправки\).  Архив связан с объектом `CSocketFile`.  
  
     Имейте в виду, что `CArchive` не работает с сокетами датаграмм.  
  
6.  Используйте объект `CArchive` для передачи данных между клиентом и сокетами сервера.  
  
     Имейте в виду, что заданный объект `CArchive` перемещает данные только в одном направлении. для загрузки \(или получение\) или сохранения \(отправки\).  В некоторых случаях используется 2 объекта `CArchive` : одно для отправки данных, — для получения подтверждения.  
  
     После принятия подключения и настраивать архив можно выполнять такие задачи, как проверка пароли.  
  
7.  Удалите архив, файл сокета, объекты сокета.  
  
    > [!NOTE]
    >  Предоставляет `CArchive` класса функцию\-член `IsBufferEmpty` специально для использования с классом `CSocket`.  Если буфер содержит несколько сообщений данных, например, необходимо воспроизвести до тех пор, пока все они не будут прочитаны и буфер.  В противном случае в следующее уведомление о том, что данные, которые необходимо получить может быть задержано неопределенно.  Используйте `IsBufferEmpty`, чтобы убедить, необходимо извлечь все данные.  
  
 На статью [Сокеты Windows. Последовательность операций](../Topic/Windows%20Sockets:%20Sequence%20of%20Operations.md) показано обе стороны этого процесса с примером кода.  
  
 Дополнительные сведения см. в следующих разделах:  
  
-   [Сокеты Windows. Сокеты потоков](../mfc/windows-sockets-stream-sockets.md)  
  
-   [Сокеты Windows. Сокеты датаграмм](../mfc/windows-sockets-datagram-sockets.md)  
  
## См. также  
 [Сокеты Windows в MFC](../mfc/windows-sockets-in-mfc.md)   
 [CSocket::Create](../Topic/CSocket::Create.md)
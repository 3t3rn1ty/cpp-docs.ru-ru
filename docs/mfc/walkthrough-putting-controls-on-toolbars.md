---
title: "Пошаговое руководство. Размещение элементов управления на панели инструментов | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "Настраиваемое диалоговое окно, добавление элементов управления"
  - "панели инструментов, добавление элементов управления"
ms.assetid: 8fc94bdf-0da7-45d9-8bc4-52b7b1edf205
caps.latest.revision: 24
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 20
---
# Пошаговое руководство. Размещение элементов управления на панели инструментов
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этом разделе описывается добавление кнопки панели инструментов, которая содержит элемент управления Windows на панель инструментов.  В MFC кнопки панели инструментов должна быть [CMFCToolBarButton Class](../mfc/reference/cmfctoolbarbutton-class.md)\- производным классом, например [CMFCToolBarComboBoxButton Class](../Topic/CMFCToolBarComboBoxButton%20Class.md), [CMFCToolBarEditBoxButton Class](../Topic/CMFCToolBarEditBoxButton%20Class.md), [CMFCDropDownToolbarButton Class](../mfc/reference/cmfcdropdowntoolbarbutton-class.md) или [CMFCToolBarMenuButton Class](../mfc/reference/cmfctoolbarmenubutton-class.md).  
  
## Добавление элементов управления в панели инструментов  
 Чтобы добавить элемент управления в панель инструментов, выполните следующие действия.  
  
1.  Резервируется вспомогательный идентификатор ресурса для кнопки в родительском диалоговом окне инструментов.  Дополнительные сведения о создании кнопки с помощью редактора панели инструментов в Visual Studio см. в разделе [Toolbar Editor](../mfc/toolbar-editor.md).  
  
2.  Резервируется образ Значок кнопки панели инструментов \(\) для кнопки во всех трех изображениях родительского инструмента.  
  
3.  В обработчике сообщений, процессы сообщение `AFX_WM_RESETTOOLBAR`, выполняющих следующее:  
  
    1.  Создайте элемент управления "кнопка" с помощью `CMFCToolbarButton`\- производного класса.  
  
    2.  Замените фиктивная кнопку новым элементом управления с помощью [CMFCToolBar::ReplaceButton](../Topic/CMFCToolBar::ReplaceButton.md).  Этот объект можно создать кнопки в стеке, поскольку `ReplaceButton` копирует объект кнопки и поддержку копию.  
  
> [!NOTE]
>  Если включено настройки в приложении, можно сбросить панель инструментов, нажав кнопку **Сброс** на вкладке **Панели инструментов** диалогового окна **Настроить** для просмотра обновленный элемент управления в приложении после повторной компиляции.  Состояние " сохраняется в реестре Windows и загружаются и применяются данные реестра после вызова метода `ReplaceButton` выполняется во время запуска приложения.  
  
## Элементы управления панели инструментов и настройки  
 Вкладка **Команды** диалогового окна **Настроить** содержится список команд, доступных в приложении.  По умолчанию процессы диалогового окна **Настроить** меню приложения и построения список стандартных кнопок панели инструментов в каждой категории меню.  Чтобы сохранить расширенная функциональность, элементы управления панели инструментов предоставляют, необходимо заменить стандартной кнопки панели инструментов с пользовательским элементом управления в диалоговом окне **Настроить**.  
  
 При включении настройки создается диалоговое окно **Настроить** в обработчике `OnViewCustomize` настройки с помощью класса [CMFCToolBarsCustomizeDialog Class](../mfc/reference/cmfctoolbarscustomizedialog-class.md).  Прежде чем отобразить диалоговое окно **Настроить**, можно вызвать метод [CMFCToolBarsCustomizeDialog::Create](../Topic/CMFCToolBarsCustomizeDialog::Create.md), вызов [CMFCToolBarsCustomizeDialog::ReplaceButton](../Topic/CMFCToolBarsCustomizeDialog::ReplaceButton.md), чтобы заменить стандартной кнопки новым элементом управления.  
  
## Пример: Создать поле со списком найти  
 В этом разделе описывается, как создать элемент управления " Поле со списком `Find`, отображается на панели инструментов и содержится недавн\-, используемые строки поиска.  Пользователь может добавлять строки в элементе управления, а затем нажать ключ в документ или нажмите ключ escape\-последовательности для возвращения фокуса наиболее ЭВМ.  В этом примере высказывать документа см. в разделе [CEditView Class](../Topic/CEditView%20Class.md)\- производном представлении.  
  
### Создание элемента управления найти  
 Сначала создайте элемент управления " Поле со списком `Find`:  
  
1.  Добавьте кнопку и его команды к ресурсам приложения:  
  
    1.  В ресурсах приложения добавьте новой кнопки с идентификатором команды `ID_EDIT_FIND` к панели инструментов в приложении и ко всем растровым изображениям, связанным с панелью инструментов.  
  
    2.  Создайте новый пункт меню с идентификатором команды ID\_EDIT\_FIND  
  
    3.  Добавляет новую строку «поиск» text\\nFind в таблице строк и присвойте ей идентификатор команды. `ID_EDIT_FIND_COMBO` Этот идентификатор используется как идентификатор команды кнопки поля со списком `Find`.  
  
        > [!NOTE]
        >  Поскольку `ID_EDIT_FIND` стандартную команду, которая обрабатывается `CEditView`, не требуется реализовать специальный обработчик для этой команды.  Однако необходимо реализовать обработчик для новой команды `ID_EDIT_FIND_COMBO`.  
  
2.  Создайте новый класс, `CFindComboBox`, производное от [CComboBox Class](../mfc/reference/ccombobox-class.md).  
  
3.  В классе `CFindComboBox`, переопределите метод виртуального `PreTranslateMessage`.  Этот метод включает процесс поля со списком сообщение [WM\_KEYDOWN](http://msdn.microsoft.com/library/windows/desktop/ms646280).  Если пользователь ударяет ключ escape\-последовательности \(`VK_ESCAPE`\), возвращает фокус в главное окно фреймовому.  Если пользователь ударяет ключ \(`VK_ENTER`\), опубликовать на основном фреймовое окно сообщения `WM_COMMAND`, содержащее идентификатор команды. `ID_EDIT_FIND_COMBO`  
  
4.  Создание класса для кнопки поля со списком `Find`, производный от [CMFCToolBarComboBoxButton Class](../Topic/CMFCToolBarComboBoxButton%20Class.md).  В этом случае он — `CFindComboButton`.  
  
5.  Конструктор `CMFCToolbarComboBoxButton` принимает 3 параметра: идентификатор команды кнопки, индекса образа кнопки и стиля поля со списком.  Задайте следующие параметры:  
  
    1.  Передайте `ID_EDIT_FIND_COMBO` как идентификатор команды.  
  
    2.  Используйте [CCommandManager::GetCmdImage](http://msdn.microsoft.com/ru-ru/4094d08e-de74-4398-a483-76d27a742dca) с `ID_EDIT_FIND` для получения индекс образа.  
  
    3.  Стили поля со списком Для списка доступных см. в разделе [Стили полей со списками](../mfc/reference/combo-box-styles.md).  
  
6.  В классе `CFindComboButton` переопределите метод`CMFCToolbarComboBoxButton::CreateCombo`.  Далее необходимо создать объект `CFindComboButton` и вернуть указатель на него.  
  
7.  Следует использовать макрос [IMPLEMENT\_SERIAL](../Topic/IMPLEMENT_SERIAL.md), чтобы сделать комбинированную кнопки упорным.  Диспетчер рабочих областей автоматически загружает и сохраняет состояние кнопки в реестре Windows.  
  
8.  Реализуйте обработчик `ID_EDIT_FIND_COMBO` в представлении документа.  Используйте [CMFCToolBar::GetCommandButtons](../Topic/CMFCToolBar::GetCommandButtons.md) с `ID_EDIT_FIND_COMBO` для извлечения всех кнопок поля со списком `Find`.  Может существовать несколько копий кнопки с таким же идентификатором команды из\-за настройки.  
  
9. В обработчике сообщений `OnFind` ID\_EDIT\_FIND, используйте [CMFCToolBar::IsLastCommandFromButton](../Topic/CMFCToolBar::IsLastCommandFromButton.md), чтобы определить, выполняется ли команда кнопки, из поля со списком `Find`.  В этом случае поиск текста и добавьте строку поиска в поле со списком.  
  
### Добавление элемента управления найти на главной панели инструментов  
 Чтобы добавить кнопку поля со списком в панель инструментов, выполните следующие действия.  
  
1.  Реализуйте обработчик сообщений `OnToolbarReset``AFX_WM_RESETTOOLBAR` в главном окне фреймовом.  
  
    > [!NOTE]
    >  Платформа отправляет сообщение в главное окно при фреймовому инструмент инициализируется во время запуска приложения, или когда инструмент сброшен во время настройки.  В любом случае необходимо заменить стандартной кнопки панели инструментов с пользовательской кнопки поля со списком `Find`.  
  
2.  В обработчике `AFX_WM_RESETTOOLBAR` просмотрите идентификатор инструментов, т е `WPARAM` сообщения `AFX_WM_RESETTOOLBAR`.  Если идентификатор инструмента равно параметрам инструмента, который содержит кнопку поля со списком `Find`, вызовите метод [CMFCToolBar::ReplaceButton](../Topic/CMFCToolBar::ReplaceButton.md), чтобы заменить кнопку `Find` \(то есть кнопка с идентификатором `ID_EDIT_FIND)` команды с объектом `CFindComboButton`.  
  
    > [!NOTE]
    >  Можно создать объект `CFindComboBox` в стеке, поскольку `ReplaceButton` копирует объект кнопки и поддержку копию.  
  
### Добавление элемента управления найти в диалоговое окно настройки  
 В обработчике `OnViewCustomize` настройки необходимо вызвать метод [CMFCToolBarsCustomizeDialog::ReplaceButton](../Topic/CMFCToolBarsCustomizeDialog::ReplaceButton.md), чтобы заменить кнопку `Find` \(то есть кнопка с идентификатором `ID_EDIT_FIND)` команды с объектом `CFindComboButton`.  
  
## См. также  
 [Диаграмма иерархии](../mfc/hierarchy-chart.md)   
 [Классы](../Topic/MFC%20Classes.md)   
 [CMFCToolBar Class](../mfc/reference/cmfctoolbar-class.md)   
 [CMFCToolBarButton Class](../mfc/reference/cmfctoolbarbutton-class.md)   
 [CMFCToolBarComboBoxButton Class](../Topic/CMFCToolBarComboBoxButton%20Class.md)   
 [CMFCToolBarsCustomizeDialog Class](../mfc/reference/cmfctoolbarscustomizedialog-class.md)
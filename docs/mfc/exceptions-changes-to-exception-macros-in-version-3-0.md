---
title: "Исключения. Изменения макроса исключений в версии 3.0 | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "обработка исключений С++, аспекты обновления"
  - "CATCH - макрос"
  - "исключения, изменения по сравнению с предыдущей версией"
  - "THROW_LAST - макрос"
ms.assetid: 3aa20d8c-229e-449c-995c-ab879eac84bc
caps.latest.revision: 10
caps.handback.revision: 6
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Исключения. Изменения макроса исключений в версии 3.0
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Это дополнительный раздел.  
  
 В MFC версии 3.0 и более поздних версиях, макросы обработки исключений были изменены для использования C исключений C\+\+.  Этот раздел показывает, как эти изменения могут повлиять на расширение функциональности существующего кода, использующий макросы.  
  
 Этот раздел охватывает следующее:  
  
-   [Типы исключений и макрос ПЕРЕХВАТА](#_core_exception_types_and_the_catch_macro)  
  
-   [Повторно при порождении исключения](#_core_re.2d.throwing_exceptions)  
  
##  <a name="_core_exception_types_and_the_catch_macro"></a> Типы исключений и макрос ПЕРЕХВАТА  
 В более ранних версиях, MFC макрос **CATCH** используется данные типа во время выполнения MFC для указания типа исключения; тип исключения определяется, другими словами, на сайте catch.  С исключениями C\+\+, однако тип исключения всегда определяется на сайте хода типом объекта исключения, возникает.  Это приведет к несовместимости в тех редких случаях, когда тип указателя на объект брошенному отличается от типа создание объекта.  
  
 В следующем примере показано последствия данного отличия между версии MFC 3.0 и более ранних версиях:  
  
 [!code-cpp[NVC_MFCExceptions#1](../mfc/codesnippet/CPP/exceptions-changes-to-exception-macros-in-version-3-0_1.cpp)]  
  
 Этот код работает по\-разному в версии 3.0, поскольку элемент управления всегда передает в первый блок исключений с объявлением **catch**  сопоставления.  Результат выражения хода  
  
 [!code-cpp[NVC_MFCExceptions#19](../mfc/codesnippet/CPP/exceptions-changes-to-exception-macros-in-version-3-0_2.cpp)]  
  
 создает как **CException\***, даже если он построен как **CCustomException**.  Макрос **CATCH** в версии MFC 2.5 и более ранних версий используется `CObject::IsKindOf` для выполнения тип во время выполнения.  Поскольку выражение  
  
 [!code-cpp[NVC_MFCExceptions#20](../mfc/codesnippet/CPP/exceptions-changes-to-exception-macros-in-version-3-0_3.cpp)]  
  
 либо, первые два блока catch перехватывает исключение.  В версии 3.0, которая использует исключения C\+\+ для реализации многих макросов обработки исключений, второй блок catch соответствует брошенному `CException`.  
  
 Код, как показано ниже неупотребителен.  Оно обычно возникает, когда объект исключения передается другой функции, которая принимает универсальный шаблон **CException\***, выполняет «,» ход обработки и, наконец создает исключение.  
  
 Для решения этой проблемы перемещение выражение хода из функции в вызывающий код и создание исключения фактического типа известного компилятору это исключение создается.  
  
##  <a name="_core_re.2d.throwing_exceptions"></a> Повторно при порождении исключения  
 Блок catch не может создавать один указатель исключения, он уловил.  
  
 Например, этот код был допустимым в предыдущих версиях, но будет иметь непредвиденные результаты с версией 3.0:  
  
 [!code-cpp[NVC_MFCExceptions#2](../mfc/codesnippet/CPP/exceptions-changes-to-exception-macros-in-version-3-0_4.cpp)]  
  
 Использование **THROW** в блоке catch, то при наведении указателя `e` должен быть удален, так как внешний сайт catch получила недопустимый указатель.  С помощью ход `e``THROW_LAST`.  
  
 Дополнительные сведения см. в разделе [Исключения: Улавливающ и удаление исключения](../mfc/exceptions-catching-and-deleting-exceptions.md).  
  
## См. также  
 [Обработка исключений](../mfc/exception-handling-in-mfc.md)
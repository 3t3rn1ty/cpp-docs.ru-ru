---
title: "Использование полей обратного вызова элемента выбора даты и времени | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "DTN_FORMATQUERY"
  - "DTN_FORMAT"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "поля обратного вызова в классе CDateTimeCtrl"
  - "CDateTimeCtrl - класс, поля обратного вызова"
  - "CDateTimeCtrl - класс, обработка DTN_FORMAT и DTN_FORMATQ"
  - "DateTimePicker - элемент управления [MFC]"
  - "DateTimePicker - элемент управления [MFC], поля обратного вызова"
  - "DTN_FORMAT - уведомление"
  - "DTN_FORMATQUERY - уведомление"
ms.assetid: 404f4ba9-cba7-4718-9faa-bc6b274a723f
caps.latest.revision: 11
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 7
---
# Использование полей обратного вызова элемента выбора даты и времени
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В дополнение к символам стандартного формата, поля определяются выбора даты и времени, можно настраивать свой вывод, определив части строки пользовательского формата как поля обратного вызова.  Для объявления поля обратного вызова включите один знак «x» \(код ASCII 88\) в любом месте внутри тела строки формата.  Например, следующая строка «today is: » yy «\/» MM «\/«dd» \(день «x»\)» в результате элемент управления " выбор даты и времени отображать текущее значение как год за средой месяц, дата и, наконец день года.  
  
> [!NOTE]
>  Номер X в поле обратного вызова не соответствует числу символов, которое будет отображаться.  
  
 Можно отличить между несколькими полями обратного вызова в пользовательской строки, итерации символ «x».  Таким образом, строка «XXddddMMMdd формата, 'yyyXXX» содержит 2 уникальных поля обратного вызова, «XX» и «XXX».  
  
> [!NOTE]
>  Поля обратного вызова рассматриваются как допустимые поля, поэтому приложение должно быть подготовить обработки сообщения уведомления **DTN\_WMKEYDOWN** .  
  
 Реализация поля обратного вызова в элементе управления " выбор даты и времени состоит из 3 частей:  
  
-   Инициализация строку настраиваемого формата  
  
-   Обработка уведомления **DTN\_FORMATQUERY**  
  
-   Обработка уведомления **DTN\_FORMAT**  
  
## Инициализация строку настраиваемого формата  
 Инициализация строка с вызовом `CDateTimeCtrl::SetFormat`.  Дополнительные сведения см. в разделе [С помощью строк настраиваемого формата в элементе управления " выбор даты и времени](../mfc/using-custom-format-strings-in-a-date-and-time-picker-control.md) в.  Общее место для размещения строку настраиваемого формата в функции `OnInitDialog`, содержащего класса диалогового окна или функции, `OnInitialUpdate` вашего класса представления.  
  
## Обработка уведомления DTN\_FORMATQUERY  
 Если элемент управления выполняет синтаксический анализ строки формата и обнаруживает поле обратного вызова, приложение отправляет уведомляющие сообщения **DTN\_FORMAT** и **DTN\_FORMATQUERY**.  Строка поля обратного вызова включена с уведомлениями, поэтому можно определить, какое поле запрашивается обратного вызова.  
  
 Уведомление отправляется **DTN\_FORMATQUERY** для извлечения максимально допустимый размер в пикселях строки, которая будет отображаться в текущем поле обратного вызова.  
  
 Для правильного вычисления это значение необходимо вычислить высоту и ширину строки, могли быть для поля, используя плакатный шрифта элемента управления.  Реальное вычисление строки легко достигается с вызовом функции [GetTextExtentPoint32](http://msdn.microsoft.com/library/windows/desktop/dd144938) Win32.  Как только размер определяется, передайте значение приложение и оставьте функцию обработчика событий.  
  
 В следующем примере один метод указания размер строки обратного вызова:  
  
 [!code-cpp[NVC_MFCControlLadenDialog#8](../mfc/codesnippet/CPP/using-callback-fields-in-a-date-and-time-picker-control_1.cpp)]  
  
 Только размер текущего поля обратного вызова, вычисляется, необходимо обновить значение поля.  Это можно сделать в обработчике для уведомления **DTN\_FORMAT** .  
  
## Обработка уведомления DTN\_FORMAT  
 Уведомление **DTN\_FORMAT** используется приложением запросить символьную строку, которая будет заменена.  В следующем примере показан один из возможных метод:  
  
 [!code-cpp[NVC_MFCControlLadenDialog#9](../mfc/codesnippet/CPP/using-callback-fields-in-a-date-and-time-picker-control_2.cpp)]  
  
> [!NOTE]
>  Указатель на структуру **NMDATETIMEFORMAT**  найден путем приведения первый параметр обработчика уведомления к нужному типу.  
  
## См. также  
 [Использование CDateTimeCtrl](../mfc/using-cdatetimectrl.md)   
 [Элементы управления](../mfc/controls-mfc.md)
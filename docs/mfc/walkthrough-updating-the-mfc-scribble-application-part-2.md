---
title: "Пошаговое руководство. Обновление приложения MFC Scribble (часть 2) | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "пошаговые руководства [C++]"
ms.assetid: 602df5c2-17d4-4cd9-8cf6-dff652c4cae5
caps.latest.revision: 36
caps.handback.revision: 32
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Пошаговое руководство. Обновление приложения MFC Scribble (часть 2)
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

[Часть 1](../mfc/walkthrough-updating-the-mfc-scribble-application-part-1.md) затем показано, как добавить пошагового руководства Microsoft Office Fluent ленты на классическому приложения Scribble.  Эта часть добавление панели и элементы управления ленты, что пользователи могут использовать вместо меню и команд.  
  
## Обязательные компоненты  
 [Примеры кода на Visual C\+\+](../top/visual-cpp-samples.md)  
  
##  <a name="top"></a> Подразделы  
 В этой части пошагового руководства имеет следующие разделы:  
  
-   [Добавление новых панели на ленту](#addNewPanel)  
  
-   [Добавить панель справки на ленту](#addHelpPanel)  
  
-   [Добавление панели пера на ленту](#addPenPanel)  
  
-   [Чтобы добавить кнопку цвета на ленту](#addColorButton)  
  
-   [Добавить элемент цвета в класс документа](#addColorMember)  
  
-   [Инициализация перья и сохранить настройки](#initPenSave)  
  
##  <a name="addNewPanel"></a> Добавление новых панели на ленту  
 В следующих шагов, как добавить панель **Вид**, которая содержит 2 флажка видимость элемента управления панели инструментов и строки состояния, а также панель **Окно**, которая содержит по вертикали ориентирована разворачивающаяся кнопка, создание и размещение элементов управления windows \(MDI\) для поддержки интерфейса.  
  
#### Добавление панели представления и панель окна на панели ленты  
  
1.  Создайте панель `Вид`, который содержит 2 флажка, изменить строку состояния и панель инструментов.  
  
    1.  Из **Панель элементов** перетащите **Панель**  в категории **Главная**.  Затем перетащите 2 на панели **Флажки**.  
  
    2.  Щелкните панель, чтобы изменить его свойства.  Измените **Заголовок** на `Вид`.  
  
    3.  Щелкните этот флажок, чтобы изменить его свойства.  Измените **Идентификатор** на `ID_VIEW_TOOLBAR`, а свойству **Заголовок** значение `Панель инструментов`.  
  
    4.  Щелкните второй флажок, чтобы изменить его свойства.  Измените **Идентификатор** на `ID_VIEW_STATUS_BAR`, а свойству **Заголовок** значение `Строка состояния`.  
  
2.  Создайте панель `Окно` с разворачивающейся кнопки.  Когда пользователь щелкает разворачивающаяся кнопка, отображения контекстного меню 3 команды, уже определены в приложении Scribble.  
  
    1.  Из **Панель элементов** перетащите **Панель** в категории **Главная**.  Затем перетащите **Кнопка** в панели.  
  
    2.  Щелкните панель, чтобы изменить его свойства.  Измените **Заголовок** на `Окно`.  
  
    3.  Щелкните кнопку.  Измените **Заголовок** на **Ключи** значение `Окна`, `w`, `1` в **Большой индекс образа** и **Режим разделения** на `ложь`.  Затем щелкните многоточие \(**...**\) рядом с полем **элементы меню**, чтобы открыть диалоговое окно **Редактор элементов**.  
  
    4.  Щелкните **Добавить** три раза, чтобы добавить 3 кнопки.  
  
    5.  Щелкните первую кнопку и измените **Заголовок** на `Новое окно`, а для свойства **Идентификатор** значение `ID_WINDOW_NEW`.  
  
    6.  Щелкните вторую кнопку и измените **Заголовок** на `Каскадом`, а для свойства **Идентификатор** значение `ID_WINDOW_CASCADE`.  
  
    7.  Нажмите на кнопку и измените **Заголовок** на `Рядом`, а для свойства **Идентификатор** значение `ID_WINDOW_TILE_HORZ`.  
  
3.  Сохраните изменения, а затем построить и запустить приложение.  Панели **Вид** и **Окно** должны отображаться.  Нажмите кнопки, чтобы убедиться, что они правильно функции.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="addHelpPanel"></a> Добавить панель справки на ленту  
 Теперь можно присвоить 2 пунктов меню, которые определены в приложении Scribble для кнопок ленты, называются **Вызов справки**  и  **О Scribble**.  Кнопки добавляются в новой с панели **Справка**.  
  
#### Добавить панель справки  
  
1.  Из **Панель элементов** перетащите **Панель** в категории **Главная**.  Затем перетащите 2 на панели **Кнопка**.  
  
2.  Щелкните панель, чтобы изменить его свойства.  Измените **Заголовок** на `Справка`.  
  
3.  Щелкните первую кнопку.  Измените **Заголовок** на `Вызов справки`, а для свойства **Идентификатор** значение `ID_HELP_FINDER`.  
  
4.  Щелкните вторую кнопку.  Измените **Заголовок** на `О Scribble…`, а для свойства **Идентификатор** значение `ID_APP_ABOUT`.  
  
5.  Сохраните изменения, а затем построить и запустить приложение.  Панель **Справка**, которая содержит 2 кнопки ленты должна отображаться.  
  
    > [!IMPORTANT]
    >  При нажатии кнопки **Вызов справки**, приложения Scribble для открытия сжанное HTML \(.chm\) *your\_project\_name* с файлом справки .chm.  Следовательно, если проект не называется Scribble, его необходимо переименовать файл справки в имени проекта.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="addPenPanel"></a> Добавление панели пера на ленту  
 Теперь добавьте в панель кнопок отображения, элемент управления толщина пера и цвет.  Эта панель содержит флажок, переключает толстые и место перья.  Эта функция похож на одно из пункта меню **Толстая линия** в приложении Scribble.  
  
 Изначально приложения Scribble позволяет ширину пера пользователя отборным из диалогового окна, которое появляется, когда пользователь нажимает кнопку **Ширины пера** в меню.  Поскольку область ленты содержит широко место для новых элементов управления, можно заменить диалоговое окно с помощью 2 полей со списком на ленте.  Одно поле со списком настроить ширину тонкого пера и другое поле со списком настроить ширину толстого пера.  
  
#### Добавление панели и поле со списком на ленте пера  
  
1.  Из **Панель элементов** перетащите **Панель** в категории **Главная**.  Затем перетащите **флажок** и 2 на панели **Поля со списком**.  
  
2.  Щелкните панель, чтобы изменить его свойства.  Измените **Заголовок** на `Перо`.  
  
3.  Щелкните флажок.  Измените **Заголовок** на `Используйте толщиной`, а для свойства **Идентификатор** значение `ID_PEN_THICK_OR_THIN`.  
  
4.  Щелкните первое поле со списком.  **Заголовок** Измените значение **Идентификатор** на `Компактный перо`, `ID_PEN_THIN_WIDTH`, `2`, **Текст** для **Тип** и значение `Раскрывающийся список` для свойства **Данные** значение `1; 2; 3; 4; 5; 6; 7; 8; 9;`.  
  
5.  Щелкните второе поле со списком.  Измените **Заголовок** на **Идентификатор** значение `Толстое перо`, `ID_PEN_THICK_WIDTH`, `5`, **Текст** для **Тип** и значение `Раскрывающийся список` для свойства **Данные** значение `5; 6; 7; 8; 9; 10; 11; 12; 13; 14; 15; 16; 17; 18; 19; 20;`.  
  
6.  Новые поля со списком не соответствуют имеющимся пунктов меню.  Следовательно, необходимо создать пункт меню для каждого параметра пера.  
  
    1.  В окне **Ресурсы** откройте ресурс меню IDR\_SCRIBBTYPE.  
  
    2.  Нажмите кнопку **Перо**, чтобы открыть меню **ru** p.  Затем нажмите **Прототип для текста** и введите `Thi&перо n`.  
  
    3.  Щелкните правой кнопкой мыши текст, который только что для открытия окна **Свойства** и измените свойства идентификатора значение `ID_PEN_THIN_WIDTH`.  
  
    4.  Необходимо также создать обработчик событий для каждого пункта меню пера.  Щелкните правой кнопкой мыши пункт меню **Утончить&перо**, созданные и затем нажмите **Добавить обработчик события**.  **Мастер обработчика события**.  
  
    5.  В поле **Список классов** в мастере, выберите **CScribbleDoc** и нажмите кнопку **Добавить\/править**.  Будет создан обработчик событий `CScribbleDoc::OnPenThinWidth`.  
  
    6.  Добавьте следующий код к `CScribbleDoc::OnPenThinWidth`.  
  
        ```  
        // Get a pointer to the ribbon bar  
        CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();  
        ASSERT_VALID(pRibbon);  
        // Get a pointer to the Thin Width combo box  
        CMFCRibbonComboBox* pThinComboBox = DYNAMIC_DOWNCAST(  
           CMFCRibbonComboBox, pRibbon->FindByID(ID_PEN_THIN_WIDTH));  
        //Get the selected value  
        int nCurSel = pThinComboBox->GetCurSel();  
        if (nCurSel >= 0)  
        {  
           m_nThinWidth = atoi(pThinComboBox->GetItem(nCurSel));  
        }  
        // Create a new pen using the selected width  
        ReplacePen();    
        ```  
  
7.  Теперь создайте пункт меню и обработчики событий для толстого пера.  
  
    1.  В окне **Ресурсы** откройте ресурс меню IDR\_SCRIBBTYPE.  
  
    2.  Нажмите кнопку **Перо** , чтобы открыть меню пера.  Затем нажмите **Прототип для текста** и введите `Thic&перо k`.  
  
    3.  Щелкните правой кнопкой мыши текст, который только что для отображения окна **Свойства**.  Измените свойства идентификатора значение `ID_PEN_THICK_WIDTH`.  
  
    4.  Щелкните правой кнопкой мыши пункт меню **Толстое перо**, созданные и затем нажмите **Добавить обработчик события**.  **Мастер обработчика события**.  
  
    5.  В окне мастера **Список классов**, выберите **CScribbleDoc** и нажмите кнопку **Добавить\/править**.  Будет создан обработчик событий `CScribbleDoc::OnPenThickWidth`.  
  
    6.  Добавьте следующий код к `CScribbleDoc::OnPenThickWidth`.  
  
        ```  
        // Get a pointer to the ribbon bar  
        CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx *) AfxGetMainWnd())->GetRibbonBar();  
        ASSERT_VALID(pRibbon);  
        CMFCRibbonComboBox* pThickComboBox = DYNAMIC_DOWNCAST(  
           CMFCRibbonComboBox, pRibbon->FindByID(ID_PEN_THICK_WIDTH));  
        // Get the selected value  
        int nCurSel = pThickComboBox->GetCurSel();  
        if (nCurSel >= 0)  
        {  
           m_nThickWidth = atoi(pThickComboBox->GetItem(nCurSel));  
        }  
        // Create a new pen using the selected width  
        ReplacePen();  
        ```  
  
8.  Сохраните изменения, а затем построить и запустить приложение.  Новые кнопки и поля со списком должны отображаться.  Попробуйте использовать различные ширины пера в scribble.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="addColorButton"></a> Чтобы добавить кнопку цвета на панель пера  
 Затем добавьте объект [CMFCRibbonColorButton](../mfc/reference/cmfcribboncolorbutton-class.md), который позволяет scribble пользователя цветом.  
  
#### Чтобы добавить кнопку цвета на панель пера  
  
1.  Прежде чем добавить кнопку цвета, создайте пункт меню для него.  В окне **Ресурсы** откройте ресурс меню IDR\_SCRIBBTYPE.  Щелкните пункт меню **Перо**  для открытия меню пера.  Затем нажмите **Прототип для текста** и введите `&Color`.  Щелкните правой кнопкой мыши текст, который только что для отображения окна **Свойства**.  Измените идентификатор на `ID_PEN_COLOR`.  
  
2.  Добавьте кнопку цвета.  Из **Панель элементов** перетащите **Кнопка цвета** на панель **Перо**.  
  
3.  Нажмите кнопку цвета.  Измените **Заголовок** на **Идентификатор** значение `Цвет`, `ID_PEN_COLOR`, `True`, к **ПростойПросмотретьБольшой индекс образа** на `1`, а для свойства **Режим разделения** значение `ложь`.  
  
4.  Сохраните изменения, а затем построить и запустить приложение.  Новая кнопку цвета должна отображаться на панели **Перо**.  Однако ее нельзя использовать, так как она еще не существует обработчик событий.  Ниже показано, как добавить обработчик событий для кнопки цвета.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="addColorMember"></a> Добавить элемент цвета в класс документа  
 Поскольку исходного приложения Scribble не имеет перья цвета, необходимо написать их реализацию.  Для хранения цвета пера документа добавьте новый элемент в класс документа `CscribbleDoc.`  
  
#### Добавить элемент цвета в класс документа  
  
1.  В scribdoc.h, в классе `CScribbleDoc` найдите раздел `// Attributes`.  Добавьте следующие строки кода после определения элемента данных `m_nThickWidth`.  
  
    ```  
    // Current pen color  
    COLORREF   m_penColor;  
    ```  
  
2.  Каждый документ содержит список гладит рукой, что пользователь уже выписал.  Каждый штрих определяется объектом `CStroke`.  Класс `CStroke` не включает сведения о цвете пера.  Поэтому необходимо изменить класс.  В scribdoc.h, в классе `CStroke`, добавьте следующие строки кода после определения элемента данных `m_nPenWidth`.  
  
    ```  
    // Pen color for the stroke  
    COLORREF   m_penColor;  
    ```  
  
3.  В scribdoc.h добавьте новый конструктор `CStroke` параметры определяют, ширину и цвет.  Добавьте следующую строку кода после выписки `CStroke(UINT nPenWidth);`.  
  
    ```  
    CStroke(UINT nPenWidth, COLORREF penColor);  
    ```  
  
4.  В scribdoc.cpp добавьте реализация нового конструктора `CStroke`.  Добавьте следующий код после реализации конструктора `CStroke::CStroke(UINT nPenWidth)`.  
  
    ```  
    // Constructor that uses the document's current width and color  
    CStroke::CStroke(UINT nPenWidth, COLORREF penColor)  
    {  
       m_nPenWidth = nPenWidth;  
       m_penColor = penColor;  
       m_rectBounding.SetRectEmpty();  
    }  
    ```  
  
5.  Измените вторая линия метода `CStroke::DrawStroke` следующим образом.  
  
    ```  
    if (!penStroke.CreatePen(PS_SOLID, m_nPenWidth, m_penColor))  
    ```  
  
6.  Настройка цвета пера по умолчанию для класса документа.  В scribdoc.cpp добавьте следующие линии в `CScribbleDoc::InitDocument` после выписки `m_nThickWidth = 5;`.  
  
    ```  
    // default pen color is black  
    m_penColor = RGB(0,0,0);   
    ```  
  
7.  В scribdoc.cpp измените первая линия метода `CScribbleDoc::NewStroke` к другому.  
  
    ```  
    CStroke* pStrokeItem = new CStroke(m_nPenWidth, m_penColor);  
    ```  
  
8.  Измените последнюю линия метода `CScribbleDoc::ReplacePen` к другому.  
  
    ```  
    m_penCur.CreatePen(PS_SOLID, m_nPenWidth, m_penColor);  
    ```  
  
9. Добавленный элемент `m_penColor` на предыдущем шаге.  Теперь создайте обработчик событий для кнопки цвета, которая задает члена.  
  
    1.  В окне **Ресурсы** откройте ресурс меню IDR\_SCRIBBTYPE.  
  
    2.  Щелкните правой кнопкой мыши пункт меню **Цвет** и щелкните **Добавление обработчика событий…**.  **Мастер обработчика события**.  
  
    3.  В поле **Список классов** в мастере, выберите **CScribbleDoc** и нажмите кнопку **Добавить\/править**.  При этом создается заглушка обработчика событий `CScribbleDoc::OnPenColor`.  
  
10. Замените заглушка обработчика событий `CScribbleDoc::OnPenColor` следующим кодом.  
  
    ```  
    void CScribbleDoc::OnPenColor()  
    {  
    // Change pen color to reflect color button's current selection  
    CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();  
    ASSERT_VALID(pRibbon);  
    CMFCRibbonColorButton* pColorBtn = DYNAMIC_DOWNCAST(  
       CMFCRibbonColorButton, pRibbon->FindByID(ID_PEN_COLOR));  
    m_penColor = pColorBtn->GetColor();  
    // Create new pen using the selected color  
    ReplacePen();  
    }  
    ```  
  
11. Сохраните изменения и затем выполните построение и запустите приложение.  Необходимо знать, как нажать кнопку цвета и изменения цвета пера.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="initPenSave"></a> Инициализация перья и сохранить настройки  
 Далее, инициализируйте цвет и ширину перьев.  Наконец, сохранять и загружает рисунок цвета из файла.  
  
#### Инициализация элементов управления в панели ленты  
  
1.  Инициализация перья на панели ленты.  
  
     Добавьте следующий код в scribdoc.cpp, в методе `CScribbleDoc::InitDocument` после выписки `m_sizeDoc = CSize(200,200)`.  
  
    ```  
    // Reset the ribbon UI to its initial values  
    CMFCRibbonBar* pRibbon =   
       ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();  
    ASSERT_VALID(pRibbon);  
    CMFCRibbonColorButton* pColorBtn = DYNAMIC_DOWNCAST(  
       CMFCRibbonColorButton,   
       pRibbon->FindByID(ID_PEN_COLOR));  
    // Set ColorButton to black  
    pColorBtn->SetColor(RGB(0,0,0));    
    CMFCRibbonComboBox* pThinComboBox = DYNAMIC_DOWNCAST(  
       CMFCRibbonComboBox,   
       pRibbon->FindByID(ID_PEN_THIN_WIDTH));  
    // Set Thin pen combobox to 2  
    pThinComboBox->SelectItem(1);   
    CMFCRibbonComboBox* pThickComboBox = DYNAMIC_DOWNCAST(  
       CMFCRibbonComboBox,   
       pRibbon->FindByID(ID_PEN_THICK_WIDTH));  
    // Set Thick pen combobox to 5  
    pThickComboBox->SelectItem(0);  
    ```  
  
2.  Сохраните цвет рисования в файл.  Добавьте следующую выписка в scribdoc.cpp, в методе `CStroke::Serialize` после выписки `ar << (WORD)m_nPenWidth;`.  
  
    ```  
    ar << (COLORREF)m_penColor;  
    ```  
  
3.  Наконец, загрузите рисунок цвета из файла.  Добавьте следующую строку кода, в методе `CStroke::Serialize` после выписки `m_nPenWidth = w;`.  
  
    ```  
    ar >> m_penColor;  
    ```  
  
4.  Теперь scribble цветом и сохраняет пользовательское рисование в файл.  
  
 \[[Подразделы](#top)\]  
  
## Заключение  
 Обновления приложения MFC Scribble.  Используйте в данном пошаговом руководстве в качестве руководства при изменении существующих приложений.  
  
## См. также  
 [Пошаговые руководства](../mfc/walkthroughs-mfc.md)   
 [Пошаговое руководство. Обновление приложения MFC Scribble \(часть 1\)](../mfc/walkthrough-updating-the-mfc-scribble-application-part-1.md)
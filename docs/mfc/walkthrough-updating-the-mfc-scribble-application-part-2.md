---
title: 'Пошаговое руководство: Обновление приложения MFC Scribble (часть 2) | Документы Microsoft'
ms.custom: ''
ms.date: 06/28/2018
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- walkthroughs [MFC]
ms.assetid: 602df5c2-17d4-4cd9-8cf6-dff652c4cae5
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: bccc10e1aa2d984486c3cadfd45a14a6625ec959
ms.sourcegitcommit: 208d445fd7ea202de1d372d3f468e784e77bd666
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2018
ms.locfileid: "37122409"
---
# <a name="walkthrough-updating-the-mfc-scribble-application-part-2"></a>Пошаговое руководство. Обновление приложения MFC Scribble (часть 2)

[Часть 1](../mfc/walkthrough-updating-the-mfc-scribble-application-part-1.md) этого пошагового руководства показано, как добавить ленту Office Fluent классической Scribble приложения. В этом разделе рассматриваются добавление панелей ленты и элементов управления, которые пользователи могут использовать вместо меню и команд.

## <a name="prerequisites"></a>Предварительные требования

[Примеры кода на Visual C++](../visual-cpp-samples.md)

##  <a name="top"></a> Разделы

В этой части пошагового руководства состоит из следующих подразделов:

- [Добавление новых элементов управления на ленту](#addnewpanel)

- [Добавление панель справки на ленту](#addhelppanel)

- [Добавление панели пера на ленту](#addpenpanel)

- [Добавление кнопки цвет на ленту](#addcolorbutton)

- [Добавление члена цвет класс документа](#addcolormember)

- [Инициализация перья и сохранение настроек](#initpensave)

##  <a name="addnewpanel"></a> Добавление новых элементов управления на ленту

Следующие шаги показывают, как добавить **представление** панель, которая содержит два флажка, управляющие видимостью панели инструментов и строки состояния, а также **окна** панель, содержащую вертикально разбиения Кнопка, которая управляет созданием и расположении окон многодокументного интерфейса (MDI).

### <a name="to-add-a-view-panel-and-window-panel-to-the-ribbon-bar"></a>Чтобы добавить панели представления и окна панели на панель ленты

1. Создание панели с именем `View`, который имеет два флажка, Переключить строку состояния и панель инструментов.

   1. Из **элементов**, перетащите **панель** для **Главная** категории. Затем перетащите два **флажки** панель.

   2. Щелкните панель, чтобы изменить его свойства. Изменение **заголовок** для `View`.

   3. Щелкните первый флажок, чтобы изменить его свойства. Изменение **идентификатор** для `ID_VIEW_TOOLBAR` и **заголовок** для `Toolbar`.

   4. Выберите второй флажок, чтобы изменить его свойства. Изменение **идентификатор** для `ID_VIEW_STATUS_BAR` и **заголовок** для `Status Bar`.

2. Создание панели с именем `Window` с разворачивающейся кнопки. При нажатии кнопки разделения контекстное меню отображаются три команды, которые уже определены в приложении Scribble.

   1. Из **элементов**, перетащите **панель** для **Главная** категории. Затем перетащите **кнопку** панель.

   2. Щелкните панель, чтобы изменить его свойства. Изменение **заголовок** для `Window`.

   3. Нажмите кнопку. Изменение **заголовок** для `Windows`, **ключей** для `w`, **индекс большого изображения** для `1`, и **режим разбиения** Чтобы `False`. Нажмите кнопку с многоточием (**...** ) рядом с **пунктов меню** Открытие **редактор элементов** диалоговое окно.

   4. Нажмите кнопку **добавить** три раза, чтобы добавить три кнопки.

   5. Нажмите кнопку «первый», а затем измените **заголовок** для `New Window`, и **идентификатор** для `ID_WINDOW_NEW`.

   6. Нажмите вторую кнопку, а затем измените **заголовок** для `Cascade`, и **идентификатор** для `ID_WINDOW_CASCADE`.

   7. Щелкните третью кнопка и измените **заголовок** для `Tile`, и **идентификатор** для `ID_WINDOW_TILE_HORZ`.

3. Сохранить изменения и затем постройте и запустите приложение. **Представление** и **окна** панели должны отображаться. Нажмите кнопки, чтобы подтвердить правильность их.

[[Разделы](#top)]

##  <a name="addhelppanel"></a> Добавление панель справки на ленту

Теперь можно назначить два элемента меню, которые определены в приложении Scribble для кнопки ленты, которые называются **разделы справки** и **об Scribble**. Кнопки добавляются в новую область с именем **справки**.

### <a name="to-add-a-help-panel"></a>Чтобы добавить панель справки

1. Из **элементов**, перетащите **панель** для **Главная** категории. Затем перетащите два **кнопки** панель.

2. Щелкните панель, чтобы изменить его свойства. Изменение **заголовок** для `Help`.

3. Нажмите первую кнопку. Изменение **заголовок** для `Help Topics`, и **идентификатор** для `ID_HELP_FINDER`.

4. Нажмите вторую кнопку. Изменение **заголовок** для `About Scribble...`, и **идентификатор** для `ID_APP_ABOUT`.

5. Сохранить изменения и затем постройте и запустите приложение. Объект **справки** отображать панель, которая содержит две кнопки на ленте.

   > [!IMPORTANT]
   > При нажатии кнопки **разделы справки** кнопки, приложение Scribble открывает сжатого файла справки HTML (.chm) с именем *your_project_name*. chm. Следовательно Если проект называется Scribble, необходимо переименовать файл справки на имя вашего проекта.

[[Разделы](#top)]

##  <a name="addpenpanel"></a> Добавление панели пера на ленту

Теперь добавьте панель для отображения кнопок, которые управляют толщину и цвет пера. Эта панель содержит флажок, который выполняет переключение между перья толстой структуру и малый размер. Аналогично его функциональность **толстой линией** элемента меню в приложении Scribble.

В исходном приложении Scribble дает пользователю возможность выбирать ширину пера в диалоговом окне, которое появляется при нажатии **толщины** меню. Поскольку панель ленты имеет достаточно места для новых элементов управления, можно заменить диалоговое окно с помощью двух поля со списком на ленте. Одно поле со списком Корректирует ширину пера тонкой и поле со списком Корректирует ширину толстого пера.

#### <a name="to-add-a-pen-panel-and-combo-boxes-to-the-ribbon"></a>Чтобы добавить перо панель "и" поле со списком "на ленте

1. Из **элементов**, перетащите **панель** для **Главная** категории. Затем перетащите **флажок** и два **поля со списком** панель.

2. Щелкните панель, чтобы изменить его свойства. Изменение **заголовок** для `Pen`.

3. Установите флажок. Изменение **заголовок** для `Use Thick`, и **идентификатор** для `ID_PEN_THICK_OR_THIN`.

4. Щелкните в первом поле со списком. Изменение **заголовок** для `Thin Pen`, **идентификатор** для `ID_PEN_THIN_WIDTH`, **текст** для `2`, **тип** для `Drop List`, и **данные** для `1;2;3;4;5;6;7;8;9;`.

5. Щелкните второе поле со списком. Изменение **заголовок** для `Thick Pen`, **идентификатор** для `ID_PEN_THICK_WIDTH`, **текст** для `5`, **тип** для `Drop List`, и **данные** для `5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20;`.

6. Новые поля со списком всех имеющихся элементов меню не соответствуют. Таким образом необходимо создать пункт меню для каждого параметра пера.

   1. В **представление ресурсов** окно, открыть ресурс меню IDR_SCRIBBTYPE.

   2. Нажмите кнопку **перо** открыть p**en** меню. Нажмите кнопку **введите здесь** и тип `Thi&n Pen`.

   3. Щелкните правой кнопкой мыши текст, который вы ввели откройте **свойства** окон, а затем изменить идентификатор свойства `ID_PEN_THIN_WIDTH`.

   4. Также необходимо создать обработчик событий для всех элементов меню пера. Щелкните правой кнопкой мыши **вер & n перо** пункт меню, который вы только что создали и нажмите кнопку **добавить обработчик событий**. **Мастер обработчиков событий** отображается.

   5. В **список классов** поле в мастере выберите **CScribbleDoc** и нажмите кнопку **добавлять и редактировать**. При этом создается обработчик событий с именем `CScribbleDoc::OnPenThinWidth`.

   6. Добавьте следующий код к `CScribbleDoc::OnPenThinWidth`.

    ```cpp
    // Get a pointer to the ribbon bar
    CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();
    ASSERT_VALID(pRibbon);

    // Get a pointer to the Thin Width combo box
    CMFCRibbonComboBox* pThinComboBox = DYNAMIC_DOWNCAST(
    CMFCRibbonComboBox, pRibbon->FindByID(ID_PEN_THIN_WIDTH));

    //Get the selected value
    int nCurSel = pThinComboBox->GetCurSel();
    if (nCurSel>= 0)
    {
        m_nThinWidth = atoi(pThinComboBox->GetItem(nCurSel));
    }
    
    // Create a new pen using the selected width
    ReplacePen();
    ```

7. Создайте меню элемента и обработчики событий для толстого пера.

   1. В **представление ресурсов** окно, открыть ресурс меню IDR_SCRIBBTYPE.

   2. Нажмите кнопку **перо** чтобы открыть меню «перо». Нажмите кнопку **введите здесь** и тип `Thic&k Pen`.

   3. Щелкните правой кнопкой мыши текст, указанный для отображения **свойства** окна. Измените значение свойства идентификатора на `ID_PEN_THICK_WIDTH`.

   4. Щелкните правой кнопкой мыши **толстого пера** пункт меню, который вы только что создали и нажмите кнопку **добавить обработчик событий**. **Мастер обработчиков событий** отображается.

   5. В **список классов** поле мастера выберите **CScribbleDoc** и нажмите кнопку **добавлять и редактировать**. При этом создается обработчик событий с именем `CScribbleDoc::OnPenThickWidth`.

   6. Добавьте следующий код к `CScribbleDoc::OnPenThickWidth`.

      ```cpp
      // Get a pointer to the ribbon bar
      CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx *) AfxGetMainWnd())->GetRibbonBar();
      ASSERT_VALID(pRibbon);

      CMFCRibbonComboBox* pThickComboBox = DYNAMIC_DOWNCAST(
          CMFCRibbonComboBox, pRibbon->FindByID(ID_PEN_THICK_WIDTH));
      // Get the selected value
      int nCurSel = pThickComboBox->GetCurSel();
      if (nCurSel>= 0)
      {
          m_nThickWidth = atoi(pThickComboBox->GetItem(nCurSel));
      }
      
      // Create a new pen using the selected width
      ReplacePen();
      ```

8. Сохранить изменения и затем постройте и запустите приложение. Отображать новые кнопки и поля со списком. Попробуйте использовать другой толщины для scribble.

[[Разделы](#top)]

##  <a name="addcolorbutton"></a> Добавление кнопки цвет пера панели

Добавьте [CMFCRibbonColorButton](../mfc/reference/cmfcribboncolorbutton-class.md) объект, позволяющий пользователю scribble цветом.

### <a name="to-add-a-color-button-to-the-pen-panel"></a>Чтобы добавить кнопку цвета на панель «перо»

1. Прежде чем добавить кнопку цвета, создайте пункт меню для него. В **представление ресурсов** окно, открыть ресурс меню IDR_SCRIBBTYPE. Нажмите кнопку **перо** пункт меню, чтобы открыть меню «перо». Нажмите кнопку **введите здесь** и тип `&Color`. Щелкните правой кнопкой мыши текст, указанный для отображения **свойства** окна. Измените идентификатор на `ID_PEN_COLOR`.

2. Теперь можно добавьте кнопку цвета. Из **элементов**, перетащите **кнопку цвета** для **перо** панель.

3. Нажмите кнопку цвета. Изменение **заголовок** для `Color`, **идентификатор** для `ID_PEN_COLOR`, **SimpleLook** для `True`, **индекс большого изображения** для `1`, и **режим разбиения** для `False`.

4. Сохранить изменения и затем постройте и запустите приложение. Должны отображаться на кнопке создания цвет **перо** панель. Однако он не может использоваться, поскольку он еще не обработчика событий. Следующие шаги демонстрируют добавить обработчик событий для кнопки «цвет».

[[Разделы](#top)]

##  <a name="addcolormember"></a> Добавление члена цвет класс документа

Так как в исходном приложении Scribble не имеет цвет перья, для них необходимо написать реализацию. Чтобы сохранить цвет пера документа, Добавление нового элемента класс документа `CscribbleDoc.`

### <a name="to-add-a-color-member-to-the-document-class"></a>Для добавления члена цвет класс документа

1. В scribdoc.h в `CScribbleDoc` класса, найти `// Attributes` раздела. Добавьте следующий код после определения `m_nThickWidth` члена данных.

   ```cpp
   // Current pen color
   COLORREF m_penColor;
   ```

2. Каждый документ содержит список штрихов, что пользователь уже отображены. Каждый штриха определяется `CStroke` объекта. `CStroke` Класса не включает сведения о цвет пера. Таким образом необходимо изменить класс. В scribdoc.h в `CStroke` класса, добавьте следующий код после определения `m_nPenWidth` члена данных.

   ```cpp
   // Pen color for the stroke
   COLORREF m_penColor;
   ```

3. В scribdoc.h, добавьте новый `CStroke` конструктор, параметры которого задайте ширину и цвет. Добавьте следующую строку кода после `CStroke(UINT nPenWidth);` инструкции.

   ```cpp
   CStroke(UINT nPenWidth, COLORREF penColor);
   ```

4. В scribdoc.cpp, добавьте реализацию нового `CStroke` конструктор. Добавьте следующий код после реализации `CStroke::CStroke(UINT nPenWidth)` конструктор.

   ```cpp
   // Constructor that uses the document's current width and color
   CStroke::CStroke(UINT nPenWidth, COLORREF penColor)
   {
       m_nPenWidth = nPenWidth;
       m_penColor = penColor;
       m_rectBounding.SetRectEmpty();
   }
   ```

5. Измените вторую строку `CStroke::DrawStroke` метод следующим образом.

   ```cpp
   if (!penStroke.CreatePen(PS_SOLID, m_nPenWidth, m_penColor))
   ```

6. Задайте цвет пера по умолчанию для класса документа. В scribdoc.cpp, добавьте следующие строки для `CScribbleDoc::InitDocument`после того, как `m_nThickWidth = 5;` инструкции.

   ```cpp
   // default pen color is black
   m_penColor = RGB(0, 0, 0);
   ```

7. В scribdoc.cpp, измените первой строки `CScribbleDoc::NewStroke` метод следующее.

   ```cpp
   CStroke* pStrokeItem = new CStroke(m_nPenWidth, m_penColor);
   ```

8. Изменения в последней строке `CScribbleDoc::ReplacePen` метод следующее.

   ```cpp
   m_penCur.CreatePen(PS_SOLID, m_nPenWidth, m_penColor);
   ```

9. Вы добавили `m_penColor` члена в предыдущем шаге. Теперь создайте обработчик событий для кнопки цвета, которая задает член.

   1. В **представление ресурсов** окно, открыть ресурс меню IDR_SCRIBBTYPE.

   2. Щелкните правой кнопкой мыши **цвет** пункт меню и нажмите кнопку **добавить обработчик событий**. **Мастер обработчиков событий** отображается.

   3. В **список классов** поле в мастере выберите **CScribbleDoc** и нажмите кнопку **добавлять и редактировать** кнопки. При этом создается `CScribbleDoc::OnPenColor` заглушки обработчик события.

10. Замените заглушку для `CScribbleDoc::OnPenColor` обработчик событий следующим кодом.

   ```cpp
   void CScribbleDoc::OnPenColor()
   {
       // Change pen color to reflect color button's current selection
       CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();
       ASSERT_VALID(pRibbon);

       CMFCRibbonColorButton* pColorBtn = DYNAMIC_DOWNCAST(
           CMFCRibbonColorButton, pRibbon->FindByID(ID_PEN_COLOR));

       m_penColor = pColorBtn->GetColor();
       // Create new pen using the selected color
       ReplacePen();
   }
   ```

11. Сохранить изменения и затем постройте и запустите приложение. Вы сможете нажмите кнопку цвета и изменить цвет пера.

[[Разделы](#top)]

##  <a name="initpensave"></a> Инициализация перья и сохранение настроек

Затем инициализируйте цвет и ширину пера. Наконец сохранять и загружать цвет рисования из файла.

### <a name="to-initialize-controls-on-the-ribbon-bar"></a>Для инициализации элементов управления на ленте

1. Инициализируйте перья на панели ленты.

   Добавьте следующий код в scribdoc.cpp, `CScribbleDoc::InitDocument` метод после того, как `m_sizeDoc = CSize(200,200)` инструкции.

   ```cpp
   // Reset the ribbon UI to its initial values
   CMFCRibbonBar* pRibbon =
       ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();
   ASSERT_VALID(pRibbon);

   CMFCRibbonColorButton* pColorBtn = DYNAMIC_DOWNCAST(
       CMFCRibbonColorButton,
       pRibbon->FindByID(ID_PEN_COLOR));

   // Set ColorButton to black
   pColorBtn->SetColor(RGB(0, 0, 0));

   CMFCRibbonComboBox* pThinComboBox = DYNAMIC_DOWNCAST(
       CMFCRibbonComboBox,
       pRibbon->FindByID(ID_PEN_THIN_WIDTH));

   // Set Thin pen combobox to 2
   pThinComboBox->SelectItem(1);

   CMFCRibbonComboBox* pThickComboBox = DYNAMIC_DOWNCAST(
       CMFCRibbonComboBox,
       pRibbon->FindByID(ID_PEN_THICK_WIDTH));

   // Set Thick pen combobox to 5
   pThickComboBox->SelectItem(0);
   ```

2. Сохраните цвет рисования в файл. Добавьте следующую инструкцию, чтобы scribdoc.cpp, в `CStroke::Serialize` метод после того, как `ar << (WORD)m_nPenWidth;` инструкции.

   ```cpp
   ar << (COLORREF)m_penColor;
    ```

3. Наконец Загрузите цвет рисования из файла. Добавьте следующую строку кода, в `CStroke::Serialize` метод после того, как `m_nPenWidth = w;` инструкции.

   ```cpp
   ar >> m_penColor;
   ```

4. Теперь scribble цветом и сохранить документ в файл.

[[Разделы](#top)]

## <a name="conclusion"></a>Заключение

Приложения MFC Scribble были обновлены. Используйте в данном пошаговом руководстве в качестве руководства при изменении существующих приложений.

## <a name="see-also"></a>См. также

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)  
[Пошаговое руководство. Обновление приложения MFC Scribble (часть 1)](../mfc/walkthrough-updating-the-mfc-scribble-application-part-1.md)  

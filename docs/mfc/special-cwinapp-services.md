---
title: "Специальные службы CWinApp | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "LoadStdProfileSettings"
  - "EnableShellOpen"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "объекты приложений [C++], службы"
  - "CWinApp - класс, перетаскивание диспетчера файлов"
  - "CWinApp - класс, инициализация GDI+"
  - "CWinApp - класс, недавно использовавшиеся документы"
  - "CWinApp - класс, службы"
  - "CWinApp - класс, регистрация оболочки"
  - "перетаскивание [C++], файлы"
  - "DragAcceptFiles - метод"
  - "EnableShellOpen - метод"
  - "файлы [C++], перетаскивание"
  - "файлы [C++], самые последние использовавшиеся"
  - "GDI+, инициализация для MFC"
  - "GDI+, подавление фонового потока [MFC]"
  - "LoadStdProfileSettings - метод"
  - "MFC [C++], файловые операции"
  - "MFC [C++], список самых недавно использовавшихся файлов"
  - "MFC [C++], регистрация оболочки"
  - "списки последних выбиравшихся файлов"
  - "регистрация типов файлов"
  - "RegisterShellFileTypes - метод"
  - "регистрация [C++], оболочка"
  - "реестр [C++], самые недавно использовавшиеся файлы"
  - "службы, предоставлено CWinApp"
  - "Оболочка, регистрация типов файлов"
ms.assetid: 0480cd01-f629-4249-b221-93432d95b431
caps.latest.revision: 10
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 7
---
# Специальные службы CWinApp
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Помимо выполнения цикла обработки сообщений и давать возможность инициализации приложения и очистить после него, [CWinApp](../mfc/reference/cwinapp-class.md) предоставляет несколько других служб.  
  
##  <a name="_core_shell_registration"></a> Регистрация оболочки  
 По умолчанию с помощью мастера приложений MFC делает возможным для пользователя открыть файлы данных, чтобы приложение ", дважды щелкнув их в проводнике или файловом менеджере.  Если приложение MDI и указать расширение для файлов, приложение создается с помощью мастера приложений MFC добавляет вызовы методов [RegisterShellFileTypes](../Topic/CWinApp::RegisterShellFileTypes.md) и функции\-члены [EnableShellOpen](../Topic/CWinApp::EnableShellOpen.md)[CWinApp](../mfc/reference/cwinapp-class.md) в `InitInstance` переопределяют, записывает автоматически.  
  
 `RegisterShellFileTypes` регистрирует типы документов приложения с проводником или файловых менеджером.  Функция добавляет записи в базе данных регистрации, которую поддерживает Windows.  Регистрируются записи каждого типа документа, связывают расширение файла с данным типом файлов, определяющие командную строку, чтобы открыть приложение, и указывает команду \(DDE\) обмена платформы динамических данных открыть документ этого типа.  
  
 `EnableShellOpen` выполняет процесс приложения, предоставляя возможность доступа к командам DDE из проводника или файлового — открыть файл выбранный пользователем.  
  
 Эта поддержка автоматической регистрации в `CWinApp` исключает необходимость сделать reg\-файла вместе с приложением или рабочими специальной установки задачи.  
  
 Если требуется инициализировать GDI\+ для приложения \(путем вызова [GdiplusStartup](_gdiplus_FUNC_GdiplusStartup_token_input_output_) в функции [InitInstance](../Topic/CWinApp::InitInstance.md) \), необходимо отключить фоновый поток GDI\+.  
  
 Это можно сделать, параметр **SuppressBackgroundThread** члена структуры [GdiplusStartupInput](_gdiplus_STRUC_GdiplusStartupInput) в **TRUE**.  Подавляя фоновый поток GDI\+, **NotificationHook** и **NotificationUnhook** \(см. [GdiplusStartupOutput](_gdiplus_STRUC_GdiplusStartupOutput)\) должны быть выполненные только до вставки и оставить цикл обработки сообщений приложения.  Поэтому рекомендуется начать ознакомление с раздела для вызова **GdiplusStartup** и функции уведомления обработчика, будут находиться в переопределении виртуальной функции [CWinApp::Run](../Topic/CWinApp::Run.md), как показано ниже:  
  
 [!code-cpp[NVC_MFCDocView#6](../mfc/codesnippet/CPP/special-cwinapp-services_1.cpp)]  
  
 Если не отключаются фоновый поток GDI\+, команды можно DDE преждевременно проблему в приложение до его главное окно было создано.  Команды DDE выданные оболочкой можно преждевременно прервать, и в сообщениях об ошибках.  
  
##  <a name="_core_file_manager_drag_and_drop"></a> Файловый менеджер перетаскивания  
 Файлы можно перетаскивать из окна представления файла файлового менеджере или проводника в окно в приложении.  Можно, например, включить один или несколько файлов, перетащенным в главное окно приложения MDI, где приложение может получить имена файлов и открыть дочерние окна MDI для этих файлов.  
  
 Чтобы включить файл перетаскивания в приложении с помощью мастера приложений MFC записывает вызов функции\-члены [DragAcceptFiles](../Topic/CWnd::DragAcceptFiles.md)[CWnd](../Topic/CWnd%20Class.md) для основного фреймового окна в `InitInstance`.  Можно удалить этот вызов, если не нужно реализовать функцией перетаскивания.  
  
> [!NOTE]
>  Также можно реализовать наиболее общий перетаскивания возможность\- при перетаскивании данных или в документ\- с OLE.  Дополнительные сведения см. в статье [Перетаскивание OLE \(\)](../mfc/drag-and-drop-ole.md).  
  
##  <a name="_core_keeping_track_of_the_most_recently_used_documents"></a> Отслеживать последних использовавшийся ся документов  
 По мере того, как пользователь открывает и закрывает файлы, объект приложения следит за 4 последних использовавшийся ся файлов.  Имена этих файлов добавляются в меню "Файл" и обновляются при изменении.  Платформа эти имена файлов хранятся либо в реестре, либо в INI\-файле с таким же именем, что и проект, и считывает их из файла при запуске приложения.  Переопределение `InitInstance`, мастер приложений MFC создается автоматически включает вызов функции\-члены [LoadStdProfileSettings](../Topic/CWinApp::LoadStdProfileSettings.md)[CWinApp](../mfc/reference/cwinapp-class.md), который загружает данные из реестра или INI\-файла, включая последние использовавшийся ся имена файлов.  
  
 Эти записи хранятся следующим образом:  
  
-   В Windows NT, Windows 2000 и более поздних версиях, значение сохраняется в раздел реестра.  
  
-   В Windows 3.x, значение сохраняется в файле WIN.INI.  
  
-   В Windows 95 и более поздних версиях, значение сохраняется в кэшированной версии WIN.INI.  
  
## См. также  
 [CWinApp: класс приложений](../Topic/CWinApp:%20The%20Application%20Class.md)
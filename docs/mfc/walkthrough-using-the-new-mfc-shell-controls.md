---
title: "Пошаговое руководство. Использование новых элементов управления оболочки MFC | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "элементы управления оболочки (MFC)"
ms.assetid: f0015caa-199d-4aaf-9501-5a239fce9095
caps.latest.revision: 14
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 10
---
# Пошаговое руководство. Использование новых элементов управления оболочки MFC
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этом пошаговом руководстве создается приложение, которое будет выглядеть как передаточного звена.  Предлагается создать окно с двумя областями.  В левой области будет содержаться объект [CMFCShellTreeCtrl](../mfc/reference/cmfcshelltreectrl-class.md), отображающего рабочий стол в иерархическом представлении.  В правой области будет содержаться [CMFCShellListCtrl](../mfc/reference/cmfcshelllistctrl-class.md), которая указывает файлы в папке, выбранной в левой области.  
  
## Обязательные компоненты  
 В данном пошаговом руководстве высказывать, не настраивал [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)] для использования **Обычные параметры разработки**.  Если используется другой параметр разработки, некоторые окна [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)], мы используем в этом пошаговом руководстве не могут отображаться по умолчанию.  
  
### Создание нового приложения MFC с помощью мастера приложений MFC  
  
1.  Используйте **Мастер приложений MFC** для создания нового приложения MFC.  Чтобы запустить мастер, select **Создать** из меню **Файл**, а затем выбрав **Проект**.  Откроется диалоговое окно **Создать проект** будет отображаться.  
  
2.  В диалоговом окне **Создать проект** разверните узел **Visual C\+\+** в области **Типы проектов** и выберите **Библиотека MFC**.  Затем в области **Шаблоны**, выберите **Приложение MFC**.  Введите имя проекта, например `MFCShellControls` и нажмите кнопку **ОК**.  **Мастер приложений MFC** Будет отображаться.  
  
3.  В диалоговом окне **Мастер приложений MFC**, щелкните **Далее**.  Область **Тип приложения** отображается.  
  
4.  В области **Тип приложения** выберите **Тип приложения**, снять флажок **Документы с вкладками**.  Далее, выберите **Один документ** и выберите **Поддержка архитектуры документов и представлений**.  В области **Стиль проекта**, отборным **Visual Studio** и в раскрывающемся списке select **Office 2007 \(синяя тема\)Визуальный стиль и цвета**.  Оставьте все остальные параметры по мере их.  Нажмите кнопку **Далее**, чтобы отобразить область **Поддержка составн. док\-тов**.  
  
5.  В области **Поддержка составн. док\-тов**, выберите **Нет**.  Нажмите кнопку **Далее**, чтобы отобразить область **Строки шаблона документа**.  
  
6.  Не вносите никаких изменений в область **Строки шаблона документа**.  Нажмите кнопку **Далее**, чтобы отобразить область **Поддержка базы данных**.  
  
7.  В области **Поддержка базы данных** выберите **Нет**, поскольку это приложение не использует базу данных.  Нажмите кнопку **Далее**, чтобы отобразить область **Свойства интерфейса пользователя**.  
  
8.  В области **Свойства интерфейса пользователя** убедитесь, что выбран параметр **Использовать строку меню и панель инструментов**.  Оставьте все остальные параметры по мере их.  Нажмите кнопку **Далее**, чтобы отобразить область **Дополнительные параметры**.  
  
9. В области **Дополнительные параметры** в поле **Дополнительные параметры** выберите только **Элементы управления ActiveX** и **Манифест стандартных элементов управления**.  В области **Дополнительные области фреймов** выделите только параметр **Область переходов**.  После этого мастер создания область слева от окна с уже внедренный `CMFCShellTreeCtrl`.  Нажмите кнопку **Далее**, чтобы отобразить область **Созданные классы**.  
  
10. Это не идем вносить изменения в области **Созданные классы**.  Следовательно, нажмите кнопку **Готово** для создания нового проекта MFC.  
  
11. Убедитесь, что приложение было успешно создано, выполнив его построение и запуск.  Для построения приложения в меню select **Построить решениеСборка**.  Если построение приложения выполнено успешно, запустите приложение, выбрав **Начать отладку** в меню **Отладка**.  
  
     Мастер автоматически создает приложение, имеющее стандартной строки меню, панели инструментов, стандартный стандартную строку состояния и outlook область слева от окна на представление **Папки** и представление **Календарь**.  
  
### Добавление элемента управления "Список" оболочки в представление документа  
  
1.  В этом разделе добавьте экземпляр `CMFCShellListCtrl` в представление, мастером.  Откройте файл заголовка представления, дважды щелкнув MFCShellControlsView.h в **Обозреватель решений**.  
  
     Найдите директива `#pragma once` в верхней части файла заголовка.  Непосредственно под ним добавьте следующий код для включения файла заголовка для `CMFCShellListCtrl`:  
  
    ```  
    #include <afxShellListCtrl.h>  
    ```  
  
     Теперь добавьте переменную\-член типа `CMFCShellListCtrl`.  Сначала найдите следующий комментарий в файле заголовка.  
  
    ```  
    // Generated message map functions  
    ```  
  
     Непосредственно над этим комментария добавьте следующий код:  
  
    ```  
    private:  
        CMFCShellListCtrl m_wndList;  
    ```  
  
2.  **Мастер приложений MFC** Уже создал объект `CMFCShellTreeCtrl` в классе `CMainFrame`, но защищенному члену.  Рекомендуется открыть этот объект позже.  Таким образом, создайте доступ для ее сейчас.  Откройте файл заголовка MainFrm.h, дважды щелкнув его в **Обозреватель решений**.  Найдите следующий комментарий.  
  
    ```  
    // Attributes  
    ```  
  
     Непосредственно под ним добавьте объявление следующего приема:  
  
    ```  
    public:  
        CMFCShellTreeCtrl& GetShellTreeCtrl();  
    ```  
  
     Затем откройте файл источника MainFrm.cpp, дважды щелкнув его в **Обозреватель решений**.  В нижней части этого файла, добавьте определение следующего приема:  
  
    ```  
    CMFCShellTreeCtrl& CMainFrame::GetShellTreeCtrl()  
    {  
        return m_wndTree;  
    }  
    ```  
  
3.  Теперь следует обновим класс `CMFCShellControlsView` для обработки сообщения windows **WM\_CREATE**.  Откройте файл заголовка MFCShellControlsView.h и нажмите на следующую строку кода:  
  
    ```  
    class CMFCShellControlsView : public CView  
    ```  
  
     Далее, в диалоговом окне **Свойства**, щелкните Значок **Сообщения**.  Прокрутите вниз до тех пор, пока не найдете сообщение **WM\_CREATE**.  В раскрывающемся списке рядом с **WM\_CREATE**, выберите **\<Add\> OnCreate**.  Это создает обработчик сообщений для нас и автоматически обновляется схема сообщений MFC.  
  
     В методе `OnCreate` мы создадим теперь этот объект `CMFCShellListCtrl`.  Найдите определение метода `OnCreate` в файле источника MFCShellControlsView.cpp реализация и замените его следующим кодом:  
  
    ```  
    int CMFCShellControlsView::OnCreate(LPCREATESTRUCT lpCreateStruct)  
    {  
        if (CView::OnCreate(lpCreateStruct) == -1)  
            return -1;  
  
        CRect rectDummy (0, 0, 0, 0);  
        m_wndList.Create(WS_CHILD | WS_VISIBLE | LVS_REPORT,  
            rectDummy, this, 1);  
  
        return 0;  
    }  
    ```  
  
4.  Повторяющийся предыдущий шаг, но для сообщения **WM\_SIZE**.  После этого представления перерисовать приложений, когда пользователь изменяет размер окна приложения.  Замените определение метода `OnSize` следующим кодом:  
  
    ```  
    void CMFCShellControlsView::OnSize(UINT nType, int cx, int cy)  
    {  
        CView::OnSize(nType, cx, cy);  
        m_wndList.SetWindowPos(NULL, -1, -1, cx, cy,  
            SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);  
    }  
    ```  
  
5.  Последний этап подключения объекты `CMFCShellTreeCtrl` и `CMFCShellListCtrl` с помощью метода [CMFCShellTreeCtrl::SetRelatedList](../Topic/CMFCShellTreeCtrl::SetRelatedList.md).  После вызова этого метода, `CMFCShellListCtrl` автоматически отображает содержимое элемента, выбранного в `CMFCShellTreeCtrl`.  Мы будет делать это в методе `OnActivateView`, который переопределен в [CView::OnActivateView](../Topic/CView::OnActivateView.md).  
  
     В файле заголовка, MFCShellControlsView.h внутри объявления класса `CMFCShellControlsView` добавьте объявление следующего приема:  
  
    ```  
    protected:  
        virtual void OnActivateView(BOOL bActivate,  
            CView* pActivateView,  
            CView* pDeactiveView);  
    ```  
  
     Добавьте определение этого метода в файл источника MFCShellControlsView.cpp:  
  
    ```  
    void CMFCShellControlsView::OnActivateView(BOOL bActivate,  
        CView* pActivateView,  
        CView* pDeactiveView)   
    {  
        if (bActivate && AfxGetMainWnd() != NULL)  
        {  
            ((CMainFrame*)AfxGetMainWnd())->GetShellTreeCtrl().SetRelatedList(&m_wndList);  
        }  
  
        CView::OnActivateView(bActivate, pActivateView, pDeactiveView);  
    }  
    ```  
  
     Поскольку мы будем называть методы из класса `CMainFrame`, нужно добавить директиву `#include` в верхней части файла источника MFCShellControlsView.cpp:  
  
    ```  
    #include "MainFrm.h"  
    ```  
  
6.  Убедитесь, что приложение было успешно создано, выполнив его построение и запуск.  Для построения приложения в меню select **Построить решениеСборка**.  Если построение приложения выполнено успешно, запустите его с помощью пункта **Начать отладку** в меню **Отладка**.  
  
     Должны отобразиться сведения для элемента, выбранного в `CMFCShellTreeCtrl` в области просмотра.  При выборе узла в `CMFCShellTreeCtrl`, `CMFCShellListCtrl` автоматически обновляются.  Кроме того, если дважды щелкнуть папку в `CMFCShellListCtrl`, `CMFCShellTreeCtrl` должна быть автоматически обновляется.  
  
     Щелкните правой кнопкой мыши любой элемент в элементе управления дерева или в элементе управления списка.  Обратите внимание, что при получении такого же контекстное меню при использовании реальный проводник.  
  
## Следующие действия  
  
-   Мастером панели outlook, в область **Папки**, и с областью **Календарь**.  Он может не должно иметь область **Календарь** в окне обозревателя.  Поэтому удалите эта область ".  
  
-   Файлы `CMFCShellListCtrl` поддерживает просмотр в различных режимах, такие как **Крупные значки**, **Мелкие значки**, **Список** и **Сведения**.  Обновление приложения для реализации этой функции.  Подсказка. в разделе [Примеры кода на Visual C\+\+](../top/visual-cpp-samples.md).  
  
## См. также  
 [Пошаговые руководства](../mfc/walkthroughs-mfc.md)
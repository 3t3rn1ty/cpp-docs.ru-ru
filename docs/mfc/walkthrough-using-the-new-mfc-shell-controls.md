---
title: 'Пошаговое руководство: Использование MFC, новый оболочки управления | Документы Microsoft'
ms.custom: ''
ms.date: 06/28/2018
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- shell controls (MFC)
ms.assetid: f0015caa-199d-4aaf-9501-5a239fce9095
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: eebfc98af109bbcdb0e5c1b3b2b3bf517dd8b076
ms.sourcegitcommit: 208d445fd7ea202de1d372d3f468e784e77bd666
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2018
ms.locfileid: "37122102"
---
# <a name="walkthrough-using-the-new-mfc-shell-controls"></a>Пошаговое руководство. Использование новых элементов управления оболочки MFC

В этом пошаговом руководстве вы создадите приложения вида проводника. Вы создадите окна, содержащего две области. В левой области будет содержаться [CMFCShellTreeCtrl](../mfc/reference/cmfcshelltreectrl-class.md) объекта, который отображает рабочий стол в иерархическом представлении. В правой области будет содержаться [объект CMFCShellListCtrl](../mfc/reference/cmfcshelllistctrl-class.md) , отображение файлов в папке, выбранной в левой области.

## <a name="prerequisites"></a>Предварительные требования

В этом пошаговом руководстве предполагается, что вы настроили [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)] использовать **обычные параметры разработки**. При использовании параметров разработки некоторые [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)] windows, используемые в этом пошаговом руководстве будет отображаться по умолчанию.

### <a name="to-create-a-new-mfc-application-by-using-the-mfc-application-wizard"></a>Создание нового приложения MFC с помощью мастера приложений MFC

1. Используйте **мастер приложений MFC** для создания нового приложения MFC. Запуск мастера **файл** меню выберите **New**и выберите **проекта**. **Новый проект** будет отображаться диалоговое окно.

2. В **новый проект** диалогового окна разверните **Visual C++** узел в **типов проектов** области и выберите команду **MFC**. Затем в **шаблоны** выберите **приложение MFC**. Введите имя проекта, например `MFCShellControls` и нажмите кнопку **ОК**. **Мастер приложений MFC** будет отображаться.

3. В **мастер приложений MFC** диалоговое окно, нажмите кнопку **Далее**. **Тип приложения** появится область.

4. На **тип приложения** панели в разделе **тип приложения**снимите **документы с вкладками** параметр. Затем выберите **однооконный** и выберите **поддержка архитектуры Document/View**. В разделе **проекта стиль**выберите **Visual Studio**и из **визуальный стиль и цвета** раскрывающемся списке выберите **Office 2007 (синяя тема)**. Изменяйте другие параметры. Нажмите кнопку **Далее** для отображения **поддержка составных документов** области.

5. На **поддержка составных документов** выберите **нет**. Нажмите кнопку **Далее** для отображения **строки шаблонов документов** области.

6. Не внести изменения в **строки шаблонов документов** области. Нажмите кнопку **Далее** для отображения **Поддержка баз данных** области.

7. На **Поддержка баз данных** выберите **нет** так, как это приложение не использует базу данных. Нажмите кнопку **Далее** для отображения **возможности пользовательского интерфейса** области.

8. На **возможности пользовательского интерфейса** области, убедитесь, что **использовать строку меню и панель инструментов** выбран параметр. Изменяйте другие параметры. Нажмите кнопку **Далее** для отображения **дополнительные функции** области.

9. На **дополнительные функции** панели в разделе **дополнительные функции**, выберите только **элементы управления ActiveX** и **общие манифеста управления**. В разделе **дополнительные области фреймов**, выберите только **панели навигации** параметр. Мастер создания панели в левой части окна с `CMFCShellTreeCtrl` уже встроены. Нажмите кнопку **Далее** для отображения **классы, создаваемые** области.

10. Мы не будем внести изменения в **классы, создаваемые** области. Таким образом, нажмите кнопку **Готово** для создания нового проекта MFC.

11. Убедитесь, что приложение успешно создано, построения и выполнения его. Чтобы построить приложение, из **построения** меню выберите **построить решение**. Если сборка приложения прошла успешно, запустите приложение, выбрав **начать отладку** из **отладки** меню.

   Мастер автоматически создает приложение, имеющее стандартные меню, стандартная панель инструментов, строка состояния стандартные и панель Outlook слева от окна с **папки** представление и **календаря** представление .

### <a name="to-add-the-shell-list-control-to-the-document-view"></a>Чтобы добавить элемент управления списка оболочки для просмотра документа

1. В этом разделе вы добавите экземпляр `CMFCShellListCtrl` к представлению, созданный мастером. Откройте файл заголовка представления, дважды щелкнув MFCShellControlsView.h в **обозревателе решений**.

   Найдите `#pragma once` директив в верхней части файла заголовка. Сразу же под его добавьте следующий код, чтобы включить файл заголовка для `CMFCShellListCtrl`:

   ```cpp
   #include <afxShellListCtrl.h>
   ```

   Теперь добавьте переменную-член типа `CMFCShellListCtrl`. Во-первых найдите следующий комментарий в файле заголовка:

   ```cpp
   // Generated message map functions
   ```

   Непосредственно над этого комментария добавьте следующий код:

   ```cpp
   private:
   CMFCShellListCtrl m_wndList;
   ```

2. **Мастер приложений MFC** уже создан `CMFCShellTreeCtrl` объекта в `CMainFrame` класса, но она имеет защищенный элемент. Мы будем обращаться этого объекта. Таким образом создаете метод доступа для него сейчас. Откройте файл заголовка MainFrm.h, дважды щелкнув его в **обозревателе решений**. Найдите следующий комментарий:

   ```cpp
   // Attributes
   ```

   Сразу же под ней добавьте следующее объявление метода:

   ```cpp
   public:
       CMFCShellTreeCtrl& GetShellTreeCtrl();
   ```

   Затем откройте исходный файл MainFrm.cpp, дважды щелкнув его в **обозревателе решений**. В нижней части этого файла добавьте следующее определение метода:

   ```cpp
   CMFCShellTreeCtrl& CMainFrame::GetShellTreeCtrl()
   {
        return m_wndTree;
   }
   ```

3. Теперь мы обновление `CMFCShellControlsView` класса, чтобы обрабатывать **WM_CREATE** сообщение windows. Откройте файл заголовка MFCShellControlsView.h и щелкните эту строку кода:

    ```cpp
    class CMFCShellControlsView : public CView
    ```

   Затем в **свойства** окно, нажмите кнопку **сообщений** значок. Прокрутите вниз, пока не найдете **WM_CREATE** сообщения. Из раскрывающегося списка рядом с **WM_CREATE**выберите  **\<Добавить > OnCreate**. Это создает обработчик сообщений для нас и автоматически обновляет схему сообщений MFC.

   В `OnCreate` создадим метод нашей `CMFCShellListCtrl` объекта. Найти `OnCreate` определение метода в MFCShellControlsView.cpp исходный файл и замените его реализации с помощью следующего кода:

    ```cpp
    int CMFCShellControlsView::OnCreate(LPCREATESTRUCT lpCreateStruct)
    {
        if (CView::OnCreate(lpCreateStruct) == -1)
            return -1;

        CRect rectDummy (0, 0, 0, 0);

        m_wndList.Create(WS_CHILD | WS_VISIBLE | LVS_REPORT,
            rectDummy, this, 1);

        return 0;
    }
    ```

4. Повторите предыдущий шаг, но для **WM_SIZE** сообщения. В результате представление приложений перерисовку всякий раз, когда пользователь изменяет размер окна приложения. Замените определение `OnSize` метод следующим кодом:

    ```cpp
    void CMFCShellControlsView::OnSize(UINT nType, int cx, int cy)
    {
        CView::OnSize(nType, cx, cy);

        m_wndList.SetWindowPos(NULL, -1, -1, cx, cy,
            SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);
    }
    ```

5. Последним шагом является подключение `CMFCShellTreeCtrl` и `CMFCShellListCtrl` объектов с помощью [CMFCShellTreeCtrl::SetRelatedList](../mfc/reference/cmfcshelltreectrl-class.md#setrelatedlist) метод. После вызова этого метода `CMFCShellListCtrl` автоматически будет отображать содержимое элемента, выбранного в `CMFCShellTreeCtrl`. Мы сделаем это `OnActivateView` метод, который переопределяется из [CView::OnActivateView](../mfc/reference/cview-class.md#onactivateview).

   В файле заголовка MFCShellControlsView.h внутри `CMFCShellControlsView` объявления класса, добавьте следующее объявление метода:

    ```cpp
    protected:
    virtual void OnActivateView(BOOL bActivate,
        CView* pActivateView,
        CView* pDeactiveView);
    ```

   Добавьте определение для этого метода в MFCShellControlsView.cpp исходный файл.

    ```cpp
    void CMFCShellControlsView::OnActivateView(BOOL bActivate,
        CView* pActivateView,
        CView* pDeactiveView)
    {
        if (bActivate&& AfxGetMainWnd() != NULL)
        {
            ((CMainFrame*)AfxGetMainWnd())->GetShellTreeCtrl().SetRelatedList(&m_wndList);
        }

        CView::OnActivateView(bActivate,
            pActivateView,
            pDeactiveView);
    }
    ```

   Поскольку поступает вызов методов из `CMainFrame` класса, необходимо добавить `#include` директив в верхней части исходного файла MFCShellControlsView.cpp:

    ```cpp
    #include "MainFrm.h"
    ```

6. Убедитесь, что приложение успешно создано, построения и выполнения его. Чтобы построить приложение, из **построения** меню выберите **построить решение**. Если сборка приложения прошла успешно, запустите его, выбрав **начать отладку** из **отладки** меню.

   Теперь вы увидите сведения для элемента, выбранного в `CMFCShellTreeCtrl` в области представления. При нажатии на узел в `CMFCShellTreeCtrl`, `CMFCShellListCtrl` будут обновляться автоматически. Аналогично Если дважды щелкнуть папку в `CMFCShellListCtrl`, `CMFCShellTreeCtrl` должны обновляться автоматически.

   Щелкните правой кнопкой мыши любой элемент в элементе управления иерархического представления или в элементе управления списком. Следует отметить, что контекстное меню же как при использовании реального файла в проводнике.

## <a name="next-steps"></a>Следующие шаги

- Мастер создал панель Outlook с обоими **папки** области и **календаря** области. Он, скорее всего, не имеет смысла иметь **календаря** панель в окне проводника. Таким образом удалите этой панели.

- `CMFCShellListCtrl` Поддерживает просмотр файлов в различных режимах, таких как **крупные значки**, **мелких значков**, **списка**, и **сведения**. Обновление приложения для реализации этой функции. Подсказка: в разделе [примеры Visual C++](../visual-cpp-samples.md).

## <a name="see-also"></a>См. также

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)  

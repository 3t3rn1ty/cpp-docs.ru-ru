---
title: "Два способа создать объект CArchive | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "CArchive"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "CArchive - класс, закрытие объектов CArchive"
  - "CArchive - класс, конструктор"
  - "CArchive - объекты"
  - "CArchive - объекты, закрытие"
  - "хранение данных [C++], CArchive - класс"
  - "Ввод и вывод [MFC], создание объектов CArchive"
  - "сериализация [C++], CArchive - класс"
  - "хранение [C++], CArchive - класс"
ms.assetid: aefa28ce-b55c-40dc-9e42-5f038030985d
caps.latest.revision: 10
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 6
---
# Два способа создать объект CArchive
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

2 Способа создания объекта `CArchive`:  
  
-   [Неявное создание объекта CArchive через платформу](#_core_implicit_creation_of_a_carchive_object_via_the_framework)  
  
-   [Явное создание экземпляра объекта CArchive](#_core_explicit_creation_of_a_carchive_object)  
  
##  <a name="_core_implicit_creation_of_a_carchive_object_via_the_framework"></a> Неявное создание объекта CArchive с помощью платформы .NET Framework  
 Чаще всего, и наиболее простой способ платформе, позволяет создать объект `CArchive` для документа его сохранения, сохранить как и открыть команды в меню "Файл".  
  
 Здесь роль платформы. если пользователь текущих проблем приложения команда "Сохранить как" из меню "Файл":  
  
1.  Открывает диалоговое окно **Сохранить как** и получает имя файла пользователя.  
  
2.  Открывается файл с именем пользователя как объект `CFile`.  
  
3.  Создает объект `CArchive`, на который указывает на этот объект `CFile`.  При создании объекта `CArchive` платформа задает режим «хранилище» \(запись, издайте сериализации\), в отличие от «прочитанной загрузки, выполнения \(»\).  
  
4.  Вызывает функцию `Serialize`, указанных в **CDocument**\- производном классе, передав ему ссылку на объект `CArchive`.  
  
 Функция `Serialize` создаваемого документа затем записывает данные в объект `CArchive`, как объясняется вскоре.  При возврате из функции `Serialize` платформа уничтожает объект `CArchive` и затем объект `CFile`.  
  
 Таким образом, если платформе позволяет создать объект `CArchive` для документа, то все, что нужно сделать для реализации функций `Serialize` документа, которая считывает и записывает входящие и исходящие архива.  Необходимо также реализовать `Serialize` для любого `CObject`\- производные объекты, функция `Serialize` документа в свою очередь сериализует прямо или косвенно.  
  
##  <a name="_core_explicit_creation_of_a_carchive_object"></a> Явное создание экземпляра объекта CArchive  
 Помимо сериализации документа через платформу, другие случаи, когда имеется объект `CArchive`.  Например, может потребоваться сериализация данных на диск и с него, представленного объектом `CSharedFile`.  Или, возможно, потребуется использовать интерфейс пользователя для сохранения файла, отличается от одного предложенное средой выполнения.  В этом случае можно явно создать объект `CArchive`.  Это действие выполняется так же, как платформа выполняется с помощью следующей процедуры.  
  
#### Явно создать объект CArchive  
  
1.  Создайте объект `CFile` или объект, производный от `CFile`.  
  
2.  Передайте объект `CFile` конструктора для `CArchive`, как показано в следующем примере:  
  
     [!code-cpp[NVC_MFCSerialization#5](../mfc/codesnippet/CPP/two-ways-to-create-a-carchive-object_1.cpp)]  
  
     Второй аргумент конструктора `CArchive` перечисляемое значение, определяющее, используется ли архив для сохранения или загрузки данных на или из файла.  Функция `Serialize` объекта проверяет это состояние путем вызова функции `IsStoring` для объекта архива.  
  
 Завершив сохранения или загрузки данных на или из объекта `CArchive`, закрыть его.  Хотя объекты `CArchive` \(и `CFile`\) автоматически закроют архив \(и файл\), рекомендуется явно сделать, так как она выполняет восстановление из ошибок проще.  Обработка ошибок Дополнительные сведения о см. в статье [Исключения: Улавливающ и удаление исключения](../mfc/exceptions-catching-and-deleting-exceptions.md).  
  
#### Закрыть объект CArchive  
  
1.  В следующем примере показано, как закрыть объект `CArchive`:  
  
     [!code-cpp[NVC_MFCSerialization#6](../mfc/codesnippet/CPP/two-ways-to-create-a-carchive-object_2.cpp)]  
  
## См. также  
 [Сериализация. Сериализация объекта](../Topic/Serialization:%20Serializing%20an%20Object.md)
---
title: "Пошаговое руководство. Обновление приложения MFC Scribble (часть 1) | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "примеры [C++], обновление существующего приложения"
  - "Пакет компонентов MFC, обновление существующего приложения"
  - "ИП Office Fluent, перенос в"
  - "ИП ленты, перенос в"
  - "примеры [C++], обновление существующего приложения"
  - "пошаговые руководства [C++], обновление существующего приложения"
ms.assetid: aa6330d3-6cfc-4c79-8fcb-0282263025f7
caps.latest.revision: 54
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 50
---
# Пошаговое руководство. Обновление приложения MFC Scribble (часть 1)
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этом пошаговом руководстве показано, как изменить существующее приложение MFC использовать пользовательский интерфейс ленты.  Visual Studio поддерживает и ленты Office 2007 и Windows 7 сценарное ленты.  Дополнительные сведения о пользовательский интерфейс ленты см. в разделе [Ленты](http://go.microsoft.com/fwlink/?LinkId=129233) на веб\-сайте MSDN.  
  
 В данном пошаговом руководстве изменяется классического примера 1.0 MFC Scribble, позволяет использовать мышь, чтобы создать карандашные фигур.  В этой части пошагового руководства показывает, как изменить образец Scribble, и оно появится панель ленты.  [Часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md) добавляет дополнительные кнопки на панели ленты.  
  
## Обязательные компоненты  
 [Примеры кода на Visual C\+\+](../top/visual-cpp-samples.md)  
  
 [Примеры кода на Visual C\+\+](../top/visual-cpp-samples.md)  
  
##  <a name="top"></a> Подразделы  
 В этой части пошагового руководства имеет следующие разделы:  
  
-   [Заменить базовые классы](#replaceClass)  
  
-   [Добавление растровых изображений в проект](#addBitmap)  
  
-   [Добавление ресурса ленты в проект](#addRibbon)  
  
-   [Создание экземпляра панели ленты](#createInstance)  
  
-   [Добавление категории ленты](#addCategory)  
  
-   [Параметр " приложения](#setLook)  
  
##  <a name="replaceClass"></a> Заменить базовые классы  
 Чтобы преобразовать приложение, поддерживающее меню в приложение, поддерживающее ленты, необходимо создать приложение, фреймовое окно, панели инструментов и классы из обновленных базовых классов. \(Рекомендуется ознакомиться, не изменяя исходный образец Scribble; вместо этого удалите проекта Scribble, скопируйте его в другой каталог, а затем изменить копию\).  
  
#### Заменить базовых классов приложения Scribble  
  
1.  В scribble.cpp убедитесь, что `CScribbleApp::InitInstance` включает вызов [AfxOleInit](../Topic/AfxOleInit.md).  
  
2.  Добавьте следующий код в файл stdafx.h.  
  
    ```  
    #include <afxcontrolbars.h>  
    ```  
  
3.  В scribble.h измените определение класса `CScribbleApp` таким образом, чтобы он является производным от класса [CWinAppEx Class](../mfc/reference/cwinappex-class.md).  
  
    ```  
    class CScribbleApp: public CWinAppEx  
    ```  
  
4.  Scribble 1.0 был записан при Windows\-приложение использовался файл инициализации \(INI\) для сохранения данных параметры пользователя.  Вместо файла настройки, измените Scribble для хранения настроек пользователя в реестре.  Чтобы задать раздел реестра и базу, введите следующий код в `CScribbleApp::InitInstance` после выписки `LoadStdProfileSettings()`.  
  
    ```  
    SetRegistryKey(_T("MFCNext\\Samples\\Scribble2"));  
    SetRegistryBase(_T("Settings"));  
    ```  
  
5.  Большая ЭВМ для приложения \(MDI\)\) больше не является производным от класса `CMDIFrameWnd`.  Вместо этого он является производным от класса [CMDIFrameWndEx](../Topic/CMDIFrameWndEx%20Class.md).  
  
     В файлах mainfrm.h и mainfrm.cpp, следует заменить все ссылки на `CMDIFrameWnd` с `CMDIFrameWndEx`.  
  
6.  В файлах childfrm.h и childfrm.cpp замените `CMDIChildWnd` с `CMDIChildWndEx`.  
  
     В childfrm. файл h, заменяет `CSplitterWnd` с `CSplitterWndEx`.  
  
7.  Изменение панели инструментов и строки состояния для использования новых классов MFC.  
  
     В файле mainfrm.h:  
  
    1.  Замените `CToolBar` объектом `CMFCToolBar`.  
  
    2.  Замените `CStatusBar` объектом `CMFCStatusBar`.  
  
8.  В файле mainfrm.cpp:  
  
    1.  Замените `m_wndToolBar.SetBarStyle` с `m_wndToolBar.SetPaneStyle`  
  
    2.  Замените `m_wndToolBar.GetBarStyle` с `m_wndToolBar.GetPaneStyle`  
  
    3.  Замените `DockControlBar(&m_wndToolBar)` с `DockPane(&m_wndToolBar)`  
  
9. В файле ipframe.cpp, закомментируйте следующие 3 строк кода.  
  
    ```  
    m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);  
    pWndFrame->EnableDocking(CBRS_ALIGN_ANY);  
    pWndFrame->DockPane(&m_wndToolBar);  
    ```  
  
10. Если требуется связать приложение статически, добавьте следующий код в начало файла ресурсов проекта \(RC\).  
  
    ```  
    #include "afxribbon.rc"  
    ```  
  
     Файл afxribbon.rc содержит ресурсы, необходимые во время выполнения.  [мастер приложений MFC](../Topic/MFC%20Application%20Wizard.md) включает этот файл автоматически при создании приложения.  
  
11. Сохраните изменения и затем выполните построение и запустите приложение.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="addBitmap"></a> Добавление растровых изображений в проект  
 Следующие 4 шага данного пошагового руководства требуется ресурсов растрового изображения.  Можно получить соответствующие растровые изображения различными способами:  
  
-   Используйте [Resource Editors](../mfc/resource-editors.md), чтобы изобрести собственные растровые изображения.  Или используйте редакторы ресурсов для сбора растровые изображения из портативных образов сетевой графики \(PNG\), входящих в состав [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)].  Эти изображения в каталоге `VS2008ImageLibrary`.  
  
     Однако пользовательский интерфейс ленты необходимо, чтобы некоторые растровые изображения поддерживают прозрачные изображения.  Прозрачный растровые изображения используют пиксели разрядные 32, где 24 бита определяют красной, зеленой и синей компоненты цвета и 8 бит определяют *альфа\-канал*, определяющий прозрачности цвета.  Текущие редакторы ресурсов могут просматривать, но не изменять растровые изображения с 32 описывается пикселями.  Следовательно, использование внешнего редактор изображений вместо редакторов ресурсов для управления прозрачные растровых изображений.  
  
-   Скопируйте соответствующий файл ресурсов из другого приложения в проект, а затем импортировать растровые изображения из этого файла.  
  
 В данном пошаговом руководстве копирует файлы ресурсов из приложения в каталоге образцов.  
  
#### Добавление растровых изображений в проект  
  
1.  Используйте проводник, чтобы скопировать следующие файлы BMP из каталога ресурсов \(`res`\) примера RibbonGadgets:  
  
    1.  Скопируйте main.bmp в проекте Scribble.  
  
    2.  Скопируйте filesmall.bmp и filelarge.bmp в проекте Scribble.  
  
    3.  Создайте новые копии из файлов filelarge.bmp и filesmall.bmp, но сохраните копирования в примере RibbonGadgets.  Переименуйте копии homesmall.bmp и homelarge.bmp и затем переместите копирования в проекте Scribble.  
  
    4.  Добавление копии из файла toolbar.bmp, но сохраните копию в примере RibbonGadgets.  Переименуйте копию panelicons.bmp и затем переместите ее в проект Scribble.  
  
2.  Импортировать растровое изображение для приложения MFC.  В **Ресурсы** дважды щелкните узел **scribble.rc**, дважды щелкните узел **Точечный рисунок**, а затем щелкните **Добавить ресурс**.  В диалоговом окне, появившемся на экране, нажмите кнопку **Импорт**.  Перейдите в каталог `res`, выделите файл main.bmp, а затем щелкните **Открыть**.  
  
     Растровое изображение main.bmp содержит изображение 26x26.  Измените идентификатор растрового изображения в IDB\_RIBBON\_MAIN.  
  
3.  Импортировать растровые изображения для меню файла, вложено в кнопку приложения.  
  
    1.  Импортировать файл filesmall.bmp, содержащая 10 \(16x160 образов 16x16\).  Поскольку нам требуется только 8 образов 16x16 \(16x128\), используйте **Ресурсы**, чтобы изменить ширину этого растрового изображения от 160 до 128.  Измените идентификатор растрового изображения в IDB\_RIBBON\_FILESMALL.  
  
    2.  Импортировать filelarge.bmp, содержащий \(8\) 32x256 образов 32x32.  Измените идентификатор растрового изображения в IDB\_RIBBON\_FILELARGE.  
  
4.  Импортировать растровые изображения для категорий и панелей ленты.  Перейдите на соответствующую вкладку на панели ленты категория и состоит из текстовой подписи и необязательного образа.  
  
    1.  Импортировать homesmall.bmp растровое изображение, которое содержит 8 образов 16x16 для небольших растровых изображений кнопки.  Измените идентификатор растрового изображения в IDB\_RIBBON\_HOMESMALL.  
  
    2.  Импортировать homelarge.bmp растровое изображение, которое содержит 8 образов 32x32 для больших растровых изображений кнопки.  Измените идентификатор растрового изображения в IDB\_RIBBON\_HOMELARGE.  
  
5.  Импортировать растровые изображения для измененных размер панелей ленты.  Используются эти или растровые изображения, Значки панели, после завершения операции изменения, если лента слишком мала для отображения всей панели.  
  
    1.  Импортировать panelicons.bmp растровое изображение, которое содержит 8 образов 16x16.  В окне **СвойстваРедактор точечных рисунков**, настройте ширину растрового изображения в 16x64 \(64\).  Измените идентификатор растрового изображения в IDB\_PANEL\_ICONS.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="addRibbon"></a> Добавление ресурса ленты в проект  
 При преобразовании приложение, использующее меню в приложение, использующее ленты, не следует удалять или отключить существующих меню.  Вместо этого необходимо создать ресурс лент, добавьте кнопки ленты, а затем связать новые кнопки с существующими пунктами меню.  Хотя меню будут скрыты, сообщения от панели ленты маршрутизируются через меню.  Кроме того, ярлыки меню продолжают работать.  
  
 Кнопки ленты состоит из приложения, которая большая кнопку на верхний слева ленты и одного или нескольких вкладок категории.  Каждая вкладка содержит одну или несколько категорий области, которые служат в качестве контейнеров для кнопок и элементов управления ленты.  В следующей процедуре показано, как создать ресурс ленты и затем настраивать кнопка приложения.  
  
#### Добавление ресурса ленты в проект  
  
1.  В меню **Проект**, щелкните **Добавить ресурс**.  
  
2.  В диалоговом окне **Добавить ресурс**, выберите **ribbon** и нажмите кнопку **Создать**.  
  
     Visual Studio создает ресурс ленты и открыть его в представлении конструирования.  Идентификатор ресурса IDR\_RIBBON1 ленты, которое отображается в **Ресурсы**.  Ленты содержит одну категорию и одну панель.  
  
3.  Можно настраивать кнопка приложения можно изменить его свойства.  Идентификатор сообщения, используемые в этом коде уже определены в меню для Scribble 1.0.  
  
4.  В представлении конструирования, нажмите кнопку приложения, чтобы отобразить его свойства.  Значения свойств изменения следующим образом: **Изображение**  на **Запрос**  значение `IDB_RIBBON_MAIN`, `Файл`, `f`, **Ключи**  для **Большие изображений** и значение `IDB_RIBBON_FILELARGE` для свойства **Небольшие изображения** значение `IDB_RIBBON_FILESMALL`.  
  
5.  Следующие изменения создают меню, которое появляется, когда пользователь нажимает кнопку приложения.  Щелкните многоточие \(**...**\) рядом с полем **В основном элементы**, чтобы открыть **Редактор элементов**.  
  
    1.  Нажмите **Добавить**, чтобы добавить кнопку.  **Заголовок** Измените значение **Идентификатор** на `&New`, `ID_FILE_NEW`, `0`, к **ИзображениеБольшое изображение** на `0`.  
  
    2.  Нажмите **Добавить**, чтобы добавить второй кнопки.  Измените **Заголовок**  на `&Save`, `ID_FILE_SAVE`, к **Идентификатор Изображение**  на `2`, а для свойства **Большое изображение**  значение `2`.  
  
    3.  Нажмите **Добавить** , чтобы добавить третья кнопка.  Измените **Заголовок**  на `Сохранить &Как`, `ID_FILE_SAVE_AS`, к **Идентификатор Изображение**  на `3`, а для свойства **Большое изображение**  значение `3`.  
  
    4.  Нажмите **Добавить** , чтобы добавить четвертая кнопка.  Измените **Заголовок**  на `&Print`, `ID_FILE_PRINT`, к **Идентификатор Изображение**  на `4`, а для свойства **Большое изображение**  значение `4`.  
  
    5.  Измените тип **item** на **Разделитель**, а затем щелкните **Добавить**.  
  
    6.  Измените тип **item** значение **Кнопка**.  Нажмите **Добавить**, чтобы добавить пятая кнопка.  Измените **Заголовок**  на `&Close`, `ID_FILE_CLOSE`, к **Идентификатор Изображение**  на `5`, а для свойства **Большое изображение**  значение `5`.  
  
6.  Следующие изменения создают подменю кнопкой печати, созданную в предыдущем шаге.  
  
    1.  Нажмите кнопку **Печать**, измените тип **item** на **Метка**, а затем щелкните **Вставить**.  Измените **Заголовок** на `Предварительный просмотр и печать документа`.  
  
    2.  Нажмите кнопку **Печать** , измените тип **item** , выберите **Кнопка** и щелкните **Вставить**.  Измените **Заголовок**  на `&Print`, `ID_FILE_PRINT`, к **ИдентификаторИзображение**  на `4`, а для свойства **Большое изображение**  значение `4`.  
  
    3.  Нажмите кнопку **Печать**, а затем щелкните **Вставить**, чтобы добавить кнопку.  Измените **Заголовок** на `&Quick Print`, `ID_FILE_PRINT_DIRECT`, к **ИдентификаторИзображение** на `7`, а для свойства **Большое изображение** значение `7`.  
  
    4.  Нажмите кнопку **Печать**, а затем щелкните **Вставить**, чтобы добавить другой кнопки.  **Заголовок** Измените значение **Идентификатор** на `Печать Pre&представление`, `ID_FILE_PRINT_PREVIEW`, `6` в **Изображение** , и **Большое изображение** на `6`.  
  
    5.  Теперь вы изменили **В основном элементы**.  Нажмите кнопку **Закрыть** , чтобы выйти из **Редактор элементов**.  
  
7.  Следующее изменение создает кнопку выхода, отображается в нижней части кнопки меню приложения.  
  
    1.  В поле **Свойства**, щелкните многоточие \(**...**\) рядом с полем **Кнопка**, чтобы открыть **Редактор элементов**.  
  
    2.  Нажмите **Добавить**, чтобы добавить кнопку.  **Заголовок** Измените значение **Идентификатор** на `E&xit`, `ID_APP_EXIT`,`8`**Изображение** значение .  
  
 \[[Подразделы](#top)\]  
  
##  <a name="createInstance"></a> Создание экземпляра панели ленты  
 В следующей процедуре показано, как создать экземпляр панели ленты, когда стартует приложения.  Чтобы добавить панель ленты в приложение, объявите панель ленты в файле mainfrm.h.  Затем в файле mainfrm.cpp, напишите код для загрузки ленты ресурс.  
  
#### Создание экземпляра панели ленты  
  
1.  В файле mainfrm.h добавьте элемент данных к защищенному раздел `CMainFrame`, определение класса для большой ЭВМ.  Этот член представляет область ленты.  
  
    ```  
    // Ribbon bar for the application  
    CMFCRibbonBar  m_wndRibbonBar;  
    ```  
  
2.  В файле mainfrm.cpp, добавьте следующий код перед конечной выпиской `return` в конце функции `CMainFrame::OnCreate`.  Это создает экземпляр панели ленты.  
  
    ```  
    // Create the ribbon bar  
    if (!m_wndRibbonBar.Create(this))  
    {  
    return -1;   //Failed to create ribbon bar  
    }  
    m_wndRibbonBar.LoadFromResource(IDR_RIBBON1);  
    ```  
  
 \[[Подразделы](#top)\]  
  
##  <a name="addCategory"></a> Настраивать ресурс ленты  
 Теперь, после создания кнопка приложения элементы на ленте.  
  
> [!NOTE]
>  В данном пошаговом руководстве используется тот же значка для всех панелей.  Однако можно использовать другие индексы списка изображений указать другие Значки.  
  
#### Добавление домашняя категории и изменение панели  
  
1.  Программа Scribble необходимы только одной категории.  В представлении конструирования щелкните **Категория**, чтобы отобразить его свойства.  Значения свойств изменения следующим образом: **Заголовок** значение `&Home`, `IDB_RIBBON_HOMELARGE`, к **Большие изображенийНебольшие изображения** на `IDB_RIBBON_HOMESMALL`.  
  
2.  Каждая категория ленты организована в виде именованные панели.  Каждая панель содержит набор элементов управления, выполняющего связанные операции.  Эта категория содержит одну панель.  Нажмите кнопку **Панель**, а затем измените **Заголовок**  на `Изменить`, а свойству **Индекс образа**  значение `0`.  
  
3.  На панели **Изменить** добавьте кнопку, которая отвечает за очистить содержимое документа.  Идентификатор сообщения для этой кнопки уже был определен в ресурсе меню IDR\_SCRIBBTYPE.  Укажите `Очистить все` в качестве текст кнопки и индекс растрового изображения, оформляющий кнопку.  Откройте **Панель элементов**, затем перетащите **Кнопка** в панели **Изменить**.  Нажмите кнопку **Заголовок**  и измените значение **Идентификатор**  на `Очистить все`, `ID_EDIT_CLEAR_ALL`, `0`, к **Индекс образаБольшой индекс образа** на `0`.  
  
4.  Сохраните изменения, а затем построить и запустить приложение.  Приложения Scribble должно отображаться, и он должен иметь панель ленты в верхней части окна вместо строки меню.  Область ленты должна иметь одну категорию, **Главная** и **Главная**, должен иметь одну панель **Изменить**.  Кнопки ленты, добавленных должны быть связаны с существующими обработчиками событий, **Открыть**, **Закрыть**, **Сохранить**, **Печать** и кнопками **Очистить все** должны работать так, как ожидалось.  
  
 \[[Подразделы](#top)\]  
  
##  <a name="setLook"></a> Параметр " приложения  
 *диспетчер визуального представления* глобальный объект, элементы управления все изображение для приложения.  Поскольку исходного приложения Scribble используется стиль \(UI\) интерфейса пользователя Office 2000, приложение может выглядеть старомодным.  Можно создать приложение для использования диспетчера визуального представления Office 2007, чтобы он напоминает приложение Office 2007.  
  
#### Для настройки внешнего вида приложения  
  
1.  В функции `CMainFrame::OnCreate` введите следующий код для изменения диспетчер визуального представления и стиль по умолчанию.  
  
    ```  
    // Set the default manager to Office 2007   
    CMFCVisualManager::SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerOffice2007));  
    CMFCVisualManagerOffice2007::SetStyle(CMFCVisualManagerOffice2007::Office2007_LunaBlue);  
    ```  
  
2.  Сохраните изменения, а затем построить и запустить приложение.  Пользовательский интерфейс приложения должен напоминать пользовательский интерфейс Office 2007.  
  
 \[[Подразделы](#top)\]  
  
## Следующие действия  
 Вы изменили классического примера 1.0 MFC Scribble для использования конструктора лент.  Перейдите к [Часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md).  
  
## См. также  
 [Пошаговые руководства](../mfc/walkthroughs-mfc.md)   
 [Пошаговое руководство. Обновление приложения MFC Scribble \(часть 2\)](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md)
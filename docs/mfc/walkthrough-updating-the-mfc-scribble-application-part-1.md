---
title: 'Пошаговое руководство: Обновление приложения MFC Scribble (часть 1) | Документация Майкрософт'
ms.custom: ''
ms.date: 06/28/2018
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- examples [MFC], update existing application
- ribbon UI, porting to
- Office Fluent UI, porting to
- samples [MFC], update existing application
- MFC Feature Pack, update existing application
- walkthroughs [MFC], update existing application
ms.assetid: aa6330d3-6cfc-4c79-8fcb-0282263025f7
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: 37cec86d276732bd7273d0f5585de5093f0cd01f
ms.sourcegitcommit: a41c4d096afca1e9b619bbbce045b77135d32ae2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2018
ms.locfileid: "42540717"
---
# <a name="walkthrough-updating-the-mfc-scribble-application-part-1"></a>Пошаговое руководство: Обновление приложения MFC Scribble (часть 1)

В этом пошаговом руководстве показано, как изменить существующее приложение MFC использовать пользовательский интерфейс ленты. Visual Studio поддерживает ленты Office 2007 и ленты Scenic Windows 7. Дополнительные сведения о пользовательском интерфейсе Ribbon, см. в разделе [лент](http://go.microsoft.com/fwlink/p/?linkid=129233) на сайте MSDN.

В этом пошаговом руководстве изменяет классический пример Scribble 1.0 MFC, который позволяет создавать рисунки строки с помощью мыши. Этой части пошагового руководства показано, как изменить примера Scribble на базе, чтобы он отображал панели ленты. [Часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md) добавляет дополнительные кнопки на ленте.

## <a name="prerequisites"></a>Предварительные требования

[Примеры кода на Visual C++](../visual-cpp-samples.md)

[Примеры кода на Visual C++](../visual-cpp-samples.md)

##  <a name="top"></a> Разделы

Этой части пошагового руководства состоит из следующих разделов:

- [Замена базовые классы](#replaceclass)

- [Добавление растровых изображений в проект](#addbitmap)

- [Добавление в ресурс ленты в проект](#addribbon)

- [Создание экземпляра ленты](#createinstance)

- [Добавление категории ленты](#addcategory)

- [Настройка внешнего вида приложения](#setlook)

##  <a name="replaceclass"></a> Замена базовые классы

Чтобы преобразовать приложение, поддерживающее меню, чтобы приложение, поддерживающее ленты, должны происходить приложения, фрейм окна и панели инструментов классы от обновленные базовые классы. (Мы рекомендуем пройти не изменить исходный пример Scribble; вместо этого очистите проект Scribble, скопируйте его в другой каталог и затем изменить копию).

### <a name="to-replace-the-base-classes-in-the-scribble-application"></a>Для замены базовых классов в приложении Scribble

1. Убедитесь, что в scribble.cpp, `CScribbleApp::InitInstance` включает вызов [AfxOleInit](../mfc/reference/ole-initialization.md#afxoleinit).

2. Добавьте следующий код в файл stdafx.h.

    ```cpp
    #include <afxcontrolbars.h>
    ```

3. В scribble.h, измените определение `CScribbleApp` таким образом, чтобы он является производным от [класс CWinAppEx](../mfc/reference/cwinappex-class.md).

    ```cpp
    class CScribbleApp: public CWinAppEx
    ```

4. Scribble 1.0 был записан при приложений Windows файла инициализации (ini) для сохранения данных предпочтений пользователя. Вместо файла инициализации измените Scribble для хранения пользовательских параметров в реестре. Чтобы задать раздел реестра и базы, введите следующий код в `CScribbleApp::InitInstance` после `LoadStdProfileSettings()` инструкции.

    ```cpp
    SetRegistryKey(_T("MFCNext\\Samples\\Scribble2"));
    SetRegistryBase(_T("Settings"));
    ```

5. Главного фрейма для нескольких приложений интерфейса (MDI) документа больше не является производным от `CMDIFrameWnd` класса. Вместо этого он является производным от [CMDIFrameWndEx](../mfc/reference/cmdiframewndex-class.md) класса.

     В файлах mainfrm.h и mainfrm.cpp, замените все вхождения `CMDIFrameWnd` с `CMDIFrameWndEx`.

6. В файлах childfrm.h и childfrm.cpp, замените `CMDIChildWnd` с `CMDIChildWndEx`.

     В childfrm. h файл, замените `CSplitterWnd` с `CSplitterWndEx`.

7. Изменение панелей инструментов и строки состояния, чтобы использовать новые классы MFC.

     В файле mainfrm.h:

    1. Замените `CToolBar` объектом `CMFCToolBar`.

    2. Замените `CStatusBar` объектом `CMFCStatusBar`.

8. В файле mainfrm.cpp:

    1. Замените `m_wndToolBar.SetBarStyle` с `m_wndToolBar.SetPaneStyle`

    2. Замените `m_wndToolBar.GetBarStyle` с `m_wndToolBar.GetPaneStyle`

    3. Замените `DockControlBar(&m_wndToolBar)` с `DockPane(&m_wndToolBar)`

9. В файле ipframe.cpp закомментируйте следующие три строки кода.

    ```cpp
    m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);
    pWndFrame->EnableDocking(CBRS_ALIGN_ANY);
    pWndFrame->DockPane(&m_wndToolBar);
    ```

10. Если вы собираетесь статическая компоновка приложения, добавьте следующий код в начало файла ресурсов (.rc) проекта.

    ```cpp
    #include "afxribbon.rc"
    ```

     Файл afxribbon.rc содержит ресурсы, которые требуются во время выполнения. [Мастер приложений MFC](../mfc/reference/mfc-application-wizard.md) включает в себя этот файл автоматически при создании приложения.

11. Сохраните изменения и затем постройте и запустите приложение.

[[Разделах](#top)]

##  <a name="addbitmap"></a> Добавление растровых изображений в проект

Следующих четырех шагах данного пошагового руководства требуются ресурсы растрового изображения. Вы можете получить соответствующие растровые изображения по-разному:

- Используйте [редакторы ресурсов](../windows/resource-editors.md) изобретать свои собственные точечные рисунки. Или используйте редакторы ресурсов сборка точечных рисунков из изображений PNG-файлы, которые входят в состав Visual Studio. Изображения хранятся в `VS2008ImageLibrary` каталога.

     Однако пользовательский интерфейс ленты требует, что определенные растровые изображения поддерживает прозрачные изображения. Прозрачными точечными рисунками использовать 32-разрядных пикселей, где 24 бита выбора красного, зеленого и синего компонентов цвета, и определите 8 бит *альфа-канал* , указывающий прозрачности цвета. Текущий редакторы ресурсов можно просматривать, но не изменять точечные рисунки с 32-разрядных пикселей. Следовательно используйте внешнего редактора изображений вместо редакторы ресурсов для управления прозрачными точечными рисунками.

- Скопируйте файл соответствующего ресурса из другого приложения в проект, а затем импортировать точечных рисунков из этого файла.

В этом пошаговом руководстве копирует файлы ресурсов из приложения в каталоге Samples.

### <a name="to-add-bitmaps-to-the-project"></a>Добавление растровых изображений в проект

1. Скопируйте следующие файлы .bmp из каталога ресурсов с помощью проводника (`res`) пример RibbonGadgets:

   1. Скопируйте main.bmp проекта Scribble.

   2. Скопировать в проект Scribble filesmall.bmp и filelarge.bmp.

   3. Создайте новые копии файлов filelarge.bmp и filesmall.bmp, но сохранять копии в пример RibbonGadgets. Переименуйте homesmall.bmp копий и homelarge.bmp и переместите их в проект Scribble.

   4. Создайте копию файла файлу toolbar.bmp, но сохранить копию в пример RibbonGadgets. Переименуйте panelicons.bmp копирования, а затем переместите ее в проект Scribble.

2. Импортируйте растровое изображение для приложения MFC. В **представление ресурсов**, дважды щелкните **scribble.rc** узла, дважды щелкните **точечного рисунка** узел, а затем щелкните **добавьте ресурс**. В появившемся диалоговом окне, щелкните **импорта**. Перейдите к `res` каталог, выберите файл main.bmp и нажмите кнопку **откройте**.

   Битовая карта main.bmp содержит образ 26 x 26. Измените идентификатор растрового изображения на IDB_RIBBON_MAIN.

3. Импортируйте растровые изображения для меню "файл", подключенный к кнопки приложения.

   1. Импортировать файл filesmall.bmp, который содержит десять 16 x 16 (16 x 160) изображения. Поскольку мы изображения составляет всего восемь 16 x 16 (16 x 128), используйте **представление ресурсов** изменение ширины этого точечного рисунка из 160 128. Измените идентификатор растрового изображения на IDB_RIBBON_FILESMALL.

   2. Импорт filelarge.bmp, которая содержит восемь 32 x 32 (32 x 256) изображения. Измените идентификатор растрового изображения на IDB_RIBBON_FILELARGE.

4. Импортируйте растровые изображения для категорий ленты и панели. Каждая вкладка на ленте, категория и состоит из текстовой меткой и необязательное изображение.

   1. Импортируйте homesmall.bmp растрового изображения, который содержит восемь 16 x 16 образы для растровых изображений маленькую кнопку. Измените идентификатор растрового изображения на IDB_RIBBON_HOMESMALL.

   2. Импортируйте homelarge.bmp растрового изображения, который содержит восемь 32 x 32 образы для растровых изображений большая кнопка. Измените идентификатор растрового изображения на IDB_RIBBON_HOMELARGE.

5. Импорт точечных рисунков для панели ленты с измененным размером. Эти точечные рисунки, значки панели используются или после операции изменения размера Если ленты слишком мал для отображения всей панели.

   1. Импортируйте panelicons.bmp точечного рисунка, который содержит восемь 16 x 16 изображений. В **свойства** окно **редактора точечных рисунков**, Ширина растрового изображения до 64 (16 x 64). Измените идентификатор растрового изображения на IDB_PANEL_ICONS.

[[Разделах](#top)]

##  <a name="addribbon"></a> Добавление в ресурс ленты в проект

При преобразовании приложения, использующего меню для приложения, использующего ленты, у вас нет для удаления или отключения существующих меню. Вместо этого вы создайте ресурс ленты, добавление кнопок ленты и затем связать новые кнопки с существующих элементов меню. Несмотря на то, что меню, не отображаются, сообщения на ленте направляются через меню. Кроме того меню быстрого вызова продолжают работать.

Лента состоит из кнопки приложения, являющийся большая кнопка в верхней левой ленте, и один или несколько вкладок категории. Каждая категория вкладка содержит одну или несколько панелей, которые являются контейнерами для кнопок ленты и элементов управления. Ниже показано, как создать ресурс ленты и затем Настройка кнопки приложения.

### <a name="to-add-a-ribbon-resource-to-the-project"></a>Чтобы добавить ресурс ленты в проект

1. На **проекта** меню, щелкните **добавить ресурс**.

2. В **добавить ресурс** выберите **ленты** и нажмите кнопку **New**.

   Visual Studio создает ресурс ленты и открывает его в режиме конструктора. Идентификатор ресурса ленты — IDR_RIBBON1, который отображается в **представление ресурсов**. Ленты содержит одну категорию и одной панели.

3. Кнопка «приложение» можно настроить, изменив его свойства. Идентификаторы сообщений, которые используются в этом коде уже определены в меню Scribble 1.0.

4. В режиме конструктора нажмите кнопку приложения для отображения его свойств. Измените значения свойств следующим образом: **изображение** для `IDB_RIBBON_MAIN`, **Prompt** для `File`, **ключи** для `f`, **больших изображений** для `IDB_RIBBON_FILELARGE`, и **маленькие изображения** для `IDB_RIBBON_FILESMALL`.

5. Следующие изменения создать меню, которое появляется, когда пользователь нажимает кнопки приложения. Нажмите кнопку с многоточием (**...** ) рядом с полем **элементы Main** открыть **редактор элементов**.

   1. Нажмите кнопку **добавить** для добавления кнопки. Изменение **заголовок** для `&New`, **идентификатор** для `ID_FILE_NEW`, **изображение** для `0`, **большое изображение** для `0`.

   2. Нажмите кнопку **добавить** для добавления второй кнопки. Изменение **заголовок** для `&Save`, **идентификатор** для `ID_FILE_SAVE`, **изображение** для `2`, и **большое изображение** для `2`.

   3. Нажмите кнопку **добавить** для третья кнопка "Добавить". Изменение **заголовок** для `Save &As`, **идентификатор** для `ID_FILE_SAVE_AS`, **изображение** для `3`, и **большое изображение** для `3`.

   4. Нажмите кнопку **добавить** для Четвертая кнопка "Добавить". Изменение **заголовок** для `&Print`, **идентификатор** для `ID_FILE_PRINT`, **изображение** для `4`, и **большое изображение** для `4`.

   5. Изменение **элемент** тип **разделителя** и нажмите кнопку **добавить**.

   6. Изменение **элемент** тип **кнопку**. Нажмите кнопку **добавить** для пятая кнопка "Добавить". Изменение **заголовок** для `&Close`, **идентификатор** для `ID_FILE_CLOSE`, **изображение** для `5`, и **большое изображение** для `5`.

6. Следующие изменения Создание вложенного меню "Печать", созданный на предыдущем шаге.

   1. Нажмите кнопку **печати** "Кнопка", измените **элемент** тип **метка**и нажмите кнопку **вставить**. Изменение **заголовок** для `Preview and print the document`.

   2. Нажмите кнопку **печати** "Кнопка", измените **элемент** тип **кнопку**и нажмите кнопку **вставить**. Изменение **заголовок** для `&Print`, **идентификатор** для `ID_FILE_PRINT`, **изображение** для `4`, и **большое изображение** для `4`.

   3. Нажмите кнопку **печати** а затем нажмите кнопку **вставить** для добавления кнопки. Изменение **заголовок** для `&Quick Print`, **идентификатор** для `ID_FILE_PRINT_DIRECT`, **изображение** для `7`, и **большое изображение** для `7`.

   4. Нажмите кнопку **печати** а затем нажмите кнопку **вставить** добавить еще одну кнопку. Изменение **заголовок** для `Print Pre&view`, **идентификатор** для `ID_FILE_PRINT_PREVIEW`, **изображение** для `6`, и **большое изображение** для `6`.

   5. Теперь вы изменили **элементы Main**. Нажмите кнопку **закрыть** для выхода из **редактор элементов**.

7. Следующее изменение создает кнопку выхода, которая отображается в нижней части меню кнопки приложения.

   1. В **свойства** окно, нажмите кнопку с многоточием (**...** ) рядом с полем **кнопку** открыть **редактор элементов**.

   2. Нажмите кнопку **добавить** для добавления кнопки. Изменение **заголовок** для `E&xit`, **идентификатор** для `ID_APP_EXIT`, **изображение** для `8`.

[[Разделах](#top)]

##  <a name="createinstance"></a> Создание экземпляра ленты

Ниже показано, как создать экземпляр панели ленты при запуске приложения. Чтобы добавить на панель ленты в приложение, объявите панели ленты в файле mainfrm.h. Затем в файле mainfrm.cpp написать код для загрузки ресурса ленты.

### <a name="to-create-an-instance-of-the-ribbon-bar"></a>Для создания экземпляра ленты

1. Добавить элемент данных защищенный раздел в файле mainfrm.h `CMainFrame`, в определении класса для главного фрейма. Этот член представляет панели ленты.

    ```cpp
    // Ribbon bar for the application
    CMFCRibbonBar m_wndRibbonBar;
    ```

2. В файле mainfrm.cpp, добавьте следующий код перед последней `return` инструкции в конце `CMainFrame::OnCreate` функции. Это создает экземпляр панели ленты.

    ```cpp
    // Create the ribbon bar
    if (!m_wndRibbonBar.Create(this))
    {
        return -1;   //Failed to create ribbon bar
    }
    m_wndRibbonBar.LoadFromResource(IDR_RIBBON1);
    ```

[[Разделах](#top)]

##  <a name="addcategory"></a> Настройка ресурс ленты

Теперь, когда вы создали кнопки приложения, можно добавить элементы на ленту.

> [!NOTE]
> В этом пошаговом руководстве используется один и тот же самый значок панели для всех панелей. Тем не менее можно использовать другие индексы списка изображений для отображения других значков.

### <a name="to-add-a-home-category-and-edit-panel"></a>Чтобы добавить категорию домашней и изменять панели

1. Scribble программе требуется только одна категория. В режиме конструктора щелкните **категории** для отображения его свойств. Измените значения свойств следующим образом: **заголовок** для `&Home`, **больших изображений** для `IDB_RIBBON_HOMELARGE`, **маленькие изображения** для `IDB_RIBBON_HOMESMALL`.

2. Каждая категория ленты организована в именованный панелей. Каждая панель содержит набор элементов управления, выполняющих связанные операции. Эта категория содержит одну панель. Нажмите кнопку **панели**, а затем измените **заголовок** для `Edit` и **индекс образа** для `0`.

3. Чтобы **изменить** панели, добавление кнопки, которая отвечает за очистки содержимого документа. В ресурсе меню IDR_SCRIBBTYPE уже определен идентификатор сообщения для данной кнопки. Укажите `Clear All` как текст кнопки и индекс точечного рисунка, который оформляет кнопки. Откройте **элементов**и затем перетащите **кнопку** для **изменить** панели. Нажмите кнопку, а затем измените **заголовок** для `Clear All`, **идентификатор** для `ID_EDIT_CLEAR_ALL`, **индекс образа** для `0`, **большой индекс образа**  для `0`.

4. Сохраните изменения и затем постройте и запустите приложение. Должны быть на панель ленты в верхней части окна, а не строку меню, и приложения Scribble должны отображаться. Ленты должны иметь одну категорию **Главная**, и **Главная** должны иметь одну панель **изменить**. Кнопок ленты, которые вы добавили должны быть связаны с существующие обработчики событий и **откройте**, **закрыть**, **Сохранить**, **печати**, и **очистить все** кнопок должен работать соответствующим образом.

[[Разделах](#top)]

##  <a name="setlook"></a> Настройка внешнего вида приложения

Объект *наглядный диспетчер* — это глобальный объект, управляющий все прорисовки для приложения. Так как в исходном приложении Scribble использует стиль пользовательского интерфейса пользователя Office 2000, приложение может выглядеть доброе. Вы можете сбросить приложения для использования Office 2007 наглядный диспетчер, как указано в приложениях Office 2007.

### <a name="to-set-the-look-of-the-application"></a>Чтобы задать внешний вид приложения

1. В `CMainFrame::OnCreate` функции, введите следующий код, чтобы изменить значение по умолчанию наглядный диспетчер и стиль.

    ```cpp
    // Set the default manager to Office 2007
    CMFCVisualManager::SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerOffice2007));
    CMFCVisualManagerOffice2007::SetStyle(CMFCVisualManagerOffice2007::Office2007_LunaBlue);
    ```

2. Сохраните изменения и затем постройте и запустите приложение. Пользовательский Интерфейс приложения должно выглядеть как пользовательского интерфейса Office 2007.

[[Разделах](#top)]

## <a name="next-steps"></a>Следующие шаги

Вы изменили классический пример Scribble 1.0 MFC для использования конструктора лент. Теперь перейдите к [часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md).

## <a name="see-also"></a>См. также

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)  
[Пошаговое руководство: обновление приложения MFC Scribble (часть 2)] (.. / mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md)  

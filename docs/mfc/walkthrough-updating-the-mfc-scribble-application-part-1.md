---
title: 'Пошаговое руководство: Обновление приложения MFC Scribble (часть 1) | Документы Microsoft'
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- examples [MFC], update existing application
- ribbon UI, porting to
- Office Fluent UI, porting to
- samples [MFC], update existing application
- MFC Feature Pack, update existing application
- walkthroughs [MFC], update existing application
ms.assetid: aa6330d3-6cfc-4c79-8fcb-0282263025f7
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: cfe91812d178618b1707f99aa10d6bd492109069
ms.sourcegitcommit: c6b095c5f3de7533fd535d679bfee0503e5a1d91
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2018
ms.locfileid: "36956799"
---
# <a name="walkthrough-updating-the-mfc-scribble-application-part-1"></a>Пошаговое руководство: Обновление приложения MFC Scribble (часть 1)
В этом пошаговом руководстве показано, как изменить существующее приложение MFC для использования пользовательского интерфейса ленты. Visual Studio поддерживает ленты Office 2007 и Windows 7 живописных ленты. Дополнительные сведения о пользовательском интерфейсе ленты см. в разделе [лент](http://go.microsoft.com/fwlink/p/?linkid=129233) на сайте MSDN.  
  
 В этом пошаговом руководстве изменяет классического образца Scribble 1.0 MFC, позволяющий создать рисунков с помощью мыши. В этой части пошагового руководства показано, как изменить пример Scribble так, чтобы оно отображалось на панель ленты. [Часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md) добавляет дополнительные кнопки на ленте.  
  
## <a name="prerequisites"></a>Предварительные требования  
 [Примеры кода на Visual C++](../visual-cpp-samples.md)  
  
 [Примеры кода на Visual C++](../visual-cpp-samples.md)  
  
##  <a name="top"></a> Разделы  
 В этой части пошагового руководства состоит из следующих подразделов:  
  
- [Замена базовые классы](#replaceclass)  
  
- [Добавление растровых изображений в проект](#addbitmap)  
  
- [Добавление ресурса ленты в проект](#addribbon)  
  
- [Создание экземпляра ленты](#createinstance)  
  
- [Добавление категории ленты](#addcategory)  
  
- [Настройка внешнего вида приложения](#setlook)  
  
##  <a name="replaceclass"></a> Замена базовые классы  
 Чтобы преобразовать приложение, поддерживающее меню для приложения, поддерживающего ленты, должны наследовать классы инструментов приложений, фрейм окна и от обновленные базовых классов. (Мы рекомендуем не изменить исходный пример Scribble; вместо этого очистите проект Scribble, скопировать его в другой каталог и затем изменить копию).  
  
#### <a name="to-replace-the-base-classes-in-the-scribble-application"></a>Для замены базовых классов в приложении Scribble  
  
1.  Убедитесь, что в scribble.cpp, `CScribbleApp::InitInstance` включает вызов [AfxOleInit](../mfc/reference/ole-initialization.md#afxoleinit).  
  
2.  Добавьте следующий код в файл stdafx.h.  
  
 ```  
    #include <afxcontrolbars.h>  
 ```  
  
3.  В scribble.h, измените определение `CScribbleApp` класса, чтобы он является производным от [CWinAppEx класс](../mfc/reference/cwinappex-class.md).  
  
 ```  
    class CScribbleApp: public CWinAppEx  
 ```  
  
4.  Scribble 1.0 был записан при использовании приложений Windows файл инициализации (ini) для сохранения данных предпочтений пользователя. Вместо файла инициализации измените Scribble для хранения пользовательских параметров в реестре. Чтобы задать раздел реестра и базы, введите следующий код в `CScribbleApp::InitInstance` после `LoadStdProfileSettings()` инструкции.  
  
 ```  
    SetRegistryKey(_T("MFCNext\\Samples\\Scribble2"));

 SetRegistryBase(_T("Settings"));

 ```  
  
5.  Главного фрейма для нескольких приложений интерфейса (MDI) документа больше не является производным от `CMDIFrameWnd` класса. Вместо этого он является производным от [CMDIFrameWndEx](../mfc/reference/cmdiframewndex-class.md) класса.  
  
     В файлах mainfrm.h и mainfrm.cpp, замените все ссылки на `CMDIFrameWnd` с `CMDIFrameWndEx`.  
  
6.  В файлах childfrm.h и childfrm.cpp, замените `CMDIChildWnd` с `CMDIChildWndEx`.  
  
     В childfrm. h файл замените `CSplitterWnd` с `CSplitterWndEx`.  
  
7.  Изменение панели инструментов и строки состояния, чтобы использовать новые классы MFC.  
  
     В файле mainfrm.h:  
  
    1.  Замените `CToolBar` объектом `CMFCToolBar`.  
  
    2.  Замените `CStatusBar` объектом `CMFCStatusBar`.  
  
8.  В файле mainfrm.cpp:  
  
    1.  Замените `m_wndToolBar.SetBarStyle` с `m_wndToolBar.SetPaneStyle`  
  
    2.  Замените `m_wndToolBar.GetBarStyle` с `m_wndToolBar.GetPaneStyle`  
  
    3.  Замените `DockControlBar(&m_wndToolBar)` с `DockPane(&m_wndToolBar)`  
  
9. В файле ipframe.cpp закомментируйте следующие три строки кода.  
  
 ```  
    m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);

 pWndFrame->EnableDocking(CBRS_ALIGN_ANY);

    pWndFrame->DockPane(&m_wndToolBar);

 ```  
  
10. Если вы собираетесь создавать статических ссылок приложения, добавьте следующий код в начало файла ресурсов (.rc) проекта.  
  
 ```  
    #include "afxribbon.rc"  
 ```  
  
     Файл afxribbon.rc содержит ресурсы, необходимые во время выполнения. [Мастер приложений MFC](../mfc/reference/mfc-application-wizard.md) включает этот файл автоматически при создании приложения.  
  
11. Сохранить изменения и затем постройте и запустите приложение.  
  
 [[Разделы](#top)]  
  
##  <a name="addbitmap"></a> Добавление растровых изображений в проект  
 Следующие четыре действия данного пошагового руководства требуются ресурсы растрового изображения. Вы можете получить соответствующие растровые изображения различными способами:  
  
-   Используйте [редакторы ресурсов](../windows/resource-editors.md) программистами собственные точечные рисунки. Или с помощью редакторов ресурсов можно собрать растровые изображения из изображений PNG-переносимой сетевой, входящих в состав [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)]. Эти образы являются в `VS2008ImageLibrary` каталога.  
  
     Однако пользовательский интерфейс ленты требуется, определенных растровых изображений поддерживает прозрачные изображения. Прозрачными точечными рисунками использовать 32-разрядных пикселей, где 24 бита укажите компонентов красного, зеленого и синего цвета, и задайте 8 бит *альфа-канал* , определяет прозрачность цвета. Текущий редакторы ресурсов можно просматривать, но не изменять растровые изображения с 32-разрядных пикселей. Следовательно используйте внешнего редактора изображений вместо редакторы ресурсов для управления прозрачными точечными рисунками.  
  
-   Скопируйте файл соответствующего ресурса из другого приложения в проекте, а затем импортируйте растровые изображения из этого файла.  
  
 В этом пошаговом руководстве копирует файлы ресурсов из приложения в каталог образцов.  
  
#### <a name="to-add-bitmaps-to-the-project"></a>Добавление растровых изображений в проект  
  
1.  Скопируйте следующие файлы .bmp из каталога ресурсов с помощью проводника (`res`) пример RibbonGadgets:  
  
    1.  Скопируйте main.bmp проект Scribble.  
  
    2.  Скопируйте filesmall.bmp и filelarge.bmp проект Scribble.  
  
    3.  Создайте новые копии файлов filelarge.bmp и filesmall.bmp, но сохранять копии в образце RibbonGadgets. Переименуйте копии homesmall.bmp и homelarge.bmp, а затем переместите копий проект Scribble.  
  
    4.  Создайте копию файла файлу toolbar.bmp, но сохранить копию в образце RibbonGadgets. Переименуйте panelicons.bmp копирования, а затем переместите копирования проект Scribble.  
  
2.  Импортируйте растровое изображение для приложения MFC. В **представление ресурсов**, дважды щелкните **scribble.rc** узла, дважды щелкните **растрового изображения** , а затем щелкните **добавить ресурс**. В появившемся диалоговом окне, выберите **импорта**. Перейдите к `res` каталог, выберите файл main.bmp, затем щелкните **откройте**.  
  
     Битовая карта main.bmp изображению 26 x 26. Измените идентификатор точечного рисунка на IDB_RIBBON_MAIN.  
  
3.  Импорт точечных рисунков для меню "файл", присоединенный к кнопки приложения.  
  
    1.  Импортируйте файл filesmall.bmp, который содержит десять 16 x 16 (16 x 160) изображений. Поскольку мы изображения всего восемь 16 x 16 (16 x 128), используйте **представление ресурсов** изменение ширины это растровое изображение с 160 на 128. Измените идентификатор точечного рисунка на IDB_RIBBON_FILESMALL.  
  
    2.  Импорт filelarge.bmp, который содержит восемь 32 x 32 (32 x 256) изображений. Измените идентификатор точечного рисунка на IDB_RIBBON_FILELARGE.  
  
4.  Импорт точечных рисунков для категорий ленты и панели. Каждая вкладка ленты — категория и состоит из текстовой меткой и необязательное изображение.  
  
    1.  Импорт homesmall.bmp растрового изображения, содержащей восемь 16 x 16 изображений для Маленькая кнопка растровых изображений. Измените идентификатор точечного рисунка на IDB_RIBBON_HOMESMALL.  
  
    2.  Импорт homelarge.bmp растрового изображения, содержащей восемь 32 x 32 изображений для точечных рисунков большую кнопку. Измените идентификатор точечного рисунка на IDB_RIBBON_HOMELARGE.  
  
5.  Импорт точечных рисунков для панели ленты с измененным размером. Эти растровыми изображениями или значками панели используются после операции изменения размера, если слишком мало для отображения всей панели ленты.  
  
    1.  Импорт panelicons.bmp растрового изображения, содержащей восемь 16 x 16 изображений. В **свойства** окно **редакторе точечных рисунков**, Ширина растрового изображения к 64 (16 x 64). Измените идентификатор точечного рисунка на IDB_PANEL_ICONS.  
  
 [[Разделы](#top)]  
  
##  <a name="addribbon"></a> Добавление ресурса ленты в проект  
 При преобразовании приложения, использующего меню для приложения, использующего ленты, у вас для удаления или отключения существующих меню. Вместо этого можно создать ресурс ленты, добавить кнопки ленты и связать новые кнопки с существующие элементы меню. Несмотря на то, что больше не отображаются в меню, сообщения с панели ленты, маршрутизируются через меню. Кроме того ярлыки меню продолжать работу.  
  
 Лента состоит из «приложение», которая имеет большую кнопку ленты со стороны левый верхний, и одну или несколько вкладок категории. Каждая вкладка категории содержит одну или несколько панелей, которые действуют как контейнеры для элементов управления и кнопки ленты. Ниже показано, как создать ресурс ленты, а затем настройте кнопки приложения.  
  
#### <a name="to-add-a-ribbon-resource-to-the-project"></a>Чтобы добавить ресурс ленты в проект  
  
1.  На **проекта** меню, нажмите кнопку **добавить ресурс**.  
  
2.  В **добавить ресурс** выберите **ленты** и нажмите кнопку **New**.  
  
     Visual Studio создает ресурс ленты и открывает его в режиме конструктора. Идентификатор ресурса ленты — IDR_RIBBON1, который отображается в **представление ресурсов**. Ленты содержит одну категорию и одной панели.  
  
3.  Кнопка приложения можно настроить, изменив его свойства. Идентификаторы сообщений, которые используются в этом коде уже определены в меню Scribble 1.0.  
  
4.  В представлении конструирования нажмите кнопку «приложение», чтобы отобразить ее свойства. Изменения значений свойства следующим образом: **изображения** для *IDB_RIBBON_MAIN*, **Prompt** для *файл*, **ключей** Чтобы *f*, **большие изображения** для *IDB_RIBBON_FILELARGE*, и **маленькие изображения** для *IDB_RIBBON_ FILESMALL*.  
  
5.  Следующие изменения создать меню, которое появляется при нажатии пользователем кнопки приложения. Нажмите кнопку с многоточием (**...** ) рядом с **элементы Main** Открытие **редактор элементов**.  
  
    1.  Нажмите кнопку **добавить** для добавления кнопки. Изменение **заголовок** для *& новый*, **идентификатор** для *ID_FILE_NEW*, **изображения** для *0*, **Большие изображения** для *0*.  
  
    2.  Нажмите кнопку **добавить** для добавления второй кнопки. Изменение **заголовок** для *& Сохранить*, **идентификатор** для *ID_FILE_SAVE*, **изображения** для *2* , и **большие изображения** для *2*.  
  
    3.  Нажмите кнопку **добавить** Добавление третьей кнопки. Изменение **заголовок** для *& Сохранить как*, **идентификатор** для *ID_FILE_SAVE_AS*, **изображения** для *3*, и **большие изображения** для *3*.  
  
    4.  Нажмите кнопку **добавить** Добавление Четвертая кнопка. Изменение **заголовок** для *& Печать*, **идентификатор** для *ID_FILE_PRINT*, **изображения** для *4* , и **большие изображения** для *4*.  
  
    5.  Изменение **элемент** тип **разделителя** и нажмите кнопку **добавить**.  
  
    6.  Изменение **элемент** тип **кнопку**. Нажмите кнопку **добавить** для добавления пятого кнопки. Изменение **заголовок** для *& Закрыть*, **идентификатор** для *ID_FILE_CLOSE*, **изображения** для *5* , и **большие изображения** для *5*.  
  
6.  Следующие изменения создания вложенного меню кнопки «Печать», созданный на предыдущем шаге.  
  
    1.  Нажмите кнопку **печати** кнопку, измените **элемент** тип **метка**и нажмите кнопку **вставить**. Изменение **заголовок** для *Предварительный просмотр и печать документа*.  
  
    2.  Нажмите кнопку **печати** кнопку, измените **элемент** тип **кнопку**и нажмите кнопку **вставить**. Изменение **заголовок** для *& Печать*, **идентификатор** для *ID_FILE_PRINT*, **изображения** для *4* , и **большие изображения** для *4*.  
  
    3.  Нажмите кнопку **печати** и щелкните **вставить** для добавления кнопки. Изменение **заголовок** для *& быстрый печати*, **идентификатор** для *ID_FILE_PRINT_DIRECT*, **изображения** для *7*, и **большие изображения** для *7*.  
  
    4.  Нажмите кнопку **печати** и щелкните **вставить** Чтобы добавить другую кнопку. Изменение **заголовок** для *& Просмотр печати*, **идентификатор** для *ID_FILE_PRINT_PREVIEW*, **изображения** для *6*, и **большие изображения** для *6*.  
  
    5.  Теперь вы изменили **Main элементы**. Нажмите кнопку **закрыть** для выхода из **редактор элементов**.  
  
7.  Следующие изменения создает кнопку выхода, которая отображается в нижней части меню кнопки приложения.  
  
    1.  В **свойства** окно, нажмите кнопку с многоточием (**...** ) рядом с **кнопку** Открытие **редактор элементов**.  
  
    2.  Нажмите кнопку **добавить** для добавления кнопки. Изменение **заголовок** для *& выход из*, **идентификатор** для *ID_APP_EXIT*, **изображения** для *8* .  
  
 [[Разделы](#top)]  
  
##  <a name="createinstance"></a> Создание экземпляра ленты  
 Ниже показано, как создать экземпляр ленты при запуске приложения. Чтобы добавить на панель ленты в приложение, объявите панель ленты в файле mainfrm.h. Затем в файле mainfrm.cpp напишите код для загрузки ресурса ленты.  
  
#### <a name="to-create-an-instance-of-the-ribbon-bar"></a>Для создания экземпляра ленты  
  
1.  В файле mainfrm.h добавьте данные-член защищенный раздел `CMainFrame`, в определении класса для главного фрейма. Этот член представляет панели ленты.  
  
 "" * / / Ленте панель приложения  
    CMFCRibbonBar m_wndRibbonBar;  
 ```  
  
2.  In the mainfrm.cpp file, add the following code before the final **return** statement at the end of the `CMainFrame::OnCreate` function. This creates an instance of the ribbon bar.  
  
 ``` *// Create the ribbon bar  
    if (!m_wndRibbonBar.Create(this))  
 {  
    return -1;   //Failed to create ribbon bar  
 }  
    m_wndRibbonBar.LoadFromResource(IDR_RIBBON1);

 ```  
  
 [[Разделы](#top)]  
  
##  <a name="addcategory"></a> Настройка ресурс ленты  
 После создания кнопки приложения можно добавить элементы на ленту.  
  
> [!NOTE]
>  В этом пошаговом руководстве используется один и тот же значок панели для всех панелей. Тем не менее можно использовать другие индексы списка изображений для отображения других значков.  
  
#### <a name="to-add-a-home-category-and-edit-panel"></a>Добавить категорию домашней и изменить панель  
  
1.  Программа Scribble требует только одной категории. В представлении конструктора щелкните **категории** для отображения его свойств. Изменения значений свойства следующим образом: **заголовок** для *& Главная*, **большие изображения** для *IDB_RIBBON_HOMELARGE*,  **Маленькие изображения** для *IDB_RIBBON_HOMESMALL*.  
  
2.  Каждая категория ленты организована в именованный панелей. Каждая панель содержит набор элементов, выполняющих связанные операции. Эта категория имеет одну панель. Нажмите кнопку **панель**и затем измените **заголовок** для *изменить* и **индекс образа** для *0*.  
  
3.  Чтобы **изменить** панели, добавить кнопки, которая отвечает за удаление содержимого документа. Идентификатор сообщения для этой кнопки в IDR_SCRIBBTYPE ресурс уже определен. Укажите *очистить все* как текст кнопки и индекс точечного рисунка, который оформляет кнопки. Откройте **элементов**и затем перетащите **кнопку** для **изменить** панель. Нажмите кнопку, а затем измените **заголовок** для *очистить все*, **идентификатор** для *ID_EDIT_CLEAR_ALL*, **индекс образа** для *0*, **индекс большого изображения** для *0*.  
  
4.  Сохранить изменения и затем постройте и запустите приложение. Должны быть на панель ленты в верхней части окна вместо строки меню, и приложения Scribble должны отображаться. Ленты должны иметь одну категорию **Главная**, и **Главная** должны иметь одну панель **изменить**. Кнопки ленты, которые вы добавили должен быть связан с существующие обработчики событий и **откройте**, **закрыть**, **Сохранить**, **печати**, и **очистить все** кнопки должен работать соответствующим образом.  
  
 [[Разделы](#top)]  
  
##  <a name="setlook"></a> Настройка внешнего вида приложения  
 Объект *наглядный диспетчер* — это глобальный объект, управляющий все прорисовки для приложения. Так как в исходном приложении Scribble использует стиля пользовательского интерфейса Office 2000 пользователя, приложение может выглядеть просто. Вы можете сбросить приложению использовать Диспетчер визуальных Office 2007, как указано в приложениях Office 2007.  
  
#### <a name="to-set-the-look-of-the-application"></a>Чтобы задать внешний вид приложения  
  
1.  В `CMainFrame::OnCreate` введите следующий код, чтобы изменить по умолчанию наглядный диспетчер и стиль.  
  
 "" * / / Set диспетчер по умолчанию для Office 2007   
    CMFCVisualManager::SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerOffice2007));

 CMFCVisualManagerOffice2007::SetStyle(CMFCVisualManagerOffice2007::Office2007_LunaBlue);

 ```  
  
2.  Save the changes, and then build and run the application. The application UI should resemble the Office 2007 UI.  
  
 [[Sections](#top)]  
  
## Next Steps  
 You have modified the classic Scribble 1.0 MFC sample to use the Ribbon Designer. Now go to [Part 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md).  
  
## See Also  
 [Walkthroughs](../mfc/walkthroughs-mfc.md)   
 [Walkthrough: Updating the MFC Scribble Application (Part 2)](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md)


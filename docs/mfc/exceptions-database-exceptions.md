---
title: "Исключения. Исключения баз данных | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "DAO [C++], исключения"
  - "исключения баз данных [C++]"
  - "базы данных [C++], обработка исключений"
  - "коды ошибок [C++], обработка исключений базы данных"
  - "обработка исключений [С++], базы данных"
  - "исключения [C++], база данных"
  - "ODBC [C++], исключения"
  - "ODBC - исключения [C++]"
ms.assetid: 28daf260-f824-4be6-aecc-1f859e6dec26
caps.latest.revision: 10
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 6
---
# Исключения. Исключения баз данных
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этой статье описывается, как обрабатывать исключения баз данных.  Большая часть материала в этой статье применяется работаете ли вы с классами MFC для ODBC \(ODBC\) или классами MFC DAO для \(DAO\).  Материала с одной или другую модель явно помечена.  Ниже приведен список разделов.  
  
-   [Подходы к обработке исключений](#_core_approaches_to_exception_handling)  
  
-   [Пример обработки исключений базы данных](#_core_a_database_exception.2d.handling_example)  
  
##  <a name="_core_approaches_to_exception_handling"></a> Подходы к обработке исключений  
 Подход аналогичен то, что DAO или ODBC.  
  
 Следует всегда писать обработчики исключений в этом дескриптора исключительным.  
  
 Наиболее прагматический подход к исключениям заразительным базы данных запускать приложение в сценариях исключения.  Определите возникает исключения, которые могут встречаться в операции в коде, а принудительное исключение, чтобы ошибка.  Затем проверьте результаты трассировки, чтобы определить, какое исключение, или проверить, возвращаются сведения об ошибке в отладчике.  Это позволяет получать сведения, коды возврата появится сценариям исключения используется.  
  
### Коды ошибок, используемые для исключений ODBC  
 В дополнение к кодам возврата указанным платформой, с именами формы **AFX\_SQL\_ERROR\_XXX**, некоторые [CDBExceptions](../mfc/reference/cdbexception-class.md) основана на кодах возврата [ODBC](../data/odbc/odbc-basics.md).  Коды возврата для таких исключений, имеют имена формы **SQL\_ERROR\_XXX**.  
  
 Коды возврата и .NET Framework, и ODBC\- указанный —, классы базы данных могут возвращать описаны в элемент данных [m\_nRetCode](../Topic/CDBException::m_nRetCode.md) класса `CDBException`.  Дополнительные сведения о кодах возврата указанных ODBC доступно в *справочнике программиста* ODBC SDK в библиотеке MSDN.  
  
### Коды ошибок, используемые для исключений DAO  
 Для исключений DAO обычно доступны дополнительные сведения.  Можно просмотреть сведения об ошибке доступа через 3 элемента данных уловленного объекта [CDaoException](../mfc/reference/cdaoexception-class.md).  
  
-   [m\_pErrorInfo](../Topic/CDaoException::m_pErrorInfo.md) содержит указатель на объект [CDaoErrorInfo](../mfc/reference/cdaoerrorinfo-structure.md), который инкапсулирует сведения об ошибке в коллекции DAO объектов ошибок, связанных с базой данных.  
  
-   [m\_nAfxDaoError](../Topic/CDaoException::m_nAfxDaoError.md) расширенный содержит код ошибки из классов MFC DAO.  Эти коды ошибок, с именами **AFX\_DAO\_ERROR\_XXX** формы, содержится в элементе данных в `CDaoException`.  
  
-   [m\_scode](../Topic/CDaoException::m_scode.md) содержит OLE `SCODE` из DAO, если применимо.  Иногда бывает необходимо для работы с этим кодом ошибки, однако.  Обычно дополнительные сведения доступны в других элементах данных 2.  См. также: элемент данных дополнительные сведения о значениях `SCODE`.  
  
 Дополнительные сведения об ошибках DAO, типе объекта ошибки DAO и коллекции ошибок DAO доступно в классом [CDaoException](../mfc/reference/cdaoexception-class.md).  
  
##  <a name="_core_a_database_exception.2d.handling_example"></a> Пример обработки исключений базы данных  
 В следующем примере выполняется попытка создать [CRecordset](../Topic/CRecordset%20Class.md)\- производного объекта в куче с помощью оператора **новый**, а затем открыть набор записей \(для источника данных ODBC\).  Для подобного примера для классов DAO см. в разделе «пример исключения DAO» ниже.  
  
### Пример исключения ODBC  
 Исключение может вызывать функцию\-член [Открыть](../Topic/CRecordset::Open.md) \(типа [CDBException](../mfc/reference/cdbexception-class.md) для классов ODBC\), поэтому квадратные скобки этого кода вызов **Открыть** с помощью блока **try**.  Следующий блок **catch** будет перехватывать `CDBException`.  Можно просмотреть самого объекта исключения, вызывается `e`, но в этом случае достаточно, чтобы узнать, что попытка создать набор записей завершилась неудачно.  Блок **catch** показывает окно сообщения и очищает путем удаления объекта набора записей.  
  
 [!code-cpp[NVC_MFCDatabase#36](../mfc/codesnippet/CPP/exceptions-database-exceptions_1.cpp)]  
  
### Пример исключения DAO  
 Пример DAO похож на пример для ODBC, но обычно можно извлечь несколько типов данных.  Следующий код также пытается открыть набор записей.  Если попытка создает исключение, можно просмотреть элемент данных объекта исключения для сведений об ошибке.  Как и в предыдущем примере ODBC, возможно, достаточно знать, что попытка создать набор записей завершилась неудачно.  
  
 [!code-cpp[NVC_MFCDatabase#37](../mfc/codesnippet/CPP/exceptions-database-exceptions_2.cpp)]  
  
 Этот код получает строку сообщения об ошибке от члена [m\_pErrorInfo](../Topic/CDaoException::m_pErrorInfo.md) объекта исключения.  MFC такое член, если она вызывает исключение.  
  
 Обсуждение сведений об ошибке возвращать объектом `CDaoException` см. классы [CDaoException](../mfc/reference/cdaoexception-class.md) и [CDaoErrorInfo](../mfc/reference/cdaoerrorinfo-structure.md).  
  
 При работе с базами данных Microsoft Jet \(.mdb\), и в большинстве случаев при работе с ODBC, будет только один объект ошибки.  В тех редких случаях при использовании источника данных ODBC и множественные ошибки можно цикл через коллекцию ошибок на основе DAO количества ошибок, возвращаемых [CDaoException::GetErrorCount](../Topic/CDaoException::GetErrorCount.md).  Каждый раз цикл через вызов [CDaoException::GetErrorInfo](../Topic/CDaoException::GetErrorInfo.md), чтобы refill элемент данных `m_pErrorInfo`.  
  
## См. также  
 [Обработка исключений](../mfc/exception-handling-in-mfc.md)
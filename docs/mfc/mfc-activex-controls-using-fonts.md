---
title: "Элементы управления ActiveX в MFC. Использование шрифтов | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "OnFontChanged"
  - "HeadingFont"
  - "InternalFont"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "шрифты, элементы управления ActiveX"
  - "GetFont - метод"
  - "HeadingFont - свойство"
  - "InternalFont - метод"
  - "IPropertyNotifySink - класс"
  - "MFC ActiveX - элементы управления, шрифты"
  - "уведомления, MFC ActiveX - шрифты элементов управления"
  - "OnDraw - метод, MFC ActiveX - элементы управления"
  - "OnFontChanged - метод"
  - "SelectStockFont - метод"
  - "SetFont - метод"
  - "Stock Font - свойство"
ms.assetid: 7c51d602-3f5a-481d-84d1-a5d8a3a71761
caps.latest.revision: 12
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 8
---
# Элементы управления ActiveX в MFC. Использование шрифтов
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Если в элемент управления ActiveX отображает текст, можно разрешить пользователю элемента управления, чтобы изменить внешний вид текста, изменив свойство шрифта.  Свойства шрифта реализуются как объекты шрифтов и может быть одним из 2 типов: биржевая или пользовательский.  Свойств font preimplemented свойства шрифта, которые можно добавить с помощью мастера добавления свойства.  Свойства пользовательского preimplemented шрифта и разработчик элемента управления определяет расширение функциональности и потребление свойства.  
  
 Этот раздел охватывает следующее:  
  
-   [С помощью свойства font](#_core_using_the_stock_font_property)  
  
-   [Использование пользовательского свойства шрифта в элементе управления](#_core_implementing_a_custom_font_property)  
  
##  <a name="_core_using_the_stock_font_property"></a> С помощью свойства font  
 Свойств font preimplemented классом [COleControl](../mfc/reference/colecontrol-class.md).  Кроме того, страница стандартных свойств font доступна также, что пользователю изменять различные атрибуты объекта шрифта, такие как имя, размер и стиль.  
  
 Чтобы получить объект шрифта посредством [GetFont](../Topic/COleControl::GetFont.md), [SetFont](../Topic/COleControl::SetFont.md) и функцию [InternalGetFont](../Topic/COleControl::InternalGetFont.md)`COleControl`.  Пользователь элемента управления к объекту через шрифта `GetFont` и функции `SetFont` точно так же, как и любой другой получает или задает свойство.  Если доступ к объекту требуется шрифта из элемента управления, используйте функцию `InternalGetFont`.  
  
 Как описано в разделе [Элементы управления ActiveX MFC. Свойства](../mfc/mfc-activex-controls-properties.md), чтобы добавить стандартные свойства делать с [Мастер добавления свойства](../ide/names-add-property-wizard.md).  Выбрано свойство шрифта и мастера добавления свойства автоматически вставляет запись font в схему подготовки к отправке элемента управления.  
  
#### Добавление свойства font с помощью мастера добавления свойства.  
  
1.  Загрузите проект элемента управления.  
  
2.  В представлении классов разверните узел библиотеки элемента управления.  
  
3.  Щелкните правой кнопкой мыши узел интерфейса для элемента управления \(второго узла узла библиотеки\), чтобы открыть контекстное меню.  
  
4.  В контекстном меню щелкните **Добавить**, а затем щелкните **Добавить свойство**.  
  
     Это будет открыт мастер добавления свойства.  
  
5.  В поле **Имя свойства**, нажмите **Шрифт**.  
  
6.  Нажмите кнопку **Готово**.  
  
 Мастера добавления свойства добавляет в следующей линия со схемой подготовки к отправке элемента управления, находящуюся в файле реализации класса элемента управления.  
  
 [!code-cpp[NVC_MFC_AxFont#1](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_1.cpp)]  
  
 Кроме того, мастер добавления свойства добавляет в следующей линию в файл элемента управления .IDL:  
  
 [!code-cpp[NVC_MFC_AxFont#2](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_2.idl)]  
  
 Свойство заголовка пример биржевой свойства текста, можно создать с помощью данных свойств font.  Добавление свойства заголовка биржевой к элементу управления с помощью шагов аналогично, используемым для свойств font.  
  
#### Добавление свойства заголовка хранения с помощью мастера добавления свойства.  
  
1.  Загрузите проект элемента управления.  
  
2.  В представлении классов разверните узел библиотеки элемента управления.  
  
3.  Щелкните правой кнопкой мыши узел интерфейса для элемента управления \(второго узла узла библиотеки\), чтобы открыть контекстное меню.  
  
4.  В контекстном меню щелкните **Добавить**, а затем щелкните **Добавить свойство**.  
  
     Это будет открыт мастер добавления свойства.  
  
5.  В поле **Имя свойства**, нажмите **Заголовок**.  
  
6.  Нажмите кнопку **Готово**.  
  
 Мастера добавления свойства добавляет в следующей линия со схемой подготовки к отправке элемента управления, находящуюся в файле реализации класса элемента управления.  
  
 [!code-cpp[NVC_MFC_AxFont#3](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_3.cpp)]  
  
##  <a name="_core_modifying_the_ondraw_function"></a> Изменить функции OnDraw  
 Реализация по умолчанию `OnDraw` используется системный шрифт Windows для всего текста, отображаемого в элементе управления.  Это означает, что необходимо изменить код `OnDraw`, выбрав объект шрифта в контексте устройства.  Для этого необходимо вызвать метод [COleControl::SelectStockFont](../Topic/COleControl::SelectStockFont.md) и передает контекст устройства элемента управления, как показано в следующем примере:  
  
 [!code-cpp[NVC_MFC_AxFont#4](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_4.cpp)]  
  
 После того как функция `OnDraw` была изменена для использования объекта шрифта, любой текст в элементе управления отображается с характеристиками из свойств font элемента управления.  
  
##  <a name="_core_using_custom_font_properties_in_your_control"></a> Использование пользовательского свойства шрифта в элементе управления  
 Помимо свойств font, элемент управления ActiveX может иметь свойства пользовательского шрифта.  Добавление пользовательского свойства шрифта необходимо:  
  
-   Использование мастера добавления свойства для реализации пользовательского свойства шрифта.  
  
-   [Обрабатывать уведомления шрифта](#_core_processing_font_notifications).  
  
-   [Реализация новый интерфейс уведомления шрифта](#_core_implementing_a_new_font_notification_interface).  
  
###  <a name="_core_implementing_a_custom_font_property"></a> Реализация пользовательского свойства шрифта  
 Для реализации пользовательского свойства шрифта используется мастер добавления свойства для добавления свойств и затем внести некоторые изменения в код.  В следующих разделах описывается, как добавить пользовательское свойство `HeadingFont` в элемент управления примера.  
  
##### Добавление пользовательского свойства шрифта с помощью мастера добавления свойства.  
  
1.  Загрузите проект элемента управления.  
  
2.  В представлении классов разверните узел библиотеки элемента управления.  
  
3.  Щелкните правой кнопкой мыши узел интерфейса для элемента управления \(второго узла узла библиотеки\), чтобы открыть контекстное меню.  
  
4.  В контекстном меню щелкните **Добавить**, а затем щелкните **Добавить свойство**.  
  
     Это будет открыт мастер добавления свойства.  
  
5.  В поле **Имя свойства** введите имя для свойства.  В данном примере используйте **HeadingFont**.  
  
6.  В поле **Тип реализации**, щелкните **Get\/set методы**.  
  
7.  В поле **свойство Type**, выберите **IDispatch\***  для типа свойства.  
  
8.  Нажмите кнопку **Готово**.  
  
 Мастера добавления свойства создает код для добавления пользовательского свойства `HeadingFont` в класс `CSampleCtrl` и файл SAMPLE.IDL.  Поскольку `HeadingFont` тип свойства get и set, мастера добавления свойства изменяет схему подготовки к отправке класса `CSampleCtrl`, чтобы включить запись макроса `DISP_PROPERTY_EX_ID`[DISP\_PROPERTY\_EX](../Topic/DISP_PROPERTY_EX.md):  
  
 [!code-cpp[NVC_MFC_AxFont#5](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_5.cpp)]  
  
 Макрос `DISP_PROPERTY_EX` сопоставляет имя свойства `HeadingFont` с соответствующим классом `CSampleCtrl` методы get и set, `GetHeadingFont` и `SetHeadingFont`.  Тип значения свойств также определен; в данном случае **VT\_FONT**.  
  
 Мастера добавления свойства также добавляет объявление в файле заголовка элемента управления \(. H\) для функций `GetHeadingFont` и `SetHeadingFont` и добавляет их шаблоны функции в файле реализации элемента управления \(CPP\).  
  
 [!code-cpp[NVC_MFC_AxFont#6](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_6.cpp)]  
  
 Наконец, мастера добавления свойства изменяет файл элемента управления .IDL путем добавления запись для свойства `HeadingFont`:  
  
 [!code-cpp[NVC_MFC_AxFont#7](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_7.idl)]  
  
### Изменения в код элемента управления  
 После добавления свойства `HeadingFont` к элементу управления, необходимо внести некоторые изменения в качестве заголовка и файлы реализации элемента управления для полной поддержки новое свойство.  
  
 В файле заголовка элемента управления \(. H\) добавьте следующее объявление защищенного переменной\-члена:  
  
 [!code-cpp[NVC_MFC_AxFont#8](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_8.h)]  
  
 В файле реализации элемента управления \(CPP\), выполните следующие действия:  
  
-   Инициализация `m_fontHeading` в конструкторе элемента управления.  
  
     [!code-cpp[NVC_MFC_AxFont#9](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_9.cpp)]  
  
-   Объявите статическую структуры **FONTDESC**, содержащими атрибуты по умолчанию шрифта.  
  
     [!code-cpp[NVC_MFC_AxFont#10](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_10.cpp)]  
  
-   В функции\-члене `DoPropExchange` элемента управления добавьте вызов функции `PX_Font`.  Это обеспечивает инициализацию и сохранение для пользовательского свойства шрифта.  
  
     [!code-cpp[NVC_MFC_AxFont#11](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_11.cpp)]  
  
-   Завершение реализации функции\-члена `GetHeadingFont` элемента управления.  
  
     [!code-cpp[NVC_MFC_AxFont#12](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_12.cpp)]  
  
-   Завершение реализации функции\-члена `SetHeadingFont` элемента управления.  
  
     [!code-cpp[NVC_MFC_AxFont#13](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_13.cpp)]  
  
-   Измените функцию\-член `OnDraw` элемента управления, чтобы определить переменную для хранения ранее выбранный шрифт.  
  
     [!code-cpp[NVC_MFC_AxFont#14](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_14.cpp)]  
  
-   Измените функцию\-член `OnDraw` элемента управления, чтобы выделить шрифт в пользовательский контекст устройства, добавив в следующей линия везде, где шрифт будет использоваться.  
  
     [!code-cpp[NVC_MFC_AxFont#15](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_15.cpp)]  
  
-   Измените функцию\-член `OnDraw` элемента управления, чтобы выбрать предыдущую back шрифта в контексте устройства, добавив в следующей линия после того, как шрифт использовался.  
  
     [!code-cpp[NVC_MFC_AxFont#16](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_16.cpp)]  
  
 После того как свойство пользовательского было реализовано шрифтов, страница стандартных свойств font должна быть реализована, что пользователи элемента управления, чтобы изменить шрифт текущего элемента управления.  Чтобы добавить идентификатор страницы свойств для страницы свойств стандартного шрифта, добавьте следующую линии после макроса `BEGIN_PROPPAGEIDS`:  
  
 [!code-cpp[NVC_MFC_AxFont#17](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_17.cpp)]  
  
 Также необходимо увеличить значение параметра числа выполнения макроса `BEGIN_PROPPAGEIDS` одним.  Это показано в следующей линия:  
  
 [!code-cpp[NVC_MFC_AxFont#18](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_18.cpp)]  
  
 После того, как эти изменения были внесены следует перестроить весь проект включение дополнительную функциональность.  
  
###  <a name="_core_processing_font_notifications"></a> Обрабатывать уведомления шрифта  
 В большинстве случаев элемент управления должен знать, когда были изменены характеристики объекта шрифта.  Каждый объект шрифта поддерживает предоставление уведомлений при изменении путем вызова функции\-члены интерфейса **IFontNotification**, реализованный `COleControl`.  
  
 Если элемент управления использует свойство font, его уведомления обрабатываются функцией\-членом `OnFontChanged``COleControl`.  При добавлении пользовательского свойства шрифта, можно получить их использовать одну и ту же реализацию.  В примере выше, это выполнялось путем передачи &**m\_xFontNotification** при инициализации переменную\-член **m\_fontHeading**.  
  
 ![Реализация интерфейсов нескольких объектов шрифта](../mfc/media/vc373q1.png "vc373Q1")  
Реализация несколько интерфейсов объекта шрифта  
  
 В приведенном выше рисунке сплошные линии показывают, что оба объекта шрифта используют одну и ту же реализацию **IFontNotification**.  Это может вызвать проблемы при необходимости различаются, шрифт был изменен.  
  
 Один из способов различать уведомлениями объекта шрифта элемента управления создать отдельный реализация интерфейса **IFontNotification** для каждого объекта шрифта в элементе управления.  Этот метод позволяет получить оптимизировать код рисования, обновление только строку или строки, которые используют измененный недавно шрифт.  Следующие разделы описывают шаги, которые ввод отдельно интерфейсы уведомлений второго свойства шрифта.  Предполагается, что будет второе свойство шрифта свойством `HeadingFont`, который был добавлен в предыдущем разделе.  
  
###  <a name="_core_implementing_a_new_font_notification_interface"></a> Реализация новый интерфейс уведомления шрифта  
 Для различения уведомлениями двух или нескольких шрифтов новый интерфейс уведомления должен быть реализован для каждого шрифта, используемого в элементе управления.  В следующих разделах описано, как реализовать новый интерфейс уведомления шрифта, изменив заголовок и файлами реализации элемента управления.  
  
### Добавления в файл заголовка  
 В файле заголовка элемента управления \(. H\) добавьте следующие линии в объявление класса:  
  
 [!code-cpp[NVC_MFC_AxFont#19](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_19.h)]  
  
 Это создает для него реализация интерфейса `IPropertyNotifySink``HeadingFontNotify`.  Этот новый интерфейс содержит метод с именем `OnChanged`.  
  
### Дополнения к файлу реализации  
 В коде, который инициализирует шрифт заголовка \(в конструкторе элемента управления\) измените `&m_xFontNotification` в `&m_xHeadingFontNotify`.  Затем добавьте следующий код:  
  
 [!code-cpp[NVC_MFC_AxFont#20](../mfc/codesnippet/CPP/mfc-activex-controls-using-fonts_20.cpp)]  
  
 Методы `AddRef` и `Release` в интерфейсе `IPropertyNotifySink` отслеживают счетчик ссылок для объекта элемента управления ActiveX.  Если элемент управления получает доступ к указателю интерфейса, элемент управления вызывает `AddRef` увеличивающий счетчик ссылок.  Когда элемент управления завершил работу с указателем, он вызывает `Release`, во многом аналогично тому, как **GlobalFree** можно вызывать для освобождения глобальный блок памяти.  Когда число ссылок для данного интерфейса перейдите к нулю, реализацию интерфейса можно освободить.  В этом примере функция `QueryInterface` возвращает указатель на интерфейс `IPropertyNotifySink` в указанном объекте.  Эта функция позволяет элемент управления ActiveX для запроса к объекту задать интерфейсы, которые она поддерживает.  
  
 После того как были внесены следующие изменения в проект, перестройте проект и использовать тестовый контейнер для выполнения интерфейс.  Сведения о доступе к тестовому контейнеру см. в разделе [Тестирование свойств и событий при помощи тестового контейнера](../mfc/testing-properties-and-events-with-test-container.md).  
  
## См. также  
 [Элементы управления ActiveX MFC](../mfc/mfc-activex-controls.md)   
 [Элементы управления ActiveX в MFC. Использование изображений в элементе управления ActiveX](../mfc/mfc-activex-controls-using-pictures-in-an-activex-control.md)   
 [Элементы управления ActiveX в MFC. Использование стандартных страниц свойств](../mfc/mfc-activex-controls-using-stock-property-pages.md)
---
title: "Руководство по переносу: MFC Scribble | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
ms.assetid: 8ddb517d-89ba-41a1-ab0d-4d2c6d9047e8
caps.latest.revision: 5
caps.handback.revision: 3
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Руководство по переносу: MFC Scribble
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

Этот раздел — первый из несколько подразделов, в которых рассматриваются процедуры обновления для проектов Visual C\+\+, созданных в более ранних версиях Visual Studio для [!INCLUDE[cpp_dev14_long](../porting/includes/cpp_dev14_long_md.md)].  В этих подразделах на примерах описывается процесс обновления начиная с очень простого проекта с постепенным повышением уровня сложности.  В этом подразделе будет рассмотрен процесс обновления для конкретного проекта MFC Scribble.  Он подходит в качестве базового примера для процесса обновления для проектов C\+\+.  
  
 Каждая версия Visual Studio может иметь некоторые несовместимости, что может усложнять перемещение кода из более старой версии Visual Studio в новую.  Иногда необходимые изменения есть в вашем коде, поэтому код необходимо перекомпилировать и обновлять. В других случаях необходимые изменения относятся к файлам проекта.  При открытии проекта, созданного в предыдущей версии Visual Studio, система автоматически предлагает обновить версию проекта или решения.  Эти средства обычно обновляют только файлы проекта \(они не изменяют исходный код\).  
  
## MFC Scribble  
 MFC Scribble — это широко известный пример, который был включен в разные версии Visual C\+\+.  Это простое приложение для рисования, демонстрирующее некоторые основные возможности MFC.  Существуют различные версии данного приложения — как управляемые версии, так и версии в машинном коде.  Для этого примера была взята старая версия Scribble в машинном коде из Visual Studio 2005 и открыта в [!INCLUDE[vs_dev14](../mfc/includes/vs_dev14_md.md)].  
  
 Перед выполнением обновления необходимо создать резервную копию всего решения и его содержимого.  Затем необходимо выбрать конкретный метод обновления.  Для более сложных решений и проектов, которые еще не обновлялись в течение длительного времени, следует рассмотреть возможность последовательного обновления только до следующей версии Visual Studio за один раз.  Таким способом можно выявить версию Visual Studio, которая создает проблему.  Для простого проекта рекомендуется попробовать открыть его в последней версии Visual Studio и позволить мастеру преобразовать данный проект.  Если это не получится, можно попробовать последовательно обновлять до каждой следующей версии, если есть доступ к соответствующим версиям Visual Studio.  
  
 Обратите внимание, что devenv можно также запускать из командной строки с помощью параметра `/Upgrade`, а не использовать мастер для обновления проектов.  См. [\/Upgrade](../Topic/-Upgrade%20\(devenv.exe\).md).  Это может оказаться полезным для автоматизации процесса обновления для большого количества проектов.  
  
### Шаг 1.Преобразование файла проекта  
 При открытии старого файла проекта в Visual Studio 2015 система предлагает преобразовать этот файл в самую последнюю принятую версию.  Появляется следующее диалоговое окно:  
  
 ![Просмотр проекта и изменения в решении](../porting/media/scribbleprojectupgrade.png "ScribbleProjectUpgrade")  
  
 Произошла ошибка, указывающая, что целевой объект Itanium недоступен и не будет преобразован.  
  
  **Платформа Itanium отсутствует в этом проекте.  Все конфигурации и параметры файлов конфигурации для данной платформы будут игнорироваться.  Чтобы преобразовать эту платформу, убедитесь, что соответствующая платформа установлена в каталоге % vctargetpath%\\platforms\\Itanium.  Продолжить преобразование данного проекта без этой платформы?**  На момент создания предыдущего проекта Scribble платформа Itanium представляла собой важную целевую платформу.  Платформа Windows больше не поддерживает Itanium, поэтому следует выбрать вариант продолжения без поддержки платформы Itanium.  
  
 Затем Visual Studio отображает отчет о миграции, в котором указываются все проблемы со старым файлом проекта.  
  
 ![Отчет об обновлении](../Image/ScribbleMigrationReport.PNG "ScribbleMigrationReport")  
  
 В этом случае проблемами были все предупреждения, а Visual Studio внесла соответствующие изменения в файл проекта.  Применительно к проекту существенная разница заключается в том, что изменился инструмент сборки: вместо vcbuild применяется msbuild.  Это изменение впервые появилось в Visual Studio 2010.  К другим изменениям относится другая последовательность элементов в самом файле проекта.  Никакие другие проблемы применительно к этому простому проекту рассматривать не нужно.  
  
### Шаг 2.Получение файла проекта для сборки  
 Перед сборкой необходимо проверить набор инструментов платформы, чтобы узнать, какую версию компилятора использует система проекта.  В диалоговом окне «Свойства проекта» в разделе **Свойства конфигурации** в категории **Общая** взгляните на свойство **Набор инструментов платформы**.  Оно содержит версию Visual Studio и номер версии набора инструментов платформы, в данном случае – v140 для версии [!INCLUDE[cpp_dev14_long](../porting/includes/cpp_dev14_long_md.md)] инструментов.  При преобразовании проекта, который изначально был скомпилирован с помощью Visual C\+\+ 2010, 2012 или 2013, набор инструментов не обновляется автоматически до [!INCLUDE[cpp_dev14_long](../porting/includes/cpp_dev14_long_md.md)].  В случае Scribble версия, которая была преобразована, была создана для Visual Studio 2005, поэтому она преобразуется для применения последнего набора инструментов.  
  
 При сборке первая возникающая проблема связана с кодом MBCS.  
  
  **Ошибка MSB8031:**  Ссылка в сообщении об ошибке отсылает к разделу о нежелательности применения MBCS в Visual Studio 2013.  По умолчанию установка MFC в Visual C\+\+ 2013 не содержит версию MBCS для MFC.  Для построения данного проекта в своей текущей форме для MFC требуется версия MBCS.  Можно либо перенести код, чтобы использовать Юникод, либо загрузить и установить версию MBCS для MFC.  В случае загрузки версии MBCS для MFC можно добавить определение для макроса NO\_WARN\_MBCS\_MFC\_DEPRECATION, чтобы подавлять это предупреждение.  
  
 Чтобы загрузить версию MBCS для MFC: сначала прочтите об нежелательности применения версии MBCS для MFC в статье [Надстройка DLL MBCS MFC](../mfc/mfc-mbcs-dll-add-on.md) и в блоге VC, а затем загрузите версию MBCS для MFC [здесь](http://www.microsoft.com/download/details.aspx?id=44930).  В диалоговом окне «Свойства проекта» в категории **C\/C\+\+** в разделе **Препроцессор** добавьте NO\_WARN\_MBCS\_MFC\_DEPRECATION в список предварительно определенных макросов.  
  
 Чтобы переключиться на Юникод, откройте свойства проекта в разделе **Свойства конфигурации**, выберите раздел **Общее** и найдите свойство **Кодировка**.  Измените значение с **Использовать многобайтовую кодировку** на **Использовать кодировку Юникод**.  В результате данного изменения определены макросы \_UNICODE и UNICODE, а \_MBCS не определен. Это можно проверить в диалоговом окне «Свойства» в категории **C\/C\+\+** в свойстве **Командная строка**.  
  
  **\/GS \/analyze\- \/W4 \/Gy \/Zc:wchar\_t \/Zi \/Gm\- \/O2 \/Ob1 \/Fd".  \\Release\\vc140.pdb" \/Zc:inline \/fp:precise \/D "\_AFXDLL" \/D "WIN32" \/D "NDEBUG" \/D "\_WINDOWS" \/D "\_UNICODE" \/D "UNICODE" \/errorReport:prompt \/GF \/WX \/Zc:forScope \/Gd \/Oy \/MD \/Fa".  \\Release\\" \/EHsc \/nologo \/Fo".  \\Release\\" \/Fp".  \\Release\\Scribble.pch"**  Несмотря на то что проект Scribble не был настроен для компиляции с символами Юникода, он был уже записан с TCHAR вместо char, поэтому фактически ничего не нужно изменять.  Сборка проекта выполняется успешно с кодировкой Юникод.  
  
 Однако существует другая проблема.  Компилятор сообщает, что \_WINNT32\_WINNT не определен:  
  
  **\_WIN32\_WINNT не определен.  По умолчанию используется \_WIN32\_WINNT\_MAXVER \(см. WinSDKVer.h\)**  Это предупреждение, а не сообщение об ошибке, которое появляется очень часто при обновлении проекта Visual C\+\+.  Это макрос, который определяет, в какой самой ранней версии Windows будет запускаться приложение.  Если проигнорировать предупреждение, принимается значение по умолчанию \(\_WIN32\_WINNT\_MAXVER\), то есть будет использоваться текущая версия Windows.  Таблицу возможных значений см. в разделе [Использование заголовков Windows](https://msdn.microsoft.com/en-us/library/aa383745.aspx).  Например, можно выбрать вариант запуска в любой версии, начиная с Vista.  
  
```  
#define _WIN32_WINNT _WIN32_WINNT_VISTA  
```  
  
 Если код использует части интерфейса Windows API, недоступные в версии Windows, которая указана с помощью этого макроса, должно появиться сообщение об ошибке компилятора.  В случае кода Scribble ошибки отсутствуют.  
  
### Шаг 3.Тестирование и отладка  
 Набор тестов отсутствует. Мы только что запустили приложение, вручную протестировали его функции с помощью пользовательского интерфейса.  Проблемы не обнаружены.  
  
### Шаг 4.Улучшение кода  
 Теперь, после перехода на Visual Studio 2015, может потребоваться внести некоторые изменения, чтобы воспользоваться преимуществами новых функций C\+\+.  Текущая версия компилятора Visual C\+\+ намного лучше соответствует стандарту C\+\+, чем предыдущие версии, поэтому, при желании внести в код некоторые изменения, чтобы сделать его более безопасным и более переносимым в другие компиляторы и операционные системы, следует предусмотреть ряд усовершенствований.  
  
## Следующие шаги  
 Scribble представляла собой небольшое и простое классическое приложение Windows, которое было несложно преобразовывать.  Многие небольшие, простые приложения также можно легко преобразовывать в новую версию.  Для более сложных приложений, содержащих много строк кода, старого традиционного кода, который может не соответствовать современным инженерным стандартам, различных проектов и библиотек, настраиваемых этапов построения или для сложных скриптовых автоматизированных построений, процедура обновления займет больше времени.  Перейдем к [следующему примеру](../porting/porting-guide-com-spy.md), к приложению ATL\/COM, которое называется COM Spy.  
  
## См. также  
 [Перенос и обновление: примеры и конкретные случаи](../porting/porting-and-upgrading-examples-and-case-studies.md)   
 [Следующий пример: COM Spy](../porting/porting-guide-com-spy.md)
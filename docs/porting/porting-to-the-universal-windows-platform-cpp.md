---
title: "Перенос в универсальную платформу Windows (C++) | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
ms.assetid: f662d2e4-8940-418d-8109-cb76cb8f8569
caps.latest.revision: 14
caps.handback.revision: 14
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# Перенос в универсальную платформу Windows (C++)
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

В этом разделе приводятся сведения о переносе существующего кода C\+\+ на платформу приложений Windows 10, которая называется универсальной платформой Windows. Термин *универсальный* означает, что код может работать на любом из устройств под управлением Windows 10, в том числе на настольных ПК, телефонах, планшетных ПК и будущих устройствах. В ОС Windows 8.1 для создания приложения, предназначенного для работы в среде Windows 8.1 и Windows Phone 8.1, можно было использовать специальную функцию системы проектирования, которая называется "общим проектом". Универсальные приложения Windows не используют этот механизм. Вместо него, следует использовать один проект и один язык XAML, который нормально работает на любом устройстве с ОС Windows 10. Чтобы пользовательский интерфейс приложения мог адаптироваться к дисплеям разного размера, можно использовать средства динамического макета в XAML.  
  
 В состав документации центра разработчиков Windows входит руководство по переносу приложений Windows 8.1 в универсальную платформу Windows. См. раздел [Перенос приложения из среды выполнения Windows 8 в UWP](http://msdn.microsoft.com/library/windows/apps/dn954974.aspx). Хотя в данном руководстве основное внимание уделено, главным образом, коду C\#, большинство рекомендаций и инструкций применимо к языку C\+\+. Следующие процедуры содержат более подробные сведения.  
  
 В этом разделе рассматриваются следующие процедуры переноса кода в UWP.  
  
1.  [Перенос приложения для магазина Windows 8.1 на UWP](#BK_81StoreApp)  
  
2.  [Перенос компонента среды выполнения Windows 8.1 на UWP](#BK_81Component)  
  
 То же самое можно сделать при наличии классической DLL\-библиотеки Win32, которую требуется вызывать из приложения UWP. С помощью таких процедур можно создать уровень пользовательского интерфейса UWP для существующего классического приложения Windows на языке C\+\+ или кроссплатформенного стандартного кода C\+\+. См. раздел [Практическое руководство. Использование существующего кода C\+\+ в приложении универсальной платформы Windows](../Topic/How%20to:%20Use%20Existing%20C++%20Code%20in%20a%20Universal%20Windows%20Platform%20App.md).  
  
##  <a name="BK_81StoreApp"></a> Перенос приложения для магазина Windows 8.1 на UWP  
 Если у вас есть приложение для магазина Windows 8.1, эту процедуру можно использовать для того, чтобы оно могло работать на UWP и любом устройстве с ОС Windows 10.  Сначала рекомендуется построить проект с [!INCLUDE[vs_dev14](../mfc/includes/vs_dev14_md.md)] как проект Windows 8.1, чтобы устранить все проблемы, которые возникают вследствие изменений в компиляторе и библиотеках. После этого можно воспользоваться одним из двух способов преобразования проекта в проект UWP для Windows 10. Самый простой способ \(как поясняется в следующей процедуре\) — создание универсального проекта Windows и копирование в него существующего кода. Если вы использовали универсальный проект для классического приложения Windows 8.1 и Windows Phone 8.1, то проект будет запускаться с двумя разными макетами в XAML. Однако на выходе вы получите один динамический макет, адаптирующийся под размер экрана. Второй способ преобразования проекта для Windows 10 — внесение изменений в файл проекта и файл Package.appxmanifest. Этот метод описан в статье [Перенос приложений на универсальную платформу Windows \(UWP\)](../misc/migrate-apps-to-the-universal-windows-platform-uwp.md).  
  
#### Перенос приложения для магазина Windows 8.1 на UWP  
  
1.  Если вы еще не осуществили перенос, откройте свой проект приложения Windows 8.1 в [!INCLUDE[vs_dev14](../mfc/includes/vs_dev14_md.md)] и выполните процедуру обновления файла проекта.  
  
     Необходимо установить средства Windows 8.1 в программе установки Visual Studio. Если эти средства не установлены, запустите программу установки Visual Studio в окне "Программы и компоненты", выберите [!INCLUDE[vs_dev14](../mfc/includes/vs_dev14_md.md)] и в окне программы установки нажмите **Изменить**. Найдите средства Windows 8.1, убедитесь, что они выделены, и нажмите кнопку ОК.  
  
2.  Откройте окно "Свойства проекта" и в области "C\+\+, общее" установите для набора инструментов платформы значение v140 — средства сборки для [!INCLUDE[vs_dev14](../mfc/includes/vs_dev14_md.md)].  
  
3.  Постройте проект как проект Windows 8.1, а затем исправьте все ошибки сборки. Как правило, на этом этапе ошибки связаны с критическими изменениями в средствах сборки и библиотеках. Подробное описание изменений, которые могут повлиять на код, см. в разделе [Критические изменения в Visual C\+\+ 2015](../Topic/Visual%20C++%20change%20history%202003%20-%2020151.md).  
  
     После того, как проект будет построен без ошибок, можно приступить к переносу на универсальную платформу Windows \(Windows 10\).  
  
4.  Создайте новый проект универсального приложения Windows с помощью пустого шаблона. Ему можно присвоить имя, совпадающее с именем существующего проекта. Но в этом случае проекты должны находиться в разных каталогах.  
  
5.  Закройте решение, а затем с помощью проводника Windows или командной строки скопируйте файлы кода \(с расширениями .cpp, .h и .xaml\) из проекта Windows 8.1 в ту же папку, что и файл проекта \(.vcxproj\) для проекта, созданного на шаге 1. Не копируйте файл Package.appxmanifest. Если у вас есть отдельный код для Windows 8.1 Desktop и Windows 8.1 Phone, выберите один из них для переноса в первую очередь \(позже вам придется выполнить ряд действий, чтобы подготовить перенос другого кода\). Не забудьте скопировать все вложенные папки и их содержимое. При появлении соответствующего запроса выберите вариант замены всех файлов с одинаковыми именами.  
  
6.  Снова откройте решение и выберите пункты **Добавить, Существующий элемент** в контекстном меню для узла проекта. Выберите все файлы, которые были скопированы, за исключением файлов, которые уже являются частью проекта.  
  
     Проверьте все вложенные папки и убедитесь, что в них также добавлены файлы.  
  
7.  Если вы используете имя проекта, которое отличается от имени старого проекта, откройте файл Package.appxmanifest и обновите точку входа в соответствии с именем пространства имен для класса приложения.  
  
     Поле **Точка входа** в файле Package.appxmanifest содержит имя области для класса приложения, содержащего пространство имен, которое содержит класс приложения. При создании универсального проекта Windows для пространства имен указывается имя проекта. Если оно отличается от имени, указанного в файлах, скопированных из старого проекта, обновите одно из них, чтобы они соответствовали друг другу.  
  
8.  Постройте проект и устраните все ошибки сборки из\-за критических изменений между различными версиями пакета Windows SDK.  
  
9. Запустите проект на локальном компьютере. Убедитесь, что отсутствуют ошибки развертывания, что макет приложения имеет приемлемый формат и что он корректно работает на настольном компьютере.  
  
10. Если у вас есть отдельные файлы кода .xaml для другого устройства, например, для Windows Phone 8.1, проанализируйте этот код и найдите в нем отличия от кода для стандартного устройства. Если разница заключается только в макете, для настройки отображения, в зависимости от размера экрана, можно использовать диспетчер визуальных состояний в xaml. Если имеются другие различия, можно использовать разделы условий в коде с помощью следующих операторов \#if.  
  
    ```  
    #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_PC_APP) #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_PHONE_APP) #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_APP) #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)  
    ```  
  
     Эти выражения применяются к приложениям для Магазина Windows, приложениям для Магазина Windows Phone, к обоим видам или ни к одному из них \(только для классических приложений Win32 для настольной системы\), соответственно. Эти макросы доступны только в пакете SDK Windows 8.1 и более поздних версиях. Поэтому если код должен компилироваться в более ранних версиях пакета SDK Windows или для других платформ, помимо Windows, необходимо учитывать ситуацию, в которой не определена ни одна их этих возможностей.  
  
11. Запустите приложение и выполните его отладку в эмуляторе или физическом устройстве для каждого типа устройств, поддерживаемого приложением. Чтобы запустить эмулятор, Visual Studio необходимо запустить на физическом компьютере, а не на виртуальной машине.  
  
##  <a name="BK_81Component"></a> Перенос компонента среды выполнения Windows 8.1 на UWP  
 Если у вас есть библиотека DLL или компонент среды выполнения Windows, которые уже работают с приложениями для магазина Windows 8.1, эту процедуру можно использовать для обеспечения работы компонента или библиотеки DLL с платформой UWP и Windows 10. Процедура в целом заключается в создании нового проекта и копировании в него кода.  
  
#### Перенос компонента среды выполнения Windows 8.1 в UWP  
  
1.  В диалоговом окне **Новый проект** в [!INCLUDE[vs_dev14](../mfc/includes/vs_dev14_md.md)] найдите узел **Универсальное приложение для Windows**. Если вы не видите этот узел, сначала установите [Инструменты для Windows 10](http://go.microsoft.com/fwlink/p/?LinkID=617903). Выберите шаблон **компонента среды выполнения Windows**, присвойте компоненту имя и нажмите кнопку **ОК**. Имя компонента будет использоваться в качестве имени пространства имен, поэтому вы можете использовать имя пространства имен старого проекта. Для этого потребуется создать проект в папке, которая отличается от папки старого проекта. Если выбрать другое имя, можно обновить имя пространства имен в созданных файлах кода.  
  
2.  Закройте проект.  
  
3.  Скопируйте все файлы кода \(CPP, H, XAML и т. д.\) из компонента Windows 8.1 в только что созданный проект. Не копируйте файл Package.appxmanifest.  
  
4.  Выполните сборку и устраните все ошибки, возникающие из\-за критических изменений между разными версиями пакета SDK Windows.  
  
## Устранение неполадок  
 В процессе переноса кода на универсальную платформу Windows могут возникать различные ошибки. Могут возникать следующие проблемы.  
  
 **Проблемы с конфигурацией проекта**  
  
 Может появиться такое сообщение об ошибке.  
  
```Output  
Не удалось найти сборку "platform.winmd": укажите путь для поиска сборки с помощью переключателя /AI или переменной среды LIBPATH  
```  
  
 Это означает, что проект не построен как универсальный проект Windows. Проверьте файл проекта и убедитесь, что он содержит правильные элементы XML, которые определяют проект как универсальный проект Windows. Должны присутствовать следующие элементы \(номер версии целевой платформы может отличаться\).  
  
```xml  
<AppContainerApplication>true</AppContainerApplication> <ApplicationType>Windows Store</ApplicationType> <WindowsTargetPlatformVersion>10.0.10156.0</WindowsTargetPlatformVersion> <WindowsTargetPlatformMinVersion>10.0.10156.0</WindowsTargetPlatformMinVersion> <ApplicationTypeRevision>10.0</ApplicationTypeRevision>  
```  
  
 При создании нового проекта универсальной платформы Windows с помощью Visual Studio эта ошибка не появится.  
  
## См. также  
 [Visual C\+\+ Porting Guide](../porting/porting-to-the-universal-windows-platform-cpp.md)   
 [Разработка приложений для универсальной платформы Windows \(UWP\)](../Topic/Develop%20apps%20for%20the%20Universal%20Windows%20Platform%20\(UWP\).md)
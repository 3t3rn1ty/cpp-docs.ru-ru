---
title: "поток | Microsoft Docs"
ms.custom: ""
ms.date: "12/05/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "language-reference"
f1_keywords: 
  - "thread"
  - "thread_cpp"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "__declspec - ключевое слово [C++], поток"
  - "thread __declspec - ключевое слово"
  - "локальное хранилище потока (TLS)"
  - "TLS (локальное хранилище потока), реализация компилятора"
ms.assetid: 667f2a77-6d1f-4b41-bee8-05e67324fab8
caps.latest.revision: 7
caps.handback.revision: 7
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
---
# поток
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

**Блок, относящийся только к системам Microsoft**  
  
 Модификатор расширенного класса хранения **thread** используется для объявления локальной переменной потока.  В C\+\+11 в качестве переносимого эквивалента можно использовать спецификатор класса хранения [thread\_local](../cpp/storage-classes-cpp.md#thread_local).  
  
## Синтаксис  
  
```  
  
__declspec( thread ) declarator  
```  
  
## Заметки  
 Локальное хранилище потока \(TLS\) — это механизм, с помощью которого в каждом потоке многопоточного процесса выделяется хранилище для хранения данных определенного потока.  В стандартных многопоточных программах данные совместно используются всеми потоками заданного процесса, в то время как локальное хранилище потока является механизмом предоставления данных для конкретного потока.  Полное обсуждение потоков см. в разделе [Многопоточность](../parallel/multithreading-support-for-older-code-visual-cpp.md).  
  
 Объявления локальных переменных потока должны использовать [расширенный синтаксис атрибутов](../cpp/declspec.md) и ключевое слово `__declspec` с ключевым словом **thread**.  В следующем примере кода показано, как объявлять целочисленную локальную переменную потока и инициализировать её некоторым значением:  
  
```  
__declspec( thread ) int tls_i = 1;  
```  
  
 Необходимо соблюдать эти правила при объявлении локальных объектов потока и переменных.  
  
-   Атрибут **thread** можно применить только к классам, объявлениям и определениям данных; **thread** нельзя использовать с объявлениями и определениями функций.  
  
-   Использование атрибута **thread** может помешать [отложенной загрузке](../build/reference/linker-support-for-delay-loaded-dlls.md) DLL\-импортов**.**  
  
-   В системах XP `thread` может работать неправильно, если библиотека DLL использует данные \_\_declspec\(thread\) и динамически загружается через LoadLibrary.  
  
-   Атрибут **thread** можно задать только для элементов данных со статической длительностью хранения.  К ним относятся глобальные объекты данных \(**статические** и `extern`\), локальные статические объекты и статические данные\-члены классов.  Невозможно объявить объекты автоматических данных с использованием атрибута **thread**.  
  
-   Атрибут **thread** следует использовать для объявления и определения локального объекта потока независимо от того, выполняются ли объявление и определение в одном файле или в отдельных файлах.  
  
-   Атрибут **thread** невозможно использовать в качестве модификатора типа.  
  
-   Поскольку разрешено объявление объектов, использующих атрибут **thread**, эти два примера семантически эквивалентны.  
  
    ```  
    // declspec_thread_2.cpp  
    // compile with: /LD  
    __declspec( thread ) class B {  
    public:  
       int data;  
    } BObject;   // BObject declared thread local.  
  
    class B2 {  
    public:  
       int data;  
    };  
    __declspec( thread ) B2 BObject2;   // BObject2 declared thread local.  
    ```  
  
-   В стандартном языке C разрешена инициализация объекта или переменной с помощью выражения, предусматривающего ссылку на себя, но только для объектов нестатической области памяти.  Хотя в C\+\+ обычно разрешена такая динамическая инициализация объекта выражениями с ссылкой на себя, такой тип инициализации не допускается в отношении локальных объектов потока.  Пример:  
  
    ```  
    // declspec_thread_3.cpp  
    // compile with: /LD  
    #define Thread __declspec( thread )  
    int j = j;   // Okay in C++; C error  
    Thread int tls_i = sizeof( tls_i );   // Okay in C and C++  
    ```  
  
     Обратите внимание, что выражение `sizeof`, включающее инициализируемый объект, не является ссылкой на себя и является допустимым как в C, так и в C\+\+.  
  
 **Завершение блока, относящегося только к системам Майкрософт**  
  
## См. также  
 [\_\_declspec](../cpp/declspec.md)   
 [Ключевые слова в C\+\+](../cpp/keywords-cpp.md)   
 [Локальное хранилище потока \(TLS\)](../parallel/thread-local-storage-tls.md)
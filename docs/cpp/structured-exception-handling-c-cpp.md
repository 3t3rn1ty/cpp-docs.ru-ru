---
title: "Структурированной обработки (C/C++) исключений | Документы Microsoft"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology:
- cpp-language
ms.tgt_pltfrm: 
ms.topic: language-reference
dev_langs:
- C++
helpviewer_keywords:
- termination handlers [C++], handling exceptions in C++
- structured exception handling [C++]
- try-catch keyword [C++], exception handlers
- C++ exception handling, termination handlers
- try-catch keyword [C++], termination handlers
- C++ exception handling, exception handlers
ms.assetid: dd3b647d-c269-43a8-aab9-ad1458712976
caps.latest.revision: 14
author: mikeblome
ms.author: mblome
manager: ghogen
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
ms.translationtype: HT
ms.sourcegitcommit: 6ffef5f51e57cf36d5984bfc43d023abc8bc5c62
ms.openlocfilehash: 9098ac4914bdb9e054d4db27c0a5498c0f9d9ea8
ms.contentlocale: ru-ru
ms.lasthandoff: 09/25/2017

---
# <a name="structured-exception-handling-cc"></a>Structured Exception Handling (C/C++)
Хотя Windows и Visual C++ поддерживают структурированную обработку исключений (SEH), настоятельно рекомендуется использовать обработку исключений C++ в соответствии со стандартом ISO, поскольку это повышает переносимость и гибкость кода. Однако в имеющемся коде или в программах определенных видов можно продолжать использовать SEH.  
  
## <a name="microsoft-specific"></a>Блок, относящийся только к системам Microsoft  
  
## <a name="grammar"></a>Грамматика  
 *Оператор try-except* :  
  
 `__try`*составной оператор*  
  
 `__except`( `expression` ) *составной оператор*  
  
## <a name="remarks"></a>Примечания  
 Обработка ошибок SEH позволяет в случае непредвиденного завершения программы корректно освободить все ресурсы, например блоки памяти и файлы. Кроме того, она позволяет обрабатывать конкретные проблемы, например нехватку памяти, при помощи краткого структурированного кода, который не зависит от операторов `goto` или длительного тестирования кодов возврата.  
  
 Операторы try-except и try-finally, которые упоминаются в этом разделе, являются расширениями языка C для систем Microsoft. Они поддерживают SEH, позволяя приложениям получать контроль над программой после событий, которые в иных ситуациях привели бы к завершению выполнения. Хотя обработка ошибок SEH работает с исходными файлами C++, она не была создана специально для этого языка. Если SEH используется в программе на C++, компиляция с помощью [/EH](../build/reference/eh-exception-handling-model.md) параметр — вместе с некоторыми модификаторами, деструкторы для локальных объектов вызываются, однако прочие аспекты выполнения не может привести к непредвиденным. (См. пример далее в этой статье.) В большинстве случаев вместо SHE рекомендуется использовать со стандартом ISO [обработка исключений с ++](../cpp/try-throw-and-catch-statements-cpp.md), который также поддерживается Visual C++. С помощью обработки исключений C++ можно повысить переносимость кода и обрабатывать исключения любого типа.  
  
 При наличии модулей на C, в которых используется SEH, их можно использовать одновременно с модулями на C++, в которых используется обработка исключений C++. Сведения см. в разделе [различия в обработке исключений](../cpp/exception-handling-differences.md).  
  
 Существует два механизма SEH.  
  
-   [Обработчики исключений](../cpp/writing-an-exception-handler.md), которая может реагировать на исключение или отбрасывать его.  
  
-   [Обработчики завершения](../cpp/writing-a-termination-handler.md), которые вызываются, когда исключение вызывает завершение в блоке кода.  
  
 Эти два типа обработчиков различаются, однако тесно взаимодействию в процессе, который называется "развертыванием стека". При возникновении исключения операционная система Windows ищет последний установленный обработчик исключений, который в данный момент активен. Обработчик может выполнить одно из трех действий:  
  
-   не распознать исключение и передать управление другим обработчикам;  
  
-   распознать исключение, но отбросить его;  
  
-   распознать исключение и обработать его.  
  
 Обработчик исключений, распознавший исключение, может находиться за пределами функции, которая выполнялась, когда возникло исключение. В некоторых случаях он может находиться в функции, хранящейся гораздо выше по стеку. Выполняемая в настоящее время функция и все прочие функции в кадре стека завершаются. Во время этого процесса стек "развертывается"; иными словами, из него удаляются локальные переменные и завершенные функции, если они не были определены с ключевым словом `static`.  
  
 По мере развертывания стека операционная система вызывает все обработчики завершения, которые были написаны для каждой функции. При помощи обработчиков завершения можно освободить ресурсы, которые в противном случае оставались бы открытыми ненормального завершения. Если был выполнен вход в критическую секцию, обработчик завершения можно использовать для выхода из нее. Если ожидается завершение программы, можно выполнить другие задачи обслуживания, например закрыть и удалить временные файлы.  
  
 Дополнительные сведения:  
  
-   [Написание обработчика исключений](../cpp/writing-an-exception-handler.md)  
  
-   [Написание обработчика завершения](../cpp/writing-a-termination-handler.md)  
  
-   [Использование структурированной обработки исключений с C++](../cpp/using-structured-exception-handling-with-cpp.md)  
  
## <a name="example"></a>Пример  
 Как уже говорилось выше, деструкторы для локальных объектов вызываются в том случае, если вы используете SEH в программе на C++ и скомпилируйте его с помощью **/EH** с определенными модификаторами, например, **/EHsc** и **/EHa**. Однако если при этом используются исключения C++, то поведение во время выполнения может отличаться от ожидаемого. Это различие в поведении демонстрируется в следующем примере.  
  
```cpp  
#include <stdio.h>  
#include <Windows.h>  
#include <exception>  
  
class TestClass  
{  
public:  
    ~TestClass()  
    {  
        printf("Destroying TestClass!\r\n");  
    }  
};  
  
__declspec(noinline) void TestCPPEX()  
{  
#ifdef CPPEX  
    printf("Throwing C++ exception\r\n");  
    throw std::exception("");  
#else  
    printf("Triggering SEH exception\r\n");  
    volatile int *pInt = 0x00000000;  
    *pInt = 20;  
#endif  
}  
  
__declspec(noinline) void TestExceptions()  
{  
    TestClass d;  
    TestCPPEX();  
}  
  
int main()  
{  
    __try  
    {  
        TestExceptions();  
    }  
    __except(EXCEPTION_EXECUTE_HANDLER)  
    {  
        printf("Executing SEH __except block\r\n");  
    }  
  
    return 0;  
}  
  
```  
  
 При использовании **/EHsc** Чтобы скомпилировать этот код, но локальное управление проверкой `CPPEX` является неопределенным, нет никакие `TestClass` деструктор и вывод выглядит следующим образом:  
  
```Output  
Triggering SEH exception  
Executing SEH __except block  
```  
  
 Если вы используете **/EHsc** для компиляции кода и `CPPEX` определяется с помощью `/DCPPEX` (чтобы создавалось исключение C++), `TestClass` выполнения деструктора и вывод выглядит следующим образом:  
  
```Output  
Throwing C++ exception  
Destroying TestClass!  
Executing SEH __except block  
```  
  
 При использовании **/EHa** для компиляции кода, `TestClass` выполнения деструктора, независимо от того, является ли исключение с помощью `std::throw` или при помощи SEH, которая создавала исключения (`CPPEX` определенные или нет). Вывод выглядит следующим образом.  
  
```Output  
Throwing C++ exception  
Destroying TestClass!  
Executing SEH __except block  
```  
  
 Дополнительные сведения см. в статье [/EH (модель обработки исключений)](../build/reference/eh-exception-handling-model.md).  
  
**Завершение блока, относящегося только к системам Майкрософт**  
  
## <a name="see-also"></a>См. также  
 [Обработка исключений](../cpp/exception-handling-in-visual-cpp.md)   
 [Ключевые слова](../cpp/keywords-cpp.md)   
 [\<exception>](../standard-library/exception.md)   
 [Обработка ошибок и исключений](../cpp/errors-and-exception-handling-modern-cpp.md)   
 [Структурированных исключений, обработки (Windows)](http://msdn.microsoft.com/library/windows/desktop/ms680657.aspx)

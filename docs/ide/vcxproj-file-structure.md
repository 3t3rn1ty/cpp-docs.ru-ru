---
title: VCXPROJ-файл и с расширением PROPS файла структуры | Документы Microsoft
ms.custom: ''
ms.date: 04/27/2017
ms.technology:
- cpp-ide
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- .vcxproj file structure
ms.assetid: 14d0c552-29db-480e-80c1-7ea89d6d8e9c
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: fe466ff9250543a61fde8da41900b152a9874e09
ms.sourcegitcommit: 76b7653ae443a2b8eb1186b789f8503609d6453e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="vcxproj-and-props-file-structure"></a>Структура файла VCXPROJ-файл и с расширением PROPS

MSBuild — система проекта по умолчанию в Visual Studio. При выборе **файл | Новый проект** в Visual C++ создается проекта MSBuild, параметры которого хранятся в XML-файл проекта, который имеет расширение `.vcxproj`. Файл проекта также может импортировать файлы с расширением PROPS и TARGETS-файлы, где можно хранить параметры. В большинстве случаев вам никогда не потребуется вручную изменить файл проекта, а на самом деле не следует изменять его вручную при отсутствии полного понимания MSBuild. По возможности следует использовать страницы свойств Visual Studio для изменения параметров проектов (см. [работа со свойствами проекта](working-with-project-properties.md). Однако в некоторых случаях может потребоваться изменить страницу файла или свойства проекта вручную. Для этих сценариев эта статья содержит основные сведения о структуре файла.

**Внимание!**

Если вы решили изменить VCXPROJ-файл вручную, следует учитывать следующие факты.

1. Структура файла должно соответствовать предписанных форму, которая описана в этой статье.

1. Система проектов Visual C++ в настоящее время не поддерживает подстановочные знаки в элементах проекта. Например это не поддерживается:

   ```xml
   <ClCompile Include="*.cpp"/>
   ```

1. Система проектов Visual C++ в настоящее время не поддерживает макросов в пути к элементам проекта. Например это не поддерживается:

   ```xml
   <ClCompile Include="$(IntDir)\generated.cpp"/>
   ```

1. Чтобы получить свойства проекта правильно добавлены, удалены или изменены при редактировании в **свойства проекта** диалоговое окно, этот файл должен содержать отдельные группы для каждой конфигурации проекта и условия должно быть в форме:

   ```xml
   Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'"
   ```

1. Каждое свойство указывается в группе с правильной метки, как указано в файле свойств правила. Дополнительные сведения см. в разделе [файлы правило xml страницы свойств](property-page-xml-files.md).

## <a name="vcxproj-file-elements"></a>элементы файла VCXPROJ-файл

Можно просмотреть содержимое файла с расширением VCXPROJ, используя любой редактор текста или XML. Просматривать в Visual Studio, щелкнув проект в обозревателе решений, выбрав **выгрузить проект** и выбрав **изменить Foo.vcxproj**.

Первое, что нужно обратить внимание — определенный порядок следования элементов верхнего уровня. Пример:

- После импорта для Microsoft.Cpp.Default.props возникать Большинство групп свойств и определения групп элементов.
- все целевые объекты импортируются в конце файла.
- Существует несколько групп свойств, каждая из которых Уникальная метка, и они встречаются в определенном порядке.

Порядок элементов в файле проекта очень важно, поскольку MSBuild основан на модели последовательного вычисления.  Если имя файла проекта, включая все импортированные расширением PROPS и TARGETS-файлы, состоит из нескольких определений одного свойства, последнего определения переопределяет предыдущий из них. В следующем примере значение «xyz» задается во время компиляции, поскольку MSBUild ядра встречает его последним во время его оценки.

```xml
  <MyProperty>abc</MyProperty>
  <MyProperty>xyz</MyProperty>
```

В следующем фрагменте показан минимальный VCXPROJ-файл. VCXPROJ-файл, созданный средой Visual Studio будет содержать эти элементы верхнего уровня MSBuild, и они будут отображаться в указанном порядке (несмотря на то, что они могут содержать несколько копий каждого такого элемента верхнего уровня). Обратите внимание, что `Label` атрибуты — это произвольные теги, которые используются только в Visual Studio как ориентиров для редактирования; они не имеют никакой другой функции.

```xml
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns='http://schemas.microsoft.com/developer/msbuild/2003'>
   <ItemGroup Label="ProjectConfigurations" />
   <PropertyGroup Label="Globals" />
   <Import Project="$(VCTargetsPath)\Microsoft.Cpp.default.props" />
   <PropertyGroup Label="Configuration" />
   <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
   <ImportGroup Label="ExtensionSettings" />
   <ImportGroup Label="PropertySheets" />
   <PropertyGroup Label="UserMacros" />
   <PropertyGroup />
   <ItemDefinitionGroup />
   <ItemGroup />
   <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
   <ImportGroup Label="ExtensionTargets" />
 </Project>
```

В следующих разделах описаны назначение каждой из этих элементов и почему они упорядочены таким образом:

### <a name="project-element"></a>Элемент проекта

```xml
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns='http://schemas.microsoft.com/developer/msbuild/2003' >
```

`Project` является корневым узлом. Он указывает версию MSBuild для использования, а также целевым объектом по умолчанию для выполнения при передаче этого файла MSBuild.exe.

### <a name="projectconfigurations-itemgroup-element"></a>Элемент ProjectConfigurations ItemGroup

```xml
<ItemGroup Label="ProjectConfigurations" />
```

`ProjectConfigurations` содержит описание конфигурации проекта. Примеры: Debug | Win32, выпуск | Win32, Debug | ARM и т. д. Многие параметры проекта относятся к конкретной конфигурации. Например возможно, требуется задать свойства оптимизации для сборки выпуска, но не отладочное построение.

`ProjectConfigurations` Группы элементов не используется во время построения. Интегрированная среда разработки Visual Studio необходимо для загрузки проекта. Этот элемент группы можно перемещать в файл с расширением PROPS и импортировать в файл с расширением VCXPROJ. Однако в этом случае, если требуется добавлять или удалять конфигурации, необходимо вручную изменить PROPS-файл; нельзя использовать интегрированной среды разработки.

### <a name="projectconfiguration-elements"></a>Элементы конфигурации проекта

В следующем фрагменте показан конфигурации проекта. В этом примере "Debug | x 64' имеет имя конфигурации. Имя конфигурации проекта должно быть в формате $(Configuration)|$(Platform). У узла конфигурации проекта может быть два свойства: Конфигурация и платформа. Эти свойства будут автоматически устанавливается со значениями, указанными ниже при активной конфигурации.

   ```xml
   <ProjectConfiguration Include="Debug|x64">
     <Configuration>Debug</Configuration>
     <Platform>x64</Platform>
   </ProjectConfiguration>
   ```

Ожидает найти конфигурации проекта для любого сочетания значений конфигурации и платформы, используемых во всех элементах конфигурации проекта интегрированной среды разработки. Часто это означает, что проект может иметь смысла проекта конфигурации для выполнения этого требования. Например если проект включает следующие конфигурации:

- Отладка | Win32
- Retail | Win32
- Особая оптимизация 32-разрядных | Win32

затем ей также необходимо предоставить эти конфигурации, несмотря на то, что не имеет смысла для x64 «Особая оптимизация 32-разрядных»:

- Отладка|x64
- Retail | x64
- Особая оптимизация 32-разрядных | x64

Можно отключить построение и развертывание команды для какой-либо настройки в **решения Configuration Manager**.

### <a name="globals-propertygroup-element"></a>Элемент Globals PropertyGroup

```xml
 <PropertyGroup Label="Globals" />
```

`Globals` содержит параметры на уровне проекта как ProjectGuid, RootNamespace и ApplicationType / ApplicationTypeRevision. Последние две часто определяют целевой ОС. Проект можно использовать только целевую одной ОС того, что ссылки проекта и его элементов не могут иметь условий в данный момент. Эти свойства обычно не переопределяются в другом месте в файле проекта. Эта группа не зависящие от конфигурации, и поэтому обычно только одна группа Globals существует в файле проекта.

### <a name="microsoftcppdefaultprops-import-element"></a>Элемент Microsoft.Cpp.default.props Import

```xml
<Import Project="$(VCTargetsPath)\Microsoft.Cpp.default.props" />
```

**Microsoft.Cpp.default.props** свойств поставляется с Visual Studio и не может быть изменено. Он содержит параметры по умолчанию для проекта. Значения по умолчанию могут различаться в зависимости от ApplicationType.

### <a name="configuration-propertygroup-elements"></a>Элементы PropertyGroup конфигурации

```xml
<PropertyGroup Label="Configuration" />
```

Объект `Configuration` группа свойств имеет условие вложенного конфигурации (например `Condition=”'$(Configuration)|$(Platform)'=='Debug|Win32'”`) и поставляется в несколько копий, по одному на конфигурации. Эта группа свойств содержит свойства, которые задаются для конкретной конфигурации. Свойства конфигурации включают PlatformToolset и управляют включения системы вкладок свойств в **файла Microsoft.Cpp.props**. Например, если определено свойство `<CharacterSet>Unicode</CharacterSet>`, затем системных свойств **корпорации Майкрософт. CPP.unicodesupport.props** будут включены. Если проверить **файла Microsoft.Cpp.props**, вы увидите строку: `<Import Condition=”'$(CharacterSet)' == 'Unicode'”   Project=”$(VCTargetsPath)\microsoft.Cpp.unicodesupport.props”/>`.

### <a name="microsoftcppprops-import-element"></a>Импорт файла Microsoft.Cpp.props элемент

```xml
<Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
```

**Файла Microsoft.Cpp.props** свойств (непосредственно или с помощью операции импорта) определяет значения по умолчанию для многих свойств конкретного инструмента, например компилятора оптимизации и предупреждение уровня свойств MIDL-инструмента TypeLibraryName свойство и т. д. Она также импортирует различные страницы свойств системы на основании свойства конфигурации, которые определены в группе свойств непосредственно перед.

### <a name="extensionsettings-importgroup-element"></a>Элемент ExtensionSettings ImportGroup

```xml
<ImportGroup Label="ExtensionSettings" />
```

`ExtensionSettings` Группа содержит импорты для страницы свойств, которые являются частью сборки настройки. Настройку построения определяется до трех файлов: TARGETS-файл, файл с расширением PROPS и XML-файл. Эта группа импорта содержит imports для файла с расширением props.

### <a name="propertysheets-importgroup-elements"></a>Элементы PropertySheets ImportGroup

```xml
<ImportGroup Label="PropertySheets" />
```

`PropertySheets` Группа содержит импорты для страницы свойств пользователя. Это страницы свойств, которые добавляются с помощью диспетчера свойств представления в Visual Studio. Порядок, в котором перечислены эти imports важен, отражаются в диспетчере свойств. Обычно файл проекта содержит несколько экземпляров этого типа импорта группы, для каждой конфигурации проекта.

### <a name="usermacros-propertygroup-element"></a>Элемент UserMacros PropertyGroup

```xml
<PropertyGroup Label="UserMacros" />
```

`UserMacros` содержит свойства создается в качестве переменных, которые используются для настройки процесса построения. Например можно определить пользовательский макрос для определения способа настраиваемые выходные данные как $(CustomOutputPath) и использовать его для определения других переменных. Эта группа свойств содержит такие свойства. Обратите внимание, что в Visual Studio, эта группа не заполняется в файле проекта Visual C++ поддерживает пользовательские макросы для конфигурации. Пользовательские макросы поддерживаются на страницах свойств.

### <a name="per-configuration-propertygroup-elements"></a>Элементы PropertyGroup-конфигурации

```xml
<PropertyGroup />
```

Существует несколько экземпляров группы свойств, по одному на конфигурации для всех конфигураций проекта. Каждая группа свойства должна иметь одно условие конфигурации присоединен. Если отсутствуют какие-либо конфигурации **свойства проекта** диалоговое окно не будет работать правильно. В отличие от выше группы свойств этого класса, не имеет метки. Эта группа содержит параметры конфигурации на уровне проекта. Эти параметры применяются ко всем файлам, которые являются частью группы указанного элемента. Определение элемента настройки построения здесь инициализации метаданных.

Этот элемент PropertyGroup должен следовать после `<Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />` и должно быть не PropertyGroup без метки перед ним (в противном случае изменения свойств проекта не будет работать правильно).

### <a name="per-configuration-itemdefinitiongroup-elements"></a>Элементы ItemDefinitionGroup-конфигурации

```xml
 <ItemDefinitionGroup />
```

Содержит определения элемента. Они должны следовать за те же условия правила, как элементы PropertyGroup без метки для каждой конфигурации.

### <a name="itemgroup-elements"></a>Элементы ItemGroup

```xml
<ItemGroup />
```

Содержит элементы (файлы исходного кода, т. д.) в проекте. Условия не поддерживаются для элементов проекта (то есть типы элементов которых обрабатываются как элементы проекта определениями правил).

Метаданные должны иметь условия конфигурации для каждой конфигурации, даже если они являются все же. Пример:

   ```xml
   <ItemGroup>
     <ClCompile Include="stdafx.cpp">
       <TreatWarningAsError Condition="‘$(Configuration)|$(Platform)’==’Debug|Win32’">true</TreatWarningAsError>
       <TreatWarningAsError Condition="‘$(Configuration)|$(Platform)’==’Debug|x64’">true</TreatWarningAsError>
     </ClCompile>
   </ItemGroup>
   ```

Система проектов Visual C++ в настоящее время не поддерживает подстановочные знаки в элементах проекта.

   ```xml
   <ItemGroup>
     <ClCompile Include="*.cpp"> <!--Error-->
   </ItemGroup>
   ```

Система проектов Visual C++ в настоящее время не поддерживает макросы в элементах проекта.

   ```xml
   <ItemGroup>
     <ClCompile Include="$(IntDir)\generated.cpp"> <!--not guaranteed to work in all scenarios-->
   </ItemGroup>
   ```

Ссылки, указанные в ItemGroup, и имеют следующие ограничения:

- Ссылки не поддерживают условия.
- Ссылается на метаданные не поддерживают условия.

### <a name="microsoftcpptargets-import-element"></a>Элемент Microsoft.Cpp.targets Import

```xml
<Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
```

Определяет (непосредственно или с помощью операции импорта) целевых объектов Visual C++, например сборка, очистка и т. п.

### <a name="extensiontargets-importgroup-element"></a>Элемент ExtensionTargets ImportGroup

```xml
<ImportGroup Label="ExtensionTargets" />
```

Эта группа содержит imports для настройки построения целевых файлов.

## <a name="impact-of-incorrect-ordering"></a>Неправильное упорядочение влияние

Интегрированная среда разработки Visual Studio зависит от того, having файл проекта, упорядочение описанных выше. Например при определении значения свойства на страницах свойств, интегрированной среды разработки обычно поместит определения свойства в группе свойств с пустой меткой. Это гарантирует, что значения по умолчанию, обозначенных страницы свойств системы переопределяются пользовательские значения. Аналогичным образом так как они используют свойства, определенные выше, и, поскольку они обычно не определяются свойства сами целевые файлы импортируются в конце. Аналогичным образом, пользовательский лист свойств импортируются после страниц свойств системы (включены через **файла Microsoft.Cpp.props**). Это гарантирует, что пользователь может переопределить все значения по умолчанию, обозначенных страницы свойств системы.

Если VCXPROJ-файл не соответствует данным макетом, результаты построения может оказаться как ожидалось. Например при импорте системных свойств ошибочно после страниц свойств, определенных пользователем пользовательские настройки будут переопределены страницы свойств системы.

Даже возможности во время разработки IDE зависит в некоторой степени на правильный порядок элементов. Например, если VCXPROJ-файл не имеет `PropertySheets` группу импорта, интегрированной среды разработки, не может быть возможность определить, куда поместить новую страницу свойств, созданных пользователем в **диспетчер свойств**. Это может привести к страница пользователя, который был переопределен листом системы. Несмотря на то, что эвристики, используемые в интегрированной среде разработки может выдержать небольших несоответствий в формате файла с расширением VCXPROJ, настоятельно рекомендуется не будет соответствовать структуре, приведенными выше в этой статье.

## <a name="how-the-ide-uses-element-labels"></a>Как IDE использует метки элемента

В Интегрированной среде разработки при установке **UseOfAtl** свойство на странице общих свойств, он записывается в группу свойств конфигурации в файле проекта при **TargetName** же странице свойств записывается в группе свойств без метки для каждой конфигурации. Visual Studio анализирует XML-файл на странице свойств сведения о том, где каждая запись. Для **Общие** страницы свойств (при условии, что у вас есть англоязычная версия Visual Studio Enterprise Edition), это файл `%ProgramFiles(x86)%\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\VC\VCTargets\1033\general.xml`. Правило файла XML страницы свойств определяет статические данные о правиле и все его свойства. Один такой фрагмент данных — это предпочтительный положение свойство правила в конечный файл (файл, который будет записан его значение). Желаемое положение задается атрибут метки в элементах файлов проекта.

## <a name="property-sheet-layout"></a>Свойство таблице макета

В следующем фрагменте XML является минимальной вида файл (с расширением PROPS) страницы свойств. Это похоже на VCXPROJ-файл и функциональные возможности с расширением PROPS элементов может быть выведен из предыдущего рассмотрения.

```xml
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ImportGroup Label="PropertySheets" />
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <ItemDefinitionGroup />
  <ItemGroup />
</Project>
```

Чтобы сделать вкладку свойств, скопировать один из файлов с расширением PROPS в папке VCTargets и измените его для ваших целей. Для выпуска Visual Studio Enterprise 2017 г. — путь по умолчанию VCTargets `%ProgramFiles%\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\VC\VCTargets`.

## <a name="see-also"></a>См. также

[Работа со свойствами проектов](working-with-project-properties.md)  
[XML-файлы страницы свойств](property-page-xml-files.md)  

---
title: "Оператор try-finally (C) | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "try_cpp"
  - "try"
  - "finally"
  - "finally_cpp"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "__finally - ключевое слово [C]"
  - "__finally - ключевое слово [C], try-finally - синтаксис оператора"
  - "структурированная обработка исключений, try-finally"
  - "try-catch - ключевое слово [C]"
  - "try-catch - ключевое слово [C], try-finally - ключевое слово [C]"
  - "try-finally - ключевое слово [C]"
ms.assetid: 514400c1-c322-4bf3-9e48-3047240b8a82
caps.latest.revision: 7
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 7
---
# Оператор try-finally (C)
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

**Блок, относящийся только к системам Microsoft**  
  
 Оператор `try-finally` является расширением Microsoft для языка C и позволяет приложениям гарантировать выполнение кода очистки при прерывании выполнения блока кода.  Очистка включает такие задачи, как отмена распределения памяти, закрытие файлов и освобождение их дескрипторов.  Оператор `try-finally` особенно полезен для подпрограмм, в которых в нескольких местах выполняется проверка на наличие ошибок, способных вызвать преждевременное возвращение из подпрограммы.  
  
 *оператор\-try\-finally*:  
 **\_\_try**  *составной\-оператор*  
  
 **\_\_finally**  *составной\-оператор*  
  
 Составной оператор после предложения `__try` представляет собой защищенный раздел.  Составной оператор после предложения `__finally` является обработчиком завершения.  Такой обработчик определяет набор действий, выполняемых при выходе из защищенного раздела, независимо от того, происходит ли выход в результате исключения \(ненормальное завершение\) или в результате стандартной передачи управления дальше \(нормальное завершение\).  
  
 Управление достигает оператора `__try` в процессе обычного последовательного выполнения \(передачи управления дальше\).  При достижении оператора `__try` становится активным соответствующий обработчик.  Выполнение происходит следующим образом:  
  
1.  Сначала выполняется защищенный раздел.  
  
2.  Вызывается обработчик завершения.  
  
3.  По окончании работы обработчика завершения выполнение продолжается после оператора `__finally`.  Независимо от того, как завершается защищенный раздел \(например, оператором `goto` выхода из защищенного тела или оператором `return`\), перед выходом потока управления из защищенного раздела выполняется обработчик завершения.  
  
 В блоке оператора `try-finally` можно использовать ключевое слово `__leave`.  Результат использования `__leave` — переход в конец блока `try-finally`.  Сразу же выполняется обработчик завершения.  Хотя для получения того же результата можно использовать оператор `goto`, он \(оператор `goto`\) приводит к освобождению стека.  Оператор `__leave` более эффективен, поскольку не вызывает освобождение стека.  
  
 Выход из оператора `try-finally` с помощью оператора `return` или функции времени выполнения `longjmp` считается ненормальным завершением.  Переход к оператору `__try` недопустим, но допустим выход из него.  Все операторы `__finally`, которые активны между исходной точкой и точкой назначения, должны быть выполнены.  Это называется локальной раскруткой.  
  
 Если при выполнении оператора `try-finally` процесс удаляется, обработчик завершения не вызывается.  
  
> [!NOTE]
>  Структурированная обработка исключений поддерживается с исходными файлами C и C\+\+.  Однако она не предназначена специально для C\+\+.  Для того чтобы ваш код лучше переносился, лучше использовать механизм обработки исключений языка C\+\+.  Кроме того, механизм обработки исключений C\+\+ обеспечивает намного более высокую гибкость, поскольку может обрабатывать исключения любого типа.  
  
> [!NOTE]
>  Для программ C\+\+ вместо структурированной обработки исключений следует использовать обработку исключений C\+\+.  Дополнительные сведения см. в разделе [Обработка исключений](../cpp/exception-handling-in-visual-cpp.md) *Справочника по языку С\+\+*.  
  
 Чтобы узнать, как работает оператор `try-finally`, обратитесь к примеру, приведенному для [оператора try\-except](../c-language/try-except-statement-c.md).  
  
 **Завершение блока, относящегося только к системам Microsoft**  
  
## См. также  
 [Оператор try\-finally](../cpp/try-finally-statement.md)
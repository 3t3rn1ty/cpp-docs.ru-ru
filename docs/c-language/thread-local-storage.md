---
title: "локальное хранилище потока | Microsoft Docs"
ms.custom: ""
ms.date: "11/04/2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-cpp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "C++"
helpviewer_keywords: 
  - "хранение, локальная память потока"
  - "атрибут класса хранения потока"
  - "локальная память потока"
  - "локальные переменные потока"
  - "TLS (локальное хранилище потока)"
ms.assetid: a0f1b109-c953-4079-aa10-e47f5483173d
caps.latest.revision: 10
author: "mikeblome"
ms.author: "mblome"
manager: "ghogen"
caps.handback.revision: 10
---
# локальное хранилище потока
[!INCLUDE[vs2017banner](../assembler/inline/includes/vs2017banner.md)]

**Блок, относящийся только к системам Microsoft**  
  
 Локальное хранилище потока \(TLS\) — это механизм, с помощью которого в каждом потоке многопоточного процесса выделяется хранилище для хранения данных определенного потока.  В стандартных многопоточных программах данные совместно используются всеми потоками заданного процесса, в то время как локальное хранилище потока является механизмом предоставления данных для конкретного потока.  Полное описание потоков см. в разделе [Процессы и потоки](http://msdn.microsoft.com/library/windows/desktop/ms684841) в [!INCLUDE[winsdkshort](../atl/reference/includes/winsdkshort_md.md)].  
  
 Язык Microsoft C включает расширенный атрибут класса хранения, поток, который используется вместе с ключевым словом \_\_declspec для объявления локальной переменной потока.  В следующем примере кода показано, как объявлять целочисленную локальную переменную потока и инициализировать её некоторым значением:  
  
```  
__declspec( thread ) int tls_i = 1;  
```  
  
 При объявлении статистически связанных локальных переменных потока необходимо соблюдать следующие рекомендации.  
  
-   Использование **\_\_declspec\(thread\)** может повлиять на [отложенную загрузку](../build/reference/linker-support-for-delay-loaded-dlls.md) импортов DLL**.**  
  
-   Атрибут thread можно применять только к объявлениям и определениям данных.  Его невозможно использовать в объявлениях или определениях функций.  Например, следующий код вызовет ошибку компиляции:  
  
    ```  
    #define Thread   __declspec( thread )  
    Thread void func();      /* Error */  
    ```  
  
-   Атрибут thread можно задать только для элементов данных со статической длительностью хранения.  Сюда входят глобальные \(статистические и внешние\) данные и локальные статические данные.  Автоматические данные невозможно объявить с помощью атрибута потока.  Например, следующий код приведет к ошибкам компилятора.  
  
    ```  
    #define Thread   __declspec( thread )  
    void func1()  
    {  
        Thread int tls_i;            /* Error */  
    }  
  
    int func2( Thread int tls_i )    /* Error */  
    {  
       return tls_i;  
    }  
    ```  
  
-   Атрибут потока следует использовать для объявления и определения локальных данных потока независимо от того, выполняются ли объявление и определение в одном файле или в отдельных файлах.  Например, следующий код вызывает ошибку:  
  
    ```  
    #define Thread   __declspec( thread )  
    extern int tls_i;     /* This generates an error, because the   */  
    int Thread tls_i;     /* declaration and the definition differ. */  
    ```  
  
-   Атрибут thread невозможно использовать в качестве модификатора типа.  Например, следующий код вызовет ошибку компиляции:  
  
    ```  
    char *ch __declspec( thread );      /* Error */  
    ```  
  
-   Адрес локальной переменной потока не является постоянным, и любое выражение с таким адресом не является константным.  Это означает, что адрес локальной переменной потока невозможно использовать в качестве инициализатора указателя.  Например, компилятор отмечает следующий код как ошибочный.  
  
    ```  
    #define Thread   __declspec( thread )  
    Thread int tls_i;  
    int *p = &tls_i;      /* Error */  
    ```  
  
-   В языке C разрешена инициализация переменной с помощью выражения со ссылкой на себя, но только для объектов нестатической области памяти.  Пример:  
  
    ```  
    #define Thread   __declspec( thread )  
    Thread int tls_i = tls_i;             /* Error */  
    int j = j;                            /* Error */  
    Thread int tls_i = sizeof( tls_i )    /* Okay  */  
    ```  
  
     Обратите внимание, что выражение sizeof, включающее инициализируемую переменную, не является ссылкой на себя и является допустимым.  
  
-   Использование **\_\_declspec\(thread\)** может повлиять на [отложенную загрузку](../build/reference/linker-support-for-delay-loaded-dlls.md) импортов DLL**.**  
  
 Дополнительные сведения об использовании атрибута потока см. в разделе [Многопоточность](../parallel/multithreading-support-for-older-code-visual-cpp.md).  
  
 **Завершение блока, относящегося только к системам Майкрософт**  
  
## См. также  
 [Расширенные атрибуты классов хранения в C](../c-language/c-extended-storage-class-attributes.md)